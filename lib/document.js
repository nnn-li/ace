import { EventEmitterClass } from './lib/event_emitter';
import { Range } from './range';
import { Anchor } from './anchor';
var $split = (function () {
    function foo(text) {
        return text.replace(/\r\n|\r/g, "\n").split("\n");
    }
    function bar(text) {
        return text.split(/\r\n|\r|\n/);
    }
    if ("aaa".split(/a/).length === 0) {
        return foo;
    }
    else {
        return bar;
    }
})();
function $clipPosition(doc, position) {
    var length = doc.getLength();
    if (position.row >= length) {
        position.row = Math.max(0, length - 1);
        position.column = doc.getLine(length - 1).length;
    }
    else if (position.row < 0) {
        position.row = 0;
    }
    return position;
}
export class Document extends EventEmitterClass {
    constructor(text) {
        super();
        this.$lines = [];
        this.$autoNewLine = "";
        this.$newLineMode = "auto";
        if (text.length === 0) {
            this.$lines = [""];
        }
        else if (Array.isArray(text)) {
            this._insertLines(0, text);
        }
        else {
            this.insert({ row: 0, column: 0 }, text);
        }
    }
    setValue(text) {
        var len = this.getLength();
        this.remove(new Range(0, 0, len, this.getLine(len - 1).length));
        this.insert({ row: 0, column: 0 }, text);
    }
    getValue() {
        return this.getAllLines().join(this.getNewLineCharacter());
    }
    createAnchor(row, column) {
        return new Anchor(this, row, column);
    }
    $detectNewLine(text) {
        var match = text.match(/^.*?(\r\n|\r|\n)/m);
        this.$autoNewLine = match ? match[1] : "\n";
        this._signal("changeNewLineMode");
    }
    getNewLineCharacter() {
        switch (this.$newLineMode) {
            case "windows":
                return "\r\n";
            case "unix":
                return "\n";
            default:
                return this.$autoNewLine || "\n";
        }
    }
    setNewLineMode(newLineMode) {
        if (this.$newLineMode === newLineMode)
            return;
        this.$newLineMode = newLineMode;
        this._signal("changeNewLineMode");
    }
    getNewLineMode() {
        return this.$newLineMode;
    }
    isNewLine(text) {
        return (text == "\r\n" || text == "\r" || text == "\n");
    }
    getLine(row) {
        return this.$lines[row] || "";
    }
    getLines(firstRow, lastRow) {
        return this.$lines.slice(firstRow, lastRow + 1);
    }
    getAllLines() {
        return this.getLines(0, this.getLength());
    }
    getLength() {
        return this.$lines.length;
    }
    getTextRange(range) {
        if (range.start.row == range.end.row) {
            return this.getLine(range.start.row).substring(range.start.column, range.end.column);
        }
        var lines = this.getLines(range.start.row, range.end.row);
        lines[0] = (lines[0] || "").substring(range.start.column);
        var l = lines.length - 1;
        if (range.end.row - range.start.row == l) {
            lines[l] = lines[l].substring(0, range.end.column);
        }
        return lines.join(this.getNewLineCharacter());
    }
    insert(position, text) {
        if (!text || text.length === 0)
            return position;
        position = $clipPosition(this, position);
        if (this.getLength() <= 1) {
            this.$detectNewLine(text);
        }
        var lines = $split(text);
        var firstLine = lines.splice(0, 1)[0];
        var lastLine = lines.length == 0 ? null : lines.splice(lines.length - 1, 1)[0];
        position = this.insertInLine(position, firstLine);
        if (lastLine !== null) {
            position = this.insertNewLine(position);
            position = this._insertLines(position.row, lines);
            position = this.insertInLine(position, lastLine || "");
        }
        return position;
    }
    insertLines(row, lines) {
        if (row >= this.getLength())
            return this.insert({ row: row, column: 0 }, "\n" + lines.join("\n"));
        return this._insertLines(Math.max(row, 0), lines);
    }
    _insertLines(row, lines) {
        if (lines.length == 0)
            return { row: row, column: 0 };
        while (lines.length > 0xF000) {
            var end = this._insertLines(row, lines.slice(0, 0xF000));
            lines = lines.slice(0xF000);
            row = end.row;
        }
        var args = [row, 0];
        args.push.apply(args, lines);
        this.$lines.splice.apply(this.$lines, args);
        var range = new Range(row, 0, row + lines.length, 0);
        var delta = {
            action: "insertLines",
            range: range,
            lines: lines
        };
        this._signal("change", { data: delta });
        return range.end;
    }
    insertNewLine(position) {
        position = $clipPosition(this, position);
        var line = this.$lines[position.row] || "";
        this.$lines[position.row] = line.substring(0, position.column);
        this.$lines.splice(position.row + 1, 0, line.substring(position.column, line.length));
        var end = {
            row: position.row + 1,
            column: 0
        };
        var delta = {
            action: "insertText",
            range: Range.fromPoints(position, end),
            text: this.getNewLineCharacter()
        };
        this._signal("change", { data: delta });
        return end;
    }
    insertInLine(position, text) {
        if (text.length == 0)
            return position;
        var line = this.$lines[position.row] || "";
        this.$lines[position.row] = line.substring(0, position.column) + text + line.substring(position.column);
        var end = {
            row: position.row,
            column: position.column + text.length
        };
        var delta = { action: "insertText", range: Range.fromPoints(position, end), text: text };
        this._signal("change", { data: delta });
        return end;
    }
    remove(range) {
        if (!(range instanceof Range))
            range = Range.fromPoints(range.start, range.end);
        range.start = $clipPosition(this, range.start);
        range.end = $clipPosition(this, range.end);
        if (range.isEmpty())
            return range.start;
        var firstRow = range.start.row;
        var lastRow = range.end.row;
        if (range.isMultiLine()) {
            var firstFullRow = range.start.column == 0 ? firstRow : firstRow + 1;
            var lastFullRow = lastRow - 1;
            if (range.end.column > 0)
                this.removeInLine(lastRow, 0, range.end.column);
            if (lastFullRow >= firstFullRow)
                this._removeLines(firstFullRow, lastFullRow);
            if (firstFullRow != firstRow) {
                this.removeInLine(firstRow, range.start.column, this.getLine(firstRow).length);
                this.removeNewLine(range.start.row);
            }
        }
        else {
            this.removeInLine(firstRow, range.start.column, range.end.column);
        }
        return range.start;
    }
    removeInLine(row, startColumn, endColumn) {
        if (startColumn === endColumn)
            return;
        var range = new Range(row, startColumn, row, endColumn);
        var line = this.getLine(row);
        var removed = line.substring(startColumn, endColumn);
        var newLine = line.substring(0, startColumn) + line.substring(endColumn, line.length);
        this.$lines.splice(row, 1, newLine);
        var delta = {
            action: "removeText",
            range: range,
            text: removed
        };
        this._signal("change", { data: delta });
        return range.start;
    }
    removeLines(firstRow, lastRow) {
        if (firstRow < 0 || lastRow >= this.getLength())
            return this.remove(new Range(firstRow, 0, lastRow + 1, 0));
        return this._removeLines(firstRow, lastRow);
    }
    _removeLines(firstRow, lastRow) {
        var range = new Range(firstRow, 0, lastRow + 1, 0);
        var removed = this.$lines.splice(firstRow, lastRow - firstRow + 1);
        var delta = {
            action: "removeLines",
            range: range,
            nl: this.getNewLineCharacter(),
            lines: removed
        };
        this._signal("change", { data: delta });
        return removed;
    }
    removeNewLine(row) {
        var firstLine = this.getLine(row);
        var secondLine = this.getLine(row + 1);
        var range = new Range(row, firstLine.length, row + 1, 0);
        var line = firstLine + secondLine;
        this.$lines.splice(row, 2, line);
        var delta = {
            action: "removeText",
            range: range,
            text: this.getNewLineCharacter()
        };
        this._signal("change", { data: delta });
    }
    replace(range, text) {
        if (!(range instanceof Range)) {
            range = Range.fromPoints(range.start, range.end);
        }
        if (text.length == 0 && range.isEmpty())
            return range.start;
        if (text == this.getTextRange(range))
            return range.end;
        this.remove(range);
        if (text) {
            var end = this.insert(range.start, text);
        }
        else {
            end = range.start;
        }
        return end;
    }
    applyDeltas(deltas) {
        for (var i = 0; i < deltas.length; i++) {
            var delta = deltas[i];
            var range = Range.fromPoints(delta.range.start, delta.range.end);
            if (delta.action == "insertLines")
                this.insertLines(range.start.row, delta.lines);
            else if (delta.action == "insertText")
                this.insert(range.start, delta.text);
            else if (delta.action == "removeLines")
                this._removeLines(range.start.row, range.end.row - 1);
            else if (delta.action == "removeText")
                this.remove(range);
        }
    }
    revertDeltas(deltas) {
        for (var i = deltas.length - 1; i >= 0; i--) {
            var delta = deltas[i];
            var range = Range.fromPoints(delta.range.start, delta.range.end);
            if (delta.action == "insertLines")
                this._removeLines(range.start.row, range.end.row - 1);
            else if (delta.action == "insertText")
                this.remove(range);
            else if (delta.action == "removeLines")
                this._insertLines(range.start.row, delta.lines);
            else if (delta.action == "removeText")
                this.insert(range.start, delta.text);
        }
    }
    indexToPosition(index, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        for (var i = startRow || 0, l = lines.length; i < l; i++) {
            index -= lines[i].length + newlineLength;
            if (index < 0)
                return { row: i, column: index + lines[i].length + newlineLength };
        }
        return { row: l - 1, column: lines[l - 1].length };
    }
    positionToIndex(pos, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        var index = 0;
        var row = Math.min(pos.row, lines.length);
        for (var i = startRow || 0; i < row; ++i)
            index += lines[i].length + newlineLength;
        return index + pos.column;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9jdW1lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZG9jdW1lbnQudHMiXSwibmFtZXMiOlsiZm9vIiwiYmFyIiwiJGNsaXBQb3NpdGlvbiIsIkRvY3VtZW50IiwiRG9jdW1lbnQuY29uc3RydWN0b3IiLCJEb2N1bWVudC5zZXRWYWx1ZSIsIkRvY3VtZW50LmdldFZhbHVlIiwiRG9jdW1lbnQuY3JlYXRlQW5jaG9yIiwiRG9jdW1lbnQuJGRldGVjdE5ld0xpbmUiLCJEb2N1bWVudC5nZXROZXdMaW5lQ2hhcmFjdGVyIiwiRG9jdW1lbnQuc2V0TmV3TGluZU1vZGUiLCJEb2N1bWVudC5nZXROZXdMaW5lTW9kZSIsIkRvY3VtZW50LmlzTmV3TGluZSIsIkRvY3VtZW50LmdldExpbmUiLCJEb2N1bWVudC5nZXRMaW5lcyIsIkRvY3VtZW50LmdldEFsbExpbmVzIiwiRG9jdW1lbnQuZ2V0TGVuZ3RoIiwiRG9jdW1lbnQuZ2V0VGV4dFJhbmdlIiwiRG9jdW1lbnQuaW5zZXJ0IiwiRG9jdW1lbnQuaW5zZXJ0TGluZXMiLCJEb2N1bWVudC5faW5zZXJ0TGluZXMiLCJEb2N1bWVudC5pbnNlcnROZXdMaW5lIiwiRG9jdW1lbnQuaW5zZXJ0SW5MaW5lIiwiRG9jdW1lbnQucmVtb3ZlIiwiRG9jdW1lbnQucmVtb3ZlSW5MaW5lIiwiRG9jdW1lbnQucmVtb3ZlTGluZXMiLCJEb2N1bWVudC5fcmVtb3ZlTGluZXMiLCJEb2N1bWVudC5yZW1vdmVOZXdMaW5lIiwiRG9jdW1lbnQucmVwbGFjZSIsIkRvY3VtZW50LmFwcGx5RGVsdGFzIiwiRG9jdW1lbnQucmV2ZXJ0RGVsdGFzIiwiRG9jdW1lbnQuaW5kZXhUb1Bvc2l0aW9uIiwiRG9jdW1lbnQucG9zaXRpb25Ub0luZGV4Il0sIm1hcHBpbmdzIjoiT0E4Qk8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQjtPQUNoRCxFQUFFLEtBQUssRUFBRSxNQUFNLFNBQVM7T0FDeEIsRUFBRSxNQUFNLEVB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QSxDQUFDQTtJQU9EYixZQUFZQSxDQUFDQSxLQUF1RkE7UUFDaEdjLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLElBQUlBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1lBQ25DQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxTQUFTQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxFQUFFQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUN6RkEsQ0FBQ0E7UUFDREEsSUFBSUEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDMURBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLENBQUNBLFNBQVNBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQzFEQSxJQUFJQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUN6QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdkNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLEVBQUVBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ3ZEQSxDQUFDQTtRQUNEQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEVBQUVBLENBQUNBLENBQUNBO0lBQ2xEQSxDQUFDQTtJQVNEZCxNQUFNQSxDQUFDQSxRQUF5Q0EsRUFBRUEsSUFBWUE7UUFDMURlLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLE1BQU1BLEtBQUtBLENBQUNBLENBQUNBO1lBQzNCQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQTtRQUVwQkEsUUFBUUEsR0FBR0EsYUFBYUEsQ0FBQ0EsSUFBSUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFHekNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3hCQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUM5QkEsQ0FBQ0E7UUFFREEsSUFBSUEsS0FBS0EsR0FBR0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDekJBLElBQUlBLFNBQVNBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ3RDQSxJQUFJQSxRQUFRQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxDQUFDQSxHQUFHQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUUvRUEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsUUFBUUEsRUFBRUEsU0FBU0EsQ0FBQ0EsQ0FBQ0E7UUFDbERBLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLEtBQUtB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S0FBS0EsR0FBR0EsS0FBS0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFckRBLEtBQUtBLENBQUNBLEtBQUtBLEdBQUdBLGFBQWFBLENBQUNBLElBQUlBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBQy9DQSxLQUFLQSxDQUFDQSxHQUFHQSxHQUFHQSxhQUFhQSxDQUFDQSxJQUFJQSxFQUFFQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUUzQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7WUFDaEJBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBO1FBRXZCQSxJQUFJQSxRQUFRQSxHQUFHQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQTtRQUMvQkEsSUFBSUEsT0FBT0EsR0FBR0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7UUFFNUJBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1lBQ3RCQSxJQUFJQSxZQUFZQSxHQUFHQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxDQUFDQSxHQUFHQSxRQUFRQSxHQUFHQSxRQUFRQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNyRUEsSUFBSUEsV0FBV0EsR0FBR0EsT0FBT0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFFOUJBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBO2dCQUNyQkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0EsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFFcERBLEVBQUVBLENBQUNBLENBQUNBLFdBQVdBLElBQUlBLFlBQVlBLENBQUNBO2dCQUM1QkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsWUFBWUEsRUFBRUEsV0FBV0EsQ0FBQ0EsQ0FBQ0E7WUFFakRBLEVBQUVBLENBQUNBLENBQUNBLFlBQVlBLElBQUlBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO2dCQUMzQkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsUUFBUUEsRUFBRUEsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7Z0JBQy9FQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUN4Q0EsQ0FBQ0E7UUFDTEEsQ0FBQ0E7UUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDRkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsUUFBUUEsRUFBRUEsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDdEVBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBO0lBQ3ZCQSxDQUFDQTtJQVVEcEIsWUFBWUEsQ0FBQ0EsR0FBV0EsRUFBRUEsV0FBbUJBLEVBQUVBLFNBQWlCQTtRQUM1RHFCLEVBQUVBLENBQUNBLENBQUNBLFdBQVdBLEtBQUtBLFNBQVNBLENBQUNBO1lBQzFCQSxNQUFNQSxDQUFDQTtRQUVYQSxJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxXQUFXQSxFQUFFQSxHQUFHQSxFQUFFQSxTQUFTQSxDQUFDQSxDQUFDQTtRQUN4REEsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDN0JBLElBQUlBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLFdBQVdBLEVBQUVBLFNBQVNBLENBQUNBLENBQUNBO1FBQ3JEQSxJQUFJQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxXQUFXQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxTQUFTQSxFQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUN0RkEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsRUFBRUEsT0FBT0EsQ0FBQ0EsQ0FBQ0E7UUFFcENBLElBQUlBLEtBQUtBLEdBQUdBO1lBQ1JBLE1BQU1BLEVBQUVBLFlBQVlBO1lBQ3BCQSxLQUFLQSxFQUFFQSxLQUFLQTtZQUNaQSxJQUFJQSxFQUFFQSxPQUFPQTtTQUNoQkEsQ0FBQ0E7UUFDRkEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsRUFBRUEsSUFBSUEsRUFBRUEsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDeENBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBO0lBQ3ZCQSxDQUFDQTtJQVNEckIsV0FBV0EsQ0FBQ0EsUUFBZ0JBLEVBQUVBLE9BQWVBO1FBQ3pDc0IsRUFBRUEsQ0FBQ0EsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsSUFBSUEsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0E7WUFDNUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLEtBQUtBLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBLEVBQUVBLE9BQU9BLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQy9EQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxRQUFRQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFDQTtJQUNoREEsQ0FBQ0E7SUFFT3RCLFlB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LElBQUlBLGFBQWFBLENBQUNBO2dCQUNuQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDMURBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLElBQUlBLFlBQVlBLENBQUNBO2dCQUNsQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFDM0JBLENBQUNBO0lBQ0xBLENBQUNBO0lBS0QxQixZQUFZQSxDQUFDQSxNQUFNQTtRQUNmMkIsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDMUNBLElBQUlBLEtBQUtBLEdBQUdBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBRXRCQSxJQUFJQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxVQUFVQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxFQUFFQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUVqRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsYUFBYUEsQ0FBQ0E7Z0JBQzlCQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMxREEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsWUFBWUEsQ0FBQ0E7Z0JBQ2xDQSxJQUFJQSxD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IERpc3RyaWJ1dGVkIHVuZGVyIHRoZSBCU0QgbGljZW5zZTpcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTAsIEFqYXgub3JnIEIuVi5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBcbiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dFxuICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLlxuICogICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGVcbiAqICAgICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG4gKiAgICAgKiBOZWl0aGVyIHRoZSBuYW1lIG9mIEFqYXgub3JnIEIuVi4gbm9yIHRoZVxuICogICAgICAgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHNcbiAqICAgICAgIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLlxuICogXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkRcbiAqIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEXG4gKiBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFXG4gKiBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBBSkFYLk9SRyBCLlYuIEJFIExJQUJMRSBGT1IgQU5ZXG4gKiBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFU1xuICogKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTO1xuICogTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EXG4gKiBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVNcbiAqIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICpcbiAqICoqKioqIEVORCBMSUNFTlNFIEJMT0NLICoqKioqICovXG5cbmltcG9ydCB7IEV2ZW50RW1pdHRlckNsYXNzIH0gZnJvbSAnLi9saWIvZXZlbnRfZW1pdHRlcic7XG5pbXBvcnQgeyBSYW5nZSB9IGZyb20gJy4vcmFuZ2UnO1xuaW1wb3J0IHsgQW5jaG9yIH0gZnJvbSAnLi9hbmNob3InO1xuXG52YXIgJHNwbGl0OiAodGV4dDogc3RyaW5nKSA9PiBzdHJpbmdbXSA9IChmdW5jdGlvbigpIHtcbiAgICBmdW5jdGlvbiBmb28odGV4dDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9cXHJcXG58XFxyL2csIFwiXFxuXCIpLnNwbGl0KFwiXFxuXCIpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBiYXIodGV4dDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGV4dC5zcGxpdCgvXFxyXFxufFxccnxcXG4vKTtcbiAgICB9XG4gICAgaWYgKFwiYWFhXCIuc3BsaXQoL2EvKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGZvbztcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBiYXI7XG4gICAgfVxufSkoKTtcblxuZnVuY3Rpb24gJGNsaXBQb3NpdGlvbihkb2M6IERvY3VtZW50LCBwb3NpdGlvbjogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfSkge1xuICAgIHZhciBsZW5ndGggPSBkb2MuZ2V0TGVuZ3RoKCk7XG4gICAgaWYgKHBvc2l0aW9uLnJvdyA+PSBsZW5ndGgpIHtcbiAgICAgICAgcG9zaXRpb24ucm93ID0gTWF0aC5tYXgoMCwgbGVuZ3RoIC0gMSk7XG4gICAgICAgIHBvc2l0aW9uLmNvbHVtbiA9IGRvYy5nZXRMaW5lKGxlbmd0aCAtIDEpLmxlbmd0aDtcbiAgICB9IGVsc2UgaWYgKHBvc2l0aW9uLnJvdyA8IDApIHtcbiAgICAgICAgcG9zaXRpb24ucm93ID0gMDtcbiAgICB9XG4gICAgcmV0dXJuIHBvc2l0aW9uO1xufVxuXG4vKipcbiAqIENvbnRhaW5zIHRoZSB0ZXh0IG9mIHRoZSBkb2N1bWVudC4gRG9jdW1lbnQgY2FuIGJlIGF0dGFjaGVkIHRvIHNldmVyYWwgW1tFZGl0U2Vzc2lvbiBgRWRpdFNlc3Npb25gXV1zLiBcbiAqXG4gKiBBdCBpdHMgY29yZSwgYERvY3VtZW50YHMgYXJlIGp1c3QgYW4gYXJyYXkgb2Ygc3RyaW5ncywgd2l0aCBlYWNoIHJvdyBpbiB0aGUgZG9jdW1lbnQgbWF0Y2hpbmcgdXAgdG8gdGhlIGFycmF5IGluZGV4LlxuICpcbiAqIEBjbGFzcyBEb2N1bWVudFxuICpcbiAqIENyZWF0ZXMgYSBuZXcgYERvY3VtZW50YC4gSWYgYHRleHRgIGlzIGluY2x1ZGVkLCB0aGUgYERvY3VtZW50YCBjb250YWlucyB0aG9zZSBzdHJpbmdzOyBvdGhlcndpc2UsIGl0J3MgZW1wdHkuXG4gKiBAcGFyYW0ge1N0cmluZyB8IEFycmF5fSB0ZXh0IFRoZSBzdGFydGluZyB0ZXh0XG4gKiBAY29uc3RydWN0b3JcbiAqL1xuLy8gRklYTUU6IFRoaXMgaXMgdGhlIG9ubHkgZXhwb3J0LCBtYWtlIGl0IHRoZSBkZWZhdWx0LlxuZXhwb3J0IGNsYXNzIERvY3VtZW50IGV4dGVuZHMgRXZlbnRFbWl0dGVyQ2xhc3Mge1xuICAgIHByaXZhdGUgJGxpbmVzOiBzdHJpbmdbXSA9IFtdO1xuICAgIHByaXZhdGUgJGF1dG9OZXdMaW5lOiBzdHJpbmcgPSBcIlwiO1xuICAgIHByaXZhdGUgJG5ld0xpbmVNb2RlOiBzdHJpbmcgPSBcImF1dG9cIjtcbiAgICAvLyBGSVhNRTogVXBncmFkZSBUeXBlU2NyaXB0IHNvIHRoYXQgdGhlIHRleHQgY2FuIGJlIGRlY2xhcmVkIHByb3Blcmx5LlxuICAgIGNvbnN0cnVjdG9yKHRleHQ6IGFueS8qKHN0cmluZyB8IEFycmF5PHN0cmluZz4pKi8pIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICAvLyBUaGVyZSBoYXMgdG8gYmUgb25lIGxpbmUgYXQgbGVhc3QgaW4gdGhlIGRvY3VtZW50LiBJZiB5b3UgcGFzcyBhbiBlbXB0eVxuICAgICAgICAvLyBzdHJpbmcgdG8gdGhlIGluc2VydCBmdW5jdGlvbiwgbm90aGluZyB3aWxsIGhhcHBlbi4gV29ya2Fyb3VuZC5cbiAgICAgICAgaWYgKHRleHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLiRsaW5lcyA9IFtcIlwiXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KHRleHQpKSB7XG4gICAgICAgICAgICB0aGlzLl9pbnNlcnRMaW5lcygwLCB0ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHsgcm93OiAwLCBjb2x1bW46IDAgfSwgdGV4dCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXBsYWNlcyBhbGwgdGhlIGxpbmVzIGluIHRoZSBjdXJyZW50IGBEb2N1bWVudGAgd2l0aCB0aGUgdmFsdWUgb2YgYHRleHRgLlxuICAgICAqIEBtZXRob2Qgc2V0VmFsdWVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdGV4dCBUaGUgdGV4dCB0byB1c2VcbiAgICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgICAqL1xuICAgIHNldFZhbHVlKHRleHQ6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB2YXIgbGVuID0gdGhpcy5nZXRMZW5ndGgoKTtcbiAgICAgICAgdGhpcy5yZW1vdmUobmV3IFJhbmdlKDAsIDAsIGxlbiwgdGhpcy5nZXRMaW5lKGxlbiAtIDEpLmxlbmd0aCkpO1xuICAgICAgICB0aGlzLmluc2VydCh7IHJvdzogMCwgY29sdW1uOiAwIH0sIHRleHQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYWxsIHRoZSBsaW5lcyBpbiB0aGUgZG9jdW1lbnQgYXMgYSBzaW5nbGUgc3RyaW5nLCBqb2luZWQgYnkgdGhlIG5ldyBsaW5lIGNoYXJhY3Rlci5cbiAgICAgKiBAbWV0aG9kIGdldFZhbHVlXG4gICAgICogQHJldHVybiB7c3RyaW5nfVxuICAgICAqL1xuICAgIGdldFZhbHVlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEFsbExpbmVzKCkuam9pbih0aGlzLmdldE5ld0xpbmVDaGFyYWN0ZXIoKSk7XG4gICAgfVxuXG4gICAgLyoqIFxuICAgICAqIENyZWF0ZXMgYSBuZXcgYEFuY2hvcmAgdG8gZGVmaW5lIGEgZmxvYXRpbmcgcG9pbnQgaW4gdGhlIGRvY3VtZW50LlxuICAgICAqIEBtZXRob2QgY3JlYXRlQW5jaG9yXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHJvdyBUaGUgcm93IG51bWJlciB0byB1c2VcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gY29sdW1uIFRoZSBjb2x1bW4gbnVtYmVyIHRvIHVzZVxuICAgICAqIEByZXR1cm4ge0FuY2hvcn1cbiAgICAgKlxuICAgICAqL1xuICAgIGNyZWF0ZUFuY2hvcihyb3c6IG51bWJlciwgY29sdW1uOiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBBbmNob3IodGhpcywgcm93LCBjb2x1bW4pO1xuICAgIH1cblxuICAgIC8qKiBcbiAgICAgKiBTcGxpdHMgYSBzdHJpbmcgb2YgdGV4dCBvbiBhbnkgbmV3bGluZSAoYFxcbmApIG9yIGNhcnJpYWdlLXJldHVybiAoJ1xccicpIGNoYXJhY3RlcnMuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kICRzcGxpdFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IFRoZSB0ZXh0IHRvIHdvcmsgd2l0aFxuICAgICAqL1xuXG4gICAgJGRldGVjdE5ld0xpbmUodGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHZhciBtYXRjaCA9IHRleHQubWF0Y2goL14uKj8oXFxyXFxufFxccnxcXG4pL20pO1xuICAgICAgICB0aGlzLiRhdXRvTmV3TGluZSA9IG1hdGNoID8gbWF0Y2hbMV0gOiBcIlxcblwiO1xuICAgICAgICB0aGlzLl9zaWduYWwoXCJjaGFuZ2VOZXdMaW5lTW9kZVwiKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIFJldHVybnMgdGhlIG5ld2xpbmUgY2hhcmFjdGVyIHRoYXQncyBiZWluZyB1c2VkLCBkZXBlbmRpbmcgb24gdGhlIHZhbHVlIG9mIGBuZXdMaW5lTW9kZWAuIFxuICAgICogQG1ldGhvZCBnZXROZXdMaW5lQ2hhcmFjdGVyXG4gICAgKiBAcmV0dXJucyB7U3RyaW5nfVxuICAgICogIElmIGBuZXdMaW5lTW9kZSA9PSB3aW5kb3dzYCwgYFxcclxcbmAgaXMgcmV0dXJuZWQuICBcbiAgICAqICBJZiBgbmV3TGluZU1vZGUgPT0gdW5peGAsIGBcXG5gIGlzIHJldHVybmVkLiAgXG4gICAgKiAgSWYgYG5ld0xpbmVNb2RlID09IGF1dG9gLCB0aGUgdmFsdWUgb2YgYGF1dG9OZXdMaW5lYCBpcyByZXR1cm5lZC5cbiAgICAqXG4gICAgKiovXG4gICAgZ2V0TmV3TGluZUNoYXJhY3RlcigpOiBzdHJpbmcge1xuICAgICAgICBzd2l0Y2ggKHRoaXMuJG5ld0xpbmVNb2RlKSB7XG4gICAgICAgICAgICBjYXNlIFwid2luZG93c1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIlxcclxcblwiO1xuICAgICAgICAgICAgY2FzZSBcInVuaXhcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJcXG5cIjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGF1dG9OZXdMaW5lIHx8IFwiXFxuXCI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBbU2V0cyB0aGUgbmV3IGxpbmUgbW9kZS5dezogI0RvY3VtZW50LnNldE5ld0xpbmVNb2RlLmRlc2N9XG4gICAgICogQG1ldGhvZCBzZXROZXdMaW5lTW9kZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuZXdMaW5lTW9kZSBbVGhlIG5ld2xpbmUgbW9kZSB0byB1c2U7IGNhbiBiZSBlaXRoZXIgYHdpbmRvd3NgLCBgdW5peGAsIG9yIGBhdXRvYF17OiAjRG9jdW1lbnQuc2V0TmV3TGluZU1vZGUucGFyYW19XG4gICAgICogQHJldHVybiB7dm9pZH1cbiAgICAgKi9cbiAgICBzZXROZXdMaW5lTW9kZShuZXdMaW5lTW9kZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLiRuZXdMaW5lTW9kZSA9PT0gbmV3TGluZU1vZGUpXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgdGhpcy4kbmV3TGluZU1vZGUgPSBuZXdMaW5lTW9kZTtcbiAgICAgICAgdGhpcy5fc2lnbmFsKFwiY2hhbmdlTmV3TGluZU1vZGVcIik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogW1JldHVybnMgdGhlIHR5cGUgb2YgbmV3bGluZXMgYmVpbmcgdXNlZDsgZWl0aGVyIGB3aW5kb3dzYCwgYHVuaXhgLCBvciBgYXV0b2BdezogI0RvY3VtZW50LmdldE5ld0xpbmVNb2RlfVxuICAgICAqIEBtZXRob2QgZ2V0TmV3TGluZU1vZGVcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICovXG4gICAgZ2V0TmV3TGluZU1vZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRuZXdMaW5lTW9kZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGB0cnVlYCBpZiBgdGV4dGAgaXMgYSBuZXdsaW5lIGNoYXJhY3RlciAoZWl0aGVyIGBcXHJcXG5gLCBgXFxyYCwgb3IgYFxcbmApLlxuICAgICAqIEBtZXRob2QgaXNOZXdMaW5lXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQgVGhlIHRleHQgdG8gY2hlY2tcbiAgICAgKiBAcmV0dXJuIHtib29sZWFufVxuICAgICAqL1xuICAgIGlzTmV3TGluZSh0ZXh0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICh0ZXh0ID09IFwiXFxyXFxuXCIgfHwgdGV4dCA9PSBcIlxcclwiIHx8IHRleHQgPT0gXCJcXG5cIik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHZlcmJhdGltIGNvcHkgb2YgdGhlIGdpdmVuIGxpbmUgYXMgaXQgaXMgaW4gdGhlIGRvY3VtZW50XG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHJvdyBUaGUgcm93IGluZGV4IHRvIHJldHJpZXZlXG4gICAgICogQHJldHVybiB7c3RyaW5nfVxuICAgICAqL1xuICAgIGdldExpbmUocm93OiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy4kbGluZXNbcm93XSB8fCBcIlwiO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogUmV0dXJucyBhbiBhcnJheSBvZiBzdHJpbmdzIG9mIHRoZSByb3dzIGJldHdlZW4gYGZpcnN0Um93YCBhbmQgYGxhc3RSb3dgLiBUaGlzIGZ1bmN0aW9uIGlzIGluY2x1c2l2ZSBvZiBgbGFzdFJvd2AuXG4gICAgKiBAcGFyYW0ge051bWJlcn0gZmlyc3RSb3cgVGhlIGZpcnN0IHJvdyBpbmRleCB0byByZXRyaWV2ZVxuICAgICogQHBhcmFtIHtOdW1iZXJ9IGxhc3RSb3cgVGhlIGZpbmFsIHJvdyBpbmRleCB0byByZXRyaWV2ZVxuICAgICpcbiAgICAqKi9cbiAgICBnZXRMaW5lcyhmaXJzdFJvdz86IG51bWJlciwgbGFzdFJvdz86IG51bWJlcik6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGxpbmVzLnNsaWNlKGZpcnN0Um93LCBsYXN0Um93ICsgMSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBSZXR1cm5zIGFsbCBsaW5lcyBpbiB0aGUgZG9jdW1lbnQgYXMgc3RyaW5nIGFycmF5LlxuICAgICoqL1xuICAgIGdldEFsbExpbmVzKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TGluZXMoMCwgdGhpcy5nZXRMZW5ndGgoKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygcm93cyBpbiB0aGUgZG9jdW1lbnQuXG4gICAgKiovXG4gICAgZ2V0TGVuZ3RoKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLiRsaW5lcy5sZW5ndGg7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBbR2l2ZW4gYSByYW5nZSB3aXRoaW4gdGhlIGRvY3VtZW50LCB0aGlzIGZ1bmN0aW9uIHJldHVybnMgYWxsIHRoZSB0ZXh0IHdpdGhpbiB0aGF0IHJhbmdlIGFzIGEgc2luZ2xlIHN0cmluZy5dezogI0RvY3VtZW50LmdldFRleHRSYW5nZS5kZXNjfVxuICAgICogQHBhcmFtIHtSYW5nZX0gcmFuZ2UgVGhlIHJhbmdlIHRvIHdvcmsgd2l0aFxuICAgICpcbiAgICAqKi9cbiAgICBnZXRUZXh0UmFuZ2UocmFuZ2U6IHsgc3RhcnQ6IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH07IGVuZDogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfSB9KTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHJhbmdlLnN0YXJ0LnJvdyA9PSByYW5nZS5lbmQucm93KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRMaW5lKHJhbmdlLnN0YXJ0LnJvdykuc3Vic3RyaW5nKHJhbmdlLnN0YXJ0LmNvbHVtbiwgcmFuZ2UuZW5kLmNvbHVtbik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGxpbmVzID0gdGhpcy5nZXRMaW5lcyhyYW5nZS5zdGFydC5yb3csIHJhbmdlLmVuZC5yb3cpO1xuICAgICAgICBsaW5lc1swXSA9IChsaW5lc1swXSB8fCBcIlwiKS5zdWJzdHJpbmcocmFuZ2Uuc3RhcnQuY29sdW1uKTtcbiAgICAgICAgdmFyIGwgPSBsaW5lcy5sZW5ndGggLSAxO1xuICAgICAgICBpZiAocmFuZ2UuZW5kLnJvdyAtIHJhbmdlLnN0YXJ0LnJvdyA9PSBsKSB7XG4gICAgICAgICAgICBsaW5lc1tsXSA9IGxpbmVzW2xdLnN1YnN0cmluZygwLCByYW5nZS5lbmQuY29sdW1uKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGluZXMuam9pbih0aGlzLmdldE5ld0xpbmVDaGFyYWN0ZXIoKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBJbnNlcnRzIGEgYmxvY2sgb2YgYHRleHRgIGF0IHRoZSBpbmRpY2F0ZWQgYHBvc2l0aW9uYC5cbiAgICAqIEBwYXJhbSB7T2JqZWN0fSBwb3NpdGlvbiBUaGUgcG9zaXRpb24gdG8gc3RhcnQgaW5zZXJ0aW5nIGF0OyBpdCdzIGFuIG9iamVjdCB0aGF0IGxvb2tzIGxpa2UgYHsgcm93OiByb3csIGNvbHVtbjogY29sdW1ufWBcbiAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IEEgY2h1bmsgb2YgdGV4dCB0byBpbnNlcnRcbiAgICAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBwb3NpdGlvbiAoe3JvdywgY29sdW1ufSkgb2YgdGhlIGxhc3QgbGluZSBvZiBgdGV4dGAuIElmIHRoZSBsZW5ndGggb2YgYHRleHRgIGlzIDAsIHRoaXMgZnVuY3Rpb24gc2ltcGx5IHJldHVybnMgYHBvc2l0aW9uYC4gXG4gICAgKlxuICAgICoqL1xuICAgIGluc2VydChwb3NpdGlvbjogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfSwgdGV4dDogc3RyaW5nKSB7XG4gICAgICAgIGlmICghdGV4dCB8fCB0ZXh0Lmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgIHJldHVybiBwb3NpdGlvbjtcblxuICAgICAgICBwb3NpdGlvbiA9ICRjbGlwUG9zaXRpb24odGhpcywgcG9zaXRpb24pO1xuXG4gICAgICAgIC8vIG9ubHkgZGV0ZWN0IG5ldyBsaW5lcyBpZiB0aGUgZG9jdW1lbnQgaGFzIG5vIGxpbmUgYnJlYWsgeWV0XG4gICAgICAgIGlmICh0aGlzLmdldExlbmd0aCgpIDw9IDEpIHtcbiAgICAgICAgICAgIHRoaXMuJGRldGVjdE5ld0xpbmUodGV4dCk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbGluZXMgPSAkc3BsaXQodGV4dCk7XG4gICAgICAgIHZhciBmaXJzdExpbmUgPSBsaW5lcy5zcGxpY2UoMCwgMSlbMF07XG4gICAgICAgIHZhciBsYXN0TGluZSA9IGxpbmVzLmxlbmd0aCA9PSAwID8gbnVsbCA6IGxpbmVzLnNwbGljZShsaW5lcy5sZW5ndGggLSAxLCAxKVswXTtcblxuICAgICAgICBwb3NpdGlvbiA9IHRoaXMuaW5zZXJ0SW5MaW5lKHBvc2l0aW9uLCBmaXJzdExpbmUpO1xuICAgICAgICBpZiAobGFzdExpbmUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHBvc2l0aW9uID0gdGhpcy5pbnNlcnROZXdMaW5lKHBvc2l0aW9uKTsgLy8gdGVybWluYXRlIGZpcnN0IGxpbmVcbiAgICAgICAgICAgIHBvc2l0aW9uID0gdGhpcy5faW5zZXJ0TGluZXMocG9zaXRpb24ucm93LCBsaW5lcyk7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IHRoaXMuaW5zZXJ0SW5MaW5lKHBvc2l0aW9uLCBsYXN0TGluZSB8fCBcIlwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcG9zaXRpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmlyZXMgd2hlbmV2ZXIgdGhlIGRvY3VtZW50IGNoYW5nZXMuXG4gICAgICpcbiAgICAgKiBTZXZlcmFsIG1ldGhvZHMgdHJpZ2dlciBkaWZmZXJlbnQgYFwiY2hhbmdlXCJgIGV2ZW50cy4gQmVsb3cgaXMgYSBsaXN0IG9mIGVhY2ggYWN0aW9uIHR5cGUsIGZvbGxvd2VkIGJ5IGVhY2ggcHJvcGVydHkgdGhhdCdzIGFsc28gYXZhaWxhYmxlOlxuICAgICAqXG4gICAgICogICogYFwiaW5zZXJ0TGluZXNcImAgKGVtaXR0ZWQgYnkgW1tEb2N1bWVudC5pbnNlcnRMaW5lc11dKVxuICAgICAqICAgICogYHJhbmdlYDogdGhlIFtbUmFuZ2VdXSBvZiB0aGUgY2hhbmdlIHdpdGhpbiB0aGUgZG9jdW1lbnRcbiAgICAgKiAgICAqIGBsaW5lc2A6IHRoZSBsaW5lcyBpbiB0aGUgZG9jdW1lbnQgdGhhdCBhcmUgY2hhbmdpbmdcbiAgICAgKiAgKiBgXCJpbnNlcnRUZXh0XCJgIChlbWl0dGVkIGJ5IFtbRG9jdW1lbnQuaW5zZXJ0TmV3TGluZV1dKVxuICAgICAqICAgICogYHJhbmdlYDogdGhlIFtbUmFuZ2VdXSBvZiB0aGUgY2hhbmdlIHdpdGhpbiB0aGUgZG9jdW1lbnRcbiAgICAgKiAgICAqIGB0ZXh0YDogdGhlIHRleHQgdGhhdCdzIGJlaW5nIGFkZGVkXG4gICAgICogICogYFwicmVtb3ZlTGluZXNcImAgKGVtaXR0ZWQgYnkgW1tEb2N1bWVudC5pbnNlcnRMaW5lc11dKVxuICAgICAqICAgICogYHJhbmdlYDogdGhlIFtbUmFuZ2VdXSBvZiB0aGUgY2hhbmdlIHdpdGhpbiB0aGUgZG9jdW1lbnRcbiAgICAgKiAgICAqIGBsaW5lc2A6IHRoZSBsaW5lcyBpbiB0aGUgZG9jdW1lbnQgdGhhdCB3ZXJlIHJlbW92ZWRcbiAgICAgKiAgICAqIGBubGA6IHRoZSBuZXcgbGluZSBjaGFyYWN0ZXIgKGFzIGRlZmluZWQgYnkgW1tEb2N1bWVudC5nZXROZXdMaW5lQ2hhcmFjdGVyXV0pXG4gICAgICogICogYFwicmVtb3ZlVGV4dFwiYCAoZW1pdHRlZCBieSBbW0RvY3VtZW50LnJlbW92ZUluTGluZV1dIGFuZCBbW0RvY3VtZW50LnJlbW92ZU5ld0xpbmVdXSlcbiAgICAgKiAgICAqIGByYW5nZWA6IHRoZSBbW1JhbmdlXV0gb2YgdGhlIGNoYW5nZSB3aXRoaW4gdGhlIGRvY3VtZW50XG4gICAgICogICAgKiBgdGV4dGA6IHRoZSB0ZXh0IHRoYXQncyBiZWluZyByZW1vdmVkXG4gICAgICpcbiAgICAgKiBAZXZlbnQgY2hhbmdlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGUgQ29udGFpbnMgYXQgbGVhc3Qgb25lIHByb3BlcnR5IGNhbGxlZCBgXCJhY3Rpb25cImAuIGBcImFjdGlvblwiYCBpbmRpY2F0ZXMgdGhlIGFjdGlvbiB0aGF0IHRyaWdnZXJlZCB0aGUgY2hhbmdlLiBFYWNoIGFjdGlvbiBhbHNvIGhhcyBhIHNldCBvZiBhZGRpdGlvbmFsIHByb3BlcnRpZXMuXG4gICAgICpcbiAgICAgKiovXG4gICAgLyoqXG4gICAgKiBJbnNlcnRzIHRoZSBlbGVtZW50cyBpbiBgbGluZXNgIGludG8gdGhlIGRvY3VtZW50LCBzdGFydGluZyBhdCB0aGUgcm93IGluZGV4IGdpdmVuIGJ5IGByb3dgLiBUaGlzIG1ldGhvZCBhbHNvIHRyaWdnZXJzIHRoZSBgJ2NoYW5nZSdgIGV2ZW50LlxuICAgICogQHBhcmFtIHtOdW1iZXJ9IHJvdyBUaGUgaW5kZXggb2YgdGhlIHJvdyB0byBpbnNlcnQgYXRcbiAgICAqIEBwYXJhbSB7QXJyYXl9IGxpbmVzIEFuIGFycmF5IG9mIHN0cmluZ3NcbiAgICAqIEByZXR1cm5zIHtPYmplY3R9IENvbnRhaW5zIHRoZSBmaW5hbCByb3cgYW5kIGNvbHVtbiwgbGlrZSB0aGlzOiAgXG4gICAgKiAgIGBgYFxuICAgICogICB7cm93OiBlbmRSb3csIGNvbHVtbjogMH1cbiAgICAqICAgYGBgICBcbiAgICAqICAgSWYgYGxpbmVzYCBpcyBlbXB0eSwgdGhpcyBmdW5jdGlvbiByZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBjdXJyZW50IHJvdywgYW5kIGNvbHVtbiwgbGlrZSB0aGlzOiAgXG4gICAgKiAgIGBgYCBcbiAgICAqICAge3Jvdzogcm93LCBjb2x1bW46IDB9XG4gICAgKiAgIGBgYFxuICAgICpcbiAgICAqKi9cbiAgICBpbnNlcnRMaW5lcyhyb3c6IG51bWJlciwgbGluZXM6IHN0cmluZ1tdKSB7XG4gICAgICAgIGlmIChyb3cgPj0gdGhpcy5nZXRMZW5ndGgoKSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluc2VydCh7IHJvdzogcm93LCBjb2x1bW46IDAgfSwgXCJcXG5cIiArIGxpbmVzLmpvaW4oXCJcXG5cIikpO1xuICAgICAgICByZXR1cm4gdGhpcy5faW5zZXJ0TGluZXMoTWF0aC5tYXgocm93LCAwKSwgbGluZXMpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2luc2VydExpbmVzKHJvdzogbnVtYmVyLCBsaW5lczogc3RyaW5nW10pIHtcbiAgICAgICAgaWYgKGxpbmVzLmxlbmd0aCA9PSAwKVxuICAgICAgICAgICAgcmV0dXJuIHsgcm93OiByb3csIGNvbHVtbjogMCB9O1xuXG4gICAgICAgIC8vIGFwcGx5IGRvZXNuJ3Qgd29yayBmb3IgYmlnIGFycmF5cyAoc21hbGxlc3QgdGhyZXNob2xkIGlzIG9uIHNhZmFyaSAweEZGRkYpXG4gICAgICAgIC8vIHRvIGNpcmN1bXZlbnQgdGhhdCB3ZSBoYXZlIHRvIGJyZWFrIGh1Z2UgaW5zZXJ0cyBpbnRvIHNtYWxsZXIgY2h1bmtzIGhlcmVcbiAgICAgICAgd2hpbGUgKGxpbmVzLmxlbmd0aCA+IDB4RjAwMCkge1xuICAgICAgICAgICAgdmFyIGVuZCA9IHRoaXMuX2luc2VydExpbmVzKHJvdywgbGluZXMuc2xpY2UoMCwgMHhGMDAwKSk7XG4gICAgICAgICAgICBsaW5lcyA9IGxpbmVzLnNsaWNlKDB4RjAwMCk7XG4gICAgICAgICAgICByb3cgPSBlbmQucm93O1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGFyZ3MgPSBbcm93LCAwXTtcbiAgICAgICAgYXJncy5wdXNoLmFwcGx5KGFyZ3MsIGxpbmVzKTtcbiAgICAgICAgdGhpcy4kbGluZXMuc3BsaWNlLmFwcGx5KHRoaXMuJGxpbmVzLCBhcmdzKTtcblxuICAgICAgICB2YXIgcmFuZ2UgPSBuZXcgUmFuZ2Uocm93LCAwLCByb3cgKyBsaW5lcy5sZW5ndGgsIDApO1xuICAgICAgICB2YXIgZGVsdGEgPSB7XG4gICAgICAgICAgICBhY3Rpb246IFwiaW5zZXJ0TGluZXNcIixcbiAgICAgICAgICAgIHJhbmdlOiByYW5nZSxcbiAgICAgICAgICAgIGxpbmVzOiBsaW5lc1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9zaWduYWwoXCJjaGFuZ2VcIiwgeyBkYXRhOiBkZWx0YSB9KTtcbiAgICAgICAgcmV0dXJuIHJhbmdlLmVuZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIEluc2VydHMgYSBuZXcgbGluZSBpbnRvIHRoZSBkb2N1bWVudCBhdCB0aGUgY3VycmVudCByb3cncyBgcG9zaXRpb25gLiBUaGlzIG1ldGhvZCBhbHNvIHRyaWdnZXJzIHRoZSBgJ2NoYW5nZSdgIGV2ZW50LiBcbiAgICAqIEBwYXJhbSB7T2JqZWN0fSBwb3NpdGlvbiBUaGUgcG9zaXRpb24gdG8gaW5zZXJ0IGF0XG4gICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBmaW5hbCByb3cgYW5kIGNvbHVtbiwgbGlrZSB0aGlzOjxici8+XG4gICAgKiAgICBgYGBcbiAgICAqICAgIHtyb3c6IGVuZFJvdywgY29sdW1uOiAwfVxuICAgICogICAgYGBgXG4gICAgKlxuICAgICoqL1xuICAgIGluc2VydE5ld0xpbmUocG9zaXRpb246IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0pIHtcbiAgICAgICAgcG9zaXRpb24gPSAkY2xpcFBvc2l0aW9uKHRoaXMsIHBvc2l0aW9uKTtcbiAgICAgICAgdmFyIGxpbmUgPSB0aGlzLiRsaW5lc1twb3NpdGlvbi5yb3ddIHx8IFwiXCI7XG5cbiAgICAgICAgdGhpcy4kbGluZXNbcG9zaXRpb24ucm93XSA9IGxpbmUuc3Vic3RyaW5nKDAsIHBvc2l0aW9uLmNvbHVtbik7XG4gICAgICAgIHRoaXMuJGxpbmVzLnNwbGljZShwb3NpdGlvbi5yb3cgKyAxLCAwLCBsaW5lLnN1YnN0cmluZyhwb3NpdGlvbi5jb2x1bW4sIGxpbmUubGVuZ3RoKSk7XG5cbiAgICAgICAgdmFyIGVuZCA9IHtcbiAgICAgICAgICAgIHJvdzogcG9zaXRpb24ucm93ICsgMSxcbiAgICAgICAgICAgIGNvbHVtbjogMFxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBkZWx0YSA9IHtcbiAgICAgICAgICAgIGFjdGlvbjogXCJpbnNlcnRUZXh0XCIsXG4gICAgICAgICAgICByYW5nZTogUmFuZ2UuZnJvbVBvaW50cyhwb3NpdGlvbiwgZW5kKSxcbiAgICAgICAgICAgIHRleHQ6IHRoaXMuZ2V0TmV3TGluZUNoYXJhY3RlcigpXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3NpZ25hbChcImNoYW5nZVwiLCB7IGRhdGE6IGRlbHRhIH0pO1xuXG4gICAgICAgIHJldHVybiBlbmQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBJbnNlcnRzIGB0ZXh0YCBpbnRvIHRoZSBgcG9zaXRpb25gIGF0IHRoZSBjdXJyZW50IHJvdy4gVGhpcyBtZXRob2QgYWxzbyB0cmlnZ2VycyB0aGUgYCdjaGFuZ2UnYCBldmVudC5cbiAgICAqIEBwYXJhbSB7T2JqZWN0fSBwb3NpdGlvbiBUaGUgcG9zaXRpb24gdG8gaW5zZXJ0IGF0LlxuICAgICogQHBhcmFtIHtTdHJpbmd9IHRleHQgQSBjaHVuayBvZiB0ZXh0XG4gICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBmaW5hbCByb3cgYW5kIGNvbHVtbi5cbiAgICAqKi9cbiAgICBpbnNlcnRJbkxpbmUocG9zaXRpb246IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0sIHRleHQ6IHN0cmluZyk6IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0ge1xuICAgICAgICBpZiAodGV4dC5sZW5ndGggPT0gMClcbiAgICAgICAgICAgIHJldHVybiBwb3NpdGlvbjtcblxuICAgICAgICB2YXIgbGluZSA9IHRoaXMuJGxpbmVzW3Bvc2l0aW9uLnJvd10gfHwgXCJcIjtcblxuICAgICAgICB0aGlzLiRsaW5lc1twb3NpdGlvbi5yb3ddID0gbGluZS5zdWJzdHJpbmcoMCwgcG9zaXRpb24uY29sdW1uKSArIHRleHQgKyBsaW5lLnN1YnN0cmluZyhwb3NpdGlvbi5jb2x1bW4pO1xuXG4gICAgICAgIHZhciBlbmQgPSB7XG4gICAgICAgICAgICByb3c6IHBvc2l0aW9uLnJvdyxcbiAgICAgICAgICAgIGNvbHVtbjogcG9zaXRpb24uY29sdW1uICsgdGV4dC5sZW5ndGhcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZGVsdGEgPSB7IGFjdGlvbjogXCJpbnNlcnRUZXh0XCIsIHJhbmdlOiBSYW5nZS5mcm9tUG9pbnRzKHBvc2l0aW9uLCBlbmQpLCB0ZXh0OiB0ZXh0IH07XG4gICAgICAgIHRoaXMuX3NpZ25hbChcImNoYW5nZVwiLCB7IGRhdGE6IGRlbHRhIH0pO1xuXG4gICAgICAgIHJldHVybiBlbmQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBSZW1vdmVzIHRoZSBgcmFuZ2VgIGZyb20gdGhlIGRvY3VtZW50LlxuICAgICogQHBhcmFtIHtSYW5nZX0gcmFuZ2UgQSBzcGVjaWZpZWQgUmFuZ2UgdG8gcmVtb3ZlXG4gICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgYHN0YXJ0YCBwcm9wZXJ0eSBvZiB0aGUgcmFuZ2UsIHdoaWNoIGNvbnRhaW5zIGBzdGFydFJvd2AgYW5kIGBzdGFydENvbHVtbmAuIElmIGByYW5nZWAgaXMgZW1wdHksIHRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgdW5tb2RpZmllZCB2YWx1ZSBvZiBgcmFuZ2Uuc3RhcnRgLlxuICAgICpcbiAgICAqKi9cbiAgICByZW1vdmUocmFuZ2U6IHsgc3RhcnQ7IGVuZDsgaXNFbXB0eTsgaXNNdWx0aUxpbmUgfSkge1xuICAgICAgICBpZiAoIShyYW5nZSBpbnN0YW5jZW9mIFJhbmdlKSlcbiAgICAgICAgICAgIHJhbmdlID0gUmFuZ2UuZnJvbVBvaW50cyhyYW5nZS5zdGFydCwgcmFuZ2UuZW5kKTtcbiAgICAgICAgLy8gY2xpcCB0byBkb2N1bWVudFxuICAgICAgICByYW5nZS5zdGFydCA9ICRjbGlwUG9zaXRpb24odGhpcywgcmFuZ2Uuc3RhcnQpO1xuICAgICAgICByYW5nZS5lbmQgPSAkY2xpcFBvc2l0aW9uKHRoaXMsIHJhbmdlLmVuZCk7XG5cbiAgICAgICAgaWYgKHJhbmdlLmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiByYW5nZS5zdGFydDtcblxuICAgICAgICB2YXIgZmlyc3RSb3cgPSByYW5nZS5zdGFydC5yb3c7XG4gICAgICAgIHZhciBsYXN0Um93ID0gcmFuZ2UuZW5kLnJvdztcblxuICAgICAgICBpZiAocmFuZ2UuaXNNdWx0aUxpbmUoKSkge1xuICAgICAgICAgICAgdmFyIGZpcnN0RnVsbFJvdyA9IHJhbmdlLnN0YXJ0LmNvbHVtbiA9PSAwID8gZmlyc3RSb3cgOiBmaXJzdFJvdyArIDE7XG4gICAgICAgICAgICB2YXIgbGFzdEZ1bGxSb3cgPSBsYXN0Um93IC0gMTtcblxuICAgICAgICAgICAgaWYgKHJhbmdlLmVuZC5jb2x1bW4gPiAwKVxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlSW5MaW5lKGxhc3RSb3csIDAsIHJhbmdlLmVuZC5jb2x1bW4pO1xuXG4gICAgICAgICAgICBpZiAobGFzdEZ1bGxSb3cgPj0gZmlyc3RGdWxsUm93KVxuICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUxpbmVzKGZpcnN0RnVsbFJvdywgbGFzdEZ1bGxSb3cpO1xuXG4gICAgICAgICAgICBpZiAoZmlyc3RGdWxsUm93ICE9IGZpcnN0Um93KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVJbkxpbmUoZmlyc3RSb3csIHJhbmdlLnN0YXJ0LmNvbHVtbiwgdGhpcy5nZXRMaW5lKGZpcnN0Um93KS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlTmV3TGluZShyYW5nZS5zdGFydC5yb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVJbkxpbmUoZmlyc3RSb3csIHJhbmdlLnN0YXJ0LmNvbHVtbiwgcmFuZ2UuZW5kLmNvbHVtbik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJhbmdlLnN0YXJ0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICogUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGNvbHVtbnMgZnJvbSB0aGUgYHJvd2AuIFRoaXMgbWV0aG9kIGFsc28gdHJpZ2dlcnMgdGhlIGAnY2hhbmdlJ2AgZXZlbnQuXG4gICAgKiBAcGFyYW0ge051bWJlcn0gcm93IFRoZSByb3cgdG8gcmVtb3ZlIGZyb21cbiAgICAqIEBwYXJhbSB7TnVtYmVyfSBzdGFydENvbHVtbiBUaGUgY29sdW1uIHRvIHN0YXJ0IHJlbW92aW5nIGF0IFxuICAgICogQHBhcmFtIHtOdW1iZXJ9IGVuZENvbHVtbiBUaGUgY29sdW1uIHRvIHN0b3AgcmVtb3ZpbmcgYXRcbiAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgYHN0YXJ0Um93YCBhbmQgYHN0YXJ0Q29sdW1uYCwgaW5kaWNhdGluZyB0aGUgbmV3IHJvdyBhbmQgY29sdW1uIHZhbHVlcy48YnIvPklmIGBzdGFydENvbHVtbmAgaXMgZXF1YWwgdG8gYGVuZENvbHVtbmAsIHRoaXMgZnVuY3Rpb24gcmV0dXJucyBub3RoaW5nLlxuICAgICpcbiAgICAqKi9cbiAgICByZW1vdmVJbkxpbmUocm93OiBudW1iZXIsIHN0YXJ0Q29sdW1uOiBudW1iZXIsIGVuZENvbHVtbjogbnVtYmVyKSB7XG4gICAgICAgIGlmIChzdGFydENvbHVtbiA9PT0gZW5kQ29sdW1uKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIHZhciByYW5nZSA9IG5ldyBSYW5nZShyb3csIHN0YXJ0Q29sdW1uLCByb3csIGVuZENvbHVtbik7XG4gICAgICAgIHZhciBsaW5lID0gdGhpcy5nZXRMaW5lKHJvdyk7XG4gICAgICAgIHZhciByZW1vdmVkID0gbGluZS5zdWJzdHJpbmcoc3RhcnRDb2x1bW4sIGVuZENvbHVtbik7XG4gICAgICAgIHZhciBuZXdMaW5lID0gbGluZS5zdWJzdHJpbmcoMCwgc3RhcnRDb2x1bW4pICsgbGluZS5zdWJzdHJpbmcoZW5kQ29sdW1uLCBsaW5lLmxlbmd0aCk7XG4gICAgICAgIHRoaXMuJGxpbmVzLnNwbGljZShyb3csIDEsIG5ld0xpbmUpO1xuXG4gICAgICAgIHZhciBkZWx0YSA9IHtcbiAgICAgICAgICAgIGFjdGlvbjogXCJyZW1vdmVUZXh0XCIsXG4gICAgICAgICAgICByYW5nZTogcmFuZ2UsXG4gICAgICAgICAgICB0ZXh0OiByZW1vdmVkXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3NpZ25hbChcImNoYW5nZVwiLCB7IGRhdGE6IGRlbHRhIH0pO1xuICAgICAgICByZXR1cm4gcmFuZ2Uuc3RhcnQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBSZW1vdmVzIGEgcmFuZ2Ugb2YgZnVsbCBsaW5lcy4gVGhpcyBtZXRob2QgYWxzbyB0cmlnZ2VycyB0aGUgYCdjaGFuZ2UnYCBldmVudC5cbiAgICAqIEBwYXJhbSB7TnVtYmVyfSBmaXJzdFJvdyBUaGUgZmlyc3Qgcm93IHRvIGJlIHJlbW92ZWRcbiAgICAqIEBwYXJhbSB7TnVtYmVyfSBsYXN0Um93IFRoZSBsYXN0IHJvdyB0byBiZSByZW1vdmVkXG4gICAgKiBAcmV0dXJucyB7W1N0cmluZ119IFJldHVybnMgYWxsIHRoZSByZW1vdmVkIGxpbmVzLlxuICAgICpcbiAgICAqKi9cbiAgICByZW1vdmVMaW5lcyhmaXJzdFJvdzogbnVtYmVyLCBsYXN0Um93OiBudW1iZXIpOiBzdHJpbmdbXSB7XG4gICAgICAgIGlmIChmaXJzdFJvdyA8IDAgfHwgbGFzdFJvdyA+PSB0aGlzLmdldExlbmd0aCgpKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlKG5ldyBSYW5nZShmaXJzdFJvdywgMCwgbGFzdFJvdyArIDEsIDApKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlbW92ZUxpbmVzKGZpcnN0Um93LCBsYXN0Um93KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9yZW1vdmVMaW5lcyhmaXJzdFJvdzogbnVtYmVyLCBsYXN0Um93OiBudW1iZXIpOiBzdHJpbmdbXSB7XG4gICAgICAgIHZhciByYW5nZSA9IG5ldyBSYW5nZShmaXJzdFJvdywgMCwgbGFzdFJvdyArIDEsIDApO1xuICAgICAgICB2YXIgcmVtb3ZlZCA9IHRoaXMuJGxpbmVzLnNwbGljZShmaXJzdFJvdywgbGFzdFJvdyAtIGZpcnN0Um93ICsgMSk7XG5cbiAgICAgICAgdmFyIGRlbHRhID0ge1xuICAgICAgICAgICAgYWN0aW9uOiBcInJlbW92ZUxpbmVzXCIsXG4gICAgICAgICAgICByYW5nZTogcmFuZ2UsXG4gICAgICAgICAgICBubDogdGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCksXG4gICAgICAgICAgICBsaW5lczogcmVtb3ZlZFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9zaWduYWwoXCJjaGFuZ2VcIiwgeyBkYXRhOiBkZWx0YSB9KTtcbiAgICAgICAgcmV0dXJuIHJlbW92ZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBSZW1vdmVzIHRoZSBuZXcgbGluZSBiZXR3ZWVuIGByb3dgIGFuZCB0aGUgcm93IGltbWVkaWF0ZWx5IGZvbGxvd2luZyBpdC4gVGhpcyBtZXRob2QgYWxzbyB0cmlnZ2VycyB0aGUgYCdjaGFuZ2UnYCBldmVudC5cbiAgICAqIEBwYXJhbSB7TnVtYmVyfSByb3cgVGhlIHJvdyB0byBjaGVja1xuICAgICpcbiAgICAqKi9cbiAgICByZW1vdmVOZXdMaW5lKHJvdzogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIHZhciBmaXJzdExpbmUgPSB0aGlzLmdldExpbmUocm93KTtcbiAgICAgICAgdmFyIHNlY29uZExpbmUgPSB0aGlzLmdldExpbmUocm93ICsgMSk7XG5cbiAgICAgICAgdmFyIHJhbmdlID0gbmV3IFJhbmdlKHJvdywgZmlyc3RMaW5lLmxlbmd0aCwgcm93ICsgMSwgMCk7XG4gICAgICAgIHZhciBsaW5lID0gZmlyc3RMaW5lICsgc2Vjb25kTGluZTtcblxuICAgICAgICB0aGlzLiRsaW5lcy5zcGxpY2Uocm93LCAyLCBsaW5lKTtcblxuICAgICAgICB2YXIgZGVsdGEgPSB7XG4gICAgICAgICAgICBhY3Rpb246IFwicmVtb3ZlVGV4dFwiLFxuICAgICAgICAgICAgcmFuZ2U6IHJhbmdlLFxuICAgICAgICAgICAgdGV4dDogdGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKClcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5fc2lnbmFsKFwiY2hhbmdlXCIsIHsgZGF0YTogZGVsdGEgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBSZXBsYWNlcyBhIHJhbmdlIGluIHRoZSBkb2N1bWVudCB3aXRoIHRoZSBuZXcgYHRleHRgLlxuICAgICogQHBhcmFtIHtSYW5nZX0gcmFuZ2UgQSBzcGVjaWZpZWQgUmFuZ2UgdG8gcmVwbGFjZVxuICAgICogQHBhcmFtIHtTdHJpbmd9IHRleHQgVGhlIG5ldyB0ZXh0IHRvIHVzZSBhcyBhIHJlcGxhY2VtZW50XG4gICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBmaW5hbCByb3cgYW5kIGNvbHVtbiwgbGlrZSB0aGlzOlxuICAgICogICAgIHtyb3c6IGVuZFJvdywgY29sdW1uOiAwfVxuICAgICogSWYgdGhlIHRleHQgYW5kIHJhbmdlIGFyZSBlbXB0eSwgdGhpcyBmdW5jdGlvbiByZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBjdXJyZW50IGByYW5nZS5zdGFydGAgdmFsdWUuXG4gICAgKiBJZiB0aGUgdGV4dCBpcyB0aGUgZXhhY3Qgc2FtZSBhcyB3aGF0IGN1cnJlbnRseSBleGlzdHMsIHRoaXMgZnVuY3Rpb24gcmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgY3VycmVudCBgcmFuZ2UuZW5kYCB2YWx1ZS5cbiAgICAqXG4gICAgKiovXG4gICAgcmVwbGFjZShyYW5nZTogeyBzdGFydDogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfTsgZW5kOiB7IHJvdzogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9OyBpc0VtcHR5OiAoKSA9PiBib29sZWFuOyBpc011bHRpTGluZTogKCkgPT4gYm9vbGVhbiB9LCB0ZXh0OiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKCEocmFuZ2UgaW5zdGFuY2VvZiBSYW5nZSkpIHtcbiAgICAgICAgICAgIHJhbmdlID0gUmFuZ2UuZnJvbVBvaW50cyhyYW5nZS5zdGFydCwgcmFuZ2UuZW5kKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGV4dC5sZW5ndGggPT0gMCAmJiByYW5nZS5pc0VtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gcmFuZ2Uuc3RhcnQ7XG5cbiAgICAgICAgLy8gU2hvcnRjdXQ6IElmIHRoZSB0ZXh0IHdlIHdhbnQgdG8gaW5zZXJ0IGlzIHRoZSBzYW1lIGFzIGl0IGlzIGFscmVhZHlcbiAgICAgICAgLy8gaW4gdGhlIGRvY3VtZW50LCB3ZSBkb24ndCBoYXZlIHRvIHJlcGxhY2UgYW55dGhpbmcuXG4gICAgICAgIGlmICh0ZXh0ID09IHRoaXMuZ2V0VGV4dFJhbmdlKHJhbmdlKSlcbiAgICAgICAgICAgIHJldHVybiByYW5nZS5lbmQ7XG5cbiAgICAgICAgdGhpcy5yZW1vdmUocmFuZ2UpO1xuICAgICAgICBpZiAodGV4dCkge1xuICAgICAgICAgICAgdmFyIGVuZCA9IHRoaXMuaW5zZXJ0KHJhbmdlLnN0YXJ0LCB0ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVuZCA9IHJhbmdlLnN0YXJ0O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVuZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIEFwcGxpZXMgYWxsIHRoZSBjaGFuZ2VzIHByZXZpb3VzbHkgYWNjdW11bGF0ZWQuIFRoZXNlIGNhbiBiZSBlaXRoZXIgYCdpbmNsdWRlVGV4dCdgLCBgJ2luc2VydExpbmVzJ2AsIGAncmVtb3ZlVGV4dCdgLCBhbmQgYCdyZW1vdmVMaW5lcydgLlxuICAgICoqL1xuICAgIGFwcGx5RGVsdGFzKGRlbHRhczogeyBhY3Rpb246IHN0cmluZzsgbGluZXM6IHN0cmluZ1tdOyByYW5nZTogeyBzdGFydDogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfTsgZW5kOiB7IHJvdzogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9IH07IHRleHQ6IHN0cmluZyB9W10pIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZWx0YXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBkZWx0YSA9IGRlbHRhc1tpXTtcbiAgICAgICAgICAgIHZhciByYW5nZSA9IFJhbmdlLmZyb21Qb2ludHMoZGVsdGEucmFuZ2Uuc3RhcnQsIGRlbHRhLnJhbmdlLmVuZCk7XG5cbiAgICAgICAgICAgIGlmIChkZWx0YS5hY3Rpb24gPT0gXCJpbnNlcnRMaW5lc1wiKVxuICAgICAgICAgICAgICAgIHRoaXMuaW5zZXJ0TGluZXMocmFuZ2Uuc3RhcnQucm93LCBkZWx0YS5saW5lcyk7XG4gICAgICAgICAgICBlbHNlIGlmIChkZWx0YS5hY3Rpb24gPT0gXCJpbnNlcnRUZXh0XCIpXG4gICAgICAgICAgICAgICAgdGhpcy5pbnNlcnQocmFuZ2Uuc3RhcnQsIGRlbHRhLnRleHQpO1xuICAgICAgICAgICAgZWxzZSBpZiAoZGVsdGEuYWN0aW9uID09IFwicmVtb3ZlTGluZXNcIilcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVMaW5lcyhyYW5nZS5zdGFydC5yb3csIHJhbmdlLmVuZC5yb3cgLSAxKTtcbiAgICAgICAgICAgIGVsc2UgaWYgKGRlbHRhLmFjdGlvbiA9PSBcInJlbW92ZVRleHRcIilcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZShyYW5nZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAqIFJldmVydHMgYW55IGNoYW5nZXMgcHJldmlvdXNseSBhcHBsaWVkLiBUaGVzZSBjYW4gYmUgZWl0aGVyIGAnaW5jbHVkZVRleHQnYCwgYCdpbnNlcnRMaW5lcydgLCBgJ3JlbW92ZVRleHQnYCwgYW5kIGAncmVtb3ZlTGluZXMnYC5cbiAgICAqKi9cbiAgICByZXZlcnREZWx0YXMoZGVsdGFzKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSBkZWx0YXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIHZhciBkZWx0YSA9IGRlbHRhc1tpXTtcblxuICAgICAgICAgICAgdmFyIHJhbmdlID0gUmFuZ2UuZnJvbVBvaW50cyhkZWx0YS5yYW5nZS5zdGFydCwgZGVsdGEucmFuZ2UuZW5kKTtcblxuICAgICAgICAgICAgaWYgKGRlbHRhLmFjdGlvbiA9PSBcImluc2VydExpbmVzXCIpXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlTGluZXMocmFuZ2Uuc3RhcnQucm93LCByYW5nZS5lbmQucm93IC0gMSk7XG4gICAgICAgICAgICBlbHNlIGlmIChkZWx0YS5hY3Rpb24gPT0gXCJpbnNlcnRUZXh0XCIpXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUocmFuZ2UpO1xuICAgICAgICAgICAgZWxzZSBpZiAoZGVsdGEuYWN0aW9uID09IFwicmVtb3ZlTGluZXNcIilcbiAgICAgICAgICAgICAgICB0aGlzLl9pbnNlcnRMaW5lcyhyYW5nZS5zdGFydC5yb3csIGRlbHRhLmxpbmVzKTtcbiAgICAgICAgICAgIGVsc2UgaWYgKGRlbHRhLmFjdGlvbiA9PSBcInJlbW92ZVRleHRcIilcbiAgICAgICAgICAgICAgICB0aGlzLmluc2VydChyYW5nZS5zdGFydCwgZGVsdGEudGV4dCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBhbiBpbmRleCBwb3NpdGlvbiBpbiBhIGRvY3VtZW50IHRvIGEgYHtyb3csIGNvbHVtbn1gIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEluZGV4IHJlZmVycyB0byB0aGUgXCJhYnNvbHV0ZSBwb3NpdGlvblwiIG9mIGEgY2hhcmFjdGVyIGluIHRoZSBkb2N1bWVudC4gRm9yIGV4YW1wbGU6XG4gICAgICpcbiAgICAgKiBgYGBqYXZhc2NyaXB0XG4gICAgICogdmFyIHggPSAwOyAvLyAxMCBjaGFyYWN0ZXJzLCBwbHVzIG9uZSBmb3IgbmV3bGluZVxuICAgICAqIHZhciB5ID0gLTE7XG4gICAgICogYGBgXG4gICAgICogXG4gICAgICogSGVyZSwgYHlgIGlzIGFuIGluZGV4IDE1OiAxMSBjaGFyYWN0ZXJzIGZvciB0aGUgZmlyc3Qgcm93LCBhbmQgNSBjaGFyYWN0ZXJzIHVudGlsIGB5YCBpbiB0aGUgc2Vjb25kLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4IEFuIGluZGV4IHRvIGNvbnZlcnRcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gc3RhcnRSb3c9MCBUaGUgcm93IGZyb20gd2hpY2ggdG8gc3RhcnQgdGhlIGNvbnZlcnNpb25cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBBIGB7cm93LCBjb2x1bW59YCBvYmplY3Qgb2YgdGhlIGBpbmRleGAgcG9zaXRpb25cbiAgICAgKi9cbiAgICBpbmRleFRvUG9zaXRpb24oaW5kZXg6IG51bWJlciwgc3RhcnRSb3c6IG51bWJlcikge1xuICAgICAgICB2YXIgbGluZXMgPSB0aGlzLiRsaW5lcyB8fCB0aGlzLmdldEFsbExpbmVzKCk7XG4gICAgICAgIHZhciBuZXdsaW5lTGVuZ3RoID0gdGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCkubGVuZ3RoO1xuICAgICAgICBmb3IgKHZhciBpID0gc3RhcnRSb3cgfHwgMCwgbCA9IGxpbmVzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgaW5kZXggLT0gbGluZXNbaV0ubGVuZ3RoICsgbmV3bGluZUxlbmd0aDtcbiAgICAgICAgICAgIGlmIChpbmRleCA8IDApXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgcm93OiBpLCBjb2x1bW46IGluZGV4ICsgbGluZXNbaV0ubGVuZ3RoICsgbmV3bGluZUxlbmd0aCB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHJvdzogbCAtIDEsIGNvbHVtbjogbGluZXNbbCAtIDFdLmxlbmd0aCB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIHRoZSBge3JvdywgY29sdW1ufWAgcG9zaXRpb24gaW4gYSBkb2N1bWVudCB0byB0aGUgY2hhcmFjdGVyJ3MgaW5kZXguXG4gICAgICpcbiAgICAgKiBJbmRleCByZWZlcnMgdG8gdGhlIFwiYWJzb2x1dGUgcG9zaXRpb25cIiBvZiBhIGNoYXJhY3RlciBpbiB0aGUgZG9jdW1lbnQuIEZvciBleGFtcGxlOlxuICAgICAqXG4gICAgICogYGBgamF2YXNjcmlwdFxuICAgICAqIHZhciB4ID0gMDsgLy8gMTAgY2hhcmFjdGVycywgcGx1cyBvbmUgZm9yIG5ld2xpbmVcbiAgICAgKiB2YXIgeSA9IC0xO1xuICAgICAqIGBgYFxuICAgICAqIFxuICAgICAqIEhlcmUsIGB5YCBpcyBhbiBpbmRleCAxNTogMTEgY2hhcmFjdGVycyBmb3IgdGhlIGZpcnN0IHJvdywgYW5kIDUgY2hhcmFjdGVycyB1bnRpbCBgeWAgaW4gdGhlIHNlY29uZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwb3MgVGhlIGB7cm93LCBjb2x1bW59YCB0byBjb252ZXJ0XG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHN0YXJ0Um93PTAgVGhlIHJvdyBmcm9tIHdoaWNoIHRvIHN0YXJ0IHRoZSBjb252ZXJzaW9uXG4gICAgICogQHJldHVybnMge051bWJlcn0gVGhlIGluZGV4IHBvc2l0aW9uIGluIHRoZSBkb2N1bWVudFxuICAgICAqL1xuICAgIHBvc2l0aW9uVG9JbmRleChwb3MsIHN0YXJ0Um93KSB7XG4gICAgICAgIHZhciBsaW5lcyA9IHRoaXMuJGxpbmVzIHx8IHRoaXMuZ2V0QWxsTGluZXMoKTtcbiAgICAgICAgdmFyIG5ld2xpbmVMZW5ndGggPSB0aGlzLmdldE5ld0xpbmVDaGFyYWN0ZXIoKS5sZW5ndGg7XG4gICAgICAgIHZhciBpbmRleCA9IDA7XG4gICAgICAgIHZhciByb3cgPSBNYXRoLm1pbihwb3Mucm93LCBsaW5lcy5sZW5ndGgpO1xuICAgICAgICBmb3IgKHZhciBpID0gc3RhcnRSb3cgfHwgMDsgaSA8IHJvdzsgKytpKVxuICAgICAgICAgICAgaW5kZXggKz0gbGluZXNbaV0ubGVuZ3RoICsgbmV3bGluZUxlbmd0aDtcblxuICAgICAgICByZXR1cm4gaW5kZXggKyBwb3MuY29sdW1uO1xuICAgIH1cbn1cbiJdfQ==