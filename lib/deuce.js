import { getInnerText } from "./lib/dom";
import { addListener, removeListener } from "./lib/event";
import Editor from "./Editor";
import EditorDocument from "./EditorDocument";
import EditSession from "./EditSession";
import UndoManager from "./UndoManager";
import VirtualRenderer from "./VirtualRenderer";
import HtmlMode from "./mode/HtmlMode";
export function edit(source) {
    var element;
    if (typeof source === 'string') {
        var id = source;
        element = document.getElementById(id);
        if (!element) {
            throw new Error("edit can't find div #" + id);
        }
    }
    else {
        element = source;
    }
    if (element && element['env'] && element['env'].editor instanceof Editor) {
        return element['env'].editor;
    }
    var value = "";
    if (element && /input|textarea/i.test(element.tagName)) {
        var oldNode = element;
        value = oldNode.value;
        element = document.createElement("pre");
        oldNode.parentNode.replaceChild(element, oldNode);
    }
    else {
        value = getInnerText(element);
        element.innerHTML = '';
    }
    var editSession = createEditSession(new EditorDocument(value), new HtmlMode());
    var editor = new Editor(new VirtualRenderer(element), editSession);
    var env = {
        document: editSession,
        editor: editor,
        onResize: editor.resize.bind(editor, null)
    };
    if (oldNode)
        env['textarea'] = oldNode;
    addListener(window, "resize", env.onResize);
    editor.on("destroy", function () {
        removeListener(window, "resize", env.onResize);
        env.editor.container['env'] = null;
    });
    editor.container['env'] = editor['env'] = env;
    return editor;
}
;
export function createEditSession(doc, mode, callback) {
    var editSession = new EditSession(doc, mode, callback);
    editSession.setUndoManager(new UndoManager());
    return editSession;
}
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV1Y2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZGV1Y2UudHMiXSwibmFtZXMiOlsiZWRpdCIsImNyZWF0ZUVkaXRTZXNzaW9uIl0sIm1hcHBpbmdzIjoiT0ErQk8sRUFBQyxZQUFZLEVBQUMsTUFBTSxXQUFXO09BQy9CLEVBQUMsV0FBVyxFQUFFLGNBQWMsRUFBQyxNQUFNLGFBQWE7T0FDaEQsTUFBTSxNQUFNLFVBQVU7T0FDdEIsY0FBYyxNQUFNLGtCQUFrQjtPQUN0QyxXQUFXLE1BQU0sZUFBZTtPQUNoQyxXQUFXLE1BQU0sZUFBZTtPQUNoQyxlQUFlLE1BQU0sbUJBQW1CO09BR3hDLFFBQVEsTUFBTSxpQkFBaUI7QUFHdEMscUJBQXFCLE1BQVc7SUFDNUJBLElBQUlBLE9BQW9CQSxDQUFDQTtJQUN6QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsTUFBTUEsS0FBS0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDN0JBLElBQUlBLEVBQUVBLEdBQVdBLE1BQU1BLENBQUNBO1FBQ3hCQSxPQUFPQSxHQUFHQSxRQUFRQSxDQUFDQSxjQUFjQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUN0Q0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDWEEsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0EsdUJBQXVCQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNsREEsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDRkEsT0FBT0EsR0FBR0EsTUFBTUEsQ0FBQ0E7SUFDckJBLENBQUNBO0lBRURBLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLElBQUlBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLE1BQU1BLFlBQVlBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1FBQ3ZFQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUNqQ0EsQ0FBQ0E7SUFFREEsSUFBSUEsS0FBS0EsR0FBR0EsRUFBRUEsQ0FBQ0E7SUFDZkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsSUFBSUEsaUJBQWlCQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNyREEsSUFBSUEsT0FBT0EsR0FBUUEsT0FBT0EsQ0FBQ0E7UUFDM0JBLEtBQUtBLEdBQUdBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBO1FBQ3RCQSxPQUFPQSxHQUFHQSxRQUFRQSxDQUFDQSxhQUFhQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUN4Q0EsT0FBT0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsT0FBT0EsRUFBRUEsT0FBT0EsQ0FBQ0EsQ0FBQ0E7SUFDdERBLENBQUNBO0lBQ0RBLElBQUlBLENBQUNBLENBQUNBO1FBQ0ZBLEtBQUtBLEdBQUdBLFlBQVlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1FBQzlCQSxPQUFPQSxDQUFDQSxTQUFTQSxHQUFHQSxFQUFFQSxDQUFDQTtJQUMzQkEsQ0FBQ0E7SUFFREEsSUFBSUEsV0FBV0EsR0FBR0EsaUJBQWlCQSxDQUFDQSxJQUFJQSxjQUFjQSxDQUFDQSxLQUFLQSxDQUFDQSxFQUFFQSxJQUFJQSxRQUFRQSxFQUFFQSxDQUFDQSxDQUFDQTtJQUUvRUEsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsTUFBTUEsQ0FBQ0EsSUFBSUEsZUFBZUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsRUFBRUEsV0FBV0EsQ0FBQ0EsQ0FBQ0E7SUFHbkVBLElBQUlBLEdBQUdBLEdBQUdBO1FBQ05BLFFBQVFBLEVBQUVBLFdBQVdBO1FBQ3JCQSxNQUFNQSxFQUFFQSxNQUFNQTtRQUNkQSxRQUFRQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxJQUFJQSxDQUFDQTtLQUM3Q0EsQ0FBQ0E7SUFFRkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0E7UUFBQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsR0FBR0EsT0FBT0EsQ0FBQ0E7SUFFdkNBLFdBQVdBLENBQUNBLE1BQU1BLEVBQUVBLFFBQVFBLEVBQUVBLEdBQUdBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO0lBRTVDQSxNQUFNQSxDQUFDQSxFQUFFQSxDQUFDQSxTQUFTQSxFQUFFQTtRQUNqQixjQUFjLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDL0MsR0FBRyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDO0lBQ3ZDLENBQUMsQ0FBQ0EsQ0FBQ0E7SUFFSEEsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0E7SUFFOUNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO0FBQ2xCQSxDQUFDQTtBQUFBLENBQUM7QUFFRixrQ0FBa0MsR0FBbUIsRUFBRSxJQUFLLEVBQUUsUUFBUztJQUNuRUMsSUFBSUEsV0FBV0EsR0FBR0EsSUFBSUEsV0FBV0EsQ0FBQ0EsR0FBR0EsRUFBRUEsSUFBSUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7SUFDdkRBLFdBQVdBLENBQUNBLGNBQWNBLENBQUNBLElBQUlBLFdBQVdBLEVBQUVBLENBQUNBLENBQUNBO0lBQzlDQSxNQUFNQSxDQUFDQSxXQUFXQSxDQUFDQTtBQUN2QkEsQ0FBQ0E7QUFBQSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMCwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIFxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0XG4gKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDpcbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuXG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZVxuICogICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cbiAqICAgICAqIE5laXRoZXIgdGhlIG5hbWUgb2YgQWpheC5vcmcgQi5WLiBub3IgdGhlXG4gKiAgICAgICBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0c1xuICogICAgICAgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXG4gKiBcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiIEFORFxuICogQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRURcbiAqIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkVcbiAqIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIEFKQVguT1JHIEIuVi4gQkUgTElBQkxFIEZPUiBBTllcbiAqIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTXG4gKiAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7XG4gKiBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkRcbiAqIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUXG4gKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJU1xuICogU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG4gKlxuICogKioqKiogRU5EIExJQ0VOU0UgQkxPQ0sgKioqKiogKi9cbi8vcmVxdWlyZShcIi4vbGliL2ZpeG9sZGJyb3dzZXJzXCIpO1xuXG5pbXBvcnQge2dldElubmVyVGV4dH0gZnJvbSBcIi4vbGliL2RvbVwiO1xuaW1wb3J0IHthZGRMaXN0ZW5lciwgcmVtb3ZlTGlzdGVuZXJ9IGZyb20gXCIuL2xpYi9ldmVudFwiO1xuaW1wb3J0IEVkaXRvciBmcm9tIFwiLi9FZGl0b3JcIjtcbmltcG9ydCBFZGl0b3JEb2N1bWVudCBmcm9tIFwiLi9FZGl0b3JEb2N1bWVudFwiO1xuaW1wb3J0IEVkaXRTZXNzaW9uIGZyb20gXCIuL0VkaXRTZXNzaW9uXCI7XG5pbXBvcnQgVW5kb01hbmFnZXIgZnJvbSBcIi4vVW5kb01hbmFnZXJcIjtcbmltcG9ydCBWaXJ0dWFsUmVuZGVyZXIgZnJvbSBcIi4vVmlydHVhbFJlbmRlcmVyXCI7XG5cbi8vIFRoZSBmb2xsb3dpbmcgcmVxdWlyZSgpcyBhcmUgZm9yIGluY2x1c2lvbiBpbiB0aGUgYnVpbHQgYWNlIGZpbGVcbmltcG9ydCBIdG1sTW9kZSBmcm9tIFwiLi9tb2RlL0h0bWxNb2RlXCI7XG5pbXBvcnQgSHRtbFdvcmtlciBmcm9tIFwiLi9tb2RlL0h0bWxXb3JrZXJcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGVkaXQoc291cmNlOiBhbnkpIHtcbiAgICB2YXIgZWxlbWVudDogSFRNTEVsZW1lbnQ7XG4gICAgaWYgKHR5cGVvZiBzb3VyY2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHZhciBpZDogc3RyaW5nID0gc291cmNlO1xuICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xuICAgICAgICBpZiAoIWVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImVkaXQgY2FuJ3QgZmluZCBkaXYgI1wiICsgaWQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBlbGVtZW50ID0gc291cmNlO1xuICAgIH1cblxuICAgIGlmIChlbGVtZW50ICYmIGVsZW1lbnRbJ2VudiddICYmIGVsZW1lbnRbJ2VudiddLmVkaXRvciBpbnN0YW5jZW9mIEVkaXRvcikge1xuICAgICAgICByZXR1cm4gZWxlbWVudFsnZW52J10uZWRpdG9yO1xuICAgIH1cblxuICAgIHZhciB2YWx1ZSA9IFwiXCI7XG4gICAgaWYgKGVsZW1lbnQgJiYgL2lucHV0fHRleHRhcmVhL2kudGVzdChlbGVtZW50LnRhZ05hbWUpKSB7XG4gICAgICAgIHZhciBvbGROb2RlOiBhbnkgPSBlbGVtZW50O1xuICAgICAgICB2YWx1ZSA9IG9sZE5vZGUudmFsdWU7XG4gICAgICAgIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgICBvbGROb2RlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGVsZW1lbnQsIG9sZE5vZGUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdmFsdWUgPSBnZXRJbm5lclRleHQoZWxlbWVudCk7XG4gICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gJyc7XG4gICAgfVxuXG4gICAgdmFyIGVkaXRTZXNzaW9uID0gY3JlYXRlRWRpdFNlc3Npb24obmV3IEVkaXRvckRvY3VtZW50KHZhbHVlKSwgbmV3IEh0bWxNb2RlKCkpO1xuXG4gICAgdmFyIGVkaXRvciA9IG5ldyBFZGl0b3IobmV3IFZpcnR1YWxSZW5kZXJlcihlbGVtZW50KSwgZWRpdFNlc3Npb24pO1xuXG4gICAgLy8gRklYTUU6IFRoZSBmaXJzdCBwcm9wZXJ0eSBpcyBpbmNvcnJlY3RseSBuYW1lZC5cbiAgICB2YXIgZW52ID0ge1xuICAgICAgICBkb2N1bWVudDogZWRpdFNlc3Npb24sXG4gICAgICAgIGVkaXRvcjogZWRpdG9yLFxuICAgICAgICBvblJlc2l6ZTogZWRpdG9yLnJlc2l6ZS5iaW5kKGVkaXRvciwgbnVsbClcbiAgICB9O1xuXG4gICAgaWYgKG9sZE5vZGUpIGVudlsndGV4dGFyZWEnXSA9IG9sZE5vZGU7XG5cbiAgICBhZGRMaXN0ZW5lcih3aW5kb3csIFwicmVzaXplXCIsIGVudi5vblJlc2l6ZSk7XG5cbiAgICBlZGl0b3Iub24oXCJkZXN0cm95XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZW1vdmVMaXN0ZW5lcih3aW5kb3csIFwicmVzaXplXCIsIGVudi5vblJlc2l6ZSk7XG4gICAgICAgIGVudi5lZGl0b3IuY29udGFpbmVyWydlbnYnXSA9IG51bGw7IC8vIHByZXZlbnQgbWVtb3J5IGxlYWsgb24gb2xkIGllXG4gICAgfSk7XG5cbiAgICBlZGl0b3IuY29udGFpbmVyWydlbnYnXSA9IGVkaXRvclsnZW52J10gPSBlbnY7XG5cbiAgICByZXR1cm4gZWRpdG9yO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVkaXRTZXNzaW9uKGRvYzogRWRpdG9yRG9jdW1lbnQsIG1vZGU/LCBjYWxsYmFjaz8pOiBFZGl0U2Vzc2lvbiB7XG4gICAgdmFyIGVkaXRTZXNzaW9uID0gbmV3IEVkaXRTZXNzaW9uKGRvYywgbW9kZSwgY2FsbGJhY2spO1xuICAgIGVkaXRTZXNzaW9uLnNldFVuZG9NYW5hZ2VyKG5ldyBVbmRvTWFuYWdlcigpKTtcbiAgICByZXR1cm4gZWRpdFNlc3Npb247XG59O1xuIl19