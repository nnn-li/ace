require("./lib/fixoldbrowsers");
var dom = require("./lib/dom");
var event = require("./lib/event");
var triton = require('./triton');
var Editor = require("./Editor");
var esm = require("./edit_session");
var undo = require("./undomanager");
var vrm = require("./virtual_renderer");
var wsm = require("./workspace/workspace");
var cfg = require('./config');
require("./worker/worker_client");
require("./keyboard/hash_handler");
require("./placeholder");
require("./multi_select");
require("./mode/folding/fold_mode");
require("./theme/textmate");
require("./ext/error_marker");
exports.config = cfg;
function edit(source, workspace) {
    var element;
    if (typeof source === 'string') {
        var id = source;
        element = document.getElementById(id);
        if (!element) {
            throw new Error("edit can't find div #" + id);
        }
    }
    else {
        element = source;
    }
    if (element && element['env'] && element['env'].editor instanceof Editor) {
        return element['env'].editor;
    }
    var value = "";
    if (element && /input|textarea/i.test(element.tagName)) {
        var oldNode = element;
        value = oldNode.value;
        element = document.createElement("pre");
        oldNode.parentNode.replaceChild(element, oldNode);
    }
    else {
        value = dom.getInnerText(element);
        element.innerHTML = '';
    }
    var editSession = createEditSession(value);
    var editor = new Editor(new vrm.VirtualRenderer(element));
    editor.setSession(editSession);
    var env = {
        document: editSession,
        editor: editor,
        onResize: editor.resize.bind(editor, null)
    };
    if (oldNode)
        env['textarea'] = oldNode;
    event.addListener(window, "resize", env.onResize);
    editor.on("destroy", function () {
        event.removeListener(window, "resize", env.onResize);
        env.editor.container['env'] = null;
    });
    editor.container['env'] = editor['env'] = env;
    return triton.wrap(editor, element, workspace, document);
}
exports.edit = edit;
;
function workspace() {
    return wsm.workspace();
}
exports.workspace = workspace;
;
function createEditSession(text, mode) {
    var doc = new esm.EditSession(text, mode);
    doc.setUndoManager(new undo.UndoManager());
    return doc;
}
exports.createEditSession = createEditSession;
;
exports.EditSession = esm.EditSession;
exports.UndoManager = undo.UndoManager;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2FjZS50cyJdLCJuYW1lcyI6WyJlZGl0Iiwid29ya3NwYWNlIiwiY3JlYXRlRWRpdFNlc3Npb24iXSwibWFwcGluZ3MiOiJBQW9DQSxPQUFPLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUVoQyxJQUFPLEdBQUcsV0FBVyxXQUFXLENBQUMsQ0FBQztBQUNsQyxJQUFPLEtBQUssV0FBVyxhQUFhLENBQUMsQ0FBQztBQUV0QyxJQUFPLE1BQU0sV0FBVyxVQUFVLENBQUMsQ0FBQztBQUNwQyxJQUFPLE1BQU0sV0FBVyxVQUFVLENBQUMsQ0FBQztBQUNwQyxJQUFPLEdBQUcsV0FBVyxnQkFBZ0IsQ0FBQyxDQUFDO0FBQ3ZDLElBQU8sSUFBSSxXQUFXLGVBQWUsQ0FBQyxDQUFDO0FBQ3ZDLElBQU8sR0FBRyxXQUFXLG9CQUFvQixDQUFDLENBQUM7QUFDM0MsSUFBTyxHQUFHLFdBQVcsdUJBQXVCLENBQUMsQ0FBQztBQUM5QyxJQUFPLEdBQUcsV0FBVyxVQUFVLENBQUMsQ0FBQztBQUdqQyxPQUFPLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUNsQyxPQUFPLENBQUMseUJBQXlCLENBQUMsQ0FBQztBQUNuQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDekIsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFDMUIsT0FBTyxDQUFDLDBCQUEwQixDQUFDLENBQUM7QUFDcEMsT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUM7QUFDNUIsT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUM7QUFFbkIsY0FBTSxHQUFHLEdBQUcsQ0FBQztBQWN4QixjQUFxQixNQUFXLEVBQUUsU0FBd0I7SUFDdERBLElBQUlBLE9BQW9CQSxDQUFDQTtJQUN6QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsTUFBTUEsS0FBS0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDN0JBLElBQUlBLEVBQUVBLEdBQVdBLE1BQU1BLENBQUNBO1FBQ3hCQSxPQUFPQSxHQUFHQSxRQUFRQSxDQUFDQSxjQUFjQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUN0Q0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDWEEsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0EsdUJBQXVCQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNsREEsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDRkEsT0FBT0EsR0FBR0EsTUFBTUEsQ0FBQ0E7SUFDckJBLENBQUNBO0lBRURBLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLElBQUlBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLE1BQU1BLFlBQVlBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1FBQ3ZFQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUNqQ0EsQ0FBQ0E7SUFFREEsSUFBSUEsS0FBS0EsR0FBR0EsRUFBRUEsQ0FBQ0E7SUFDZkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsSUFBSUEsaUJBQWlCQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNyREEsSUFBSUEsT0FBT0EsR0FBUUEsT0FBT0EsQ0FBQ0E7UUFDM0JBLEtBQUtBLEdBQUdBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBO1FBQ3RCQSxPQUFPQSxHQUFHQSxRQUFRQSxDQUFDQSxhQUFhQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUN4Q0EsT0FBT0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsT0FBT0EsRUFBRUEsT0FBT0EsQ0FBQ0EsQ0FBQ0E7SUFDdERBLENBQUNBO0lBQ0RBLElBQUlBLENBQUNBLENBQUNBO1FBQ0ZBLEtBQUtBLEdBQUdBLEdBQUdBLENBQUNBLFlBQVlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1FBQ2xDQSxPQUFPQSxDQUFDQSxTQUFTQSxHQUFHQSxFQUFFQSxDQUFDQTtJQUMzQkEsQ0FBQ0E7SUFFREEsSUFBSUEsV0FBV0EsR0FBR0EsaUJBQWlCQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtJQUUzQ0EsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsTUFBTUEsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsZUFBZUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDMURBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBO0lBRy9CQSxJQUFJQSxHQUFHQSxHQUFHQTtRQUNOQSxRQUFRQSxFQUFFQSxXQUFXQTtRQUNyQkEsTUFBTUEsRUFBRUEsTUFBTUE7UUFDZEEsUUFBUUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0E7S0FDN0NBLENBQUNBO0lBRUZBLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBO1FBQUNBLEdBQUdBLENBQUNBLFVBQVVBLENBQUNBLEdBQUdBLE9BQU9BLENBQUNBO0lBQ3ZDQSxLQUFLQSxDQUFDQSxXQUFXQSxDQUFDQSxNQUFNQSxFQUFFQSxRQUFRQSxFQUFFQSxHQUFHQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQTtJQUNsREEsTUFBTUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsU0FBU0EsRUFBRUE7UUFDakIsS0FBSyxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNyRCxHQUFHLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUM7SUFDdkMsQ0FBQyxDQUFDQSxDQUFDQTtJQUNIQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtJQUM5Q0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsT0FBT0EsRUFBRUEsU0FBU0EsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7QUFDN0RBLENBQUNBO0FBakRlLFlBQUksT0FpRG5CLENBQUE7QUFBQSxDQUFDO0FBS0Y7SUFDSUMsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0E7QUFDM0JBLENBQUNBO0FBRmUsaUJBQVMsWUFFeEIsQ0FBQTtBQUFBLENBQUM7QUFRRiwyQkFBa0MsSUFBSSxFQUFFLElBQUs7SUFDekNDLElBQUlBLEdBQUdBLEdBQUdBLElBQUlBLEdBQUdBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO0lBQzFDQSxHQUFHQSxDQUFDQSxjQUFjQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQSxDQUFDQTtJQUMzQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7QUFDZkEsQ0FBQ0E7QUFKZSx5QkFBaUIsb0JBSWhDLENBQUE7QUFBQSxDQUFDO0FBRVMsbUJBQVcsR0FBRyxHQUFHLENBQUMsV0FBVyxDQUFDO0FBRTlCLG1CQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qICoqKioqIEJFR0lOIExJQ0VOU0UgQkxPQ0sgKioqKipcbiAqIERpc3RyaWJ1dGVkIHVuZGVyIHRoZSBCU0QgbGljZW5zZTpcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTAsIEFqYXgub3JnIEIuVi5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBcbiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dFxuICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLlxuICogICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGVcbiAqICAgICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG4gKiAgICAgKiBOZWl0aGVyIHRoZSBuYW1lIG9mIEFqYXgub3JnIEIuVi4gbm9yIHRoZVxuICogICAgICAgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHNcbiAqICAgICAgIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLlxuICogXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkRcbiAqIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEXG4gKiBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFXG4gKiBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBBSkFYLk9SRyBCLlYuIEJFIExJQUJMRSBGT1IgQU5ZXG4gKiBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFU1xuICogKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTO1xuICogTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EXG4gKiBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVNcbiAqIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICpcbiAqICoqKioqIEVORCBMSUNFTlNFIEJMT0NLICoqKioqICovXG5cbi8qKlxuICogVGhlIG1haW4gY2xhc3MgcmVxdWlyZWQgdG8gc2V0IHVwIGFuIEFjZSBpbnN0YW5jZSBpbiB0aGUgYnJvd3Nlci5cbiAqXG4gKiBAY2xhc3MgQWNlXG4gKiovXG5cbnJlcXVpcmUoXCIuL2xpYi9maXhvbGRicm93c2Vyc1wiKTtcblxuaW1wb3J0IGRvbSA9IHJlcXVpcmUoXCIuL2xpYi9kb21cIik7XG5pbXBvcnQgZXZlbnQgPSByZXF1aXJlKFwiLi9saWIvZXZlbnRcIik7XG5cbmltcG9ydCB0cml0b24gPSByZXF1aXJlKCcuL3RyaXRvbicpO1xuaW1wb3J0IEVkaXRvciA9IHJlcXVpcmUoXCIuL0VkaXRvclwiKTtcbmltcG9ydCBlc20gPSByZXF1aXJlKFwiLi9lZGl0X3Nlc3Npb25cIik7XG5pbXBvcnQgdW5kbyA9IHJlcXVpcmUoXCIuL3VuZG9tYW5hZ2VyXCIpO1xuaW1wb3J0IHZybSA9IHJlcXVpcmUoXCIuL3ZpcnR1YWxfcmVuZGVyZXJcIik7XG5pbXBvcnQgd3NtID0gcmVxdWlyZShcIi4vd29ya3NwYWNlL3dvcmtzcGFjZVwiKTtcbmltcG9ydCBjZmcgPSByZXF1aXJlKCcuL2NvbmZpZycpO1xuXG4vLyBUaGUgZm9sbG93aW5nIHJlcXVpcmUoKXMgYXJlIGZvciBpbmNsdXNpb24gaW4gdGhlIGJ1aWx0IGFjZSBmaWxlXG5yZXF1aXJlKFwiLi93b3JrZXIvd29ya2VyX2NsaWVudFwiKTtcbnJlcXVpcmUoXCIuL2tleWJvYXJkL2hhc2hfaGFuZGxlclwiKTtcbnJlcXVpcmUoXCIuL3BsYWNlaG9sZGVyXCIpO1xucmVxdWlyZShcIi4vbXVsdGlfc2VsZWN0XCIpO1xucmVxdWlyZShcIi4vbW9kZS9mb2xkaW5nL2ZvbGRfbW9kZVwiKTtcbnJlcXVpcmUoXCIuL3RoZW1lL3RleHRtYXRlXCIpO1xucmVxdWlyZShcIi4vZXh0L2Vycm9yX21hcmtlclwiKTtcblxuZXhwb3J0IHZhciBjb25maWcgPSBjZmc7XG5cbi8qKlxuICogUHJvdmlkZXMgYWNjZXNzIHRvIHJlcXVpcmUgaW4gcGFja2VkIG5vY29uZmxpY3QgbW9kZVxuICogQHBhcmFtIHtTdHJpbmd9IG1vZHVsZU5hbWVcbiAqIEByZXR1cm5zIHtPYmplY3R9XG4gKiovXG4vLyBGSVhNRTogVHJ5aW5nIHRvIGV4cG9ydCB0aGlzIGluIHRoZSBBQ0UgbmFtZXNwYWNlIGlzIHByb2JsZW1hdGljIGluIFR5cGVTY3JpcHQuXG4vLyBleHBvcnQgdmFyIHJlcXVpcmUgPSByZXF1aXJlO1xuXG4vKipcbiAqIEVtYmVkcyB0aGUgQWNlIGVkaXRvciBpbnRvIHRoZSBET00sIGF0IHRoZSBlbGVtZW50IHByb3ZpZGVkIGJ5IGBlbGAuXG4gKiBAcGFyYW0ge1N0cmluZyB8IERPTUVsZW1lbnR9IGVsIEVpdGhlciB0aGUgaWQgb2YgYW4gZWxlbWVudCwgb3IgdGhlIGVsZW1lbnQgaXRzZWxmXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlZGl0KHNvdXJjZTogYW55LCB3b3Jrc3BhY2U6IHdzbS5Xb3Jrc3BhY2UpIHtcbiAgICB2YXIgZWxlbWVudDogSFRNTEVsZW1lbnQ7XG4gICAgaWYgKHR5cGVvZiBzb3VyY2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHZhciBpZDogc3RyaW5nID0gc291cmNlO1xuICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xuICAgICAgICBpZiAoIWVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImVkaXQgY2FuJ3QgZmluZCBkaXYgI1wiICsgaWQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBlbGVtZW50ID0gc291cmNlO1xuICAgIH1cblxuICAgIGlmIChlbGVtZW50ICYmIGVsZW1lbnRbJ2VudiddICYmIGVsZW1lbnRbJ2VudiddLmVkaXRvciBpbnN0YW5jZW9mIEVkaXRvcikge1xuICAgICAgICByZXR1cm4gZWxlbWVudFsnZW52J10uZWRpdG9yO1xuICAgIH1cblxuICAgIHZhciB2YWx1ZSA9IFwiXCI7XG4gICAgaWYgKGVsZW1lbnQgJiYgL2lucHV0fHRleHRhcmVhL2kudGVzdChlbGVtZW50LnRhZ05hbWUpKSB7XG4gICAgICAgIHZhciBvbGROb2RlOiBhbnkgPSBlbGVtZW50O1xuICAgICAgICB2YWx1ZSA9IG9sZE5vZGUudmFsdWU7XG4gICAgICAgIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgICBvbGROb2RlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGVsZW1lbnQsIG9sZE5vZGUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdmFsdWUgPSBkb20uZ2V0SW5uZXJUZXh0KGVsZW1lbnQpO1xuICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9ICcnO1xuICAgIH1cblxuICAgIHZhciBlZGl0U2Vzc2lvbiA9IGNyZWF0ZUVkaXRTZXNzaW9uKHZhbHVlKTtcblxuICAgIHZhciBlZGl0b3IgPSBuZXcgRWRpdG9yKG5ldyB2cm0uVmlydHVhbFJlbmRlcmVyKGVsZW1lbnQpKTtcbiAgICBlZGl0b3Iuc2V0U2Vzc2lvbihlZGl0U2Vzc2lvbik7XG5cbiAgICAvLyBGSVhNRTogVGhlIGZpcnN0IHByb3BlcnR5IGlzIGluY29ycmVjdGx5IG5hbWVkLlxuICAgIHZhciBlbnYgPSB7XG4gICAgICAgIGRvY3VtZW50OiBlZGl0U2Vzc2lvbixcbiAgICAgICAgZWRpdG9yOiBlZGl0b3IsXG4gICAgICAgIG9uUmVzaXplOiBlZGl0b3IucmVzaXplLmJpbmQoZWRpdG9yLCBudWxsKVxuICAgIH07XG5cbiAgICBpZiAob2xkTm9kZSkgZW52Wyd0ZXh0YXJlYSddID0gb2xkTm9kZTtcbiAgICBldmVudC5hZGRMaXN0ZW5lcih3aW5kb3csIFwicmVzaXplXCIsIGVudi5vblJlc2l6ZSk7XG4gICAgZWRpdG9yLm9uKFwiZGVzdHJveVwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgZXZlbnQucmVtb3ZlTGlzdGVuZXIod2luZG93LCBcInJlc2l6ZVwiLCBlbnYub25SZXNpemUpO1xuICAgICAgICBlbnYuZWRpdG9yLmNvbnRhaW5lclsnZW52J10gPSBudWxsOyAvLyBwcmV2ZW50IG1lbW9yeSBsZWFrIG9uIG9sZCBpZVxuICAgIH0pO1xuICAgIGVkaXRvci5jb250YWluZXJbJ2VudiddID0gZWRpdG9yWydlbnYnXSA9IGVudjtcbiAgICByZXR1cm4gdHJpdG9uLndyYXAoZWRpdG9yLCBlbGVtZW50LCB3b3Jrc3BhY2UsIGRvY3VtZW50KTtcbn07XG5cbi8qKlxuICogRnVuY3Rpb25hbCBjb25zdHJ1Y3RvciBmb3IgY3JlYXRpbmcgYSBuZXcgV29ya3NwYWNlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gd29ya3NwYWNlKCkge1xuICAgIHJldHVybiB3c20ud29ya3NwYWNlKCk7XG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgW1tFZGl0U2Vzc2lvbl1dLCBhbmQgcmV0dXJucyB0aGUgYXNzb2NpYXRlZCBbW0RvY3VtZW50XV0uXG4gKiBAcGFyYW0ge0RvY3VtZW50IHwgU3RyaW5nfSB0ZXh0IHs6dGV4dFBhcmFtfVxuICogQHBhcmFtIHtUZXh0TW9kZX0gbW9kZSB7Om1vZGVQYXJhbX1cbiAqIFxuICoqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVkaXRTZXNzaW9uKHRleHQsIG1vZGU/KSB7XG4gICAgdmFyIGRvYyA9IG5ldyBlc20uRWRpdFNlc3Npb24odGV4dCwgbW9kZSk7XG4gICAgZG9jLnNldFVuZG9NYW5hZ2VyKG5ldyB1bmRvLlVuZG9NYW5hZ2VyKCkpO1xuICAgIHJldHVybiBkb2M7XG59O1xuXG5leHBvcnQgdmFyIEVkaXRTZXNzaW9uID0gZXNtLkVkaXRTZXNzaW9uO1xuXG5leHBvcnQgdmFyIFVuZG9NYW5hZ2VyID0gdW5kby5VbmRvTWFuYWdlcjtcbiJdfQ==