var vrm = require("../virtual_renderer");
var Editor = require("../Editor");
var rm = require("../range");
var event = require("../lib/event");
var lng = require("../lib/lang");
var dom = require("../lib/dom");
var noop = function () { };
var ListViewPopup = (function () {
    function ListViewPopup(parentNode) {
        this.$borderSize = 1;
        this.$imageSize = 0;
        this.hoverMarker = new rm.Range(-1, 0, -1, Infinity);
        this.selectionMarker = new rm.Range(-1, 0, -1, Infinity);
        this.isOpen = false;
        this.isTopdown = false;
        this.data = [];
        var self = this;
        function createEditor(el) {
            var renderer = new vrm.VirtualRenderer(el);
            renderer.content.style.cursor = "default";
            renderer.setStyle("ace_autocomplete");
            renderer.$cursorLayer.restartTimer = noop;
            renderer.$cursorLayer.element.style.opacity = "0";
            renderer.$maxLines = 8;
            renderer.$keepTextAreaAtCursor = false;
            var editor = new Editor(renderer);
            editor.setHighlightActiveLine(false);
            editor.setShowPrintMargin(false);
            editor.renderer.setShowGutter(false);
            editor.renderer.setHighlightGutterLine(false);
            editor.setOption("displayIndentGuides", false);
            editor.setOption("dragDelay", 150);
            editor.focus = noop;
            editor.$isFocused = true;
            editor.setHighlightActiveLine(false);
            editor.session.highlight("");
            editor.session.$searchHighlight.clazz = "ace_highlight-marker";
            return editor;
        }
        var el = dom.createElement("div");
        this.editor = createEditor(el);
        if (parentNode) {
            parentNode.appendChild(el);
        }
        el.style.display = "none";
        this.editor.on("mousedown", function (e) {
            var pos = e.getDocumentPosition();
            self.editor.selection.moveToPosition(pos);
            self.selectionMarker.start.row = self.selectionMarker.end.row = pos.row;
            e.stop();
        });
        this.selectionMarkerId = this.editor.session.addMarker(this.selectionMarker, "ace_active-line", "fullLine");
        this.setSelectOnHover(false);
        this.editor.on("mousemove", function (e) {
            if (!self.lastMouseEvent) {
                self.lastMouseEvent = e;
                return;
            }
            if (self.lastMouseEvent.x == e.x && self.lastMouseEvent.y == e.y) {
                return;
            }
            self.lastMouseEvent = e;
            self.lastMouseEventScrollTop = self.editor.renderer.scrollTop;
            var row = self.lastMouseEvent.getDocumentPosition().row;
            if (self.hoverMarker.start.row != row) {
                if (!self.hoverMarkerId) {
                    self.setRow(row);
                }
                self.setHoverMarker(row);
            }
        });
        this.editor.renderer.on("beforeRender", function () {
            if (self.lastMouseEvent && self.hoverMarker.start.row != -1) {
                self.lastMouseEvent.$pos = null;
                var row = self.lastMouseEvent.getDocumentPosition().row;
                if (!self.hoverMarkerId) {
                    self.setRow(row);
                }
                self.setHoverMarker(row, true);
            }
        });
        this.editor.renderer.on("afterRender", function () {
            var row = self.getRow();
            var t = self.editor.renderer.$textLayer;
            var selected = t.element.childNodes[row - t.config.firstRow];
            if (selected == t['selectedNode'])
                return;
            if (t['selectedNode'])
                dom.removeCssClass(t['selectedNode'], "ace_selected");
            t['selectedNode'] = selected;
            if (selected)
                dom.addCssClass(selected, "ace_selected");
        });
        function hideHoverMarker() { self.setHoverMarker(-1); }
        event.addListener(this.editor.container, "mouseout", hideHoverMarker);
        this.editor.on("hide", hideHoverMarker);
        this.editor.on("changeSelection", hideHoverMarker);
        this.editor.session.doc.getLength = function () {
            return self.data.length;
        };
        this.editor.session.doc.getLine = function (i) {
            var data = self.data[i];
            if (typeof data == "string") {
                return data;
            }
            return (data && data.value) || "";
        };
        var bgTokenizer = this.editor.session.bgTokenizer;
        bgTokenizer.$tokenizeRow = function (dataIndex) {
            var data = self.data[dataIndex];
            var tokens = [];
            if (!data)
                return tokens;
            if (typeof data == "string")
                data = { value: data };
            if (!data.caption)
                data.caption = data.value || data.name;
            var last = -1;
            var flag, c;
            for (var cIndex = 0, length = data.caption.length; cIndex < length; cIndex++) {
                c = data.caption[cIndex];
                flag = data.matchMask & (1 << cIndex) ? 1 : 0;
                if (last !== flag) {
                    tokens.push({ type: data.className || "" + (flag ? "completion-highlight" : ""), value: c });
                    last = flag;
                }
                else {
                    tokens[tokens.length - 1].value += c;
                }
            }
            if (data.meta) {
                var maxW = self.editor.renderer.$size.scrollerWidth / self.editor.renderer.layerConfig.characterWidth;
                if (data.meta.length + data.caption.length < maxW - 2)
                    tokens.push({ type: "rightAlignedText", value: data.meta });
            }
            return tokens;
        };
        bgTokenizer.$updateOnChange = noop;
        bgTokenizer.start = noop;
        this.editor.session.$computeWidth = function () {
            return self.screenWidth = 0;
        };
        this.editor.on("changeSelection", function () {
            if (this.isOpen) {
                this.setRow(this.popup.selection.lead.row);
            }
        });
    }
    ListViewPopup.prototype.show = function (pos, lineHeight, topdownOnly) {
        var el = this.editor.container;
        var screenHeight = window.innerHeight;
        var screenWidth = window.innerWidth;
        var renderer = this.editor.renderer;
        var maxH = renderer.$maxLines * lineHeight * 1.4;
        var top = pos.top + this.$borderSize;
        if (top + maxH > screenHeight - lineHeight && !topdownOnly) {
            el.style.top = "";
            el.style.bottom = screenHeight - top + "px";
            this.isTopdown = false;
        }
        else {
            top += lineHeight;
            el.style.top = top + "px";
            el.style.bottom = "";
            this.isTopdown = true;
        }
        el.style.display = "";
        renderer.$textLayer.checkForSizeChanges();
        var left = pos.left;
        if (left + el.offsetWidth > screenWidth) {
            left = screenWidth - el.offsetWidth;
        }
        el.style.left = left + "px";
        this.editor._signal("show");
        this.lastMouseEvent = null;
        this.isOpen = true;
    };
    ListViewPopup.prototype.hide = function () {
        this.editor.container.style.display = "none";
        this.editor._signal("hide");
        this.isOpen = false;
    };
    ListViewPopup.prototype.setData = function (list) {
        this.data = list || [];
        this.editor.setValue(lng.stringRepeat("\n", list.length), -1);
        this.setRow(0);
    };
    ListViewPopup.prototype.getData = function (row) {
        return this.data[row];
    };
    ListViewPopup.prototype.on = function (eventName, callback, capturing) {
        return this.editor.on(eventName, callback, capturing);
    };
    ListViewPopup.prototype.getTextLeftOffset = function () {
        return this.$borderSize + this.editor.renderer.$padding + this.$imageSize;
    };
    ListViewPopup.prototype.setSelectOnHover = function (val) {
        if (!val) {
            this.hoverMarkerId = this.editor.session.addMarker(this.hoverMarker, "ace_line-hover", "fullLine");
        }
        else if (this.hoverMarkerId) {
            this.editor.session.removeMarker(this.hoverMarkerId);
            this.hoverMarkerId = null;
        }
    };
    ListViewPopup.prototype.setHoverMarker = function (row, suppressRedraw) {
        if (row !== this.hoverMarker.start.row) {
            this.hoverMarker.start.row = this.hoverMarker.end.row = row;
            if (!suppressRedraw) {
                this.editor.session._emit("changeBackMarker");
            }
            this.editor._emit("changeHoverMarker");
        }
    };
    ListViewPopup.prototype.getHoveredRow = function () {
        return this.hoverMarker.start.row;
    };
    ListViewPopup.prototype.getRow = function () {
        return this.selectionMarker.start.row;
    };
    ListViewPopup.prototype.setRow = function (row) {
        row = Math.max(-1, Math.min(this.data.length, row));
        if (this.selectionMarker.start.row != row) {
            this.editor.selection.clearSelection();
            this.selectionMarker.start.row = this.selectionMarker.end.row = row || 0;
            this.editor.session._emit("changeBackMarker");
            this.editor.moveCursorTo(row || 0, 0);
            if (this.isOpen) {
                this.editor._signal("select");
            }
        }
    };
    ListViewPopup.prototype.setTheme = function (theme) {
        this.editor.setTheme(theme);
    };
    ListViewPopup.prototype.setFontSize = function (fontSize) {
        this.editor.setFontSize(fontSize);
    };
    Object.defineProperty(ListViewPopup.prototype, "focus", {
        get: function () {
            return this.editor.focus;
        },
        enumerable: true,
        configurable: true
    });
    ListViewPopup.prototype.getLength = function () {
        return this.editor.session.getLength();
    };
    Object.defineProperty(ListViewPopup.prototype, "container", {
        get: function () {
            return this.editor.container;
        },
        enumerable: true,
        configurable: true
    });
    return ListViewPopup;
})();
exports.ListViewPopup = ListViewPopup;
dom.importCssString("\
.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {\
    background-color: #CAD6FA;\
    z-index: 1;\
}\
.ace_editor.ace_autocomplete .ace_line-hover {\
    border: 1px solid #abbffe;\
    margin-top: -1px;\
    background: rgba(233,233,253,0.4);\
}\
.ace_editor.ace_autocomplete .ace_line-hover {\
    position: absolute;\
    z-index: 2;\
}\
.ace_editor.ace_autocomplete .ace_scroller {\
   background: none;\
   border: none;\
   box-shadow: none;\
}\
.ace_rightAlignedText {\
    color: gray;\
    display: inline-block;\
    position: absolute;\
    right: 4px;\
    text-align: right;\
    z-index: -1;\
}\
.ace_editor.ace_autocomplete .ace_completion-highlight{\
    color: #000;\
    text-shadow: 0 0 0.01em;\
}\
.ace_editor.ace_autocomplete {\
    width: 280px;\
    z-index: 200000;\
    background: #fbfbfb;\
    color: #444;\
    border: 1px lightgray solid;\
    position: fixed;\
    box-shadow: 2px 3px 5px rgba(0,0,0,.2);\
    line-height: 1.4;\
}");
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wdXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYXV0b2NvbXBsZXRlL3BvcHVwLnRzIl0sIm5hbWVzIjpbIkxpc3RWaWV3UG9wdXAiLCJMaXN0Vmlld1BvcHVwLmNvbnN0cnVjdG9yIiwiTGlzdFZpZXdQb3B1cC5jb25zdHJ1Y3Rvci5jcmVhdGVFZGl0b3IiLCJMaXN0Vmlld1BvcHVwLmNvbnN0cnVjdG9yLmhpZGVIb3Zlck1hcmtlciIsIkxpc3RWaWV3UG9wdXAuc2hvdyIsIkxpc3RWaWV3UG9wdXAuaGlkZSIsIkxpc3RWaWV3UG9wdXAuc2V0RGF0YSIsIkxpc3RWaWV3UG9wdXAuZ2V0RGF0YSIsIkxpc3RWaWV3UG9wdXAub24iLCJMaXN0Vmlld1BvcHVwLmdldFRleHRMZWZ0T2Zmc2V0IiwiTGlzdFZpZXdQb3B1cC5zZXRTZWxlY3RPbkhvdmVyIiwiTGlzdFZpZXdQb3B1cC5zZXRIb3Zlck1hcmtlciIsIkxpc3RWaWV3UG9wdXAuZ2V0SG92ZXJlZFJvdyIsIkxpc3RWaWV3UG9wdXAuZ2V0Um93IiwiTGlzdFZpZXdQb3B1cC5zZXRSb3ciLCJMaXN0Vmlld1BvcHVwLnNldFRoZW1lIiwiTGlzdFZpZXdQb3B1cC5zZXRGb250U2l6ZSIsIkxpc3RWaWV3UG9wdXAuZm9jdXMiLCJMaXN0Vmlld1BvcHVwLmdldExlbmd0aCIsIkxpc3RWaWV3UG9wdXAuY29udGFpbmVyIl0sIm1hcHBpbmdzIjoiQUErQkEsSUFBTyxHQUFHLFdBQVcscUJBQXFCLENBQUMsQ0FBQztBQUM1QyxJQUFPLE1BQU0sV0FBVyxXQUFXLENBQUMsQ0FBQztBQUNyQyxJQUFPLEVBQUUsV0FBVyxVQUFVLENBQUMsQ0FBQztBQUNoQyxJQUFPLEtBQUssV0FBVyxjQUFjLENBQUMsQ0FBQztBQUN2QyxJQUFPLEdBQUcsV0FBVyxhQUFhLENBQUMsQ0FBQztBQUNwQyxJQUFPLEdBQUcsV0FBVyxZQUFZLENBQUMsQ0FBQztBQUVuQyxJQUFJLElBQUksR0FBRyxjQUFhLENB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QSxHQUFHQSxNQUFNQSxDQUFDQSxXQUFXQSxDQUFDQTtRQUN0Q0EsSUFBSUEsV0FBV0EsR0FBR0EsTUFBTUEsQ0FBQ0EsVUFBVUEsQ0FBQ0E7UUFDcENBLElBQUlBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBO1FBRXBDQSxJQUFJQSxJQUFJQSxHQUFHQSxRQUFRQSxDQUFDQSxTQUFTQSxHQUFHQSxVQUFVQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNqREEsSUFBSUEsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7UUFDckNBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLElBQUlBLEdBQUdBLFlBQVlBLEdBQUdBLFVBQVVBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBO1lBQ3pEQSxFQUFFQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxDQUFDQTtZQUNsQkEsRUFBRUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsWUFBWUEsR0FBR0EsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDNUNBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLEtBQUtBLENBQUNBO1FBQzNCQSxDQUFDQTtRQUNEQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNGQSxHQUFHQSxJQUFJQSxVQUFVQSxDQUFDQTtZQUNsQkEsRUFBRUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDMUJBLEVBQUVBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLEVBQUVBLENBQUNBO1lBQ3JCQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUMxQkEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDdEJBLFFBQVFBLENBQUNBLFVBQVVBLENBQUNBLG1CQUFtQkEsRUFBRUEsQ0FBQ0E7UUFFMUNBLElBQUlBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBO1FBQ3BCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxFQUFFQSxDQUFDQSxXQUFXQSxHQUFHQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN0Q0EsSUFBSUEsR0FBR0EsV0FBV0EsR0FBR0EsRUFBRUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7UUFDeENBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBRTVCQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUM1QkEsSUFBSUEsQ0FBQ0EsY0FBY0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDM0JBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBO0lBQ3ZCQSxDQUFDQTtJQUNESiw0QkFBSUEsR0FBSkE7UUFDSUssSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFDN0NBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQzVCQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxLQUFLQSxDQUFDQTtJQUN4QkEsQ0FBQ0E7SUFDREwsK0JBQU9BLEdBQVBBLFVBQVFBLElBQUlBO1FBQ1JNLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLElBQUlBLEVBQUVBLENBQUNBO1FBQ3ZCQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxZQUFZQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUM5REEsSUFBSUEsQ0FBQ0EsTUFB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REEsaUNBQVNBLEdBQVRBO1FBQ0lrQixNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxTQUFTQSxFQUFFQSxDQUFDQTtJQUMzQ0EsQ0FBQ0E7SUFFRGxCLHNCQUFJQSxvQ0FBU0E7YUFBYkE7WUFDSW1CLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBO1FBQ2pDQSxDQUFDQTs7O09BQUFuQjtJQUNMQSxvQkFBQ0E7QUFBREEsQ0FBQ0EsQUExUkQsSUEwUkM7QUExUlkscUJBQWEsZ0JBMFJ6QixDQUFBO0FBRUQsR0FBRyxDQUFDLGVBQWUsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztFQXdDbEIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMiwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXRcbiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuICogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlXG4gKiAgICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICogICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBBamF4Lm9yZyBCLlYuIG5vciB0aGVcbiAqICAgICAgIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzXG4gKiAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cbiAqXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkRcbiAqIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEXG4gKiBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFXG4gKiBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBBSkFYLk9SRyBCLlYuIEJFIExJQUJMRSBGT1IgQU5ZXG4gKiBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFU1xuICogKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTO1xuICogTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EXG4gKiBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVNcbiAqIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICpcbiAqICoqKioqIEVORCBMSUNFTlNFIEJMT0NLICoqKioqICovXG5cbmltcG9ydCBlc20gPSByZXF1aXJlKFwiLi4vZWRpdF9zZXNzaW9uXCIpO1xuaW1wb3J0IHZybSA9IHJlcXVpcmUoXCIuLi92aXJ0dWFsX3JlbmRlcmVyXCIpO1xuaW1wb3J0IEVkaXRvciA9IHJlcXVpcmUoXCIuLi9FZGl0b3JcIik7XG5pbXBvcnQgcm0gPSByZXF1aXJlKFwiLi4vcmFuZ2VcIik7XG5pbXBvcnQgZXZlbnQgPSByZXF1aXJlKFwiLi4vbGliL2V2ZW50XCIpO1xuaW1wb3J0IGxuZyA9IHJlcXVpcmUoXCIuLi9saWIvbGFuZ1wiKTtcbmltcG9ydCBkb20gPSByZXF1aXJlKFwiLi4vbGliL2RvbVwiKTtcblxudmFyIG5vb3AgPSBmdW5jdGlvbigpIHsgfTtcblxuZXhwb3J0IGludGVyZmFjZSBMaXN0VmlldyB7XG4gICAgaXNPcGVuOiBib29sZWFuO1xuICAgIGZvY3VzO1xuICAgIGNvbnRhaW5lcjtcbiAgICBvbihldmVudE5hbWU6IHN0cmluZywgY2FsbGJhY2ssIGNhcHR1cmluZz86IGJvb2xlYW4pO1xuICAgIGdldERhdGEocm93OiBudW1iZXIpO1xuICAgIHNldERhdGEoZGF0YTogc3RyaW5nW10pO1xuICAgIGdldFJvdygpO1xuICAgIHNldFJvdyhyb3c6IG51bWJlcik7XG4gICAgZ2V0VGV4dExlZnRPZmZzZXQoKTogbnVtYmVyO1xuICAgIHNob3cocG9zLCBsaW5lSGVpZ2h0LCB0b3Bkb3duT25seT8pOiB2b2lkO1xuICAgIGhpZGUoKTtcbiAgICBzZXRUaGVtZSh0aGVtZTogc3RyaW5nKTogdm9pZDtcbiAgICBzZXRGb250U2l6ZShmb250U2l6ZSk6IHZvaWQ7XG4gICAgZ2V0TGVuZ3RoKCk6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIExpc3RWaWV3UG9wdXAgaW1wbGVtZW50cyBMaXN0VmlldyB7XG4gICAgcHJpdmF0ZSBlZGl0b3I6IEVkaXRvcjtcbiAgICBwcml2YXRlICRib3JkZXJTaXplID0gMTtcbiAgICBwcml2YXRlICRpbWFnZVNpemUgPSAwO1xuICAgIHByaXZhdGUgaG92ZXJNYXJrZXIgPSBuZXcgcm0uUmFuZ2UoLTEsIDAsIC0xLCBJbmZpbml0eSk7XG4gICAgcHJpdmF0ZSBob3Zlck1hcmtlcklkOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBzZWxlY3Rpb25NYXJrZXIgPSBuZXcgcm0uUmFuZ2UoLTEsIDAsIC0xLCBJbmZpbml0eSk7XG4gICAgcHJpdmF0ZSBzZWxlY3Rpb25NYXJrZXJJZDogbnVtYmVyO1xuICAgIHB1YmxpYyBpc09wZW4gPSBmYWxzZTtcbiAgICBwcml2YXRlIGlzVG9wZG93biA9IGZhbHNlO1xuICAgIHByaXZhdGUgbGFzdE1vdXNlRXZlbnQ6IGFueTtcbiAgICBwcml2YXRlIGxhc3RNb3VzZUV2ZW50U2Nyb2xsVG9wO1xuICAgIHByaXZhdGUgZGF0YTogYW55W10gPSBbXTtcbiAgICBwcml2YXRlIHNjcmVlbldpZHRoO1xuICAgIGNvbnN0cnVjdG9yKHBhcmVudE5vZGU6IE5vZGUpIHtcbiAgICAgICAgLy8gQ2FjaGUgdGhlICd0aGlzJyBwb2ludGVyIGZvciBldmVudCBoYW5kbGVycy5cbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUVkaXRvcihlbDogSFRNTERpdkVsZW1lbnQpIHtcbiAgICAgICAgICAgIHZhciByZW5kZXJlciA9IG5ldyB2cm0uVmlydHVhbFJlbmRlcmVyKGVsKTtcblxuICAgICAgICAgICAgcmVuZGVyZXIuY29udGVudC5zdHlsZS5jdXJzb3IgPSBcImRlZmF1bHRcIjtcbiAgICAgICAgICAgIHJlbmRlcmVyLnNldFN0eWxlKFwiYWNlX2F1dG9jb21wbGV0ZVwiKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLiRjdXJzb3JMYXllci5yZXN0YXJ0VGltZXIgPSBub29wO1xuICAgICAgICAgICAgcmVuZGVyZXIuJGN1cnNvckxheWVyLmVsZW1lbnQuc3R5bGUub3BhY2l0eSA9IFwiMFwiO1xuICAgICAgICAgICAgcmVuZGVyZXIuJG1heExpbmVzID0gODtcbiAgICAgICAgICAgIHJlbmRlcmVyLiRrZWVwVGV4dEFyZWFBdEN1cnNvciA9IGZhbHNlO1xuXG4gICAgICAgICAgICB2YXIgZWRpdG9yID0gbmV3IEVkaXRvcihyZW5kZXJlcik7XG5cbiAgICAgICAgICAgIGVkaXRvci5zZXRIaWdobGlnaHRBY3RpdmVMaW5lKGZhbHNlKTtcbiAgICAgICAgICAgIGVkaXRvci5zZXRTaG93UHJpbnRNYXJnaW4oZmFsc2UpO1xuICAgICAgICAgICAgZWRpdG9yLnJlbmRlcmVyLnNldFNob3dHdXR0ZXIoZmFsc2UpO1xuICAgICAgICAgICAgZWRpdG9yLnJlbmRlcmVyLnNldEhpZ2hsaWdodEd1dHRlckxpbmUoZmFsc2UpO1xuXG4gICAgICAgICAgICBlZGl0b3Iuc2V0T3B0aW9uKFwiZGlzcGxheUluZGVudEd1aWRlc1wiLCBmYWxzZSk7XG4gICAgICAgICAgICBlZGl0b3Iuc2V0T3B0aW9uKFwiZHJhZ0RlbGF5XCIsIDE1MCk7XG5cbiAgICAgICAgICAgIGVkaXRvci5mb2N1cyA9IG5vb3A7XG4gICAgICAgICAgICBlZGl0b3IuJGlzRm9jdXNlZCA9IHRydWU7XG5cbiAgICAgICAgICAgIGVkaXRvci5zZXRIaWdobGlnaHRBY3RpdmVMaW5lKGZhbHNlKTtcbiAgICAgICAgICAgIGVkaXRvci5zZXNzaW9uLmhpZ2hsaWdodChcIlwiKTtcbiAgICAgICAgICAgIGVkaXRvci5zZXNzaW9uLiRzZWFyY2hIaWdobGlnaHQuY2xhenogPSBcImFjZV9oaWdobGlnaHQtbWFya2VyXCI7XG5cbiAgICAgICAgICAgIHJldHVybiBlZGl0b3I7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZWw6IEhUTUxEaXZFbGVtZW50ID0gPEhUTUxEaXZFbGVtZW50PmRvbS5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICB0aGlzLmVkaXRvciA9IGNyZWF0ZUVkaXRvcihlbCk7XG5cbiAgICAgICAgaWYgKHBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgIHBhcmVudE5vZGUuYXBwZW5kQ2hpbGQoZWwpO1xuICAgICAgICB9XG4gICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuICAgICAgICB0aGlzLmVkaXRvci5vbihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB2YXIgcG9zID0gZS5nZXREb2N1bWVudFBvc2l0aW9uKCk7XG4gICAgICAgICAgICBzZWxmLmVkaXRvci5zZWxlY3Rpb24ubW92ZVRvUG9zaXRpb24ocG9zKTtcbiAgICAgICAgICAgIHNlbGYuc2VsZWN0aW9uTWFya2VyLnN0YXJ0LnJvdyA9IHNlbGYuc2VsZWN0aW9uTWFya2VyLmVuZC5yb3cgPSBwb3Mucm93O1xuICAgICAgICAgICAgZS5zdG9wKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuc2VsZWN0aW9uTWFya2VySWQgPSB0aGlzLmVkaXRvci5zZXNzaW9uLmFkZE1hcmtlcih0aGlzLnNlbGVjdGlvbk1hcmtlciwgXCJhY2VfYWN0aXZlLWxpbmVcIiwgXCJmdWxsTGluZVwiKTtcblxuICAgICAgICB0aGlzLnNldFNlbGVjdE9uSG92ZXIoZmFsc2UpO1xuXG4gICAgICAgIHRoaXMuZWRpdG9yLm9uKFwibW91c2Vtb3ZlXCIsIGZ1bmN0aW9uKGU6IE1vdXNlRXZlbnQpIHtcbiAgICAgICAgICAgIGlmICghc2VsZi5sYXN0TW91c2VFdmVudCkge1xuICAgICAgICAgICAgICAgIHNlbGYubGFzdE1vdXNlRXZlbnQgPSBlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzZWxmLmxhc3RNb3VzZUV2ZW50LnggPT0gZS54ICYmIHNlbGYubGFzdE1vdXNlRXZlbnQueSA9PSBlLnkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxmLmxhc3RNb3VzZUV2ZW50ID0gZTtcbiAgICAgICAgICAgIHNlbGYubGFzdE1vdXNlRXZlbnRTY3JvbGxUb3AgPSBzZWxmLmVkaXRvci5yZW5kZXJlci5zY3JvbGxUb3A7XG4gICAgICAgICAgICB2YXIgcm93ID0gc2VsZi5sYXN0TW91c2VFdmVudC5nZXREb2N1bWVudFBvc2l0aW9uKCkucm93O1xuICAgICAgICAgICAgaWYgKHNlbGYuaG92ZXJNYXJrZXIuc3RhcnQucm93ICE9IHJvdykge1xuICAgICAgICAgICAgICAgIGlmICghc2VsZi5ob3Zlck1hcmtlcklkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0Um93KHJvdyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNlbGYuc2V0SG92ZXJNYXJrZXIocm93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZWRpdG9yLnJlbmRlcmVyLm9uKFwiYmVmb3JlUmVuZGVyXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHNlbGYubGFzdE1vdXNlRXZlbnQgJiYgc2VsZi5ob3Zlck1hcmtlci5zdGFydC5yb3cgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmxhc3RNb3VzZUV2ZW50LiRwb3MgPSBudWxsO1xuICAgICAgICAgICAgICAgIHZhciByb3cgPSBzZWxmLmxhc3RNb3VzZUV2ZW50LmdldERvY3VtZW50UG9zaXRpb24oKS5yb3c7XG4gICAgICAgICAgICAgICAgaWYgKCFzZWxmLmhvdmVyTWFya2VySWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRSb3cocm93KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2VsZi5zZXRIb3Zlck1hcmtlcihyb3csIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5lZGl0b3IucmVuZGVyZXIub24oXCJhZnRlclJlbmRlclwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciByb3cgPSBzZWxmLmdldFJvdygpO1xuICAgICAgICAgICAgdmFyIHQgPSBzZWxmLmVkaXRvci5yZW5kZXJlci4kdGV4dExheWVyO1xuICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gPEhUTUxFbGVtZW50PnQuZWxlbWVudC5jaGlsZE5vZGVzW3JvdyAtIHQuY29uZmlnLmZpcnN0Um93XTtcbiAgICAgICAgICAgIC8vIEZJWE1FOiBER0ggRG9uJ3Qga25vdyB3aHkgc2VsZWN0ZWROb2RlIGlzIG5vdCBmb3VuZC5cbiAgICAgICAgICAgIGlmIChzZWxlY3RlZCA9PSB0WydzZWxlY3RlZE5vZGUnXSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBpZiAodFsnc2VsZWN0ZWROb2RlJ10pXG4gICAgICAgICAgICAgICAgZG9tLnJlbW92ZUNzc0NsYXNzKHRbJ3NlbGVjdGVkTm9kZSddLCBcImFjZV9zZWxlY3RlZFwiKTtcbiAgICAgICAgICAgIHRbJ3NlbGVjdGVkTm9kZSddID0gc2VsZWN0ZWQ7XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWQpXG4gICAgICAgICAgICAgICAgZG9tLmFkZENzc0NsYXNzKHNlbGVjdGVkLCBcImFjZV9zZWxlY3RlZFwiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZnVuY3Rpb24gaGlkZUhvdmVyTWFya2VyKCkgeyBzZWxmLnNldEhvdmVyTWFya2VyKC0xKSB9XG5cbiAgICAgICAgZXZlbnQuYWRkTGlzdGVuZXIodGhpcy5lZGl0b3IuY29udGFpbmVyLCBcIm1vdXNlb3V0XCIsIGhpZGVIb3Zlck1hcmtlcik7XG4gICAgICAgIHRoaXMuZWRpdG9yLm9uKFwiaGlkZVwiLCBoaWRlSG92ZXJNYXJrZXIpO1xuICAgICAgICB0aGlzLmVkaXRvci5vbihcImNoYW5nZVNlbGVjdGlvblwiLCBoaWRlSG92ZXJNYXJrZXIpO1xuXG4gICAgICAgIHRoaXMuZWRpdG9yLnNlc3Npb24uZG9jLmdldExlbmd0aCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF0YS5sZW5ndGg7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZWRpdG9yLnNlc3Npb24uZG9jLmdldExpbmUgPSBmdW5jdGlvbihpKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IHNlbGYuZGF0YVtpXTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKGRhdGEgJiYgZGF0YS52YWx1ZSkgfHwgXCJcIjtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgYmdUb2tlbml6ZXIgPSB0aGlzLmVkaXRvci5zZXNzaW9uLmJnVG9rZW5pemVyO1xuICAgICAgICBiZ1Rva2VuaXplci4kdG9rZW5pemVSb3cgPSBmdW5jdGlvbihkYXRhSW5kZXgpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gc2VsZi5kYXRhW2RhdGFJbmRleF07XG4gICAgICAgICAgICB2YXIgdG9rZW5zID0gW107XG4gICAgICAgICAgICBpZiAoIWRhdGEpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRva2VucztcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PSBcInN0cmluZ1wiKVxuICAgICAgICAgICAgICAgIGRhdGEgPSB7IHZhbHVlOiBkYXRhIH07XG4gICAgICAgICAgICBpZiAoIWRhdGEuY2FwdGlvbilcbiAgICAgICAgICAgICAgICBkYXRhLmNhcHRpb24gPSBkYXRhLnZhbHVlIHx8IGRhdGEubmFtZTtcblxuICAgICAgICAgICAgdmFyIGxhc3QgPSAtMTtcbiAgICAgICAgICAgIHZhciBmbGFnLCBjO1xuICAgICAgICAgICAgZm9yICh2YXIgY0luZGV4ID0gMCwgbGVuZ3RoID0gZGF0YS5jYXB0aW9uLmxlbmd0aDsgY0luZGV4IDwgbGVuZ3RoOyBjSW5kZXgrKykge1xuICAgICAgICAgICAgICAgIGMgPSBkYXRhLmNhcHRpb25bY0luZGV4XTtcbiAgICAgICAgICAgICAgICBmbGFnID0gZGF0YS5tYXRjaE1hc2sgJiAoMSA8PCBjSW5kZXgpID8gMSA6IDA7XG4gICAgICAgICAgICAgICAgaWYgKGxhc3QgIT09IGZsYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goeyB0eXBlOiBkYXRhLmNsYXNzTmFtZSB8fCBcIlwiICsgKGZsYWcgPyBcImNvbXBsZXRpb24taGlnaGxpZ2h0XCIgOiBcIlwiKSwgdmFsdWU6IGMgfSk7XG4gICAgICAgICAgICAgICAgICAgIGxhc3QgPSBmbGFnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRva2Vuc1t0b2tlbnMubGVuZ3RoIC0gMV0udmFsdWUgKz0gYztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkYXRhLm1ldGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWF4VyA9IHNlbGYuZWRpdG9yLnJlbmRlcmVyLiRzaXplLnNjcm9sbGVyV2lkdGggLyBzZWxmLmVkaXRvci5yZW5kZXJlci5sYXllckNvbmZpZy5jaGFyYWN0ZXJXaWR0aDtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5tZXRhLmxlbmd0aCArIGRhdGEuY2FwdGlvbi5sZW5ndGggPCBtYXhXIC0gMilcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goeyB0eXBlOiBcInJpZ2h0QWxpZ25lZFRleHRcIiwgdmFsdWU6IGRhdGEubWV0YSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0b2tlbnM7XG4gICAgICAgIH07XG4gICAgICAgIGJnVG9rZW5pemVyLiR1cGRhdGVPbkNoYW5nZSA9IG5vb3A7XG4gICAgICAgIGJnVG9rZW5pemVyLnN0YXJ0ID0gbm9vcDtcblxuICAgICAgICB0aGlzLmVkaXRvci5zZXNzaW9uLiRjb21wdXRlV2lkdGggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBzZWxmLnNjcmVlbldpZHRoID0gMDtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmVkaXRvci5vbihcImNoYW5nZVNlbGVjdGlvblwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT3Blbikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0Um93KHRoaXMucG9wdXAuc2VsZWN0aW9uLmxlYWQucm93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7e3RvcDtsZWZ0fX0gcG9zXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGxpbmVIZWlnaHRcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHRvcGRvd25Pbmx5XG4gICAgICovXG4gICAgc2hvdyhwb3M6IHsgdG9wOiBudW1iZXI7IGxlZnQ6IG51bWJlciB9LCBsaW5lSGVpZ2h0OiBudW1iZXIsIHRvcGRvd25Pbmx5PzogYm9vbGVhbikge1xuICAgICAgICB2YXIgZWwgPSB0aGlzLmVkaXRvci5jb250YWluZXI7XG4gICAgICAgIHZhciBzY3JlZW5IZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICAgIHZhciBzY3JlZW5XaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICB2YXIgcmVuZGVyZXIgPSB0aGlzLmVkaXRvci5yZW5kZXJlcjtcbiAgICAgICAgLy8gdmFyIG1heExpbmVzID0gTWF0aC5taW4ocmVuZGVyZXIuJG1heExpbmVzLCB0aGlzLnNlc3Npb24uZ2V0TGVuZ3RoKCkpO1xuICAgICAgICB2YXIgbWF4SCA9IHJlbmRlcmVyLiRtYXhMaW5lcyAqIGxpbmVIZWlnaHQgKiAxLjQ7XG4gICAgICAgIHZhciB0b3AgPSBwb3MudG9wICsgdGhpcy4kYm9yZGVyU2l6ZTtcbiAgICAgICAgaWYgKHRvcCArIG1heEggPiBzY3JlZW5IZWlnaHQgLSBsaW5lSGVpZ2h0ICYmICF0b3Bkb3duT25seSkge1xuICAgICAgICAgICAgZWwuc3R5bGUudG9wID0gXCJcIjtcbiAgICAgICAgICAgIGVsLnN0eWxlLmJvdHRvbSA9IHNjcmVlbkhlaWdodCAtIHRvcCArIFwicHhcIjtcbiAgICAgICAgICAgIHRoaXMuaXNUb3Bkb3duID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0b3AgKz0gbGluZUhlaWdodDtcbiAgICAgICAgICAgIGVsLnN0eWxlLnRvcCA9IHRvcCArIFwicHhcIjtcbiAgICAgICAgICAgIGVsLnN0eWxlLmJvdHRvbSA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLmlzVG9wZG93biA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICAgICAgcmVuZGVyZXIuJHRleHRMYXllci5jaGVja0ZvclNpemVDaGFuZ2VzKCk7XG5cbiAgICAgICAgdmFyIGxlZnQgPSBwb3MubGVmdDtcbiAgICAgICAgaWYgKGxlZnQgKyBlbC5vZmZzZXRXaWR0aCA+IHNjcmVlbldpZHRoKSB7XG4gICAgICAgICAgICBsZWZ0ID0gc2NyZWVuV2lkdGggLSBlbC5vZmZzZXRXaWR0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsLnN0eWxlLmxlZnQgPSBsZWZ0ICsgXCJweFwiO1xuXG4gICAgICAgIHRoaXMuZWRpdG9yLl9zaWduYWwoXCJzaG93XCIpO1xuICAgICAgICB0aGlzLmxhc3RNb3VzZUV2ZW50ID0gbnVsbDtcbiAgICAgICAgdGhpcy5pc09wZW4gPSB0cnVlO1xuICAgIH1cbiAgICBoaWRlKCkge1xuICAgICAgICB0aGlzLmVkaXRvci5jb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB0aGlzLmVkaXRvci5fc2lnbmFsKFwiaGlkZVwiKTtcbiAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgc2V0RGF0YShsaXN0KSB7XG4gICAgICAgIHRoaXMuZGF0YSA9IGxpc3QgfHwgW107XG4gICAgICAgIHRoaXMuZWRpdG9yLnNldFZhbHVlKGxuZy5zdHJpbmdSZXBlYXQoXCJcXG5cIiwgbGlzdC5sZW5ndGgpLCAtMSk7XG4gICAgICAgIHRoaXMuc2V0Um93KDApO1xuICAgIH1cbiAgICBnZXREYXRhKHJvdzogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGFbcm93XTtcbiAgICB9XG4gICAgb24oZXZlbnROYW1lOiBzdHJpbmcsIGNhbGxiYWNrLCBjYXB0dXJpbmc/KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVkaXRvci5vbihldmVudE5hbWUsIGNhbGxiYWNrLCBjYXB0dXJpbmcpO1xuICAgIH1cbiAgICBnZXRUZXh0TGVmdE9mZnNldCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy4kYm9yZGVyU2l6ZSArIHRoaXMuZWRpdG9yLnJlbmRlcmVyLiRwYWRkaW5nICsgdGhpcy4kaW1hZ2VTaXplO1xuICAgIH1cbiAgICBzZXRTZWxlY3RPbkhvdmVyKHZhbCkge1xuICAgICAgICBpZiAoIXZhbCkge1xuICAgICAgICAgICAgdGhpcy5ob3Zlck1hcmtlcklkID0gdGhpcy5lZGl0b3Iuc2Vzc2lvbi5hZGRNYXJrZXIodGhpcy5ob3Zlck1hcmtlciwgXCJhY2VfbGluZS1ob3ZlclwiLCBcImZ1bGxMaW5lXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuaG92ZXJNYXJrZXJJZCkge1xuICAgICAgICAgICAgdGhpcy5lZGl0b3Iuc2Vzc2lvbi5yZW1vdmVNYXJrZXIodGhpcy5ob3Zlck1hcmtlcklkKTtcbiAgICAgICAgICAgIHRoaXMuaG92ZXJNYXJrZXJJZCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0SG92ZXJNYXJrZXIocm93OiBudW1iZXIsIHN1cHByZXNzUmVkcmF3PzogYm9vbGVhbikge1xuICAgICAgICBpZiAocm93ICE9PSB0aGlzLmhvdmVyTWFya2VyLnN0YXJ0LnJvdykge1xuICAgICAgICAgICAgdGhpcy5ob3Zlck1hcmtlci5zdGFydC5yb3cgPSB0aGlzLmhvdmVyTWFya2VyLmVuZC5yb3cgPSByb3c7XG4gICAgICAgICAgICBpZiAoIXN1cHByZXNzUmVkcmF3KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lZGl0b3Iuc2Vzc2lvbi5fZW1pdChcImNoYW5nZUJhY2tNYXJrZXJcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmVkaXRvci5fZW1pdChcImNoYW5nZUhvdmVyTWFya2VyXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldEhvdmVyZWRSb3coKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhvdmVyTWFya2VyLnN0YXJ0LnJvdztcbiAgICB9XG4gICAgZ2V0Um93KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbk1hcmtlci5zdGFydC5yb3c7XG4gICAgfVxuICAgIHNldFJvdyhyb3c6IG51bWJlcikge1xuICAgICAgICByb3cgPSBNYXRoLm1heCgtMSwgTWF0aC5taW4odGhpcy5kYXRhLmxlbmd0aCwgcm93KSk7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbk1hcmtlci5zdGFydC5yb3cgIT0gcm93KSB7XG4gICAgICAgICAgICB0aGlzLmVkaXRvci5zZWxlY3Rpb24uY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uTWFya2VyLnN0YXJ0LnJvdyA9IHRoaXMuc2VsZWN0aW9uTWFya2VyLmVuZC5yb3cgPSByb3cgfHwgMDtcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yLnNlc3Npb24uX2VtaXQoXCJjaGFuZ2VCYWNrTWFya2VyXCIpO1xuICAgICAgICAgICAgdGhpcy5lZGl0b3IubW92ZUN1cnNvclRvKHJvdyB8fCAwLCAwKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT3Blbikge1xuICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLl9zaWduYWwoXCJzZWxlY3RcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0VGhlbWUodGhlbWU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB0aGlzLmVkaXRvci5zZXRUaGVtZSh0aGVtZSk7XG4gICAgfVxuICAgIHNldEZvbnRTaXplKGZvbnRTaXplOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5lZGl0b3Iuc2V0Rm9udFNpemUoZm9udFNpemUpO1xuICAgIH1cblxuICAgIGdldCBmb2N1cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWRpdG9yLmZvY3VzO1xuICAgIH1cblxuICAgIGdldExlbmd0aCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5lZGl0b3Iuc2Vzc2lvbi5nZXRMZW5ndGgoKTtcbiAgICB9XG5cbiAgICBnZXQgY29udGFpbmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lZGl0b3IuY29udGFpbmVyO1xuICAgIH1cbn1cblxuZG9tLmltcG9ydENzc1N0cmluZyhcIlxcXG4uYWNlX2VkaXRvci5hY2VfYXV0b2NvbXBsZXRlIC5hY2VfbWFya2VyLWxheWVyIC5hY2VfYWN0aXZlLWxpbmUge1xcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogI0NBRDZGQTtcXFxuICAgIHotaW5kZXg6IDE7XFxcbn1cXFxuLmFjZV9lZGl0b3IuYWNlX2F1dG9jb21wbGV0ZSAuYWNlX2xpbmUtaG92ZXIge1xcXG4gICAgYm9yZGVyOiAxcHggc29saWQgI2FiYmZmZTtcXFxuICAgIG1hcmdpbi10b3A6IC0xcHg7XFxcbiAgICBiYWNrZ3JvdW5kOiByZ2JhKDIzMywyMzMsMjUzLDAuNCk7XFxcbn1cXFxuLmFjZV9lZGl0b3IuYWNlX2F1dG9jb21wbGV0ZSAuYWNlX2xpbmUtaG92ZXIge1xcXG4gICAgcG9zaXRpb246IGFic29sdXRlO1xcXG4gICAgei1pbmRleDogMjtcXFxufVxcXG4uYWNlX2VkaXRvci5hY2VfYXV0b2NvbXBsZXRlIC5hY2Vfc2Nyb2xsZXIge1xcXG4gICBiYWNrZ3JvdW5kOiBub25lO1xcXG4gICBib3JkZXI6IG5vbmU7XFxcbiAgIGJveC1zaGFkb3c6IG5vbmU7XFxcbn1cXFxuLmFjZV9yaWdodEFsaWduZWRUZXh0IHtcXFxuICAgIGNvbG9yOiBncmF5O1xcXG4gICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xcXG4gICAgcG9zaXRpb246IGFic29sdXRlO1xcXG4gICAgcmlnaHQ6IDRweDtcXFxuICAgIHRleHQtYWxpZ246IHJpZ2h0O1xcXG4gICAgei1pbmRleDogLTE7XFxcbn1cXFxuLmFjZV9lZGl0b3IuYWNlX2F1dG9jb21wbGV0ZSAuYWNlX2NvbXBsZXRpb24taGlnaGxpZ2h0e1xcXG4gICAgY29sb3I6ICMwMDA7XFxcbiAgICB0ZXh0LXNoYWRvdzogMCAwIDAuMDFlbTtcXFxufVxcXG4uYWNlX2VkaXRvci5hY2VfYXV0b2NvbXBsZXRlIHtcXFxuICAgIHdpZHRoOiAyODBweDtcXFxuICAgIHotaW5kZXg6IDIwMDAwMDtcXFxuICAgIGJhY2tncm91bmQ6ICNmYmZiZmI7XFxcbiAgICBjb2xvcjogIzQ0NDtcXFxuICAgIGJvcmRlcjogMXB4IGxpZ2h0Z3JheSBzb2xpZDtcXFxuICAgIHBvc2l0aW9uOiBmaXhlZDtcXFxuICAgIGJveC1zaGFkb3c6IDJweCAzcHggNXB4IHJnYmEoMCwwLDAsLjIpO1xcXG4gICAgbGluZS1oZWlnaHQ6IDEuNDtcXFxufVwiKTtcbiJdfQ==