import EditorDocument from "../EditorDocument";
import EditSession from "../EditSession";
import VirtualRenderer from "../VirtualRenderer";
import Editor from "../Editor";
import Range from "../Range";
import { addListener } from "../lib/event";
import { stringRepeat } from "../lib/lang";
import { addCssClass, createElement, importCssString, removeCssClass } from "../lib/dom";
var noop = function () { };
export class ListViewPopup {
    constructor(parentNode) {
        this.$borderSize = 1;
        this.$imageSize = 0;
        this.hoverMarker = new Range(-1, 0, -1, Infinity);
        this.selectionMarker = new Range(-1, 0, -1, Infinity);
        this.isOpen = false;
        this.isTopdown = false;
        this.data = [];
        var self = this;
        function createEditor(el) {
            var renderer = new VirtualRenderer(el);
            renderer.content.style.cursor = "default";
            renderer.setStyle("ace_autocomplete");
            renderer.$cursorLayer.restartTimer = noop;
            renderer.$cursorLayer.element.style.opacity = "0";
            renderer.$maxLines = 8;
            renderer.$keepTextAreaAtCursor = false;
            var model = new EditorDocument("");
            var editSession = new EditSession(model);
            var editor = new Editor(renderer, editSession);
            editor.setHighlightActiveLine(false);
            editor.setShowPrintMargin(false);
            editor.renderer.setShowGutter(false);
            editor.renderer.setHighlightGutterLine(false);
            editor.setOption("displayIndentGuides", false);
            editor.setOption("dragDelay", 150);
            editor.focus = noop;
            editor.$isFocused = true;
            editor.setHighlightActiveLine(false);
            editor.session.highlight("");
            editor.session.$searchHighlight.clazz = "ace_highlight-marker";
            return editor;
        }
        var el = createElement("div");
        this.editor = createEditor(el);
        if (parentNode) {
            parentNode.appendChild(el);
        }
        el.style.display = "none";
        this.editor.on("mousedown", function (e) {
            var pos = e.getDocumentPosition();
            self.editor.selection.moveToPosition(pos);
            self.selectionMarker.start.row = self.selectionMarker.end.row = pos.row;
            e.stop();
        });
        this.selectionMarkerId = this.editor.session.addMarker(this.selectionMarker, "ace_active-line", "fullLine");
        this.setSelectOnHover(false);
        this.editor.on("mousemove", function (e) {
            if (!self.lastMouseEvent) {
                self.lastMouseEvent = e;
                return;
            }
            if (self.lastMouseEvent.x == e.x && self.lastMouseEvent.y == e.y) {
                return;
            }
            self.lastMouseEvent = e;
            self.lastMouseEventScrollTop = self.editor.renderer.scrollTop;
            var row = self.lastMouseEvent.getDocumentPosition().row;
            if (self.hoverMarker.start.row != row) {
                if (!self.hoverMarkerId) {
                    self.setRow(row);
                }
                self.setHoverMarker(row);
            }
        });
        this.editor.renderer.on("beforeRender", function () {
            if (self.lastMouseEvent && self.hoverMarker.start.row != -1) {
                self.lastMouseEvent.$pos = null;
                var row = self.lastMouseEvent.getDocumentPosition().row;
                if (!self.hoverMarkerId) {
                    self.setRow(row);
                }
                self.setHoverMarker(row, true);
            }
        });
        this.editor.renderer.on("afterRender", function () {
            var row = self.getRow();
            var t = self.editor.renderer.$textLayer;
            var selected = t.element.childNodes[row - t.config.firstRow];
            if (selected == t['selectedNode'])
                return;
            if (t['selectedNode'])
                removeCssClass(t['selectedNode'], "ace_selected");
            t['selectedNode'] = selected;
            if (selected)
                addCssClass(selected, "ace_selected");
        });
        function hideHoverMarker() { self.setHoverMarker(-1); }
        addListener(this.editor.container, "mouseout", hideHoverMarker);
        this.editor.on("hide", hideHoverMarker);
        this.editor.on("changeSelection", hideHoverMarker);
        this.editor.session.doc.getLength = function () {
            return self.data.length;
        };
        this.editor.session.doc.getLine = function (i) {
            var data = self.data[i];
            if (typeof data == "string") {
                return data;
            }
            return (data && data.value) || "";
        };
        var bgTokenizer = this.editor.session.bgTokenizer;
        bgTokenizer.$tokenizeRow = function (dataIndex) {
            var data = self.data[dataIndex];
            var tokens = [];
            if (!data)
                return tokens;
            if (typeof data == "string")
                data = { value: data };
            if (!data.caption)
                data.caption = data.value || data.name;
            var last = -1;
            var flag, c;
            for (var cIndex = 0, length = data.caption.length; cIndex < length; cIndex++) {
                c = data.caption[cIndex];
                flag = data.matchMask & (1 << cIndex) ? 1 : 0;
                if (last !== flag) {
                    tokens.push({ type: data.className || "" + (flag ? "completion-highlight" : ""), value: c });
                    last = flag;
                }
                else {
                    tokens[tokens.length - 1].value += c;
                }
            }
            if (data.meta) {
                var maxW = self.editor.renderer.$size.scrollerWidth / self.editor.renderer.layerConfig.characterWidth;
                if (data.meta.length + data.caption.length < maxW - 2)
                    tokens.push({ type: "rightAlignedText", value: data.meta });
            }
            return tokens;
        };
        bgTokenizer.$updateOnChange = noop;
        bgTokenizer.start = noop;
        this.editor.session.$computeWidth = function () {
            return self.screenWidth = 0;
        };
        this.editor.on("changeSelection", function () {
            if (this.isOpen) {
                this.setRow(this.popup.selection.lead.row);
            }
        });
    }
    show(pos, lineHeight, topdownOnly) {
        var el = this.editor.container;
        var screenHeight = window.innerHeight;
        var screenWidth = window.innerWidth;
        var renderer = this.editor.renderer;
        var maxH = renderer.$maxLines * lineHeight * 1.4;
        var top = pos.top + this.$borderSize;
        if (top + maxH > screenHeight - lineHeight && !topdownOnly) {
            el.style.top = "";
            el.style.bottom = screenHeight - top + "px";
            this.isTopdown = false;
        }
        else {
            top += lineHeight;
            el.style.top = top + "px";
            el.style.bottom = "";
            this.isTopdown = true;
        }
        el.style.display = "";
        renderer.$textLayer.checkForSizeChanges();
        var left = pos.left;
        if (left + el.offsetWidth > screenWidth) {
            left = screenWidth - el.offsetWidth;
        }
        el.style.left = left + "px";
        this.editor._signal("show");
        this.lastMouseEvent = null;
        this.isOpen = true;
    }
    hide() {
        this.editor.container.style.display = "none";
        this.editor._signal("hide");
        this.isOpen = false;
    }
    setData(list) {
        this.data = list || [];
        this.editor.setValue(stringRepeat("\n", list.length), -1);
        this.setRow(0);
    }
    getData(row) {
        return this.data[row];
    }
    on(eventName, callback, capturing) {
        return this.editor.on(eventName, callback, capturing);
    }
    getTextLeftOffset() {
        return this.$borderSize + this.editor.renderer.$padding + this.$imageSize;
    }
    setSelectOnHover(val) {
        if (!val) {
            this.hoverMarkerId = this.editor.session.addMarker(this.hoverMarker, "ace_line-hover", "fullLine");
        }
        else if (this.hoverMarkerId) {
            this.editor.session.removeMarker(this.hoverMarkerId);
            this.hoverMarkerId = null;
        }
    }
    setHoverMarker(row, suppressRedraw) {
        if (row !== this.hoverMarker.start.row) {
            this.hoverMarker.start.row = this.hoverMarker.end.row = row;
            if (!suppressRedraw) {
                this.editor.session._emit("changeBackMarker");
            }
            this.editor._emit("changeHoverMarker");
        }
    }
    getHoveredRow() {
        return this.hoverMarker.start.row;
    }
    getRow() {
        return this.selectionMarker.start.row;
    }
    setRow(row) {
        row = Math.max(-1, Math.min(this.data.length, row));
        if (this.selectionMarker.start.row != row) {
            this.editor.selection.clearSelection();
            this.selectionMarker.start.row = this.selectionMarker.end.row = row || 0;
            this.editor.session._emit("changeBackMarker");
            this.editor.moveCursorTo(row || 0, 0);
            if (this.isOpen) {
                this.editor._signal("select");
            }
        }
    }
    setTheme(theme) {
        this.editor.setTheme(theme);
    }
    setFontSize(fontSize) {
        this.editor.setFontSize(fontSize);
    }
    get focus() {
        return this.editor.focus;
    }
    getLength() {
        return this.editor.session.getLength();
    }
    get container() {
        return this.editor.container;
    }
}
importCssString("\
.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {\
    background-color: #CAD6FA;\
    z-index: 1;\
}\
.ace_editor.ace_autocomplete .ace_line-hover {\
    border: 1px solid #abbffe;\
    margin-top: -1px;\
    background: rgba(233,233,253,0.4);\
}\
.ace_editor.ace_autocomplete .ace_line-hover {\
    position: absolute;\
    z-index: 2;\
}\
.ace_editor.ace_autocomplete .ace_scroller {\
   background: none;\
   border: none;\
   box-shadow: none;\
}\
.ace_rightAlignedText {\
    color: gray;\
    display: inline-block;\
    position: absolute;\
    right: 4px;\
    text-align: right;\
    z-index: -1;\
}\
.ace_editor.ace_autocomplete .ace_completion-highlight{\
    color: #000;\
    text-shadow: 0 0 0.01em;\
}\
.ace_editor.ace_autocomplete {\
    width: 280px;\
    z-index: 200000;\
    background: #fbfbfb;\
    color: #444;\
    border: 1px lightgray solid;\
    position: fixed;\
    box-shadow: 2px 3px 5px rgba(0,0,0,.2);\
    line-height: 1.4;\
}");
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wdXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYXV0b2NvbXBsZXRlL3BvcHVwLnRzIl0sIm5hbWVzIjpbIkxpc3RWaWV3UG9wdXAiLCJMaXN0Vmlld1BvcHVwLmNvbnN0cnVjdG9yIiwiTGlzdFZpZXdQb3B1cC5jb25zdHJ1Y3Rvci5jcmVhdGVFZGl0b3IiLCJMaXN0Vmlld1BvcHVwLmNvbnN0cnVjdG9yLmhpZGVIb3Zlck1hcmtlciIsIkxpc3RWaWV3UG9wdXAuc2hvdyIsIkxpc3RWaWV3UG9wdXAuaGlkZSIsIkxpc3RWaWV3UG9wdXAuc2V0RGF0YSIsIkxpc3RWaWV3UG9wdXAuZ2V0RGF0YSIsIkxpc3RWaWV3UG9wdXAub24iLCJMaXN0Vmlld1BvcHVwLmdldFRleHRMZWZ0T2Zmc2V0IiwiTGlzdFZpZXdQb3B1cC5zZXRTZWxlY3RPbkhvdmVyIiwiTGlzdFZpZXdQb3B1cC5zZXRIb3Zlck1hcmtlciIsIkxpc3RWaWV3UG9wdXAuZ2V0SG92ZXJlZFJvdyIsIkxpc3RWaWV3UG9wdXAuZ2V0Um93IiwiTGlzdFZpZXdQb3B1cC5zZXRSb3ciLCJMaXN0Vmlld1BvcHVwLnNldFRoZW1lIiwiTGlzdFZpZXdQb3B1cC5zZXRGb250U2l6ZSIsIkxpc3RWaWV3UG9wdXAuZm9jdXMiLCJMaXN0Vmlld1BvcHVwLmdldExlbmd0aCIsIkxpc3RWaWV3UG9wdXAuY29udGFpbmVyIl0sIm1hcHBpbmdzIjoiT0E4Qk8sY0FBYyxNQUFNLG1CQUFtQjtPQUN2QyxXQUFXLE1BQU0sZ0JBQWdCO09BQ2pDLGVBQWUsTUFBTSxvQkFBb0I7T0FDekMsTUFBTSxNQUFNLFdBQVc7T0FDdkIsS0FBSyxNQUFNLFVBQVU7T0FDckIsRUFBQyxXQUFXLEVBQUMsTUFBTSxjQUFjO09BQ2pDLEVBQUMsWUFBWSxFQUFDLE1BQU0sYUFBYTtPQUNqQyxFQUFDLFdBQVcsRUFBRSxhQUFhLEVBQUUsZUFBZSxFQUFFLGNBQWMsRUFBQyxNQUFNLFlBQVk7QUFFdEYsSUFBSSxJ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RUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0E7UUFDL0JBLElBQUlBLFlBQVlBLEdBQUdBLE1BQU1BLENBQUNBLFdBQVdBLENBQUNBO1FBQ3RDQSxJQUFJQSxXQUFXQSxHQUFHQSxNQUFNQSxDQUFDQSxVQUFVQSxDQUFDQTtRQUNwQ0EsSUFBSUEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0E7UUFFcENBLElBQUlBLElBQUlBLEdBQUdBLFFBQVFBLENBQUNBLFNBQVNBLEdBQUdBLFVBQVVBLEdBQUdBLEdBQUdBLENBQUNBO1FBQ2pEQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQTtRQUNyQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsSUFBSUEsR0FBR0EsWUFBWUEsR0FBR0EsVUFBVUEsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDekRBLEVBQUVBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLENBQUNBO1lBQ2xCQSxFQUFFQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxZQUFZQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUM1Q0EsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDM0JBLENBQUNBO1FBQ0RBLElBQUlBLENBQUNBLENBQUNBO1lBQ0ZBLEdBQUdBLElBQUlBLFVBQVVBLENBQUNBO1lBQ2xCQSxFQUFFQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUMxQkEsRUFBRUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDckJBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLElBQUlBLENBQUNBO1FBQzFCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxLQUFLQSxDQUFDQSxPQUFPQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUN0QkEsUUFBUUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxDQUFDQTtRQUUxQ0EsSUFBSUEsSUFBSUEsR0FBR0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0E7UUFDcEJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBLFdBQVdBLEdBQUdBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBO1lBQ3RDQSxJQUFJQSxHQUFHQSxXQUFXQSxHQUFHQSxFQUFFQSxDQUFDQSxXQUFXQSxDQUFDQTtRQUN4Q0EsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFNUJBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQzVCQSxJQUFJQSxDQUFDQSxjQUFjQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUMzQkEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0E7SUFDdkJBLENBQUNBO0lBQ0RKLElBQUlBO1FBQ0FLLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUdBLE1BQU1BLENBQUNBO1FBQzdDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUM1QkEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0E7SUFDeEJBLENBQUNBO0lBQ0RMLE9BQU9BLENBQUNBLElBQUlBO1FBQ1JNLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLElBQUlBLEVBQUVBLENBQUNBO1FBQ3ZCQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxZQUFZQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFD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LE9BQU9BLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBO0lBQzNDQSxDQUFDQTtJQUVEbEIsSUFBSUEsU0FBU0E7UUFDVG1CLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBO0lBQ2pDQSxDQUFDQTtBQUNMbkIsQ0FBQ0E7QUFFRCxlQUFlLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7RUF3Q2QsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMiwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXRcbiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuICogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlXG4gKiAgICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICogICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBBamF4Lm9yZyBCLlYuIG5vciB0aGVcbiAqICAgICAgIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzXG4gKiAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cbiAqXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkRcbiAqIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEXG4gKiBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFXG4gKiBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBBSkFYLk9SRyBCLlYuIEJFIExJQUJMRSBGT1IgQU5ZXG4gKiBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFU1xuICogKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTO1xuICogTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EXG4gKiBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVNcbiAqIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICpcbiAqICoqKioqIEVORCBMSUNFTlNFIEJMT0NLICoqKioqICovXG5cbmltcG9ydCBFZGl0b3JEb2N1bWVudCBmcm9tIFwiLi4vRWRpdG9yRG9jdW1lbnRcIjtcbmltcG9ydCBFZGl0U2Vzc2lvbiBmcm9tIFwiLi4vRWRpdFNlc3Npb25cIjtcbmltcG9ydCBWaXJ0dWFsUmVuZGVyZXIgZnJvbSBcIi4uL1ZpcnR1YWxSZW5kZXJlclwiO1xuaW1wb3J0IEVkaXRvciBmcm9tIFwiLi4vRWRpdG9yXCI7XG5pbXBvcnQgUmFuZ2UgZnJvbSBcIi4uL1JhbmdlXCI7XG5pbXBvcnQge2FkZExpc3RlbmVyfSBmcm9tIFwiLi4vbGliL2V2ZW50XCI7XG5pbXBvcnQge3N0cmluZ1JlcGVhdH0gZnJvbSBcIi4uL2xpYi9sYW5nXCI7XG5pbXBvcnQge2FkZENzc0NsYXNzLCBjcmVhdGVFbGVtZW50LCBpbXBvcnRDc3NTdHJpbmcsIHJlbW92ZUNzc0NsYXNzfSBmcm9tIFwiLi4vbGliL2RvbVwiO1xuXG52YXIgbm9vcCA9IGZ1bmN0aW9uKCkgeyB9O1xuXG5leHBvcnQgaW50ZXJmYWNlIExpc3RWaWV3IHtcbiAgICBpc09wZW46IGJvb2xlYW47XG4gICAgZm9jdXM7XG4gICAgY29udGFpbmVyO1xuICAgIG9uKGV2ZW50TmFtZTogc3RyaW5nLCBjYWxsYmFjaywgY2FwdHVyaW5nPzogYm9vbGVhbik7XG4gICAgZ2V0RGF0YShyb3c6IG51bWJlcik7XG4gICAgc2V0RGF0YShkYXRhOiBzdHJpbmdbXSk7XG4gICAgZ2V0Um93KCk7XG4gICAgc2V0Um93KHJvdzogbnVtYmVyKTtcbiAgICBnZXRUZXh0TGVmdE9mZnNldCgpOiBudW1iZXI7XG4gICAgc2hvdyhwb3MsIGxpbmVIZWlnaHQsIHRvcGRvd25Pbmx5Pyk6IHZvaWQ7XG4gICAgaGlkZSgpO1xuICAgIHNldFRoZW1lKHRoZW1lOiBzdHJpbmcpOiB2b2lkO1xuICAgIHNldEZvbnRTaXplKGZvbnRTaXplKTogdm9pZDtcbiAgICBnZXRMZW5ndGgoKTogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgTGlzdFZpZXdQb3B1cCBpbXBsZW1lbnRzIExpc3RWaWV3IHtcbiAgICBwcml2YXRlIGVkaXRvcjogRWRpdG9yO1xuICAgIHByaXZhdGUgJGJvcmRlclNpemUgPSAxO1xuICAgIHByaXZhdGUgJGltYWdlU2l6ZSA9IDA7XG4gICAgcHJpdmF0ZSBob3Zlck1hcmtlciA9IG5ldyBSYW5nZSgtMSwgMCwgLTEsIEluZmluaXR5KTtcbiAgICBwcml2YXRlIGhvdmVyTWFya2VySWQ6IG51bWJlcjtcbiAgICBwcml2YXRlIHNlbGVjdGlvbk1hcmtlciA9IG5ldyBSYW5nZSgtMSwgMCwgLTEsIEluZmluaXR5KTtcbiAgICBwcml2YXRlIHNlbGVjdGlvbk1hcmtlcklkOiBudW1iZXI7XG4gICAgcHVibGljIGlzT3BlbiA9IGZhbHNlO1xuICAgIHByaXZhdGUgaXNUb3Bkb3duID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBsYXN0TW91c2VFdmVudDogYW55O1xuICAgIHByaXZhdGUgbGFzdE1vdXNlRXZlbnRTY3JvbGxUb3A7XG4gICAgcHJpdmF0ZSBkYXRhOiBhbnlbXSA9IFtdO1xuICAgIHByaXZhdGUgc2NyZWVuV2lkdGg7XG4gICAgY29uc3RydWN0b3IocGFyZW50Tm9kZTogTm9kZSkge1xuICAgICAgICAvLyBDYWNoZSB0aGUgJ3RoaXMnIHBvaW50ZXIgZm9yIGV2ZW50IGhhbmRsZXJzLlxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlRWRpdG9yKGVsOiBIVE1MRGl2RWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIHJlbmRlcmVyID0gbmV3IFZpcnR1YWxSZW5kZXJlcihlbCk7XG5cbiAgICAgICAgICAgIHJlbmRlcmVyLmNvbnRlbnQuc3R5bGUuY3Vyc29yID0gXCJkZWZhdWx0XCI7XG4gICAgICAgICAgICByZW5kZXJlci5zZXRTdHlsZShcImFjZV9hdXRvY29tcGxldGVcIik7XG4gICAgICAgICAgICByZW5kZXJlci4kY3Vyc29yTGF5ZXIucmVzdGFydFRpbWVyID0gbm9vcDtcbiAgICAgICAgICAgIHJlbmRlcmVyLiRjdXJzb3JMYXllci5lbGVtZW50LnN0eWxlLm9wYWNpdHkgPSBcIjBcIjtcbiAgICAgICAgICAgIHJlbmRlcmVyLiRtYXhMaW5lcyA9IDg7XG4gICAgICAgICAgICByZW5kZXJlci4ka2VlcFRleHRBcmVhQXRDdXJzb3IgPSBmYWxzZTtcblxuICAgICAgICAgICAgdmFyIG1vZGVsID0gbmV3IEVkaXRvckRvY3VtZW50KFwiXCIpO1xuICAgICAgICAgICAgdmFyIGVkaXRTZXNzaW9uID0gbmV3IEVkaXRTZXNzaW9uKG1vZGVsKTtcbiAgICAgICAgICAgIHZhciBlZGl0b3IgPSBuZXcgRWRpdG9yKHJlbmRlcmVyLCBlZGl0U2Vzc2lvbik7XG5cbiAgICAgICAgICAgIGVkaXRvci5zZXRIaWdobGlnaHRBY3RpdmVMaW5lKGZhbHNlKTtcbiAgICAgICAgICAgIGVkaXRvci5zZXRTaG93UHJpbnRNYXJnaW4oZmFsc2UpO1xuICAgICAgICAgICAgZWRpdG9yLnJlbmRlcmVyLnNldFNob3dHdXR0ZXIoZmFsc2UpO1xuICAgICAgICAgICAgZWRpdG9yLnJlbmRlcmVyLnNldEhpZ2hsaWdodEd1dHRlckxpbmUoZmFsc2UpO1xuXG4gICAgICAgICAgICBlZGl0b3Iuc2V0T3B0aW9uKFwiZGlzcGxheUluZGVudEd1aWRlc1wiLCBmYWxzZSk7XG4gICAgICAgICAgICBlZGl0b3Iuc2V0T3B0aW9uKFwiZHJhZ0RlbGF5XCIsIDE1MCk7XG5cbiAgICAgICAgICAgIGVkaXRvci5mb2N1cyA9IG5vb3A7XG4gICAgICAgICAgICBlZGl0b3IuJGlzRm9jdXNlZCA9IHRydWU7XG5cbiAgICAgICAgICAgIGVkaXRvci5zZXRIaWdobGlnaHRBY3RpdmVMaW5lKGZhbHNlKTtcbiAgICAgICAgICAgIGVkaXRvci5zZXNzaW9uLmhpZ2hsaWdodChcIlwiKTtcbiAgICAgICAgICAgIGVkaXRvci5zZXNzaW9uLiRzZWFyY2hIaWdobGlnaHQuY2xhenogPSBcImFjZV9oaWdobGlnaHQtbWFya2VyXCI7XG5cbiAgICAgICAgICAgIHJldHVybiBlZGl0b3I7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZWw6IEhUTUxEaXZFbGVtZW50ID0gPEhUTUxEaXZFbGVtZW50PmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRoaXMuZWRpdG9yID0gY3JlYXRlRWRpdG9yKGVsKTtcblxuICAgICAgICBpZiAocGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgcGFyZW50Tm9kZS5hcHBlbmRDaGlsZChlbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgICAgIHRoaXMuZWRpdG9yLm9uKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciBwb3MgPSBlLmdldERvY3VtZW50UG9zaXRpb24oKTtcbiAgICAgICAgICAgIHNlbGYuZWRpdG9yLnNlbGVjdGlvbi5tb3ZlVG9Qb3NpdGlvbihwb3MpO1xuICAgICAgICAgICAgc2VsZi5zZWxlY3Rpb25NYXJrZXIuc3RhcnQucm93ID0gc2VsZi5zZWxlY3Rpb25NYXJrZXIuZW5kLnJvdyA9IHBvcy5yb3c7XG4gICAgICAgICAgICBlLnN0b3AoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5zZWxlY3Rpb25NYXJrZXJJZCA9IHRoaXMuZWRpdG9yLnNlc3Npb24uYWRkTWFya2VyKHRoaXMuc2VsZWN0aW9uTWFya2VyLCBcImFjZV9hY3RpdmUtbGluZVwiLCBcImZ1bGxMaW5lXCIpO1xuXG4gICAgICAgIHRoaXMuc2V0U2VsZWN0T25Ib3ZlcihmYWxzZSk7XG5cbiAgICAgICAgdGhpcy5lZGl0b3Iub24oXCJtb3VzZW1vdmVcIiwgZnVuY3Rpb24oZTogTW91c2VFdmVudCkge1xuICAgICAgICAgICAgaWYgKCFzZWxmLmxhc3RNb3VzZUV2ZW50KSB7XG4gICAgICAgICAgICAgICAgc2VsZi5sYXN0TW91c2VFdmVudCA9IGU7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNlbGYubGFzdE1vdXNlRXZlbnQueCA9PSBlLnggJiYgc2VsZi5sYXN0TW91c2VFdmVudC55ID09IGUueSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYubGFzdE1vdXNlRXZlbnQgPSBlO1xuICAgICAgICAgICAgc2VsZi5sYXN0TW91c2VFdmVudFNjcm9sbFRvcCA9IHNlbGYuZWRpdG9yLnJlbmRlcmVyLnNjcm9sbFRvcDtcbiAgICAgICAgICAgIHZhciByb3cgPSBzZWxmLmxhc3RNb3VzZUV2ZW50LmdldERvY3VtZW50UG9zaXRpb24oKS5yb3c7XG4gICAgICAgICAgICBpZiAoc2VsZi5ob3Zlck1hcmtlci5zdGFydC5yb3cgIT0gcm93KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFzZWxmLmhvdmVyTWFya2VySWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRSb3cocm93KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2VsZi5zZXRIb3Zlck1hcmtlcihyb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5lZGl0b3IucmVuZGVyZXIub24oXCJiZWZvcmVSZW5kZXJcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5sYXN0TW91c2VFdmVudCAmJiBzZWxmLmhvdmVyTWFya2VyLnN0YXJ0LnJvdyAhPSAtMSkge1xuICAgICAgICAgICAgICAgIHNlbGYubGFzdE1vdXNlRXZlbnQuJHBvcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIHJvdyA9IHNlbGYubGFzdE1vdXNlRXZlbnQuZ2V0RG9jdW1lbnRQb3NpdGlvbigpLnJvdztcbiAgICAgICAgICAgICAgICBpZiAoIXNlbGYuaG92ZXJNYXJrZXJJZCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnNldFJvdyhyb3cpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZWxmLnNldEhvdmVyTWFya2VyKHJvdywgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmVkaXRvci5yZW5kZXJlci5vbihcImFmdGVyUmVuZGVyXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHJvdyA9IHNlbGYuZ2V0Um93KCk7XG4gICAgICAgICAgICB2YXIgdCA9IHNlbGYuZWRpdG9yLnJlbmRlcmVyLiR0ZXh0TGF5ZXI7XG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWQgPSA8SFRNTEVsZW1lbnQ+dC5lbGVtZW50LmNoaWxkTm9kZXNbcm93IC0gdC5jb25maWcuZmlyc3RSb3ddO1xuICAgICAgICAgICAgLy8gRklYTUU6IERHSCBEb24ndCBrbm93IHdoeSBzZWxlY3RlZE5vZGUgaXMgbm90IGZvdW5kLlxuICAgICAgICAgICAgaWYgKHNlbGVjdGVkID09IHRbJ3NlbGVjdGVkTm9kZSddKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGlmICh0WydzZWxlY3RlZE5vZGUnXSlcbiAgICAgICAgICAgICAgICByZW1vdmVDc3NDbGFzcyh0WydzZWxlY3RlZE5vZGUnXSwgXCJhY2Vfc2VsZWN0ZWRcIik7XG4gICAgICAgICAgICB0WydzZWxlY3RlZE5vZGUnXSA9IHNlbGVjdGVkO1xuICAgICAgICAgICAgaWYgKHNlbGVjdGVkKVxuICAgICAgICAgICAgICAgIGFkZENzc0NsYXNzKHNlbGVjdGVkLCBcImFjZV9zZWxlY3RlZFwiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZnVuY3Rpb24gaGlkZUhvdmVyTWFya2VyKCkgeyBzZWxmLnNldEhvdmVyTWFya2VyKC0xKSB9XG5cbiAgICAgICAgYWRkTGlzdGVuZXIodGhpcy5lZGl0b3IuY29udGFpbmVyLCBcIm1vdXNlb3V0XCIsIGhpZGVIb3Zlck1hcmtlcik7XG4gICAgICAgIHRoaXMuZWRpdG9yLm9uKFwiaGlkZVwiLCBoaWRlSG92ZXJNYXJrZXIpO1xuICAgICAgICB0aGlzLmVkaXRvci5vbihcImNoYW5nZVNlbGVjdGlvblwiLCBoaWRlSG92ZXJNYXJrZXIpO1xuXG4gICAgICAgIHRoaXMuZWRpdG9yLnNlc3Npb24uZG9jLmdldExlbmd0aCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF0YS5sZW5ndGg7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZWRpdG9yLnNlc3Npb24uZG9jLmdldExpbmUgPSBmdW5jdGlvbihpKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IHNlbGYuZGF0YVtpXTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKGRhdGEgJiYgZGF0YS52YWx1ZSkgfHwgXCJcIjtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgYmdUb2tlbml6ZXIgPSB0aGlzLmVkaXRvci5zZXNzaW9uLmJnVG9rZW5pemVyO1xuICAgICAgICBiZ1Rva2VuaXplci4kdG9rZW5pemVSb3cgPSBmdW5jdGlvbihkYXRhSW5kZXgpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gc2VsZi5kYXRhW2RhdGFJbmRleF07XG4gICAgICAgICAgICB2YXIgdG9rZW5zID0gW107XG4gICAgICAgICAgICBpZiAoIWRhdGEpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRva2VucztcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PSBcInN0cmluZ1wiKVxuICAgICAgICAgICAgICAgIGRhdGEgPSB7IHZhbHVlOiBkYXRhIH07XG4gICAgICAgICAgICBpZiAoIWRhdGEuY2FwdGlvbilcbiAgICAgICAgICAgICAgICBkYXRhLmNhcHRpb24gPSBkYXRhLnZhbHVlIHx8IGRhdGEubmFtZTtcblxuICAgICAgICAgICAgdmFyIGxhc3QgPSAtMTtcbiAgICAgICAgICAgIHZhciBmbGFnLCBjO1xuICAgICAgICAgICAgZm9yICh2YXIgY0luZGV4ID0gMCwgbGVuZ3RoID0gZGF0YS5jYXB0aW9uLmxlbmd0aDsgY0luZGV4IDwgbGVuZ3RoOyBjSW5kZXgrKykge1xuICAgICAgICAgICAgICAgIGMgPSBkYXRhLmNhcHRpb25bY0luZGV4XTtcbiAgICAgICAgICAgICAgICBmbGFnID0gZGF0YS5tYXRjaE1hc2sgJiAoMSA8PCBjSW5kZXgpID8gMSA6IDA7XG4gICAgICAgICAgICAgICAgaWYgKGxhc3QgIT09IGZsYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goeyB0eXBlOiBkYXRhLmNsYXNzTmFtZSB8fCBcIlwiICsgKGZsYWcgPyBcImNvbXBsZXRpb24taGlnaGxpZ2h0XCIgOiBcIlwiKSwgdmFsdWU6IGMgfSk7XG4gICAgICAgICAgICAgICAgICAgIGxhc3QgPSBmbGFnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRva2Vuc1t0b2tlbnMubGVuZ3RoIC0gMV0udmFsdWUgKz0gYztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkYXRhLm1ldGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWF4VyA9IHNlbGYuZWRpdG9yLnJlbmRlcmVyLiRzaXplLnNjcm9sbGVyV2lkdGggLyBzZWxmLmVkaXRvci5yZW5kZXJlci5sYXllckNvbmZpZy5jaGFyYWN0ZXJXaWR0aDtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5tZXRhLmxlbmd0aCArIGRhdGEuY2FwdGlvbi5sZW5ndGggPCBtYXhXIC0gMilcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goeyB0eXBlOiBcInJpZ2h0QWxpZ25lZFRleHRcIiwgdmFsdWU6IGRhdGEubWV0YSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0b2tlbnM7XG4gICAgICAgIH07XG4gICAgICAgIGJnVG9rZW5pemVyLiR1cGRhdGVPbkNoYW5nZSA9IG5vb3A7XG4gICAgICAgIGJnVG9rZW5pemVyLnN0YXJ0ID0gbm9vcDtcblxuICAgICAgICB0aGlzLmVkaXRvci5zZXNzaW9uLiRjb21wdXRlV2lkdGggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBzZWxmLnNjcmVlbldpZHRoID0gMDtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmVkaXRvci5vbihcImNoYW5nZVNlbGVjdGlvblwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT3Blbikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0Um93KHRoaXMucG9wdXAuc2VsZWN0aW9uLmxlYWQucm93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7e3RvcDtsZWZ0fX0gcG9zXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGxpbmVIZWlnaHRcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHRvcGRvd25Pbmx5XG4gICAgICovXG4gICAgc2hvdyhwb3M6IHsgdG9wOiBudW1iZXI7IGxlZnQ6IG51bWJlciB9LCBsaW5lSGVpZ2h0OiBudW1iZXIsIHRvcGRvd25Pbmx5PzogYm9vbGVhbikge1xuICAgICAgICB2YXIgZWwgPSB0aGlzLmVkaXRvci5jb250YWluZXI7XG4gICAgICAgIHZhciBzY3JlZW5IZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICAgIHZhciBzY3JlZW5XaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICB2YXIgcmVuZGVyZXIgPSB0aGlzLmVkaXRvci5yZW5kZXJlcjtcbiAgICAgICAgLy8gdmFyIG1heExpbmVzID0gTWF0aC5taW4ocmVuZGVyZXIuJG1heExpbmVzLCB0aGlzLnNlc3Npb24uZ2V0TGVuZ3RoKCkpO1xuICAgICAgICB2YXIgbWF4SCA9IHJlbmRlcmVyLiRtYXhMaW5lcyAqIGxpbmVIZWlnaHQgKiAxLjQ7XG4gICAgICAgIHZhciB0b3AgPSBwb3MudG9wICsgdGhpcy4kYm9yZGVyU2l6ZTtcbiAgICAgICAgaWYgKHRvcCArIG1heEggPiBzY3JlZW5IZWlnaHQgLSBsaW5lSGVpZ2h0ICYmICF0b3Bkb3duT25seSkge1xuICAgICAgICAgICAgZWwuc3R5bGUudG9wID0gXCJcIjtcbiAgICAgICAgICAgIGVsLnN0eWxlLmJvdHRvbSA9IHNjcmVlbkhlaWdodCAtIHRvcCArIFwicHhcIjtcbiAgICAgICAgICAgIHRoaXMuaXNUb3Bkb3duID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0b3AgKz0gbGluZUhlaWdodDtcbiAgICAgICAgICAgIGVsLnN0eWxlLnRvcCA9IHRvcCArIFwicHhcIjtcbiAgICAgICAgICAgIGVsLnN0eWxlLmJvdHRvbSA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLmlzVG9wZG93biA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICAgICAgcmVuZGVyZXIuJHRleHRMYXllci5jaGVja0ZvclNpemVDaGFuZ2VzKCk7XG5cbiAgICAgICAgdmFyIGxlZnQgPSBwb3MubGVmdDtcbiAgICAgICAgaWYgKGxlZnQgKyBlbC5vZmZzZXRXaWR0aCA+IHNjcmVlbldpZHRoKSB7XG4gICAgICAgICAgICBsZWZ0ID0gc2NyZWVuV2lkdGggLSBlbC5vZmZzZXRXaWR0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsLnN0eWxlLmxlZnQgPSBsZWZ0ICsgXCJweFwiO1xuXG4gICAgICAgIHRoaXMuZWRpdG9yLl9zaWduYWwoXCJzaG93XCIpO1xuICAgICAgICB0aGlzLmxhc3RNb3VzZUV2ZW50ID0gbnVsbDtcbiAgICAgICAgdGhpcy5pc09wZW4gPSB0cnVlO1xuICAgIH1cbiAgICBoaWRlKCkge1xuICAgICAgICB0aGlzLmVkaXRvci5jb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB0aGlzLmVkaXRvci5fc2lnbmFsKFwiaGlkZVwiKTtcbiAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgc2V0RGF0YShsaXN0KSB7XG4gICAgICAgIHRoaXMuZGF0YSA9IGxpc3QgfHwgW107XG4gICAgICAgIHRoaXMuZWRpdG9yLnNldFZhbHVlKHN0cmluZ1JlcGVhdChcIlxcblwiLCBsaXN0Lmxlbmd0aCksIC0xKTtcbiAgICAgICAgdGhpcy5zZXRSb3coMCk7XG4gICAgfVxuICAgIGdldERhdGEocm93OiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVtyb3ddO1xuICAgIH1cbiAgICBvbihldmVudE5hbWU6IHN0cmluZywgY2FsbGJhY2ssIGNhcHR1cmluZz8pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWRpdG9yLm9uKGV2ZW50TmFtZSwgY2FsbGJhY2ssIGNhcHR1cmluZyk7XG4gICAgfVxuICAgIGdldFRleHRMZWZ0T2Zmc2V0KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLiRib3JkZXJTaXplICsgdGhpcy5lZGl0b3IucmVuZGVyZXIuJHBhZGRpbmcgKyB0aGlzLiRpbWFnZVNpemU7XG4gICAgfVxuICAgIHNldFNlbGVjdE9uSG92ZXIodmFsKSB7XG4gICAgICAgIGlmICghdmFsKSB7XG4gICAgICAgICAgICB0aGlzLmhvdmVyTWFya2VySWQgPSB0aGlzLmVkaXRvci5zZXNzaW9uLmFkZE1hcmtlcih0aGlzLmhvdmVyTWFya2VyLCBcImFjZV9saW5lLWhvdmVyXCIsIFwiZnVsbExpbmVcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5ob3Zlck1hcmtlcklkKSB7XG4gICAgICAgICAgICB0aGlzLmVkaXRvci5zZXNzaW9uLnJlbW92ZU1hcmtlcih0aGlzLmhvdmVyTWFya2VySWQpO1xuICAgICAgICAgICAgdGhpcy5ob3Zlck1hcmtlcklkID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXRIb3Zlck1hcmtlcihyb3c6IG51bWJlciwgc3VwcHJlc3NSZWRyYXc/OiBib29sZWFuKSB7XG4gICAgICAgIGlmIChyb3cgIT09IHRoaXMuaG92ZXJNYXJrZXIuc3RhcnQucm93KSB7XG4gICAgICAgICAgICB0aGlzLmhvdmVyTWFya2VyLnN0YXJ0LnJvdyA9IHRoaXMuaG92ZXJNYXJrZXIuZW5kLnJvdyA9IHJvdztcbiAgICAgICAgICAgIGlmICghc3VwcHJlc3NSZWRyYXcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVkaXRvci5zZXNzaW9uLl9lbWl0KFwiY2hhbmdlQmFja01hcmtlclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZWRpdG9yLl9lbWl0KFwiY2hhbmdlSG92ZXJNYXJrZXJcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0SG92ZXJlZFJvdygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaG92ZXJNYXJrZXIuc3RhcnQucm93O1xuICAgIH1cbiAgICBnZXRSb3coKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uTWFya2VyLnN0YXJ0LnJvdztcbiAgICB9XG4gICAgc2V0Um93KHJvdzogbnVtYmVyKSB7XG4gICAgICAgIHJvdyA9IE1hdGgubWF4KC0xLCBNYXRoLm1pbih0aGlzLmRhdGEubGVuZ3RoLCByb3cpKTtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uTWFya2VyLnN0YXJ0LnJvdyAhPSByb3cpIHtcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yLnNlbGVjdGlvbi5jbGVhclNlbGVjdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25NYXJrZXIuc3RhcnQucm93ID0gdGhpcy5zZWxlY3Rpb25NYXJrZXIuZW5kLnJvdyA9IHJvdyB8fCAwO1xuICAgICAgICAgICAgdGhpcy5lZGl0b3Iuc2Vzc2lvbi5fZW1pdChcImNoYW5nZUJhY2tNYXJrZXJcIik7XG4gICAgICAgICAgICB0aGlzLmVkaXRvci5tb3ZlQ3Vyc29yVG8ocm93IHx8IDAsIDApO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNPcGVuKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lZGl0b3IuX3NpZ25hbChcInNlbGVjdFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXRUaGVtZSh0aGVtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZWRpdG9yLnNldFRoZW1lKHRoZW1lKTtcbiAgICB9XG4gICAgc2V0Rm9udFNpemUoZm9udFNpemU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB0aGlzLmVkaXRvci5zZXRGb250U2l6ZShmb250U2l6ZSk7XG4gICAgfVxuXG4gICAgZ2V0IGZvY3VzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lZGl0b3IuZm9jdXM7XG4gICAgfVxuXG4gICAgZ2V0TGVuZ3RoKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmVkaXRvci5zZXNzaW9uLmdldExlbmd0aCgpO1xuICAgIH1cblxuICAgIGdldCBjb250YWluZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVkaXRvci5jb250YWluZXI7XG4gICAgfVxufVxuXG5pbXBvcnRDc3NTdHJpbmcoXCJcXFxuLmFjZV9lZGl0b3IuYWNlX2F1dG9jb21wbGV0ZSAuYWNlX21hcmtlci1sYXllciAuYWNlX2FjdGl2ZS1saW5lIHtcXFxuICAgIGJhY2tncm91bmQtY29sb3I6ICNDQUQ2RkE7XFxcbiAgICB6LWluZGV4OiAxO1xcXG59XFxcbi5hY2VfZWRpdG9yLmFjZV9hdXRvY29tcGxldGUgLmFjZV9saW5lLWhvdmVyIHtcXFxuICAgIGJvcmRlcjogMXB4IHNvbGlkICNhYmJmZmU7XFxcbiAgICBtYXJnaW4tdG9wOiAtMXB4O1xcXG4gICAgYmFja2dyb3VuZDogcmdiYSgyMzMsMjMzLDI1MywwLjQpO1xcXG59XFxcbi5hY2VfZWRpdG9yLmFjZV9hdXRvY29tcGxldGUgLmFjZV9saW5lLWhvdmVyIHtcXFxuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXFxuICAgIHotaW5kZXg6IDI7XFxcbn1cXFxuLmFjZV9lZGl0b3IuYWNlX2F1dG9jb21wbGV0ZSAuYWNlX3Njcm9sbGVyIHtcXFxuICAgYmFja2dyb3VuZDogbm9uZTtcXFxuICAgYm9yZGVyOiBub25lO1xcXG4gICBib3gtc2hhZG93OiBub25lO1xcXG59XFxcbi5hY2VfcmlnaHRBbGlnbmVkVGV4dCB7XFxcbiAgICBjb2xvcjogZ3JheTtcXFxuICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcXFxuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXFxuICAgIHJpZ2h0OiA0cHg7XFxcbiAgICB0ZXh0LWFsaWduOiByaWdodDtcXFxuICAgIHotaW5kZXg6IC0xO1xcXG59XFxcbi5hY2VfZWRpdG9yLmFjZV9hdXRvY29tcGxldGUgLmFjZV9jb21wbGV0aW9uLWhpZ2hsaWdodHtcXFxuICAgIGNvbG9yOiAjMDAwO1xcXG4gICAgdGV4dC1zaGFkb3c6IDAgMCAwLjAxZW07XFxcbn1cXFxuLmFjZV9lZGl0b3IuYWNlX2F1dG9jb21wbGV0ZSB7XFxcbiAgICB3aWR0aDogMjgwcHg7XFxcbiAgICB6LWluZGV4OiAyMDAwMDA7XFxcbiAgICBiYWNrZ3JvdW5kOiAjZmJmYmZiO1xcXG4gICAgY29sb3I6ICM0NDQ7XFxcbiAgICBib3JkZXI6IDFweCBsaWdodGdyYXkgc29saWQ7XFxcbiAgICBwb3NpdGlvbjogZml4ZWQ7XFxcbiAgICBib3gtc2hhZG93OiAycHggM3B4IDVweCByZ2JhKDAsMCwwLC4yKTtcXFxuICAgIGxpbmUtaGVpZ2h0OiAxLjQ7XFxcbn1cIik7XG4iXX0=