import { HashHandler } from '../../keyboard/hash_handler';
var CLASSNAME = 'ace_autocomplete';
var CLASSNAME_SELECTED = 'ace_autocomplete_selected';
export default class AutoCompleteView {
    constructor(editor, autoComplete) {
        this.handler = new HashHandler();
        if (typeof editor === 'undefined') {
            throw new Error('editor must be defined');
        }
        if (typeof autoComplete === 'undefined') {
            throw new Error('autoComplete must be defined');
        }
        this.editor = editor;
        this.autoComplete = autoComplete;
        this.selectedClassName = CLASSNAME_SELECTED;
        this.wrap = document.createElement('div');
        this.listElement = document.createElement('ul');
        this.wrap.className = CLASSNAME;
        this.wrap.appendChild(this.listElement);
        this.editor.container.appendChild(this.wrap);
        this.wrap.style.display = 'none';
        this.listElement.style.listStyleType = 'none';
        this.wrap.style.position = 'fixed';
        this.wrap.style.zIndex = '1000';
    }
    show(coords) {
        this.setPosition(coords);
        return this.wrap.style.display = 'block';
    }
    hide() {
        return this.wrap.style.display = 'none';
    }
    setPosition(coords) {
        var bottom, editorBottom, top;
        top = coords.pageY + 20;
        editorBottom = $(this.editor.container).offset().top + $(this.editor.container).height();
        bottom = top + $(this.wrap).height();
        if (bottom < editorBottom) {
            this.wrap.style.top = top + 'px';
            return this.wrap.style.left = coords.pageX + 'px';
        }
        else {
            this.wrap.style.top = (top - $(this.wrap).height() - 20) + 'px';
            return this.wrap.style.left = coords.pageX + 'px';
        }
    }
    current() {
        var child, children, i;
        children = this.listElement.childNodes;
        for (i in children) {
            child = children[i];
            if (child.className === this.selectedClassName) {
                return child;
            }
        }
        return null;
    }
    focusNext() {
        var curr, focus;
        curr = this.current();
        focus = curr.nextSibling;
        if (focus) {
            curr.className = '';
            focus.className = this.selectedClassName;
            return this.adjustPosition();
        }
    }
    focusPrev() {
        var curr, focus;
        curr = this.current();
        focus = curr.previousSibling;
        if (focus) {
            curr.className = '';
            focus.className = this.selectedClassName;
            return this.adjustPosition();
        }
    }
    ensureFocus() {
        if (!this.current()) {
            if (this.listElement.firstChild) {
                var firstChild = this.listElement.firstChild;
                firstChild.className = this.selectedClassName;
                return this.adjustPosition();
            }
        }
    }
    adjustPosition() {
        var elm, elmOuterHeight, newMargin, pos, preMargin, wrapHeight;
        elm = this.current();
        if (elm) {
            newMargin = '';
            wrapHeight = $(this.wrap).height();
            elmOuterHeight = $(elm).outerHeight();
            preMargin = parseInt($(this.listElement).css("margin-top").replace('px', ''), 10);
            pos = $(elm).position();
            if (pos.top >= (wrapHeight - elmOuterHeight)) {
                newMargin = (preMargin - elmOuterHeight) + 'px';
                $(this.listElement).css("margin-top", newMargin);
            }
            if (pos.top < 0) {
                newMargin = (-pos.top + preMargin) + 'px';
                return $(this.listElement).css("margin-top", newMargin);
            }
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXV0b0NvbXBsZXRlVmlldy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tb2RlL3R5cGVzY3JpcHQvQXV0b0NvbXBsZXRlVmlldy50cyJdLCJuYW1lcyI6WyJBdXRvQ29tcGxldGVWaWV3IiwiQXV0b0NvbXBsZXRlVmlldy5jb25zdHJ1Y3RvciIsIkF1dG9Db21wbGV0ZVZpZXcuc2hvdyIsIkF1dG9Db21wbGV0ZVZpZXcuaGlkZSIsIkF1dG9Db21wbGV0ZVZpZXcuc2V0UG9zaXRpb24iLCJBdXRvQ29tcGxldGVWaWV3LmN1cnJlbnQiLCJBdXRvQ29tcGxldGVWaWV3LmZvY3VzTmV4dCIsIkF1dG9Db21wbGV0ZVZpZXcuZm9jdXNQcmV2IiwiQXV0b0NvbXBsZXRlVmlldy5lbnN1cmVGb2N1cyIsIkF1dG9Db21wbGV0ZVZpZXcuYWRqdXN0UG9zaXRpb24iXSwibWFwcGluZ3MiOiJPQUlPLEVBQUMsV0FBVyxFQUFDLE1BQU0sNkJBQTZCO0FBRXZELElBQUksU0FBUyxHQUFHLGtCQUFrQixDQUFDO0FBQ25DLElBQUksa0JBQWtCLEdBQUcsMkJBQTJCLENBQUM7QUFFckQ7SUFPSUEsWUFBWUEsTUFBY0EsRUFBRUEsWUFBWUE7UUFEaENDLFlBQU9BLEdBQUdBLElBQUlBLFdBQVdBLEVBQUVBLENBQUNBO1FBRWhDQSxFQUFFQSxDQUFDQSxDQUFDQSxPQUFPQSxNQUFNQSxLQUFLQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNoQ0EsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0Esd0JBQXdCQSxDQUFDQSxDQUFDQTtRQUM5Q0EsQ0FBQ0E7UUFDREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsWUFBWUEsS0FBS0EsV0FBV0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdENBLE1BQU1BLElBQUlBLEtBQUtBLENBQUNBLDhCQUE4QkEsQ0FBQ0EsQ0FBQ0E7UUFDcERBLENBQUNBO1FBQ0RBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBO1FBQ3JCQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxZQUFZQSxDQUFDQTtRQUNqQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxrQkFBa0JBLENBQUNBO1FBRTVDQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxRQUFRQSxDQUFDQSxhQUFhQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUMxQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsR0FBR0EsUUFBUUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDaERBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLFNBQVNBLENBQUNBO1FBQ2hDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQTtRQUV4Q0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFFN0NBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUdBLE1BQU1BLENBQUNBO1FBQ2pDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxLQUFLQSxDQUFDQSxhQUFhQSxHQUFHQSxNQUFNQSxDQUFDQTtRQUM5Q0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsUUFBUUEsR0FBR0EsT0FBT0EsQ0FBQ0E7UUFDbkNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBO0lBQ3BDQSxDQUFDQTtJQUNERCxJQUFJQSxDQUFDQSxNQUF3Q0E7UUFDekNFLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ3pCQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxPQUFPQSxHQUFHQSxPQUFPQSxDQUFDQTtJQUM3Q0EsQ0FBQ0E7SUFDREYsSUFBSUE7UUFDQUcsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsR0FBR0EsTUFBTUEsQ0FBQ0E7SUFDNUNBLENBQUNBO0lBQ0RILFdBQVdBLENBQUNBLE1BQXdDQTtRQUNoREksSUFBSUEsTUFBTUEsRUFBRUEsWUFBWUEsRUFBRUEsR0FBR0EsQ0FBQ0E7UUFDOUJBLEdBQUdBLEdBQUdBLE1BQU1BLENBQUNBLEtBQUtBLEdBQUdBLEVBQUVBLENBQUNBO1FBQ3hCQSxZQUFZQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtRQUN6RkEsTUFBTUEsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFDckNBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLEdBQUdBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBO1lBQ3hCQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUNqQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsR0FBR0EsTUFBTUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDdERBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ0pBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLE1BQU1BLEVB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QSxFQUFFQSxDQUFDQTtRQUNyQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDTkEsU0FBU0EsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDZkEsVUFBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7WUFDbkNBLGNBQWNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBO1lBQ3RDQSxTQUFTQSxHQUFHQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUNsRkEsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0E7WUFDeEJBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLGNBQWNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUMzQ0EsU0FBU0EsR0FBR0EsQ0FBQ0EsU0FBU0EsR0FBR0EsY0FBY0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ2hEQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxZQUFZQSxFQUFFQSxTQUFTQSxDQUFDQSxDQUFDQTtZQUNyREEsQ0FBQ0E7WUFDREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2RBLFNBQVNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLFNBQVNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO2dCQUMxQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsWUFBWUEsRUFBRUEsU0FBU0EsQ0FBQ0EsQ0FBQ0E7WUFDNURBLENBQUNBO1FBQ0xBLENBQUNBO0lBQ0xBLENBQUNBO0FBQ0xULENBQUNBO0FBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUT0RPIGltcG9ydCBqcXVlcnlcbmRlY2xhcmUgdmFyICQ6IGFueTtcblxuaW1wb3J0IEVkaXRvciBmcm9tICcuLi8uLi9FZGl0b3InO1xuaW1wb3J0IHtIYXNoSGFuZGxlcn0gZnJvbSAnLi4vLi4va2V5Ym9hcmQvaGFzaF9oYW5kbGVyJztcblxudmFyIENMQVNTTkFNRSA9ICdhY2VfYXV0b2NvbXBsZXRlJztcbnZhciBDTEFTU05BTUVfU0VMRUNURUQgPSAnYWNlX2F1dG9jb21wbGV0ZV9zZWxlY3RlZCc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEF1dG9Db21wbGV0ZVZpZXcge1xuICAgIHByaXZhdGUgZWRpdG9yOiBFZGl0b3I7XG4gICAgcHJpdmF0ZSBhdXRvQ29tcGxldGU7XG4gICAgcHJpdmF0ZSBzZWxlY3RlZENsYXNzTmFtZTtcbiAgICBwdWJsaWMgd3JhcDogSFRNTERpdkVsZW1lbnQ7ICAgIC8vIE11c3QgYmUgYWNjZXNzaWJsZS5cbiAgICBwdWJsaWMgbGlzdEVsZW1lbnQ6IEhUTUxVTGlzdEVsZW1lbnQ7IC8vIE11c3QgYmUgYWNjZXNzaWJsZS5cbiAgICBwcml2YXRlIGhhbmRsZXIgPSBuZXcgSGFzaEhhbmRsZXIoKTtcbiAgICBjb25zdHJ1Y3RvcihlZGl0b3I6IEVkaXRvciwgYXV0b0NvbXBsZXRlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgZWRpdG9yID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdlZGl0b3IgbXVzdCBiZSBkZWZpbmVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBhdXRvQ29tcGxldGUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2F1dG9Db21wbGV0ZSBtdXN0IGJlIGRlZmluZWQnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVkaXRvciA9IGVkaXRvcjtcbiAgICAgICAgdGhpcy5hdXRvQ29tcGxldGUgPSBhdXRvQ29tcGxldGU7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRDbGFzc05hbWUgPSBDTEFTU05BTUVfU0VMRUNURUQ7XG4gICAgICAgIC8vIGluaXRcbiAgICAgICAgdGhpcy53cmFwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMubGlzdEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuICAgICAgICB0aGlzLndyYXAuY2xhc3NOYW1lID0gQ0xBU1NOQU1FO1xuICAgICAgICB0aGlzLndyYXAuYXBwZW5kQ2hpbGQodGhpcy5saXN0RWxlbWVudCk7XG5cbiAgICAgICAgdGhpcy5lZGl0b3IuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMud3JhcCk7XG5cbiAgICAgICAgdGhpcy53cmFwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgIHRoaXMubGlzdEVsZW1lbnQuc3R5bGUubGlzdFN0eWxlVHlwZSA9ICdub25lJztcbiAgICAgICAgdGhpcy53cmFwLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJztcbiAgICAgICAgdGhpcy53cmFwLnN0eWxlLnpJbmRleCA9ICcxMDAwJztcbiAgICB9XG4gICAgc2hvdyhjb29yZHM6IHsgcGFnZVg6IG51bWJlcjsgcGFnZVk6IG51bWJlciB9KSB7XG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb24oY29vcmRzKTtcbiAgICAgICAgcmV0dXJuIHRoaXMud3JhcC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICB9XG4gICAgaGlkZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud3JhcC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIH1cbiAgICBzZXRQb3NpdGlvbihjb29yZHM6IHsgcGFnZVg6IG51bWJlcjsgcGFnZVk6IG51bWJlciB9KSB7XG4gICAgICAgIHZhciBib3R0b20sIGVkaXRvckJvdHRvbSwgdG9wO1xuICAgICAgICB0b3AgPSBjb29yZHMucGFnZVkgKyAyMDtcbiAgICAgICAgZWRpdG9yQm90dG9tID0gJCh0aGlzLmVkaXRvci5jb250YWluZXIpLm9mZnNldCgpLnRvcCArICQodGhpcy5lZGl0b3IuY29udGFpbmVyKS5oZWlnaHQoKTtcbiAgICAgICAgYm90dG9tID0gdG9wICsgJCh0aGlzLndyYXApLmhlaWdodCgpO1xuICAgICAgICBpZiAoYm90dG9tIDwgZWRpdG9yQm90dG9tKSB7XG4gICAgICAgICAgICB0aGlzLndyYXAuc3R5bGUudG9wID0gdG9wICsgJ3B4JztcbiAgICAgICAgICAgIHJldHVybiB0aGlzLndyYXAuc3R5bGUubGVmdCA9IGNvb3Jkcy5wYWdlWCArICdweCc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLndyYXAuc3R5bGUudG9wID0gKHRvcCAtICQodGhpcy53cmFwKS5oZWlnaHQoKSAtIDIwKSArICdweCc7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy53cmFwLnN0eWxlLmxlZnQgPSBjb29yZHMucGFnZVggKyAncHgnO1xuICAgICAgICB9XG4gICAgfVxuICAgIGN1cnJlbnQoKSB7XG4gICAgICAgIHZhciBjaGlsZCwgY2hpbGRyZW4sIGk7XG4gICAgICAgIGNoaWxkcmVuID0gdGhpcy5saXN0RWxlbWVudC5jaGlsZE5vZGVzO1xuICAgICAgICBmb3IgKGkgaW4gY2hpbGRyZW4pIHtcbiAgICAgICAgICAgIGNoaWxkID0gY2hpbGRyZW5baV07XG4gICAgICAgICAgICBpZiAoY2hpbGQuY2xhc3NOYW1lID09PSB0aGlzLnNlbGVjdGVkQ2xhc3NOYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBmb2N1c05leHQoKSB7XG4gICAgICAgIHZhciBjdXJyLCBmb2N1cztcbiAgICAgICAgY3VyciA9IHRoaXMuY3VycmVudCgpO1xuICAgICAgICBmb2N1cyA9IGN1cnIubmV4dFNpYmxpbmc7XG4gICAgICAgIGlmIChmb2N1cykge1xuICAgICAgICAgICAgY3Vyci5jbGFzc05hbWUgPSAnJztcbiAgICAgICAgICAgIGZvY3VzLmNsYXNzTmFtZSA9IHRoaXMuc2VsZWN0ZWRDbGFzc05hbWU7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hZGp1c3RQb3NpdGlvbigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZvY3VzUHJldigpIHtcbiAgICAgICAgdmFyIGN1cnIsIGZvY3VzO1xuICAgICAgICBjdXJyID0gdGhpcy5jdXJyZW50KCk7XG4gICAgICAgIGZvY3VzID0gY3Vyci5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgIGlmIChmb2N1cykge1xuICAgICAgICAgICAgY3Vyci5jbGFzc05hbWUgPSAnJztcbiAgICAgICAgICAgIGZvY3VzLmNsYXNzTmFtZSA9IHRoaXMuc2VsZWN0ZWRDbGFzc05hbWU7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hZGp1c3RQb3NpdGlvbigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVuc3VyZUZvY3VzKCkge1xuICAgICAgICBpZiAoIXRoaXMuY3VycmVudCgpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5saXN0RWxlbWVudC5maXJzdENoaWxkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpcnN0Q2hpbGQ6IEhUTUxFbGVtZW50ID0gPEhUTUxFbGVtZW50PnRoaXMubGlzdEVsZW1lbnQuZmlyc3RDaGlsZDtcbiAgICAgICAgICAgICAgICBmaXJzdENoaWxkLmNsYXNzTmFtZSA9IHRoaXMuc2VsZWN0ZWRDbGFzc05hbWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRqdXN0UG9zaXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBhZGp1c3RQb3NpdGlvbigpIHtcbiAgICAgICAgdmFyIGVsbSwgZWxtT3V0ZXJIZWlnaHQsIG5ld01hcmdpbiwgcG9zLCBwcmVNYXJnaW4sIHdyYXBIZWlnaHQ7XG4gICAgICAgIGVsbSA9IHRoaXMuY3VycmVudCgpO1xuICAgICAgICBpZiAoZWxtKSB7XG4gICAgICAgICAgICBuZXdNYXJnaW4gPSAnJztcbiAgICAgICAgICAgIHdyYXBIZWlnaHQgPSAkKHRoaXMud3JhcCkuaGVpZ2h0KCk7XG4gICAgICAgICAgICBlbG1PdXRlckhlaWdodCA9ICQoZWxtKS5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgcHJlTWFyZ2luID0gcGFyc2VJbnQoJCh0aGlzLmxpc3RFbGVtZW50KS5jc3MoXCJtYXJnaW4tdG9wXCIpLnJlcGxhY2UoJ3B4JywgJycpLCAxMCk7XG4gICAgICAgICAgICBwb3MgPSAkKGVsbSkucG9zaXRpb24oKTtcbiAgICAgICAgICAgIGlmIChwb3MudG9wID49ICh3cmFwSGVpZ2h0IC0gZWxtT3V0ZXJIZWlnaHQpKSB7XG4gICAgICAgICAgICAgICAgbmV3TWFyZ2luID0gKHByZU1hcmdpbiAtIGVsbU91dGVySGVpZ2h0KSArICdweCc7XG4gICAgICAgICAgICAgICAgJCh0aGlzLmxpc3RFbGVtZW50KS5jc3MoXCJtYXJnaW4tdG9wXCIsIG5ld01hcmdpbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocG9zLnRvcCA8IDApIHtcbiAgICAgICAgICAgICAgICBuZXdNYXJnaW4gPSAoLXBvcy50b3AgKyBwcmVNYXJnaW4pICsgJ3B4JztcbiAgICAgICAgICAgICAgICByZXR1cm4gJCh0aGlzLmxpc3RFbGVtZW50KS5jc3MoXCJtYXJnaW4tdG9wXCIsIG5ld01hcmdpbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=