import HashHandler from '../../keyboard/HashHandler';
var CLASSNAME = 'ace_autocomplete';
var CLASSNAME_SELECTED = 'ace_autocomplete_selected';
export default class AutoCompleteView {
    constructor(editor, autoComplete) {
        this.handler = new HashHandler();
        if (typeof editor === 'undefined') {
            throw new Error('editor must be defined');
        }
        if (typeof autoComplete === 'undefined') {
            throw new Error('autoComplete must be defined');
        }
        this.editor = editor;
        this.autoComplete = autoComplete;
        this.selectedClassName = CLASSNAME_SELECTED;
        this.wrap = document.createElement('div');
        this.listElement = document.createElement('ul');
        this.wrap.className = CLASSNAME;
        this.wrap.appendChild(this.listElement);
        this.editor.container.appendChild(this.wrap);
        this.wrap.style.display = 'none';
        this.listElement.style.listStyleType = 'none';
        this.wrap.style.position = 'fixed';
        this.wrap.style.zIndex = '1000';
    }
    show(coords) {
        this.setPosition(coords);
        return this.wrap.style.display = 'block';
    }
    hide() {
        return this.wrap.style.display = 'none';
    }
    setPosition(coords) {
        var bottom, editorBottom, top;
        top = coords.pageY + 20;
        editorBottom = $(this.editor.container).offset().top + $(this.editor.container).height();
        bottom = top + $(this.wrap).height();
        if (bottom < editorBottom) {
            this.wrap.style.top = top + 'px';
            return this.wrap.style.left = coords.pageX + 'px';
        }
        else {
            this.wrap.style.top = (top - $(this.wrap).height() - 20) + 'px';
            return this.wrap.style.left = coords.pageX + 'px';
        }
    }
    current() {
        var child, children, i;
        children = this.listElement.childNodes;
        for (i in children) {
            child = children[i];
            if (child.className === this.selectedClassName) {
                return child;
            }
        }
        return null;
    }
    focusNext() {
        var curr, focus;
        curr = this.current();
        focus = curr.nextSibling;
        if (focus) {
            curr.className = '';
            focus.className = this.selectedClassName;
            return this.adjustPosition();
        }
    }
    focusPrev() {
        var curr, focus;
        curr = this.current();
        focus = curr.previousSibling;
        if (focus) {
            curr.className = '';
            focus.className = this.selectedClassName;
            return this.adjustPosition();
        }
    }
    ensureFocus() {
        if (!this.current()) {
            if (this.listElement.firstChild) {
                var firstChild = this.listElement.firstChild;
                firstChild.className = this.selectedClassName;
                return this.adjustPosition();
            }
        }
    }
    adjustPosition() {
        var elm, elmOuterHeight, newMargin, pos, preMargin, wrapHeight;
        elm = this.current();
        if (elm) {
            newMargin = '';
            wrapHeight = $(this.wrap).height();
            elmOuterHeight = $(elm).outerHeight();
            preMargin = parseInt($(this.listElement).css("margin-top").replace('px', ''), 10);
            pos = $(elm).position();
            if (pos.top >= (wrapHeight - elmOuterHeight)) {
                newMargin = (preMargin - elmOuterHeight) + 'px';
                $(this.listElement).css("margin-top", newMargin);
            }
            if (pos.top < 0) {
                newMargin = (-pos.top + preMargin) + 'px';
                return $(this.listElement).css("margin-top", newMargin);
            }
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXV0b0NvbXBsZXRlVmlldy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tb2RlL3R5cGVzY3JpcHQvQXV0b0NvbXBsZXRlVmlldy50cyJdLCJuYW1lcyI6WyJBdXRvQ29tcGxldGVWaWV3IiwiQXV0b0NvbXBsZXRlVmlldy5jb25zdHJ1Y3RvciIsIkF1dG9Db21wbGV0ZVZpZXcuc2hvdyIsIkF1dG9Db21wbGV0ZVZpZXcuaGlkZSIsIkF1dG9Db21wbGV0ZVZpZXcuc2V0UG9zaXRpb24iLCJBdXRvQ29tcGxldGVWaWV3LmN1cnJlbnQiLCJBdXRvQ29tcGxldGVWaWV3LmZvY3VzTmV4dCIsIkF1dG9Db21wbGV0ZVZpZXcuZm9jdXNQcmV2IiwiQXV0b0NvbXBsZXRlVmlldy5lbnN1cmVGb2N1cyIsIkF1dG9Db21wbGV0ZVZpZXcuYWRqdXN0UG9zaXRpb24iXSwibWFwcGluZ3MiOiJPQUlPLFdBQVcsTUFBTSw0QkFBNEI7QUFFcEQsSUFBSSxTQUFTLEdBQUcsa0JBQWtCLENBQUM7QUFDbkMsSUFBSSxrQkFBa0IsR0FBRywyQkFBMkIsQ0FBQztBQUVyRDtJQU9JQSxZQUFZQSxNQUFjQSxFQUFFQSxZQUFZQTtRQURoQ0MsWUFBT0EsR0FBR0EsSUFBSUEsV0FBV0EsRUFBRUEsQ0FBQ0E7UUFFaENBLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLE1BQU1BLEtBQUtBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBO1lBQ2hDQSxNQUFNQSxJQUFJQSxLQUFLQSxDQUFDQSx3QkFBd0JBLENBQUNBLENBQUNBO1FBQzlDQSxDQUFDQTtRQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxPQUFPQSxZQUFZQSxLQUFLQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN0Q0EsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0EsOEJBQThCQSxDQUFDQSxDQUFDQTtRQUNwREEsQ0FBQ0E7UUFDREEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFDckJBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLFlBQVlBLENBQUNBO1FBQ2pDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEdBQUdBLGtCQUFrQkEsQ0FBQ0E7UUFFNUNBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLFFBQVFBLENBQUNBLGFBQWFBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBQzFDQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFHQSxRQUFRQSxDQUFDQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNoREEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsU0FBU0EsQ0FBQ0E7UUFDaENBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBO1FBRXhDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUU3Q0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFDakNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLEtBQUtBLENBQUNBLGFBQWFBLEdBQUdBLE1BQU1BLENBQUNBO1FBQzlDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxRQUFRQSxHQUFHQSxPQUFPQSxDQUFDQTtRQUNuQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsTUFBTUEsQ0FBQ0E7SUFDcENBLENBQUNBO0lBQ0RELElBQUlBLENBQUNBLE1BQXdDQTtRQUN6Q0UsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDekJBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUdBLE9BQU9BLENBQUNBO0lBQzdDQSxDQUFDQTtJQUNERixJQUFJQTtRQUNBRyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxPQUFPQSxHQUFHQSxNQUFNQSxDQUFDQTtJQUM1Q0EsQ0FBQ0E7SUFDREgsV0FBV0EsQ0FBQ0EsTUFBd0NBO1FBQ2hESSxJQUFJQSxNQUFNQSxFQUFFQSxZQUFZQSxFQUFFQSxHQUFHQSxDQUFDQTtRQUM5QkEsR0FBR0EsR0FBR0EsTUFBTUEsQ0FBQ0EsS0FBS0EsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDeEJBLFlBQVlBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO1FBQ3pGQSxNQUFNQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtRQUNyQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDeEJBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBO1lBQ2pDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxHQUFHQSxNQUFNQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUN0REEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDSkEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsRUFBRUEsR0FBR0Es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QUNBO1FBQ3JCQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNOQSxTQUFTQSxHQUFHQSxFQUFFQSxDQUFDQTtZQUNmQSxVQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtZQUNuQ0EsY0FBY0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0E7WUFDdENBLFNBQVNBLEdBQUdBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1lBQ2xGQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQTtZQUN4QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsY0FBY0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzNDQSxTQUFTQSxHQUFHQSxDQUFDQSxTQUFTQSxHQUFHQSxjQUFjQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDaERBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLFlBQVlBLEVBQUVBLFNBQVNBLENBQUNBLENBQUNBO1lBQ3JEQSxDQUFDQTtZQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDZEEsU0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsU0FBU0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQzFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxZQUFZQSxFQUFFQSxTQUFTQSxDQUFDQSxDQUFDQTtZQUM1REEsQ0FBQ0E7UUFDTEEsQ0FBQ0E7SUFDTEEsQ0FBQ0E7QUFDTFQsQ0FBQ0E7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFRPRE8gaW1wb3J0IGpxdWVyeVxuZGVjbGFyZSB2YXIgJDogYW55O1xuXG5pbXBvcnQgRWRpdG9yIGZyb20gJy4uLy4uL0VkaXRvcic7XG5pbXBvcnQgSGFzaEhhbmRsZXIgZnJvbSAnLi4vLi4va2V5Ym9hcmQvSGFzaEhhbmRsZXInO1xuXG52YXIgQ0xBU1NOQU1FID0gJ2FjZV9hdXRvY29tcGxldGUnO1xudmFyIENMQVNTTkFNRV9TRUxFQ1RFRCA9ICdhY2VfYXV0b2NvbXBsZXRlX3NlbGVjdGVkJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXV0b0NvbXBsZXRlVmlldyB7XG4gICAgcHJpdmF0ZSBlZGl0b3I6IEVkaXRvcjtcbiAgICBwcml2YXRlIGF1dG9Db21wbGV0ZTtcbiAgICBwcml2YXRlIHNlbGVjdGVkQ2xhc3NOYW1lO1xuICAgIHB1YmxpYyB3cmFwOiBIVE1MRGl2RWxlbWVudDsgICAgLy8gTXVzdCBiZSBhY2Nlc3NpYmxlLlxuICAgIHB1YmxpYyBsaXN0RWxlbWVudDogSFRNTFVMaXN0RWxlbWVudDsgLy8gTXVzdCBiZSBhY2Nlc3NpYmxlLlxuICAgIHByaXZhdGUgaGFuZGxlciA9IG5ldyBIYXNoSGFuZGxlcigpO1xuICAgIGNvbnN0cnVjdG9yKGVkaXRvcjogRWRpdG9yLCBhdXRvQ29tcGxldGUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBlZGl0b3IgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2VkaXRvciBtdXN0IGJlIGRlZmluZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGF1dG9Db21wbGV0ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignYXV0b0NvbXBsZXRlIG11c3QgYmUgZGVmaW5lZCcpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZWRpdG9yID0gZWRpdG9yO1xuICAgICAgICB0aGlzLmF1dG9Db21wbGV0ZSA9IGF1dG9Db21wbGV0ZTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZENsYXNzTmFtZSA9IENMQVNTTkFNRV9TRUxFQ1RFRDtcbiAgICAgICAgLy8gaW5pdFxuICAgICAgICB0aGlzLndyYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5saXN0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG4gICAgICAgIHRoaXMud3JhcC5jbGFzc05hbWUgPSBDTEFTU05BTUU7XG4gICAgICAgIHRoaXMud3JhcC5hcHBlbmRDaGlsZCh0aGlzLmxpc3RFbGVtZW50KTtcblxuICAgICAgICB0aGlzLmVkaXRvci5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy53cmFwKTtcblxuICAgICAgICB0aGlzLndyYXAuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgdGhpcy5saXN0RWxlbWVudC5zdHlsZS5saXN0U3R5bGVUeXBlID0gJ25vbmUnO1xuICAgICAgICB0aGlzLndyYXAuc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnO1xuICAgICAgICB0aGlzLndyYXAuc3R5bGUuekluZGV4ID0gJzEwMDAnO1xuICAgIH1cbiAgICBzaG93KGNvb3JkczogeyBwYWdlWDogbnVtYmVyOyBwYWdlWTogbnVtYmVyIH0pIHtcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvbihjb29yZHMpO1xuICAgICAgICByZXR1cm4gdGhpcy53cmFwLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgIH1cbiAgICBoaWRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy53cmFwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfVxuICAgIHNldFBvc2l0aW9uKGNvb3JkczogeyBwYWdlWDogbnVtYmVyOyBwYWdlWTogbnVtYmVyIH0pIHtcbiAgICAgICAgdmFyIGJvdHRvbSwgZWRpdG9yQm90dG9tLCB0b3A7XG4gICAgICAgIHRvcCA9IGNvb3Jkcy5wYWdlWSArIDIwO1xuICAgICAgICBlZGl0b3JCb3R0b20gPSAkKHRoaXMuZWRpdG9yLmNvbnRhaW5lcikub2Zmc2V0KCkudG9wICsgJCh0aGlzLmVkaXRvci5jb250YWluZXIpLmhlaWdodCgpO1xuICAgICAgICBib3R0b20gPSB0b3AgKyAkKHRoaXMud3JhcCkuaGVpZ2h0KCk7XG4gICAgICAgIGlmIChib3R0b20gPCBlZGl0b3JCb3R0b20pIHtcbiAgICAgICAgICAgIHRoaXMud3JhcC5zdHlsZS50b3AgPSB0b3AgKyAncHgnO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMud3JhcC5zdHlsZS5sZWZ0ID0gY29vcmRzLnBhZ2VYICsgJ3B4JztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMud3JhcC5zdHlsZS50b3AgPSAodG9wIC0gJCh0aGlzLndyYXApLmhlaWdodCgpIC0gMjApICsgJ3B4JztcbiAgICAgICAgICAgIHJldHVybiB0aGlzLndyYXAuc3R5bGUubGVmdCA9IGNvb3Jkcy5wYWdlWCArICdweCc7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY3VycmVudCgpIHtcbiAgICAgICAgdmFyIGNoaWxkLCBjaGlsZHJlbiwgaTtcbiAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmxpc3RFbGVtZW50LmNoaWxkTm9kZXM7XG4gICAgICAgIGZvciAoaSBpbiBjaGlsZHJlbikge1xuICAgICAgICAgICAgY2hpbGQgPSBjaGlsZHJlbltpXTtcbiAgICAgICAgICAgIGlmIChjaGlsZC5jbGFzc05hbWUgPT09IHRoaXMuc2VsZWN0ZWRDbGFzc05hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGZvY3VzTmV4dCgpIHtcbiAgICAgICAgdmFyIGN1cnIsIGZvY3VzO1xuICAgICAgICBjdXJyID0gdGhpcy5jdXJyZW50KCk7XG4gICAgICAgIGZvY3VzID0gY3Vyci5uZXh0U2libGluZztcbiAgICAgICAgaWYgKGZvY3VzKSB7XG4gICAgICAgICAgICBjdXJyLmNsYXNzTmFtZSA9ICcnO1xuICAgICAgICAgICAgZm9jdXMuY2xhc3NOYW1lID0gdGhpcy5zZWxlY3RlZENsYXNzTmFtZTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkanVzdFBvc2l0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZm9jdXNQcmV2KCkge1xuICAgICAgICB2YXIgY3VyciwgZm9jdXM7XG4gICAgICAgIGN1cnIgPSB0aGlzLmN1cnJlbnQoKTtcbiAgICAgICAgZm9jdXMgPSBjdXJyLnByZXZpb3VzU2libGluZztcbiAgICAgICAgaWYgKGZvY3VzKSB7XG4gICAgICAgICAgICBjdXJyLmNsYXNzTmFtZSA9ICcnO1xuICAgICAgICAgICAgZm9jdXMuY2xhc3NOYW1lID0gdGhpcy5zZWxlY3RlZENsYXNzTmFtZTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkanVzdFBvc2l0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZW5zdXJlRm9jdXMoKSB7XG4gICAgICAgIGlmICghdGhpcy5jdXJyZW50KCkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmxpc3RFbGVtZW50LmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlyc3RDaGlsZDogSFRNTEVsZW1lbnQgPSA8SFRNTEVsZW1lbnQ+dGhpcy5saXN0RWxlbWVudC5maXJzdENoaWxkO1xuICAgICAgICAgICAgICAgIGZpcnN0Q2hpbGQuY2xhc3NOYW1lID0gdGhpcy5zZWxlY3RlZENsYXNzTmFtZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hZGp1c3RQb3NpdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGFkanVzdFBvc2l0aW9uKCkge1xuICAgICAgICB2YXIgZWxtLCBlbG1PdXRlckhlaWdodCwgbmV3TWFyZ2luLCBwb3MsIHByZU1hcmdpbiwgd3JhcEhlaWdodDtcbiAgICAgICAgZWxtID0gdGhpcy5jdXJyZW50KCk7XG4gICAgICAgIGlmIChlbG0pIHtcbiAgICAgICAgICAgIG5ld01hcmdpbiA9ICcnO1xuICAgICAgICAgICAgd3JhcEhlaWdodCA9ICQodGhpcy53cmFwKS5oZWlnaHQoKTtcbiAgICAgICAgICAgIGVsbU91dGVySGVpZ2h0ID0gJChlbG0pLm91dGVySGVpZ2h0KCk7XG4gICAgICAgICAgICBwcmVNYXJnaW4gPSBwYXJzZUludCgkKHRoaXMubGlzdEVsZW1lbnQpLmNzcyhcIm1hcmdpbi10b3BcIikucmVwbGFjZSgncHgnLCAnJyksIDEwKTtcbiAgICAgICAgICAgIHBvcyA9ICQoZWxtKS5wb3NpdGlvbigpO1xuICAgICAgICAgICAgaWYgKHBvcy50b3AgPj0gKHdyYXBIZWlnaHQgLSBlbG1PdXRlckhlaWdodCkpIHtcbiAgICAgICAgICAgICAgICBuZXdNYXJnaW4gPSAocHJlTWFyZ2luIC0gZWxtT3V0ZXJIZWlnaHQpICsgJ3B4JztcbiAgICAgICAgICAgICAgICAkKHRoaXMubGlzdEVsZW1lbnQpLmNzcyhcIm1hcmdpbi10b3BcIiwgbmV3TWFyZ2luKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwb3MudG9wIDwgMCkge1xuICAgICAgICAgICAgICAgIG5ld01hcmdpbiA9ICgtcG9zLnRvcCArIHByZU1hcmdpbikgKyAncHgnO1xuICAgICAgICAgICAgICAgIHJldHVybiAkKHRoaXMubGlzdEVsZW1lbnQpLmNzcyhcIm1hcmdpbi10b3BcIiwgbmV3TWFyZ2luKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==