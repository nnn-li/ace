export default class InputStream {
    constructor() {
        this.data = '';
        this.start = 0;
        this.committed = 0;
        this.eof = false;
        this.lastLocation = { line: 0, column: 0 };
    }
    slice() {
        if (this.start >= this.data.length) {
            if (!this.eof)
                throw InputStream.DRAIN;
            return InputStream.EOF;
        }
        return this.data.slice(this.start, this.data.length);
    }
    char() {
        if (!this.eof && this.start >= this.data.length - 1)
            throw InputStream.DRAIN;
        if (this.start >= this.data.length) {
            return InputStream.EOF;
        }
        var ch = this.data[this.start++];
        if (ch === '\r')
            ch = '\n';
        return ch;
    }
    advance(amount) {
        this.start += amount;
        if (this.start >= this.data.length) {
            if (!this.eof)
                throw InputStream.DRAIN;
            return InputStream.EOF;
        }
        else {
            if (this.committed > this.data.length / 2) {
                this.lastLocation = this.location();
                this.data = this.data.slice(this.committed);
                this.start = this.start - this.committed;
                this.committed = 0;
            }
        }
    }
    matchWhile(re) {
        if (this.eof && this.start >= this.data.length)
            return '';
        var r = new RegExp("^" + re + "+");
        var m = r.exec(this.slice());
        if (m) {
            if (!this.eof && m[0].length == this.data.length - this.start)
                throw InputStream.DRAIN;
            this.advance(m[0].length);
            return m[0];
        }
        else {
            return '';
        }
    }
    matchUntil(re) {
        var m, s;
        s = this.slice();
        if (s === InputStream.EOF) {
            return '';
        }
        else if (m = new RegExp(re + (this.eof ? "|$" : "")).exec(s)) {
            var t = this.data.slice(this.start, this.start + m.index);
            this.advance(m.index);
            return t.replace(/\r/g, '\n').replace(/\n{2,}/g, '\n');
        }
        else {
            throw InputStream.DRAIN;
        }
    }
    append(data) {
        this.data += data;
    }
    shift(n) {
        if (!this.eof && this.start + n >= this.data.length)
            throw InputStream.DRAIN;
        if (this.eof && this.start >= this.data.length)
            return InputStream.EOF;
        var d = this.data.slice(this.start, this.start + n).toString();
        this.advance(Math.min(n, this.data.length - this.start));
        return d;
    }
    peek(n) {
        if (!this.eof && this.start + n >= this.data.length)
            throw InputStream.DRAIN;
        if (this.eof && this.start >= this.data.length)
            return InputStream.EOF;
        return this.data.slice(this.start, Math.min(this.start + n, this.data.length)).toString();
    }
    length() {
        return this.data.length - this.start - 1;
    }
    unget(d) {
        if (d === InputStream.EOF)
            return;
        this.start -= (d.length);
    }
    undo() {
        this.start = this.committed;
    }
    commit() {
        this.committed = this.start;
    }
    location() {
        var lastLine = this.lastLocation.line;
        var lastColumn = this.lastLocation.column;
        var read = this.data.slice(0, this.committed);
        var newlines = read.match(/\n/g);
        var line = newlines ? lastLine + newlines.length : lastLine;
        var column = newlines ? read.length - read.lastIndexOf('\n') - 1 : lastColumn + read.length;
        return { line: line, column: column };
    }
}
InputStream.EOF = -1;
InputStream.DRAIN = -2;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5wdXRTdHJlYW0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbW9kZS9odG1sL0lucHV0U3RyZWFtLnRzIl0sIm5hbWVzIjpbIklucHV0U3RyZWFtIiwiSW5wdXRTdHJlYW0uY29uc3RydWN0b3IiLCJJbnB1dFN0cmVhbS5zbGljZSIsIklucHV0U3RyZWFtLmNoYXIiLCJJbnB1dFN0cmVhbS5hZHZhbmNlIiwiSW5wdXRTdHJlYW0ubWF0Y2hXaGlsZSIsIklucHV0U3RyZWFtLm1hdGNoVW50aWwiLCJJbnB1dFN0cmVhbS5hcHBlbmQiLCJJbnB1dFN0cmVhbS5zaGlmdCIsIklucHV0U3RyZWFtLnBlZWsiLCJJbnB1dFN0cmVhbS5sZW5ndGgiLCJJbnB1dFN0cmVhbS51bmdldCIsIklucHV0U3RyZWFtLnVuZG8iLCJJbnB1dFN0cmVhbS5jb21taXQiLCJJbnB1dFN0cmVhbS5sb2NhdGlvbiJdLCJtYXBwaW5ncyI6IkFBQ0E7SUFNSUE7UUFDSUMsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDZkEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDZkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDbkJBLElBQUlBLENBQUNBLEdBQUdBLEdBQUdBLEtBQUtBLENBQUNBO1FBQ2pCQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxDQUFDQSxFQUFFQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtJQUMvQ0EsQ0FBQ0E7SUFDREQsS0FBS0E7UUFDREUsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsSUFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDakNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBO2dCQUFDQSxNQUFNQSxXQUFXQSxDQUFDQSxLQUFLQSxDQUFDQTtZQUN2Q0EsTUFBTUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7UUFDM0JBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO0lBQ3pEQSxDQUFDQTtJQUNERixJQUFJQTtRQUNBRyxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxJQUFJQSxJQUFJQSxDQUFDQSxLQUFLQSxJQUFJQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUFDQSxNQUFNQSxXQUFXQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUM3RUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsSUFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDakNBLE1BQU1BLENBQUNBLFdBQVdBLENBQUNBLEdBQUdBLENBQUNBO1FBQzNCQSxDQUFDQTtRQUNEQSxJQUFJQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNqQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsS0FBS0EsSUFBSUEsQ0FBQ0E7WUFDWkEsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDZEEsTUFBTUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7SUFDZEEsQ0FBQ0E7SUFDREgsT0FBT0EsQ0FBQ0EsTUFBTUE7UUFDVkksSUFBSUEsQ0FBQ0EsS0FBS0EsSUFBSUEsTUFBTUEsQ0FBQ0E7UUFDckJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLElBQUlBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1lBQ2pDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQTtnQkFBQ0EsTUFBTUEsV0FBV0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7WUFDdkNBLE1BQU1BLENBQUNBLFdBQVdBLENBQUNBLEdBQUdBLENBQUNBO1FBQzNCQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNKQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFFeENBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBO2dCQUNwQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzVDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQTtnQkFDekNBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ3ZCQSxDQUFDQTtRQUNMQSxDQUFDQTtJQUNMQSxDQUFDQTtJQUNESixVQUFVQSxDQUFDQSxFQUFFQTtRQUNUSyxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxJQUFJQSxJQUFJQSxDQUFDQSxLQUFLQSxJQUFJQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUFDQSxNQUFNQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUMxREEsSUFBSUEsQ0FBQ0EsR0FBR0EsSUFBSUEsTUFBTUEsQ0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDbkNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBO1FBQzdCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNKQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxJQUFJQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQTtnQkFBQ0EsTUFBTUEsV0FBV0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7WUFDdkZBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1lBQzFCQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNoQkEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDSkEsTUFBTUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7UUFDZEEsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFDREwsVUFBVUEsQ0FBQ0EsRUFBRUE7UUFDVE0sSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDVEEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7UUFDakJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLFdBQVdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1lBQ3hCQSxNQUFNQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUNkQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxNQUFNQSxDQUFDQSxFQUFFQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxHQUFHQSxJQUFJQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3REEsSUFBSUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFDMURBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1lBQ3RCQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxLQUFLQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxTQUFTQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUMzREEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDSkEsTUFBTUEsV0FBV0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDNUJBLENBQUNBO0lBQ0xBLENBQUNBO0lBQ0ROLE1BQU1BLENBQUNBLElBQUlBO1FBQ1BPLElBQUlBLENBQUNBLElBQUlBLElBQUlBLElBQUlBLENBQUNBO0lBQ3RCQSxDQUFDQTtJQUNEUCxLQUFLQSxDQUFDQSxDQUFDQTtRQUNIUSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxJQUFJQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUFDQSxNQUFNQSxXQUFXQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUM3RUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsSUFBSUEsSUFBSUEsQ0FBQ0EsS0FBS0EsSUFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFBQ0EsTUFBTUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7UUFDdkVBLElBQUlBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBO1FBQy9EQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6REEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDYkEsQ0FBQ0E7SUFDRFIsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDRlMsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsSUFBSUEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFBQ0EsTUFBTUEsV0FBV0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDN0VBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLElBQUlBLElBQUlBLENBQUNBLEtBQUtBLElBQUlBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO1lBQUNBLE1BQU1BLENBQUNBLFdBQVdBLENBQUNBLEdBQUdBLENBQUNBO1FBQ3ZFQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQTtJQUM5RkEsQ0FBQ0E7SUFDRFQsTUFBTUE7UUFDRlUsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFDN0NBLENBQUNBO0lBQ0RWLEtBQUtBLENBQUNBLENBQUNBO1FBQ0hXLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLFdBQVdBLENBQUNBLEdBQUdBLENBQUNBO1lBQUNBLE1BQU1BLENBQUNBO1FBQ2xDQSxJQUFJQSxDQUFDQSxLQUFLQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtJQUM3QkEsQ0FBQ0E7SUFDRFgsSUFBSUE7UUFDQVksSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0E7SUFDaENBLENBQUNBO0lBQ0RaLE1BQU1BO1FBQ0ZhLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBO0lBQ2hDQSxDQUFDQTtJQUNEYixRQUFRQTtRQUNKYyxJQUFJQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxJQUFJQSxDQUFDQTtRQUN0Q0EsSUFBSUEsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDMUNBLElBQUlBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBO1FBQzlDQSxJQUFJQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUNqQ0EsSUFBSUEsSUFBSUEsR0FBR0EsUUFBUUEsR0FBR0EsUUFBUUEsR0FBR0EsUUFBUUEsQ0FBQ0EsTUFBTUEsR0FBR0EsUUFBUUEsQ0FBQ0E7UUFDNURBLElBQUlBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLFVBQVVBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO1FBQzVGQSxNQUFNQSxDQUFDQSxFQUFFQSxJQUFJQSxFQUFFQSxJQUFJQSxFQUFFQSxNQUFNQSxFQUFFQSxNQUFNQSxFQUFFQSxDQUFDQTtJQUMxQ0EsQ0FBQ0E7QUFHTGQsQ0FBQ0E7QUFGVSxlQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDVCxpQkFBSyxHQUFHLENBQUMsQ0FBQyxDQUNwQiIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZJWE1FIGNvbnZlcnQgQ1IgdG8gTEYgaHR0cDovL3d3dy53aGF0d2cub3JnL3NwZWNzL3dlYi1hcHBzL2N1cnJlbnQtd29yay9tdWx0aXBhZ2UvcGFyc2luZy5odG1sI2lucHV0LXN0cmVhbVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSW5wdXRTdHJlYW0ge1xuICAgIGRhdGE6IHN0cmluZztcbiAgICBzdGFydDogbnVtYmVyO1xuICAgIGNvbW1pdHRlZDogbnVtYmVyO1xuICAgIGVvZjogYm9vbGVhbjtcbiAgICBsYXN0TG9jYXRpb246IHsgbGluZTogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9O1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmRhdGEgPSAnJztcbiAgICAgICAgdGhpcy5zdGFydCA9IDA7XG4gICAgICAgIHRoaXMuY29tbWl0dGVkID0gMDtcbiAgICAgICAgdGhpcy5lb2YgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5sYXN0TG9jYXRpb24gPSB7IGxpbmU6IDAsIGNvbHVtbjogMCB9O1xuICAgIH1cbiAgICBzbGljZSgpOiBhbnkge1xuICAgICAgICBpZiAodGhpcy5zdGFydCA+PSB0aGlzLmRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuZW9mKSB0aHJvdyBJbnB1dFN0cmVhbS5EUkFJTjtcbiAgICAgICAgICAgIHJldHVybiBJbnB1dFN0cmVhbS5FT0Y7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5zbGljZSh0aGlzLnN0YXJ0LCB0aGlzLmRhdGEubGVuZ3RoKTtcbiAgICB9XG4gICAgY2hhcigpOiBhbnkge1xuICAgICAgICBpZiAoIXRoaXMuZW9mICYmIHRoaXMuc3RhcnQgPj0gdGhpcy5kYXRhLmxlbmd0aCAtIDEpIHRocm93IElucHV0U3RyZWFtLkRSQUlOO1xuICAgICAgICBpZiAodGhpcy5zdGFydCA+PSB0aGlzLmRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gSW5wdXRTdHJlYW0uRU9GO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjaCA9IHRoaXMuZGF0YVt0aGlzLnN0YXJ0KytdO1xuICAgICAgICBpZiAoY2ggPT09ICdcXHInKVxuICAgICAgICAgICAgY2ggPSAnXFxuJztcbiAgICAgICAgcmV0dXJuIGNoO1xuICAgIH1cbiAgICBhZHZhbmNlKGFtb3VudCkge1xuICAgICAgICB0aGlzLnN0YXJ0ICs9IGFtb3VudDtcbiAgICAgICAgaWYgKHRoaXMuc3RhcnQgPj0gdGhpcy5kYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmVvZikgdGhyb3cgSW5wdXRTdHJlYW0uRFJBSU47XG4gICAgICAgICAgICByZXR1cm4gSW5wdXRTdHJlYW0uRU9GO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuY29tbWl0dGVkID4gdGhpcy5kYXRhLmxlbmd0aCAvIDIpIHtcbiAgICAgICAgICAgICAgICAvLyBTbGlpaWlkZVxuICAgICAgICAgICAgICAgIHRoaXMubGFzdExvY2F0aW9uID0gdGhpcy5sb2NhdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IHRoaXMuZGF0YS5zbGljZSh0aGlzLmNvbW1pdHRlZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydCA9IHRoaXMuc3RhcnQgLSB0aGlzLmNvbW1pdHRlZDtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbW1pdHRlZCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgbWF0Y2hXaGlsZShyZSkge1xuICAgICAgICBpZiAodGhpcy5lb2YgJiYgdGhpcy5zdGFydCA+PSB0aGlzLmRhdGEubGVuZ3RoKSByZXR1cm4gJyc7XG4gICAgICAgIHZhciByID0gbmV3IFJlZ0V4cChcIl5cIiArIHJlICsgXCIrXCIpO1xuICAgICAgICB2YXIgbSA9IHIuZXhlYyh0aGlzLnNsaWNlKCkpO1xuICAgICAgICBpZiAobSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmVvZiAmJiBtWzBdLmxlbmd0aCA9PSB0aGlzLmRhdGEubGVuZ3RoIC0gdGhpcy5zdGFydCkgdGhyb3cgSW5wdXRTdHJlYW0uRFJBSU47XG4gICAgICAgICAgICB0aGlzLmFkdmFuY2UobVswXS5sZW5ndGgpO1xuICAgICAgICAgICAgcmV0dXJuIG1bMF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbWF0Y2hVbnRpbChyZSkge1xuICAgICAgICB2YXIgbSwgcztcbiAgICAgICAgcyA9IHRoaXMuc2xpY2UoKTtcbiAgICAgICAgaWYgKHMgPT09IElucHV0U3RyZWFtLkVPRikge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9IGVsc2UgaWYgKG0gPSBuZXcgUmVnRXhwKHJlICsgKHRoaXMuZW9mID8gXCJ8JFwiIDogXCJcIikpLmV4ZWMocykpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcy5kYXRhLnNsaWNlKHRoaXMuc3RhcnQsIHRoaXMuc3RhcnQgKyBtLmluZGV4KTtcbiAgICAgICAgICAgIHRoaXMuYWR2YW5jZShtLmluZGV4KTtcbiAgICAgICAgICAgIHJldHVybiB0LnJlcGxhY2UoL1xcci9nLCAnXFxuJykucmVwbGFjZSgvXFxuezIsfS9nLCAnXFxuJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBJbnB1dFN0cmVhbS5EUkFJTjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhcHBlbmQoZGF0YSkge1xuICAgICAgICB0aGlzLmRhdGEgKz0gZGF0YTtcbiAgICB9XG4gICAgc2hpZnQobik6IGFueSB7XG4gICAgICAgIGlmICghdGhpcy5lb2YgJiYgdGhpcy5zdGFydCArIG4gPj0gdGhpcy5kYXRhLmxlbmd0aCkgdGhyb3cgSW5wdXRTdHJlYW0uRFJBSU47XG4gICAgICAgIGlmICh0aGlzLmVvZiAmJiB0aGlzLnN0YXJ0ID49IHRoaXMuZGF0YS5sZW5ndGgpIHJldHVybiBJbnB1dFN0cmVhbS5FT0Y7XG4gICAgICAgIHZhciBkID0gdGhpcy5kYXRhLnNsaWNlKHRoaXMuc3RhcnQsIHRoaXMuc3RhcnQgKyBuKS50b1N0cmluZygpO1xuICAgICAgICB0aGlzLmFkdmFuY2UoTWF0aC5taW4obiwgdGhpcy5kYXRhLmxlbmd0aCAtIHRoaXMuc3RhcnQpKTtcbiAgICAgICAgcmV0dXJuIGQ7XG4gICAgfVxuICAgIHBlZWsobik6IGFueSB7XG4gICAgICAgIGlmICghdGhpcy5lb2YgJiYgdGhpcy5zdGFydCArIG4gPj0gdGhpcy5kYXRhLmxlbmd0aCkgdGhyb3cgSW5wdXRTdHJlYW0uRFJBSU47XG4gICAgICAgIGlmICh0aGlzLmVvZiAmJiB0aGlzLnN0YXJ0ID49IHRoaXMuZGF0YS5sZW5ndGgpIHJldHVybiBJbnB1dFN0cmVhbS5FT0Y7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEuc2xpY2UodGhpcy5zdGFydCwgTWF0aC5taW4odGhpcy5zdGFydCArIG4sIHRoaXMuZGF0YS5sZW5ndGgpKS50b1N0cmluZygpO1xuICAgIH1cbiAgICBsZW5ndGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEubGVuZ3RoIC0gdGhpcy5zdGFydCAtIDE7XG4gICAgfVxuICAgIHVuZ2V0KGQpIHtcbiAgICAgICAgaWYgKGQgPT09IElucHV0U3RyZWFtLkVPRikgcmV0dXJuO1xuICAgICAgICB0aGlzLnN0YXJ0IC09IChkLmxlbmd0aCk7XG4gICAgfVxuICAgIHVuZG8oKSB7XG4gICAgICAgIHRoaXMuc3RhcnQgPSB0aGlzLmNvbW1pdHRlZDtcbiAgICB9XG4gICAgY29tbWl0KCkge1xuICAgICAgICB0aGlzLmNvbW1pdHRlZCA9IHRoaXMuc3RhcnQ7XG4gICAgfVxuICAgIGxvY2F0aW9uKCkge1xuICAgICAgICB2YXIgbGFzdExpbmUgPSB0aGlzLmxhc3RMb2NhdGlvbi5saW5lO1xuICAgICAgICB2YXIgbGFzdENvbHVtbiA9IHRoaXMubGFzdExvY2F0aW9uLmNvbHVtbjtcbiAgICAgICAgdmFyIHJlYWQgPSB0aGlzLmRhdGEuc2xpY2UoMCwgdGhpcy5jb21taXR0ZWQpO1xuICAgICAgICB2YXIgbmV3bGluZXMgPSByZWFkLm1hdGNoKC9cXG4vZyk7XG4gICAgICAgIHZhciBsaW5lID0gbmV3bGluZXMgPyBsYXN0TGluZSArIG5ld2xpbmVzLmxlbmd0aCA6IGxhc3RMaW5lO1xuICAgICAgICB2YXIgY29sdW1uID0gbmV3bGluZXMgPyByZWFkLmxlbmd0aCAtIHJlYWQubGFzdEluZGV4T2YoJ1xcbicpIC0gMSA6IGxhc3RDb2x1bW4gKyByZWFkLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIHsgbGluZTogbGluZSwgY29sdW1uOiBjb2x1bW4gfTtcbiAgICB9XG4gICAgc3RhdGljIEVPRiA9IC0xO1xuICAgIHN0YXRpYyBEUkFJTiA9IC0yO1xufVxuIl19