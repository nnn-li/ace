import entities from './entities';
import InputStream from './InputStream';
import isAlphaNumeric from './isAlphaNumeric';
import isDecimalDigit from './isDecimalDigit';
import isHexDigit from './isHexDigit';
var namedEntityPrefixes = {};
Object.keys(entities).forEach(function (entityKey) {
    for (var i = 0; i < entityKey.length; i++) {
        namedEntityPrefixes[entityKey.substring(0, i + 1)] = true;
    }
});
class EntityParserClass {
    constructor() {
    }
    consumeEntity(buffer, tokenizer, additionalAllowedCharacter) {
        var decodedCharacter = '';
        var consumedCharacters = '';
        var ch = buffer.char();
        if (ch === InputStream.EOF)
            return false;
        consumedCharacters += ch;
        if (ch == '\t' || ch == '\n' || ch == '\v' || ch == ' ' || ch == '<' || ch == '&') {
            buffer.unget(consumedCharacters);
            return false;
        }
        if (additionalAllowedCharacter === ch) {
            buffer.unget(consumedCharacters);
            return false;
        }
        if (ch == '#') {
            ch = buffer.shift(1);
            if (ch === InputStream.EOF) {
                tokenizer._parseError("expected-numeric-entity-but-got-eof");
                buffer.unget(consumedCharacters);
                return false;
            }
            consumedCharacters += ch;
            var radix = 10;
            var isDigit = isDecimalDigit;
            if (ch == 'x' || ch == 'X') {
                radix = 16;
                isDigit = isHexDigit;
                ch = buffer.shift(1);
                if (ch === InputStream.EOF) {
                    tokenizer._parseError("expected-numeric-entity-but-got-eof");
                    buffer.unget(consumedCharacters);
                    return false;
                }
                consumedCharacters += ch;
            }
            if (isDigit(ch)) {
                var code = '';
                while (ch !== InputStream.EOF && isDigit(ch)) {
                    code += ch;
                    ch = buffer.char();
                }
                code = parseInt(code, radix);
                var replacement = this.replaceEntityNumbers(code);
                if (replacement) {
                    tokenizer._parseError("invalid-numeric-entity-replaced");
                    code = replacement;
                }
                if (code > 0xFFFF && code <= 0x10FFFF) {
                    code -= 0x10000;
                    var first = ((0xffc00 & code) >> 10) + 0xD800;
                    var second = (0x3ff & code) + 0xDC00;
                    decodedCharacter = String.fromCharCode(first, second);
                }
                else
                    decodedCharacter = String.fromCharCode(code);
                if (ch !== ';') {
                    tokenizer._parseError("numeric-entity-without-semicolon");
                    buffer.unget(ch);
                }
                return decodedCharacter;
            }
            buffer.unget(consumedCharacters);
            tokenizer._parseError("expected-numeric-entity");
            return false;
        }
        if ((ch >= 'a' && ch <= 'z') || (ch >= 'A' && ch <= 'Z')) {
            var mostRecentMatch = '';
            while (namedEntityPrefixes[consumedCharacters]) {
                if (entities[consumedCharacters]) {
                    mostRecentMatch = consumedCharacters;
                }
                if (ch == ';')
                    break;
                ch = buffer.char();
                if (ch === InputStream.EOF)
                    break;
                consumedCharacters += ch;
            }
            if (!mostRecentMatch) {
                tokenizer._parseError("expected-named-entity");
                buffer.unget(consumedCharacters);
                return false;
            }
            decodedCharacter = entities[mostRecentMatch];
            if (ch === ';' || !additionalAllowedCharacter || !(isAlphaNumeric(ch) || ch === '=')) {
                if (consumedCharacters.length > mostRecentMatch.length) {
                    buffer.unget(consumedCharacters.substring(mostRecentMatch.length));
                }
                if (ch !== ';') {
                    tokenizer._parseError("named-entity-without-semicolon");
                }
                return decodedCharacter;
            }
            buffer.unget(consumedCharacters);
            return false;
        }
    }
    replaceEntityNumbers(c) {
        switch (c) {
            case 0x00: return 0xFFFD;
            case 0x13: return 0x0010;
            case 0x80: return 0x20AC;
            case 0x81: return 0x0081;
            case 0x82: return 0x201A;
            case 0x83: return 0x0192;
            case 0x84: return 0x201E;
            case 0x85: return 0x2026;
            case 0x86: return 0x2020;
            case 0x87: return 0x2021;
            case 0x88: return 0x02C6;
            case 0x89: return 0x2030;
            case 0x8A: return 0x0160;
            case 0x8B: return 0x2039;
            case 0x8C: return 0x0152;
            case 0x8D: return 0x008D;
            case 0x8E: return 0x017D;
            case 0x8F: return 0x008F;
            case 0x90: return 0x0090;
            case 0x91: return 0x2018;
            case 0x92: return 0x2019;
            case 0x93: return 0x201C;
            case 0x94: return 0x201D;
            case 0x95: return 0x2022;
            case 0x96: return 0x2013;
            case 0x97: return 0x2014;
            case 0x98: return 0x02DC;
            case 0x99: return 0x2122;
            case 0x9A: return 0x0161;
            case 0x9B: return 0x203A;
            case 0x9C: return 0x0153;
            case 0x9D: return 0x009D;
            case 0x9E: return 0x017E;
            case 0x9F: return 0x0178;
            default:
                if ((c >= 0xD800 && c <= 0xDFFF) || c > 0x10FFFF) {
                    return 0xFFFD;
                }
                else if ((c >= 0x0001 && c <= 0x0008) || (c >= 0x000E && c <= 0x001F) ||
                    (c >= 0x007F && c <= 0x009F) || (c >= 0xFDD0 && c <= 0xFDEF) ||
                    c == 0x000B || c == 0xFFFE || c == 0x1FFFE || c == 0x2FFFFE ||
                    c == 0x2FFFF || c == 0x3FFFE || c == 0x3FFFF || c == 0x4FFFE ||
                    c == 0x4FFFF || c == 0x5FFFE || c == 0x5FFFF || c == 0x6FFFE ||
                    c == 0x6FFFF || c == 0x7FFFE || c == 0x7FFFF || c == 0x8FFFE ||
                    c == 0x8FFFF || c == 0x9FFFE || c == 0x9FFFF || c == 0xAFFFE ||
                    c == 0xAFFFF || c == 0xBFFFE || c == 0xBFFFF || c == 0xCFFFE ||
                    c == 0xCFFFF || c == 0xDFFFE || c == 0xDFFFF || c == 0xEFFFE ||
                    c == 0xEFFFF || c == 0xFFFFE || c == 0xFFFFF || c == 0x10FFFE ||
                    c == 0x10FFFF) {
                    return c;
                }
        }
    }
}
export var EntityParser = new EntityParserClass();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW50aXR5UGFyc2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL21vZGUvaHRtbC9FbnRpdHlQYXJzZXIudHMiXSwibmFtZXMiOlsiRW50aXR5UGFyc2VyQ2xhc3MiLCJFbnRpdHlQYXJzZXJDbGFzcy5jb25zdHJ1Y3RvciIsIkVudGl0eVBhcnNlckNsYXNzLmNvbnN1bWVFbnRpdHkiLCJFbnRpdHlQYXJzZXJDbGFzcy5yZXBsYWNlRW50aXR5TnVtYmVycyJdLCJtYXBwaW5ncyI6Ik9BQU8sUUFBUSxNQUFNLFlBQVk7T0FDMUIsV0FBVyxNQUFNLGVBQWU7T0FDaEMsY0FBYyxNQUFNLGtCQUFrQjtPQUN0QyxjQUFjLE1BQU0sa0JBQWtCO09BQ3RDLFVBQVUsTUFBTSxjQUFjO0FBR3JDLElBQUksbUJBQW1CLEdBQUcsRUFBRSxDQUFDO0FBQzdCLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVMsU0FBUztJQUM1QyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQ3hDLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQztJQUM5RCxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSDtJQUNJQTtJQUNBQyxDQUFDQTtJQUNERCxhQUFhQSxDQUFDQSxNQUFtQkEsRUFBRUEsU0FBb0JBLEVBQUVBLDBCQUFtQ0E7UUFDeEZFLElBQUlBLGdCQUFnQkEsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDMUJBLElBQUlBLGtCQUFrQkEsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDNUJBLElBQUlBLEVBQUVBLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLEVBQUVBLENBQUNBO1FBQ3ZCQSxFQUFFQSxD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QUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQTtnQkFDSUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsTUFBTUEsSUFBSUEsQ0FBQ0EsSUFBSUEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQy9DQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtnQkFDbEJBLENBQUNBO2dCQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxNQUFNQSxJQUFJQSxDQUFDQSxJQUFJQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxJQUFJQSxNQUFNQSxJQUFJQSxDQUFDQSxJQUFJQSxNQUFNQSxDQUFDQTtvQkFDbkVBLENBQUNBLENBQUNBLElBQUlBLE1BQU1BLElBQUlBLENBQUNBLElBQUlBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLENBQUNBLElBQUlBLE1BQU1BLElBQUlBLENBQUNBLElBQUlBLE1BQU1BLENBQUNBO29CQUM1REEsQ0FBQ0EsSUFBSUEsTUFBTUEsSUFBSUEsQ0FBQ0EsSUFBSUEsTUFBTUEsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsUUFBUUE7b0JBQzNEQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQTtvQkFDNURBLENBQUNBLElBQUlBLE9BQU9BLElBQUlBLENBQUNBLElBQUlBLE9BQU9BLElBQUlBLENBQUNBLElBQUlBLE9BQU9BLElBQUlBLENBQUNBLElBQUlBLE9BQU9BO29CQUM1REEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0E7b0JBQzVEQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQTtvQkFDNURBLENBQUNBLElBQUlBLE9BQU9BLElBQUlBLENBQUNBLElBQUlBLE9BQU9BLElBQUlBLENBQUNBLElBQUlBLE9BQU9BLElBQUlBLENBQUNBLElBQUlBLE9BQU9BO29CQUM1REEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0E7b0JBQzVEQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxRQUFRQTtvQkFDN0RBLENBQUNBLElBQUlBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO29CQUNoQkEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2JBLENBQUNBO1FBQ1RBLENBQUNBO0lBQ0xBLENBQUNBO0FBQ0xILENBQUNBO0FBRUQsV0FBVyxZQUFZLEdBQUcsSUFBSSxpQkFBaUIsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGVudGl0aWVzIGZyb20gJy4vZW50aXRpZXMnO1xuaW1wb3J0IElucHV0U3RyZWFtIGZyb20gJy4vSW5wdXRTdHJlYW0nO1xuaW1wb3J0IGlzQWxwaGFOdW1lcmljIGZyb20gJy4vaXNBbHBoYU51bWVyaWMnO1xuaW1wb3J0IGlzRGVjaW1hbERpZ2l0IGZyb20gJy4vaXNEZWNpbWFsRGlnaXQnO1xuaW1wb3J0IGlzSGV4RGlnaXQgZnJvbSAnLi9pc0hleERpZ2l0JztcbmltcG9ydCBUb2tlbml6ZXIgZnJvbSAnLi9Ub2tlbml6ZXInO1xuXG52YXIgbmFtZWRFbnRpdHlQcmVmaXhlcyA9IHt9O1xuT2JqZWN0LmtleXMoZW50aXRpZXMpLmZvckVhY2goZnVuY3Rpb24oZW50aXR5S2V5KSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbnRpdHlLZXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbmFtZWRFbnRpdHlQcmVmaXhlc1tlbnRpdHlLZXkuc3Vic3RyaW5nKDAsIGkgKyAxKV0gPSB0cnVlO1xuICAgIH1cbn0pO1xuXG5jbGFzcyBFbnRpdHlQYXJzZXJDbGFzcyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgfVxuICAgIGNvbnN1bWVFbnRpdHkoYnVmZmVyOiBJbnB1dFN0cmVhbSwgdG9rZW5pemVyOiBUb2tlbml6ZXIsIGFkZGl0aW9uYWxBbGxvd2VkQ2hhcmFjdGVyPzogc3RyaW5nKTogYW55IHtcbiAgICAgICAgdmFyIGRlY29kZWRDaGFyYWN0ZXIgPSAnJztcbiAgICAgICAgdmFyIGNvbnN1bWVkQ2hhcmFjdGVycyA9ICcnO1xuICAgICAgICB2YXIgY2ggPSBidWZmZXIuY2hhcigpO1xuICAgICAgICBpZiAoY2ggPT09IElucHV0U3RyZWFtLkVPRilcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgY29uc3VtZWRDaGFyYWN0ZXJzICs9IGNoO1xuICAgICAgICBpZiAoY2ggPT0gJ1xcdCcgfHwgY2ggPT0gJ1xcbicgfHwgY2ggPT0gJ1xcdicgfHwgY2ggPT0gJyAnIHx8IGNoID09ICc8JyB8fCBjaCA9PSAnJicpIHtcbiAgICAgICAgICAgIGJ1ZmZlci51bmdldChjb25zdW1lZENoYXJhY3RlcnMpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhZGRpdGlvbmFsQWxsb3dlZENoYXJhY3RlciA9PT0gY2gpIHtcbiAgICAgICAgICAgIGJ1ZmZlci51bmdldChjb25zdW1lZENoYXJhY3RlcnMpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaCA9PSAnIycpIHtcbiAgICAgICAgICAgIGNoID0gYnVmZmVyLnNoaWZ0KDEpO1xuICAgICAgICAgICAgaWYgKGNoID09PSBJbnB1dFN0cmVhbS5FT0YpIHtcbiAgICAgICAgICAgICAgICB0b2tlbml6ZXIuX3BhcnNlRXJyb3IoXCJleHBlY3RlZC1udW1lcmljLWVudGl0eS1idXQtZ290LWVvZlwiKTtcbiAgICAgICAgICAgICAgICBidWZmZXIudW5nZXQoY29uc3VtZWRDaGFyYWN0ZXJzKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdW1lZENoYXJhY3RlcnMgKz0gY2g7XG4gICAgICAgICAgICB2YXIgcmFkaXggPSAxMDtcbiAgICAgICAgICAgIHZhciBpc0RpZ2l0ID0gaXNEZWNpbWFsRGlnaXQ7XG4gICAgICAgICAgICBpZiAoY2ggPT0gJ3gnIHx8IGNoID09ICdYJykge1xuICAgICAgICAgICAgICAgIHJhZGl4ID0gMTY7XG4gICAgICAgICAgICAgICAgaXNEaWdpdCA9IGlzSGV4RGlnaXQ7XG4gICAgICAgICAgICAgICAgY2ggPSBidWZmZXIuc2hpZnQoMSk7XG4gICAgICAgICAgICAgICAgaWYgKGNoID09PSBJbnB1dFN0cmVhbS5FT0YpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyLl9wYXJzZUVycm9yKFwiZXhwZWN0ZWQtbnVtZXJpYy1lbnRpdHktYnV0LWdvdC1lb2ZcIik7XG4gICAgICAgICAgICAgICAgICAgIGJ1ZmZlci51bmdldChjb25zdW1lZENoYXJhY3RlcnMpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN1bWVkQ2hhcmFjdGVycyArPSBjaDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc0RpZ2l0KGNoKSkge1xuICAgICAgICAgICAgICAgIHZhciBjb2RlOiBhbnkgPSAnJztcbiAgICAgICAgICAgICAgICB3aGlsZSAoY2ggIT09IElucHV0U3RyZWFtLkVPRiAmJiBpc0RpZ2l0KGNoKSkge1xuICAgICAgICAgICAgICAgICAgICBjb2RlICs9IGNoO1xuICAgICAgICAgICAgICAgICAgICBjaCA9IGJ1ZmZlci5jaGFyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvZGUgPSBwYXJzZUludChjb2RlLCByYWRpeCk7XG4gICAgICAgICAgICAgICAgdmFyIHJlcGxhY2VtZW50ID0gdGhpcy5yZXBsYWNlRW50aXR5TnVtYmVycyhjb2RlKTtcbiAgICAgICAgICAgICAgICBpZiAocmVwbGFjZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyLl9wYXJzZUVycm9yKFwiaW52YWxpZC1udW1lcmljLWVudGl0eS1yZXBsYWNlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgY29kZSA9IHJlcGxhY2VtZW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY29kZSA+IDB4RkZGRiAmJiBjb2RlIDw9IDB4MTBGRkZGKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHdlIHN1YnN0cmFjdCAweDEwMDAwIGZyb20gY3AgdG8gZ2V0IGEgMjAtYml0cyBudW1iZXJcbiAgICAgICAgICAgICAgICAgICAgLy8gaW4gdGhlIHJhbmdlIDAuLjB4RkZGRlxuICAgICAgICAgICAgICAgICAgICBjb2RlIC09IDB4MTAwMDA7XG4gICAgICAgICAgICAgICAgICAgIC8vIHdlIGFkZCAweEQ4MDAgdG8gdGhlIG51bWJlciBmb3JtZWQgYnkgdGhlIGZpcnN0IDEwIGJpdHNcbiAgICAgICAgICAgICAgICAgICAgLy8gdG8gZ2l2ZSB0aGUgZmlyc3QgYnl0ZVxuICAgICAgICAgICAgICAgICAgICB2YXIgZmlyc3QgPSAoKDB4ZmZjMDAgJiBjb2RlKSA+PiAxMCkgKyAweEQ4MDA7XG4gICAgICAgICAgICAgICAgICAgIC8vIHdlIGFkZCAweERDMDAgdG8gdGhlIG51bWJlciBmb3JtZWQgYnkgdGhlIGxvdyAxMCBiaXRzXG4gICAgICAgICAgICAgICAgICAgIC8vIHRvIGdpdmUgdGhlIHNlY29uZCBieXRlXG4gICAgICAgICAgICAgICAgICAgIHZhciBzZWNvbmQgPSAoMHgzZmYgJiBjb2RlKSArIDB4REMwMDtcbiAgICAgICAgICAgICAgICAgICAgZGVjb2RlZENoYXJhY3RlciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZmlyc3QsIHNlY29uZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGRlY29kZWRDaGFyYWN0ZXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpO1xuICAgICAgICAgICAgICAgIGlmIChjaCAhPT0gJzsnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRva2VuaXplci5fcGFyc2VFcnJvcihcIm51bWVyaWMtZW50aXR5LXdpdGhvdXQtc2VtaWNvbG9uXCIpO1xuICAgICAgICAgICAgICAgICAgICBidWZmZXIudW5nZXQoY2gpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlZENoYXJhY3RlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJ1ZmZlci51bmdldChjb25zdW1lZENoYXJhY3RlcnMpO1xuICAgICAgICAgICAgdG9rZW5pemVyLl9wYXJzZUVycm9yKFwiZXhwZWN0ZWQtbnVtZXJpYy1lbnRpdHlcIik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChjaCA+PSAnYScgJiYgY2ggPD0gJ3onKSB8fCAoY2ggPj0gJ0EnICYmIGNoIDw9ICdaJykpIHtcbiAgICAgICAgICAgIHZhciBtb3N0UmVjZW50TWF0Y2ggPSAnJztcbiAgICAgICAgICAgIHdoaWxlIChuYW1lZEVudGl0eVByZWZpeGVzW2NvbnN1bWVkQ2hhcmFjdGVyc10pIHtcbiAgICAgICAgICAgICAgICBpZiAoZW50aXRpZXNbY29uc3VtZWRDaGFyYWN0ZXJzXSkge1xuICAgICAgICAgICAgICAgICAgICBtb3N0UmVjZW50TWF0Y2ggPSBjb25zdW1lZENoYXJhY3RlcnM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjaCA9PSAnOycpXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNoID0gYnVmZmVyLmNoYXIoKTtcbiAgICAgICAgICAgICAgICBpZiAoY2ggPT09IElucHV0U3RyZWFtLkVPRilcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY29uc3VtZWRDaGFyYWN0ZXJzICs9IGNoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFtb3N0UmVjZW50TWF0Y2gpIHtcbiAgICAgICAgICAgICAgICB0b2tlbml6ZXIuX3BhcnNlRXJyb3IoXCJleHBlY3RlZC1uYW1lZC1lbnRpdHlcIik7XG4gICAgICAgICAgICAgICAgYnVmZmVyLnVuZ2V0KGNvbnN1bWVkQ2hhcmFjdGVycyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVjb2RlZENoYXJhY3RlciA9IGVudGl0aWVzW21vc3RSZWNlbnRNYXRjaF07XG4gICAgICAgICAgICBpZiAoY2ggPT09ICc7JyB8fCAhYWRkaXRpb25hbEFsbG93ZWRDaGFyYWN0ZXIgfHwgIShpc0FscGhhTnVtZXJpYyhjaCkgfHwgY2ggPT09ICc9JykpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29uc3VtZWRDaGFyYWN0ZXJzLmxlbmd0aCA+IG1vc3RSZWNlbnRNYXRjaC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLnVuZ2V0KGNvbnN1bWVkQ2hhcmFjdGVycy5zdWJzdHJpbmcobW9zdFJlY2VudE1hdGNoLmxlbmd0aCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY2ggIT09ICc7Jykge1xuICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIuX3BhcnNlRXJyb3IoXCJuYW1lZC1lbnRpdHktd2l0aG91dC1zZW1pY29sb25cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBkZWNvZGVkQ2hhcmFjdGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnVmZmVyLnVuZ2V0KGNvbnN1bWVkQ2hhcmFjdGVycyk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVwbGFjZUVudGl0eU51bWJlcnMoYzogbnVtYmVyKSB7XG4gICAgICAgIHN3aXRjaCAoYykge1xuICAgICAgICAgICAgY2FzZSAweDAwOiByZXR1cm4gMHhGRkZEOyAvLyBSRVBMQUNFTUVOVCBDSEFSQUNURVJcbiAgICAgICAgICAgIGNhc2UgMHgxMzogcmV0dXJuIDB4MDAxMDsgLy8gQ2FycmlhZ2UgcmV0dXJuXG4gICAgICAgICAgICBjYXNlIDB4ODA6IHJldHVybiAweDIwQUM7IC8vIEVVUk8gU0lHTlxuICAgICAgICAgICAgY2FzZSAweDgxOiByZXR1cm4gMHgwMDgxOyAvLyA8Y29udHJvbD5cbiAgICAgICAgICAgIGNhc2UgMHg4MjogcmV0dXJuIDB4MjAxQTsgLy8gU0lOR0xFIExPVy05IFFVT1RBVElPTiBNQVJLXG4gICAgICAgICAgICBjYXNlIDB4ODM6IHJldHVybiAweDAxOTI7IC8vIExBVElOIFNNQUxMIExFVFRFUiBGIFdJVEggSE9PS1xuICAgICAgICAgICAgY2FzZSAweDg0OiByZXR1cm4gMHgyMDFFOyAvLyBET1VCTEUgTE9XLTkgUVVPVEFUSU9OIE1BUktcbiAgICAgICAgICAgIGNhc2UgMHg4NTogcmV0dXJuIDB4MjAyNjsgLy8gSE9SSVpPTlRBTCBFTExJUFNJU1xuICAgICAgICAgICAgY2FzZSAweDg2OiByZXR1cm4gMHgyMDIwOyAvLyBEQUdHRVJcbiAgICAgICAgICAgIGNhc2UgMHg4NzogcmV0dXJuIDB4MjAyMTsgLy8gRE9VQkxFIERBR0dFUlxuICAgICAgICAgICAgY2FzZSAweDg4OiByZXR1cm4gMHgwMkM2OyAvLyBNT0RJRklFUiBMRVRURVIgQ0lSQ1VNRkxFWCBBQ0NFTlRcbiAgICAgICAgICAgIGNhc2UgMHg4OTogcmV0dXJuIDB4MjAzMDsgLy8gUEVSIE1JTExFIFNJR05cbiAgICAgICAgICAgIGNhc2UgMHg4QTogcmV0dXJuIDB4MDE2MDsgLy8gTEFUSU4gQ0FQSVRBTCBMRVRURVIgUyBXSVRIIENBUk9OXG4gICAgICAgICAgICBjYXNlIDB4OEI6IHJldHVybiAweDIwMzk7IC8vIFNJTkdMRSBMRUZULVBPSU5USU5HIEFOR0xFIFFVT1RBVElPTiBNQVJLXG4gICAgICAgICAgICBjYXNlIDB4OEM6IHJldHVybiAweDAxNTI7IC8vIExBVElOIENBUElUQUwgTElHQVRVUkUgT0VcbiAgICAgICAgICAgIGNhc2UgMHg4RDogcmV0dXJuIDB4MDA4RDsgLy8gPGNvbnRyb2w+XG4gICAgICAgICAgICBjYXNlIDB4OEU6IHJldHVybiAweDAxN0Q7IC8vIExBVElOIENBUElUQUwgTEVUVEVSIFogV0lUSCBDQVJPTlxuICAgICAgICAgICAgY2FzZSAweDhGOiByZXR1cm4gMHgwMDhGOyAvLyA8Y29udHJvbD5cbiAgICAgICAgICAgIGNhc2UgMHg5MDogcmV0dXJuIDB4MDA5MDsgLy8gPGNvbnRyb2w+XG4gICAgICAgICAgICBjYXNlIDB4OTE6IHJldHVybiAweDIwMTg7IC8vIExFRlQgU0lOR0xFIFFVT1RBVElPTiBNQVJLXG4gICAgICAgICAgICBjYXNlIDB4OTI6IHJldHVybiAweDIwMTk7IC8vIFJJR0hUIFNJTkdMRSBRVU9UQVRJT04gTUFSS1xuICAgICAgICAgICAgY2FzZSAweDkzOiByZXR1cm4gMHgyMDFDOyAvLyBMRUZUIERPVUJMRSBRVU9UQVRJT04gTUFSS1xuICAgICAgICAgICAgY2FzZSAweDk0OiByZXR1cm4gMHgyMDFEOyAvLyBSSUdIVCBET1VCTEUgUVVPVEFUSU9OIE1BUktcbiAgICAgICAgICAgIGNhc2UgMHg5NTogcmV0dXJuIDB4MjAyMjsgLy8gQlVMTEVUXG4gICAgICAgICAgICBjYXNlIDB4OTY6IHJldHVybiAweDIwMTM7IC8vIEVOIERBU0hcbiAgICAgICAgICAgIGNhc2UgMHg5NzogcmV0dXJuIDB4MjAxNDsgLy8gRU0gREFTSFxuICAgICAgICAgICAgY2FzZSAweDk4OiByZXR1cm4gMHgwMkRDOyAvLyBTTUFMTCBUSUxERVxuICAgICAgICAgICAgY2FzZSAweDk5OiByZXR1cm4gMHgyMTIyOyAvLyBUUkFERSBNQVJLIFNJR05cbiAgICAgICAgICAgIGNhc2UgMHg5QTogcmV0dXJuIDB4MDE2MTsgLy8gTEFUSU4gU01BTEwgTEVUVEVSIFMgV0lUSCBDQVJPTlxuICAgICAgICAgICAgY2FzZSAweDlCOiByZXR1cm4gMHgyMDNBOyAvLyBTSU5HTEUgUklHSFQtUE9JTlRJTkcgQU5HTEUgUVVPVEFUSU9OIE1BUktcbiAgICAgICAgICAgIGNhc2UgMHg5QzogcmV0dXJuIDB4MDE1MzsgLy8gTEFUSU4gU01BTEwgTElHQVRVUkUgT0VcbiAgICAgICAgICAgIGNhc2UgMHg5RDogcmV0dXJuIDB4MDA5RDsgLy8gPGNvbnRyb2w+XG4gICAgICAgICAgICBjYXNlIDB4OUU6IHJldHVybiAweDAxN0U7IC8vIExBVElOIFNNQUxMIExFVFRFUiBaIFdJVEggQ0FST05cbiAgICAgICAgICAgIGNhc2UgMHg5RjogcmV0dXJuIDB4MDE3ODsgLy8gTEFUSU4gQ0FQSVRBTCBMRVRURVIgWSBXSVRIIERJQUVSRVNJU1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAoKGMgPj0gMHhEODAwICYmIGMgPD0gMHhERkZGKSB8fCBjID4gMHgxMEZGRkYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDB4RkZGRDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKChjID49IDB4MDAwMSAmJiBjIDw9IDB4MDAwOCkgfHwgKGMgPj0gMHgwMDBFICYmIGMgPD0gMHgwMDFGKSB8fFxuICAgICAgICAgICAgICAgICAgICAoYyA+PSAweDAwN0YgJiYgYyA8PSAweDAwOUYpIHx8IChjID49IDB4RkREMCAmJiBjIDw9IDB4RkRFRikgfHxcbiAgICAgICAgICAgICAgICAgICAgYyA9PSAweDAwMEIgfHwgYyA9PSAweEZGRkUgfHwgYyA9PSAweDFGRkZFIHx8IGMgPT0gMHgyRkZGRkUgfHxcbiAgICAgICAgICAgICAgICAgICAgYyA9PSAweDJGRkZGIHx8IGMgPT0gMHgzRkZGRSB8fCBjID09IDB4M0ZGRkYgfHwgYyA9PSAweDRGRkZFIHx8XG4gICAgICAgICAgICAgICAgICAgIGMgPT0gMHg0RkZGRiB8fCBjID09IDB4NUZGRkUgfHwgYyA9PSAweDVGRkZGIHx8IGMgPT0gMHg2RkZGRSB8fFxuICAgICAgICAgICAgICAgICAgICBjID09IDB4NkZGRkYgfHwgYyA9PSAweDdGRkZFIHx8IGMgPT0gMHg3RkZGRiB8fCBjID09IDB4OEZGRkUgfHxcbiAgICAgICAgICAgICAgICAgICAgYyA9PSAweDhGRkZGIHx8IGMgPT0gMHg5RkZGRSB8fCBjID09IDB4OUZGRkYgfHwgYyA9PSAweEFGRkZFIHx8XG4gICAgICAgICAgICAgICAgICAgIGMgPT0gMHhBRkZGRiB8fCBjID09IDB4QkZGRkUgfHwgYyA9PSAweEJGRkZGIHx8IGMgPT0gMHhDRkZGRSB8fFxuICAgICAgICAgICAgICAgICAgICBjID09IDB4Q0ZGRkYgfHwgYyA9PSAweERGRkZFIHx8IGMgPT0gMHhERkZGRiB8fCBjID09IDB4RUZGRkUgfHxcbiAgICAgICAgICAgICAgICAgICAgYyA9PSAweEVGRkZGIHx8IGMgPT0gMHhGRkZGRSB8fCBjID09IDB4RkZGRkYgfHwgYyA9PSAweDEwRkZGRSB8fFxuICAgICAgICAgICAgICAgICAgICBjID09IDB4MTBGRkZGKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHZhciBFbnRpdHlQYXJzZXIgPSBuZXcgRW50aXR5UGFyc2VyQ2xhc3MoKTtcbiJdfQ==