import entities from './entities';
import InputStream from './InputStream';
import isAlphaNumeric from './isAlphaNumeric';
import isDecimalDigit from './isDecimalDigit';
import isHexDigit from './isHexDigit';
var namedEntityPrefixes = {};
Object.keys(entities).forEach(function (entityKey) {
    for (var i = 0; i < entityKey.length; i++) {
        namedEntityPrefixes[entityKey.substring(0, i + 1)] = true;
    }
});
export class EntityParserClass {
    constructor() {
    }
    consumeEntity(buffer, tokenizer, additionalAllowedCharacter) {
        var decodedCharacter = '';
        var consumedCharacters = '';
        var ch = buffer.char();
        if (ch === InputStream.EOF)
            return false;
        consumedCharacters += ch;
        if (ch == '\t' || ch == '\n' || ch == '\v' || ch == ' ' || ch == '<' || ch == '&') {
            buffer.unget(consumedCharacters);
            return false;
        }
        if (additionalAllowedCharacter === ch) {
            buffer.unget(consumedCharacters);
            return false;
        }
        if (ch == '#') {
            ch = buffer.shift(1);
            if (ch === InputStream.EOF) {
                tokenizer._parseError("expected-numeric-entity-but-got-eof");
                buffer.unget(consumedCharacters);
                return false;
            }
            consumedCharacters += ch;
            var radix = 10;
            var isDigit = isDecimalDigit;
            if (ch == 'x' || ch == 'X') {
                radix = 16;
                isDigit = isHexDigit;
                ch = buffer.shift(1);
                if (ch === InputStream.EOF) {
                    tokenizer._parseError("expected-numeric-entity-but-got-eof");
                    buffer.unget(consumedCharacters);
                    return false;
                }
                consumedCharacters += ch;
            }
            if (isDigit(ch)) {
                var code = '';
                while (ch !== InputStream.EOF && isDigit(ch)) {
                    code += ch;
                    ch = buffer.char();
                }
                code = parseInt(code, radix);
                var replacement = this.replaceEntityNumbers(code);
                if (replacement) {
                    tokenizer._parseError("invalid-numeric-entity-replaced");
                    code = replacement;
                }
                if (code > 0xFFFF && code <= 0x10FFFF) {
                    code -= 0x10000;
                    var first = ((0xffc00 & code) >> 10) + 0xD800;
                    var second = (0x3ff & code) + 0xDC00;
                    decodedCharacter = String.fromCharCode(first, second);
                }
                else
                    decodedCharacter = String.fromCharCode(code);
                if (ch !== ';') {
                    tokenizer._parseError("numeric-entity-without-semicolon");
                    buffer.unget(ch);
                }
                return decodedCharacter;
            }
            buffer.unget(consumedCharacters);
            tokenizer._parseError("expected-numeric-entity");
            return false;
        }
        if ((ch >= 'a' && ch <= 'z') || (ch >= 'A' && ch <= 'Z')) {
            var mostRecentMatch = '';
            while (namedEntityPrefixes[consumedCharacters]) {
                if (entities[consumedCharacters]) {
                    mostRecentMatch = consumedCharacters;
                }
                if (ch == ';')
                    break;
                ch = buffer.char();
                if (ch === InputStream.EOF)
                    break;
                consumedCharacters += ch;
            }
            if (!mostRecentMatch) {
                tokenizer._parseError("expected-named-entity");
                buffer.unget(consumedCharacters);
                return false;
            }
            decodedCharacter = entities[mostRecentMatch];
            if (ch === ';' || !additionalAllowedCharacter || !(isAlphaNumeric(ch) || ch === '=')) {
                if (consumedCharacters.length > mostRecentMatch.length) {
                    buffer.unget(consumedCharacters.substring(mostRecentMatch.length));
                }
                if (ch !== ';') {
                    tokenizer._parseError("named-entity-without-semicolon");
                }
                return decodedCharacter;
            }
            buffer.unget(consumedCharacters);
            return false;
        }
    }
    replaceEntityNumbers(c) {
        switch (c) {
            case 0x00: return 0xFFFD;
            case 0x13: return 0x0010;
            case 0x80: return 0x20AC;
            case 0x81: return 0x0081;
            case 0x82: return 0x201A;
            case 0x83: return 0x0192;
            case 0x84: return 0x201E;
            case 0x85: return 0x2026;
            case 0x86: return 0x2020;
            case 0x87: return 0x2021;
            case 0x88: return 0x02C6;
            case 0x89: return 0x2030;
            case 0x8A: return 0x0160;
            case 0x8B: return 0x2039;
            case 0x8C: return 0x0152;
            case 0x8D: return 0x008D;
            case 0x8E: return 0x017D;
            case 0x8F: return 0x008F;
            case 0x90: return 0x0090;
            case 0x91: return 0x2018;
            case 0x92: return 0x2019;
            case 0x93: return 0x201C;
            case 0x94: return 0x201D;
            case 0x95: return 0x2022;
            case 0x96: return 0x2013;
            case 0x97: return 0x2014;
            case 0x98: return 0x02DC;
            case 0x99: return 0x2122;
            case 0x9A: return 0x0161;
            case 0x9B: return 0x203A;
            case 0x9C: return 0x0153;
            case 0x9D: return 0x009D;
            case 0x9E: return 0x017E;
            case 0x9F: return 0x0178;
            default:
                if ((c >= 0xD800 && c <= 0xDFFF) || c > 0x10FFFF) {
                    return 0xFFFD;
                }
                else if ((c >= 0x0001 && c <= 0x0008) || (c >= 0x000E && c <= 0x001F) ||
                    (c >= 0x007F && c <= 0x009F) || (c >= 0xFDD0 && c <= 0xFDEF) ||
                    c == 0x000B || c == 0xFFFE || c == 0x1FFFE || c == 0x2FFFFE ||
                    c == 0x2FFFF || c == 0x3FFFE || c == 0x3FFFF || c == 0x4FFFE ||
                    c == 0x4FFFF || c == 0x5FFFE || c == 0x5FFFF || c == 0x6FFFE ||
                    c == 0x6FFFF || c == 0x7FFFE || c == 0x7FFFF || c == 0x8FFFE ||
                    c == 0x8FFFF || c == 0x9FFFE || c == 0x9FFFF || c == 0xAFFFE ||
                    c == 0xAFFFF || c == 0xBFFFE || c == 0xBFFFF || c == 0xCFFFE ||
                    c == 0xCFFFF || c == 0xDFFFE || c == 0xDFFFF || c == 0xEFFFE ||
                    c == 0xEFFFF || c == 0xFFFFE || c == 0xFFFFF || c == 0x10FFFE ||
                    c == 0x10FFFF) {
                    return c;
                }
        }
    }
}
export var EntityParser = new EntityParserClass();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW50aXR5UGFyc2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL21vZGUvaHRtbC9FbnRpdHlQYXJzZXIudHMiXSwibmFtZXMiOlsiRW50aXR5UGFyc2VyQ2xhc3MiLCJFbnRpdHlQYXJzZXJDbGFzcy5jb25zdHJ1Y3RvciIsIkVudGl0eVBhcnNlckNsYXNzLmNvbnN1bWVFbnRpdHkiLCJFbnRpdHlQYXJzZXJDbGFzcy5yZXBsYWNlRW50aXR5TnVtYmVycyJdLCJtYXBwaW5ncyI6Ik9BQU8sUUFBUSxNQUFNLFlBQVk7T0FDMUIsV0FBVyxNQUFNLGVBQWU7T0FDaEMsY0FBYyxNQUFNLGtCQUFrQjtPQUN0QyxjQUFjLE1BQU0sa0JBQWtCO09BQ3RDLFVBQVUsTUFBTSxjQUFjO0FBR3JDLElBQUksbUJBQW1CLEdBQUcsRUFBRSxDQUFDO0FBQzdCLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVMsU0FBUztJQUM1QyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQ3hDLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQztJQUM5RCxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSDtJQUNJQTtJQUNBQyxDQUFDQTtJQUNERCxhQUFhQSxDQUFDQSxNQUFtQkEsRUFBRUEsU0FBb0JBLEVBQUVBLDBCQUFtQ0E7UUFDeEZFLElBQUlBLGdCQUFnQkEsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDMUJBLElBQUlBLGtCQUFrQkEsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDNUJBLElBQUlBLEVBQUVBLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLEVBQUVBLENBQUNBO1FBQ3ZCQSxFQUFFQSxD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QUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQSxLQUFLQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN6QkEsS0FBS0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDekJBLEtBQUtBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ3pCQTtnQkFDSUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsTUFBTUEsSUFBSUEsQ0FBQ0EsSUFBSUEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQy9DQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtnQkFDbEJBLENBQUNBO2dCQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxNQUFNQSxJQUFJQSxDQUFDQSxJQUFJQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxJQUFJQSxNQUFNQSxJQUFJQSxDQUFDQSxJQUFJQSxNQUFNQSxDQUFDQTtvQkFDbkVBLENBQUNBLENBQUNBLElBQUlBLE1BQU1BLElBQUlBLENBQUNBLElBQUlBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLENBQUNBLElBQUlBLE1BQU1BLElBQUlBLENBQUNBLElBQUlBLE1BQU1BLENBQUNBO29CQUM1REEsQ0FBQ0EsSUFBSUEsTUFBTUEsSUFBSUEsQ0FBQ0EsSUFBSUEsTUFBTUEsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsUUFBUUE7b0JBQzNEQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQTtvQkFDNURBLENBQUNBLElBQUlBLE9BQU9BLElBQUlBLENBQUNBLElBQUlBLE9BQU9BLElBQUlBLENBQUNBLElBQUlBLE9BQU9BLElBQUlBLENBQUNBLElBQUlBLE9BQU9BO29CQUM1REEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0E7b0JBQzVEQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQTtvQkFDNURBLENBQUNBLElBQUlBLE9BQU9BLElBQUlBLENBQUNBLElBQUlBLE9BQU9BLElBQUlBLENBQUNBLElBQUlBLE9BQU9BLElBQUlBLENBQUNBLElBQUlBLE9BQU9BO29CQUM1REEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsQ0FBQ0EsSUFBSUEsT0FBT0E7b0JBQzVEQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxPQUFPQSxJQUFJQSxDQUFDQSxJQUFJQSxRQUFRQTtvQkFDN0RBLENBQUNBLElBQUlBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO29CQUNoQkEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2JBLENBQUNBO1FBQ1RBLENBQUNBO0lBQ0xBLENBQUNBO0FBQ0xILENBQUNBO0FBRUQsV0FBVyxZQUFZLEdBQUcsSUFBSSxpQkFBaUIsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGVudGl0aWVzIGZyb20gJy4vZW50aXRpZXMnO1xuaW1wb3J0IElucHV0U3RyZWFtIGZyb20gJy4vSW5wdXRTdHJlYW0nO1xuaW1wb3J0IGlzQWxwaGFOdW1lcmljIGZyb20gJy4vaXNBbHBoYU51bWVyaWMnO1xuaW1wb3J0IGlzRGVjaW1hbERpZ2l0IGZyb20gJy4vaXNEZWNpbWFsRGlnaXQnO1xuaW1wb3J0IGlzSGV4RGlnaXQgZnJvbSAnLi9pc0hleERpZ2l0JztcbmltcG9ydCBUb2tlbml6ZXIgZnJvbSAnLi9Ub2tlbml6ZXInO1xuXG52YXIgbmFtZWRFbnRpdHlQcmVmaXhlcyA9IHt9O1xuT2JqZWN0LmtleXMoZW50aXRpZXMpLmZvckVhY2goZnVuY3Rpb24oZW50aXR5S2V5KSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbnRpdHlLZXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbmFtZWRFbnRpdHlQcmVmaXhlc1tlbnRpdHlLZXkuc3Vic3RyaW5nKDAsIGkgKyAxKV0gPSB0cnVlO1xuICAgIH1cbn0pO1xuXG5leHBvcnQgY2xhc3MgRW50aXR5UGFyc2VyQ2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgIH1cbiAgICBjb25zdW1lRW50aXR5KGJ1ZmZlcjogSW5wdXRTdHJlYW0sIHRva2VuaXplcjogVG9rZW5pemVyLCBhZGRpdGlvbmFsQWxsb3dlZENoYXJhY3Rlcj86IHN0cmluZyk6IGFueSB7XG4gICAgICAgIHZhciBkZWNvZGVkQ2hhcmFjdGVyID0gJyc7XG4gICAgICAgIHZhciBjb25zdW1lZENoYXJhY3RlcnMgPSAnJztcbiAgICAgICAgdmFyIGNoID0gYnVmZmVyLmNoYXIoKTtcbiAgICAgICAgaWYgKGNoID09PSBJbnB1dFN0cmVhbS5FT0YpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGNvbnN1bWVkQ2hhcmFjdGVycyArPSBjaDtcbiAgICAgICAgaWYgKGNoID09ICdcXHQnIHx8IGNoID09ICdcXG4nIHx8IGNoID09ICdcXHYnIHx8IGNoID09ICcgJyB8fCBjaCA9PSAnPCcgfHwgY2ggPT0gJyYnKSB7XG4gICAgICAgICAgICBidWZmZXIudW5nZXQoY29uc3VtZWRDaGFyYWN0ZXJzKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWRkaXRpb25hbEFsbG93ZWRDaGFyYWN0ZXIgPT09IGNoKSB7XG4gICAgICAgICAgICBidWZmZXIudW5nZXQoY29uc3VtZWRDaGFyYWN0ZXJzKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2ggPT0gJyMnKSB7XG4gICAgICAgICAgICBjaCA9IGJ1ZmZlci5zaGlmdCgxKTtcbiAgICAgICAgICAgIGlmIChjaCA9PT0gSW5wdXRTdHJlYW0uRU9GKSB7XG4gICAgICAgICAgICAgICAgdG9rZW5pemVyLl9wYXJzZUVycm9yKFwiZXhwZWN0ZWQtbnVtZXJpYy1lbnRpdHktYnV0LWdvdC1lb2ZcIik7XG4gICAgICAgICAgICAgICAgYnVmZmVyLnVuZ2V0KGNvbnN1bWVkQ2hhcmFjdGVycyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3VtZWRDaGFyYWN0ZXJzICs9IGNoO1xuICAgICAgICAgICAgdmFyIHJhZGl4ID0gMTA7XG4gICAgICAgICAgICB2YXIgaXNEaWdpdCA9IGlzRGVjaW1hbERpZ2l0O1xuICAgICAgICAgICAgaWYgKGNoID09ICd4JyB8fCBjaCA9PSAnWCcpIHtcbiAgICAgICAgICAgICAgICByYWRpeCA9IDE2O1xuICAgICAgICAgICAgICAgIGlzRGlnaXQgPSBpc0hleERpZ2l0O1xuICAgICAgICAgICAgICAgIGNoID0gYnVmZmVyLnNoaWZ0KDEpO1xuICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gSW5wdXRTdHJlYW0uRU9GKSB7XG4gICAgICAgICAgICAgICAgICAgIHRva2VuaXplci5fcGFyc2VFcnJvcihcImV4cGVjdGVkLW51bWVyaWMtZW50aXR5LWJ1dC1nb3QtZW9mXCIpO1xuICAgICAgICAgICAgICAgICAgICBidWZmZXIudW5nZXQoY29uc3VtZWRDaGFyYWN0ZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdW1lZENoYXJhY3RlcnMgKz0gY2g7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNEaWdpdChjaCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29kZTogYW55ID0gJyc7XG4gICAgICAgICAgICAgICAgd2hpbGUgKGNoICE9PSBJbnB1dFN0cmVhbS5FT0YgJiYgaXNEaWdpdChjaCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29kZSArPSBjaDtcbiAgICAgICAgICAgICAgICAgICAgY2ggPSBidWZmZXIuY2hhcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb2RlID0gcGFyc2VJbnQoY29kZSwgcmFkaXgpO1xuICAgICAgICAgICAgICAgIHZhciByZXBsYWNlbWVudCA9IHRoaXMucmVwbGFjZUVudGl0eU51bWJlcnMoY29kZSk7XG4gICAgICAgICAgICAgICAgaWYgKHJlcGxhY2VtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHRva2VuaXplci5fcGFyc2VFcnJvcihcImludmFsaWQtbnVtZXJpYy1lbnRpdHktcmVwbGFjZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIGNvZGUgPSByZXBsYWNlbWVudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNvZGUgPiAweEZGRkYgJiYgY29kZSA8PSAweDEwRkZGRikge1xuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBzdWJzdHJhY3QgMHgxMDAwMCBmcm9tIGNwIHRvIGdldCBhIDIwLWJpdHMgbnVtYmVyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluIHRoZSByYW5nZSAwLi4weEZGRkZcbiAgICAgICAgICAgICAgICAgICAgY29kZSAtPSAweDEwMDAwO1xuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBhZGQgMHhEODAwIHRvIHRoZSBudW1iZXIgZm9ybWVkIGJ5IHRoZSBmaXJzdCAxMCBiaXRzXG4gICAgICAgICAgICAgICAgICAgIC8vIHRvIGdpdmUgdGhlIGZpcnN0IGJ5dGVcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpcnN0ID0gKCgweGZmYzAwICYgY29kZSkgPj4gMTApICsgMHhEODAwO1xuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBhZGQgMHhEQzAwIHRvIHRoZSBudW1iZXIgZm9ybWVkIGJ5IHRoZSBsb3cgMTAgYml0c1xuICAgICAgICAgICAgICAgICAgICAvLyB0byBnaXZlIHRoZSBzZWNvbmQgYnl0ZVxuICAgICAgICAgICAgICAgICAgICB2YXIgc2Vjb25kID0gKDB4M2ZmICYgY29kZSkgKyAweERDMDA7XG4gICAgICAgICAgICAgICAgICAgIGRlY29kZWRDaGFyYWN0ZXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGZpcnN0LCBzZWNvbmQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICAgICAgICBkZWNvZGVkQ2hhcmFjdGVyID0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKTtcbiAgICAgICAgICAgICAgICBpZiAoY2ggIT09ICc7Jykge1xuICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIuX3BhcnNlRXJyb3IoXCJudW1lcmljLWVudGl0eS13aXRob3V0LXNlbWljb2xvblwiKTtcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLnVuZ2V0KGNoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlY29kZWRDaGFyYWN0ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBidWZmZXIudW5nZXQoY29uc3VtZWRDaGFyYWN0ZXJzKTtcbiAgICAgICAgICAgIHRva2VuaXplci5fcGFyc2VFcnJvcihcImV4cGVjdGVkLW51bWVyaWMtZW50aXR5XCIpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoY2ggPj0gJ2EnICYmIGNoIDw9ICd6JykgfHwgKGNoID49ICdBJyAmJiBjaCA8PSAnWicpKSB7XG4gICAgICAgICAgICB2YXIgbW9zdFJlY2VudE1hdGNoID0gJyc7XG4gICAgICAgICAgICB3aGlsZSAobmFtZWRFbnRpdHlQcmVmaXhlc1tjb25zdW1lZENoYXJhY3RlcnNdKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVudGl0aWVzW2NvbnN1bWVkQ2hhcmFjdGVyc10pIHtcbiAgICAgICAgICAgICAgICAgICAgbW9zdFJlY2VudE1hdGNoID0gY29uc3VtZWRDaGFyYWN0ZXJzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY2ggPT0gJzsnKVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjaCA9IGJ1ZmZlci5jaGFyKCk7XG4gICAgICAgICAgICAgICAgaWYgKGNoID09PSBJbnB1dFN0cmVhbS5FT0YpXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNvbnN1bWVkQ2hhcmFjdGVycyArPSBjaDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghbW9zdFJlY2VudE1hdGNoKSB7XG4gICAgICAgICAgICAgICAgdG9rZW5pemVyLl9wYXJzZUVycm9yKFwiZXhwZWN0ZWQtbmFtZWQtZW50aXR5XCIpO1xuICAgICAgICAgICAgICAgIGJ1ZmZlci51bmdldChjb25zdW1lZENoYXJhY3RlcnMpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlY29kZWRDaGFyYWN0ZXIgPSBlbnRpdGllc1ttb3N0UmVjZW50TWF0Y2hdO1xuICAgICAgICAgICAgaWYgKGNoID09PSAnOycgfHwgIWFkZGl0aW9uYWxBbGxvd2VkQ2hhcmFjdGVyIHx8ICEoaXNBbHBoYU51bWVyaWMoY2gpIHx8IGNoID09PSAnPScpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbnN1bWVkQ2hhcmFjdGVycy5sZW5ndGggPiBtb3N0UmVjZW50TWF0Y2gubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1ZmZlci51bmdldChjb25zdW1lZENoYXJhY3RlcnMuc3Vic3RyaW5nKG1vc3RSZWNlbnRNYXRjaC5sZW5ndGgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNoICE9PSAnOycpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyLl9wYXJzZUVycm9yKFwibmFtZWQtZW50aXR5LXdpdGhvdXQtc2VtaWNvbG9uXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlZENoYXJhY3RlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJ1ZmZlci51bmdldChjb25zdW1lZENoYXJhY3RlcnMpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlcGxhY2VFbnRpdHlOdW1iZXJzKGM6IG51bWJlcikge1xuICAgICAgICBzd2l0Y2ggKGMpIHtcbiAgICAgICAgICAgIGNhc2UgMHgwMDogcmV0dXJuIDB4RkZGRDsgLy8gUkVQTEFDRU1FTlQgQ0hBUkFDVEVSXG4gICAgICAgICAgICBjYXNlIDB4MTM6IHJldHVybiAweDAwMTA7IC8vIENhcnJpYWdlIHJldHVyblxuICAgICAgICAgICAgY2FzZSAweDgwOiByZXR1cm4gMHgyMEFDOyAvLyBFVVJPIFNJR05cbiAgICAgICAgICAgIGNhc2UgMHg4MTogcmV0dXJuIDB4MDA4MTsgLy8gPGNvbnRyb2w+XG4gICAgICAgICAgICBjYXNlIDB4ODI6IHJldHVybiAweDIwMUE7IC8vIFNJTkdMRSBMT1ctOSBRVU9UQVRJT04gTUFSS1xuICAgICAgICAgICAgY2FzZSAweDgzOiByZXR1cm4gMHgwMTkyOyAvLyBMQVRJTiBTTUFMTCBMRVRURVIgRiBXSVRIIEhPT0tcbiAgICAgICAgICAgIGNhc2UgMHg4NDogcmV0dXJuIDB4MjAxRTsgLy8gRE9VQkxFIExPVy05IFFVT1RBVElPTiBNQVJLXG4gICAgICAgICAgICBjYXNlIDB4ODU6IHJldHVybiAweDIwMjY7IC8vIEhPUklaT05UQUwgRUxMSVBTSVNcbiAgICAgICAgICAgIGNhc2UgMHg4NjogcmV0dXJuIDB4MjAyMDsgLy8gREFHR0VSXG4gICAgICAgICAgICBjYXNlIDB4ODc6IHJldHVybiAweDIwMjE7IC8vIERPVUJMRSBEQUdHRVJcbiAgICAgICAgICAgIGNhc2UgMHg4ODogcmV0dXJuIDB4MDJDNjsgLy8gTU9ESUZJRVIgTEVUVEVSIENJUkNVTUZMRVggQUNDRU5UXG4gICAgICAgICAgICBjYXNlIDB4ODk6IHJldHVybiAweDIwMzA7IC8vIFBFUiBNSUxMRSBTSUdOXG4gICAgICAgICAgICBjYXNlIDB4OEE6IHJldHVybiAweDAxNjA7IC8vIExBVElOIENBUElUQUwgTEVUVEVSIFMgV0lUSCBDQVJPTlxuICAgICAgICAgICAgY2FzZSAweDhCOiByZXR1cm4gMHgyMDM5OyAvLyBTSU5HTEUgTEVGVC1QT0lOVElORyBBTkdMRSBRVU9UQVRJT04gTUFSS1xuICAgICAgICAgICAgY2FzZSAweDhDOiByZXR1cm4gMHgwMTUyOyAvLyBMQVRJTiBDQVBJVEFMIExJR0FUVVJFIE9FXG4gICAgICAgICAgICBjYXNlIDB4OEQ6IHJldHVybiAweDAwOEQ7IC8vIDxjb250cm9sPlxuICAgICAgICAgICAgY2FzZSAweDhFOiByZXR1cm4gMHgwMTdEOyAvLyBMQVRJTiBDQVBJVEFMIExFVFRFUiBaIFdJVEggQ0FST05cbiAgICAgICAgICAgIGNhc2UgMHg4RjogcmV0dXJuIDB4MDA4RjsgLy8gPGNvbnRyb2w+XG4gICAgICAgICAgICBjYXNlIDB4OTA6IHJldHVybiAweDAwOTA7IC8vIDxjb250cm9sPlxuICAgICAgICAgICAgY2FzZSAweDkxOiByZXR1cm4gMHgyMDE4OyAvLyBMRUZUIFNJTkdMRSBRVU9UQVRJT04gTUFSS1xuICAgICAgICAgICAgY2FzZSAweDkyOiByZXR1cm4gMHgyMDE5OyAvLyBSSUdIVCBTSU5HTEUgUVVPVEFUSU9OIE1BUktcbiAgICAgICAgICAgIGNhc2UgMHg5MzogcmV0dXJuIDB4MjAxQzsgLy8gTEVGVCBET1VCTEUgUVVPVEFUSU9OIE1BUktcbiAgICAgICAgICAgIGNhc2UgMHg5NDogcmV0dXJuIDB4MjAxRDsgLy8gUklHSFQgRE9VQkxFIFFVT1RBVElPTiBNQVJLXG4gICAgICAgICAgICBjYXNlIDB4OTU6IHJldHVybiAweDIwMjI7IC8vIEJVTExFVFxuICAgICAgICAgICAgY2FzZSAweDk2OiByZXR1cm4gMHgyMDEzOyAvLyBFTiBEQVNIXG4gICAgICAgICAgICBjYXNlIDB4OTc6IHJldHVybiAweDIwMTQ7IC8vIEVNIERBU0hcbiAgICAgICAgICAgIGNhc2UgMHg5ODogcmV0dXJuIDB4MDJEQzsgLy8gU01BTEwgVElMREVcbiAgICAgICAgICAgIGNhc2UgMHg5OTogcmV0dXJuIDB4MjEyMjsgLy8gVFJBREUgTUFSSyBTSUdOXG4gICAgICAgICAgICBjYXNlIDB4OUE6IHJldHVybiAweDAxNjE7IC8vIExBVElOIFNNQUxMIExFVFRFUiBTIFdJVEggQ0FST05cbiAgICAgICAgICAgIGNhc2UgMHg5QjogcmV0dXJuIDB4MjAzQTsgLy8gU0lOR0xFIFJJR0hULVBPSU5USU5HIEFOR0xFIFFVT1RBVElPTiBNQVJLXG4gICAgICAgICAgICBjYXNlIDB4OUM6IHJldHVybiAweDAxNTM7IC8vIExBVElOIFNNQUxMIExJR0FUVVJFIE9FXG4gICAgICAgICAgICBjYXNlIDB4OUQ6IHJldHVybiAweDAwOUQ7IC8vIDxjb250cm9sPlxuICAgICAgICAgICAgY2FzZSAweDlFOiByZXR1cm4gMHgwMTdFOyAvLyBMQVRJTiBTTUFMTCBMRVRURVIgWiBXSVRIIENBUk9OXG4gICAgICAgICAgICBjYXNlIDB4OUY6IHJldHVybiAweDAxNzg7IC8vIExBVElOIENBUElUQUwgTEVUVEVSIFkgV0lUSCBESUFFUkVTSVNcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgaWYgKChjID49IDB4RDgwMCAmJiBjIDw9IDB4REZGRikgfHwgYyA+IDB4MTBGRkZGKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAweEZGRkQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICgoYyA+PSAweDAwMDEgJiYgYyA8PSAweDAwMDgpIHx8IChjID49IDB4MDAwRSAmJiBjIDw9IDB4MDAxRikgfHxcbiAgICAgICAgICAgICAgICAgICAgKGMgPj0gMHgwMDdGICYmIGMgPD0gMHgwMDlGKSB8fCAoYyA+PSAweEZERDAgJiYgYyA8PSAweEZERUYpIHx8XG4gICAgICAgICAgICAgICAgICAgIGMgPT0gMHgwMDBCIHx8IGMgPT0gMHhGRkZFIHx8IGMgPT0gMHgxRkZGRSB8fCBjID09IDB4MkZGRkZFIHx8XG4gICAgICAgICAgICAgICAgICAgIGMgPT0gMHgyRkZGRiB8fCBjID09IDB4M0ZGRkUgfHwgYyA9PSAweDNGRkZGIHx8IGMgPT0gMHg0RkZGRSB8fFxuICAgICAgICAgICAgICAgICAgICBjID09IDB4NEZGRkYgfHwgYyA9PSAweDVGRkZFIHx8IGMgPT0gMHg1RkZGRiB8fCBjID09IDB4NkZGRkUgfHxcbiAgICAgICAgICAgICAgICAgICAgYyA9PSAweDZGRkZGIHx8IGMgPT0gMHg3RkZGRSB8fCBjID09IDB4N0ZGRkYgfHwgYyA9PSAweDhGRkZFIHx8XG4gICAgICAgICAgICAgICAgICAgIGMgPT0gMHg4RkZGRiB8fCBjID09IDB4OUZGRkUgfHwgYyA9PSAweDlGRkZGIHx8IGMgPT0gMHhBRkZGRSB8fFxuICAgICAgICAgICAgICAgICAgICBjID09IDB4QUZGRkYgfHwgYyA9PSAweEJGRkZFIHx8IGMgPT0gMHhCRkZGRiB8fCBjID09IDB4Q0ZGRkUgfHxcbiAgICAgICAgICAgICAgICAgICAgYyA9PSAweENGRkZGIHx8IGMgPT0gMHhERkZGRSB8fCBjID09IDB4REZGRkYgfHwgYyA9PSAweEVGRkZFIHx8XG4gICAgICAgICAgICAgICAgICAgIGMgPT0gMHhFRkZGRiB8fCBjID09IDB4RkZGRkUgfHwgYyA9PSAweEZGRkZGIHx8IGMgPT0gMHgxMEZGRkUgfHxcbiAgICAgICAgICAgICAgICAgICAgYyA9PSAweDEwRkZGRikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCB2YXIgRW50aXR5UGFyc2VyID0gbmV3IEVudGl0eVBhcnNlckNsYXNzKCk7XG4iXX0=