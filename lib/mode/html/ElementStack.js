function isScopeMarker(node) {
    if (node.namespaceURI === "http://www.w3.org/1999/xhtml") {
        return node.localName === "applet"
            || node.localName === "caption"
            || node.localName === "marquee"
            || node.localName === "object"
            || node.localName === "table"
            || node.localName === "td"
            || node.localName === "th";
    }
    if (node.namespaceURI === "http://www.w3.org/1998/Math/MathML") {
        return node.localName === "mi"
            || node.localName === "mo"
            || node.localName === "mn"
            || node.localName === "ms"
            || node.localName === "mtext"
            || node.localName === "annotation-xml";
    }
    if (node.namespaceURI === "http://www.w3.org/2000/svg") {
        return node.localName === "foreignObject"
            || node.localName === "desc"
            || node.localName === "title";
    }
}
function isListItemScopeMarker(node) {
    return isScopeMarker(node)
        || (node.namespaceURI === "http://www.w3.org/1999/xhtml" && node.localName === 'ol')
        || (node.namespaceURI === "http://www.w3.org/1999/xhtml" && node.localName === 'ul');
}
function isTableScopeMarker(node) {
    return (node.namespaceURI === "http://www.w3.org/1999/xhtml" && node.localName === 'table')
        || (node.namespaceURI === "http://www.w3.org/1999/xhtml" && node.localName === 'html');
}
function isTableBodyScopeMarker(node) {
    return (node.namespaceURI === "http://www.w3.org/1999/xhtml" && node.localName === 'tbody')
        || (node.namespaceURI === "http://www.w3.org/1999/xhtml" && node.localName === 'tfoot')
        || (node.namespaceURI === "http://www.w3.org/1999/xhtml" && node.localName === 'thead')
        || (node.namespaceURI === "http://www.w3.org/1999/xhtml" && node.localName === 'html');
}
function isTableRowScopeMarker(node) {
    return (node.namespaceURI === "http://www.w3.org/1999/xhtml" && node.localName === 'tr')
        || (node.namespaceURI === "http://www.w3.org/1999/xhtml" && node.localName === 'html');
}
function isButtonScopeMarker(node) {
    return isScopeMarker(node)
        || (node.namespaceURI === "http://www.w3.org/1999/xhtml" && node.localName === 'button');
}
function isSelectScopeMarker(node) {
    return !(node.namespaceURI === "http://www.w3.org/1999/xhtml" && node.localName === 'optgroup')
        && !(node.namespaceURI === "http://www.w3.org/1999/xhtml" && node.localName === 'option');
}
export default function ElementStack() {
    this.elements = [];
    this.rootNode = null;
    this.headElement = null;
    this.bodyElement = null;
}
ElementStack.prototype._inScope = function (localName, isMarker) {
    for (var i = this.elements.length - 1; i >= 0; i--) {
        var node = this.elements[i];
        if (node.localName === localName)
            return true;
        if (isMarker(node))
            return false;
    }
};
ElementStack.prototype.push = function (item) {
    this.elements.push(item);
};
ElementStack.prototype.pushHtmlElement = function (item) {
    this.rootNode = item.node;
    this.push(item);
};
ElementStack.prototype.pushHeadElement = function (item) {
    this.headElement = item.node;
    this.push(item);
};
ElementStack.prototype.pushBodyElement = function (item) {
    this.bodyElement = item.node;
    this.push(item);
};
ElementStack.prototype.pop = function () {
    return this.elements.pop();
};
ElementStack.prototype.remove = function (item) {
    this.elements.splice(this.elements.indexOf(item), 1);
};
ElementStack.prototype.popUntilPopped = function (localName) {
    var element;
    do {
        element = this.pop();
    } while (element.localName != localName);
};
ElementStack.prototype.popUntilTableScopeMarker = function () {
    while (!isTableScopeMarker(this.top))
        this.pop();
};
ElementStack.prototype.popUntilTableBodyScopeMarker = function () {
    while (!isTableBodyScopeMarker(this.top))
        this.pop();
};
ElementStack.prototype.popUntilTableRowScopeMarker = function () {
    while (!isTableRowScopeMarker(this.top))
        this.pop();
};
ElementStack.prototype.item = function (index) {
    return this.elements[index];
};
ElementStack.prototype.contains = function (element) {
    return this.elements.indexOf(element) !== -1;
};
ElementStack.prototype.inScope = function (localName) {
    return this._inScope(localName, isScopeMarker);
};
ElementStack.prototype.inListItemScope = function (localName) {
    return this._inScope(localName, isListItemScopeMarker);
};
ElementStack.prototype.inTableScope = function (localName) {
    return this._inScope(localName, isTableScopeMarker);
};
ElementStack.prototype.inButtonScope = function (localName) {
    return this._inScope(localName, isButtonScopeMarker);
};
ElementStack.prototype.inSelectScope = function (localName) {
    return this._inScope(localName, isSelectScopeMarker);
};
ElementStack.prototype.hasNumberedHeaderElementInScope = function () {
    for (var i = this.elements.length - 1; i >= 0; i--) {
        var node = this.elements[i];
        if (node.isNumberedHeader())
            return true;
        if (isScopeMarker(node))
            return false;
    }
};
ElementStack.prototype.furthestBlockForFormattingElement = function (element) {
    var furthestBlock = null;
    for (var i = this.elements.length - 1; i >= 0; i--) {
        var node = this.elements[i];
        if (node.node === element)
            break;
        if (node.isSpecial())
            furthestBlock = node;
    }
    return furthestBlock;
};
ElementStack.prototype.findIndex = function (localName) {
    for (var i = this.elements.length - 1; i >= 0; i--) {
        if (this.elements[i].localName == localName)
            return i;
    }
    return -1;
};
ElementStack.prototype.remove_openElements_until = function (callback) {
    var finished = false;
    var element;
    while (!finished) {
        element = this.elements.pop();
        finished = callback(element);
    }
    return element;
};
Object.defineProperty(ElementStack.prototype, 'top', {
    get: function () {
        return this.elements[this.elements.length - 1];
    }
});
Object.defineProperty(ElementStack.prototype, 'length', {
    get: function () {
        return this.elements.length;
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWxlbWVudFN0YWNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL21vZGUvaHRtbC9FbGVtZW50U3RhY2sudHMiXSwibmFtZXMiOlsiaXNTY29wZU1hcmtlciIsImlzTGlzdEl0ZW1TY29wZU1hcmtlciIsImlzVGFibGVTY29wZU1hcmtlciIsImlzVGFibGVCb2R5U2NvcGVNYXJrZXIiLCJpc1RhYmxlUm93U2NvcGVNYXJrZXIiLCJpc0J1dHRvblNjb3BlTWFya2VyIiwiaXNTZWxlY3RTY29wZU1hcmtlciIsIkVsZW1lbnRTdGFjayJdLCJtYXBwaW5ncyI6IkFBQUEsdUJBQXVCLElBQUk7SUFDekJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLEtBQUtBLDhCQUE4QkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDekRBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLEtBQUtBLFFBQVFBO2VBQzdCQSxJQUFJQSxDQUFDQSxTQUFTQSxLQUFLQSxTQUFTQTtlQUM1QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsS0FBS0EsU0FBU0E7ZUFDNUJBLElBQUlBLENBQUNBLFNBQVNBLEtBQUtBLFFBQVFBO2VBQzNCQSxJQUFJQSxDQUFDQSxTQUFTQSxLQUFLQSxPQUFPQTtlQUMxQkEsSUFBSUEsQ0FBQ0EsU0FBU0EsS0FBS0EsSUFBSUE7ZUFDdkJBLElBQUlBLENBQUNBLFNBQVNBLEtBQUtBLElBQUlBLENBQUNBO0lBQy9CQSxDQUFDQTtJQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxLQUFLQSxvQ0FBb0NBLENBQUNBLENBQUNBLENBQUNBO1FBQy9EQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxLQUFLQSxJQUFJQTtlQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsS0FBS0EsSUFBSUE7ZUFDdkJBLElBQUlBLENBQUNBLFNBQVNBLEtBQUtBLElBQUlBO2VBQ3ZCQSxJQUFJQSxDQUFDQSxTQUFT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LGNBQWMsQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRTtJQUN0RCxHQUFHLEVBQUU7UUFDSCxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7SUFDOUIsQ0FBQztDQUNGLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGlzU2NvcGVNYXJrZXIobm9kZSkge1xuICBpZiAobm9kZS5uYW1lc3BhY2VVUkkgPT09IFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiKSB7XG4gICAgcmV0dXJuIG5vZGUubG9jYWxOYW1lID09PSBcImFwcGxldFwiXG4gICAgICB8fCBub2RlLmxvY2FsTmFtZSA9PT0gXCJjYXB0aW9uXCJcbiAgICAgIHx8IG5vZGUubG9jYWxOYW1lID09PSBcIm1hcnF1ZWVcIlxuICAgICAgfHwgbm9kZS5sb2NhbE5hbWUgPT09IFwib2JqZWN0XCJcbiAgICAgIHx8IG5vZGUubG9jYWxOYW1lID09PSBcInRhYmxlXCJcbiAgICAgIHx8IG5vZGUubG9jYWxOYW1lID09PSBcInRkXCJcbiAgICAgIHx8IG5vZGUubG9jYWxOYW1lID09PSBcInRoXCI7XG4gIH1cbiAgaWYgKG5vZGUubmFtZXNwYWNlVVJJID09PSBcImh0dHA6Ly93d3cudzMub3JnLzE5OTgvTWF0aC9NYXRoTUxcIikge1xuICAgIHJldHVybiBub2RlLmxvY2FsTmFtZSA9PT0gXCJtaVwiXG4gICAgICB8fCBub2RlLmxvY2FsTmFtZSA9PT0gXCJtb1wiXG4gICAgICB8fCBub2RlLmxvY2FsTmFtZSA9PT0gXCJtblwiXG4gICAgICB8fCBub2RlLmxvY2FsTmFtZSA9PT0gXCJtc1wiXG4gICAgICB8fCBub2RlLmxvY2FsTmFtZSA9PT0gXCJtdGV4dFwiXG4gICAgICB8fCBub2RlLmxvY2FsTmFtZSA9PT0gXCJhbm5vdGF0aW9uLXhtbFwiO1xuICB9XG4gIGlmIChub2RlLm5hbWVzcGFjZVVSSSA9PT0gXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiKSB7XG4gICAgcmV0dXJuIG5vZGUubG9jYWxOYW1lID09PSBcImZvcmVpZ25PYmplY3RcIlxuICAgICAgfHwgbm9kZS5sb2NhbE5hbWUgPT09IFwiZGVzY1wiXG4gICAgICB8fCBub2RlLmxvY2FsTmFtZSA9PT0gXCJ0aXRsZVwiO1xuICB9XG59XG5cbmZ1bmN0aW9uIGlzTGlzdEl0ZW1TY29wZU1hcmtlcihub2RlKSB7XG4gIHJldHVybiBpc1Njb3BlTWFya2VyKG5vZGUpXG4gICAgfHwgKG5vZGUubmFtZXNwYWNlVVJJID09PSBcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcIiAmJiBub2RlLmxvY2FsTmFtZSA9PT0gJ29sJylcbiAgICB8fCAobm9kZS5uYW1lc3BhY2VVUkkgPT09IFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiICYmIG5vZGUubG9jYWxOYW1lID09PSAndWwnKTtcbn1cblxuZnVuY3Rpb24gaXNUYWJsZVNjb3BlTWFya2VyKG5vZGUpIHtcbiAgcmV0dXJuIChub2RlLm5hbWVzcGFjZVVSSSA9PT0gXCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sXCIgJiYgbm9kZS5sb2NhbE5hbWUgPT09ICd0YWJsZScpXG4gICAgfHwgKG5vZGUubmFtZXNwYWNlVVJJID09PSBcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcIiAmJiBub2RlLmxvY2FsTmFtZSA9PT0gJ2h0bWwnKTtcbn1cblxuZnVuY3Rpb24gaXNUYWJsZUJvZHlTY29wZU1hcmtlcihub2RlKSB7XG4gIHJldHVybiAobm9kZS5uYW1lc3BhY2VVUkkgPT09IFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiICYmIG5vZGUubG9jYWxOYW1lID09PSAndGJvZHknKVxuICAgIHx8IChub2RlLm5hbWVzcGFjZVVSSSA9PT0gXCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sXCIgJiYgbm9kZS5sb2NhbE5hbWUgPT09ICd0Zm9vdCcpXG4gICAgfHwgKG5vZGUubmFtZXNwYWNlVVJJID09PSBcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcIiAmJiBub2RlLmxvY2FsTmFtZSA9PT0gJ3RoZWFkJylcbiAgICB8fCAobm9kZS5uYW1lc3BhY2VVUkkgPT09IFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiICYmIG5vZGUubG9jYWxOYW1lID09PSAnaHRtbCcpO1xufVxuXG5mdW5jdGlvbiBpc1RhYmxlUm93U2NvcGVNYXJrZXIobm9kZSkge1xuICByZXR1cm4gKG5vZGUubmFtZXNwYWNlVVJJID09PSBcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcIiAmJiBub2RlLmxvY2FsTmFtZSA9PT0gJ3RyJylcbiAgICB8fCAobm9kZS5uYW1lc3BhY2VVUkkgPT09IFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiICYmIG5vZGUubG9jYWxOYW1lID09PSAnaHRtbCcpO1xufVxuXG5mdW5jdGlvbiBpc0J1dHRvblNjb3BlTWFya2VyKG5vZGUpIHtcbiAgcmV0dXJuIGlzU2NvcGVNYXJrZXIobm9kZSlcbiAgICB8fCAobm9kZS5uYW1lc3BhY2VVUkkgPT09IFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiICYmIG5vZGUubG9jYWxOYW1lID09PSAnYnV0dG9uJyk7XG59XG5cbmZ1bmN0aW9uIGlzU2VsZWN0U2NvcGVNYXJrZXIobm9kZSkge1xuICByZXR1cm4gIShub2RlLm5hbWVzcGFjZVVSSSA9PT0gXCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sXCIgJiYgbm9kZS5sb2NhbE5hbWUgPT09ICdvcHRncm91cCcpXG4gICAgJiYgIShub2RlLm5hbWVzcGFjZVVSSSA9PT0gXCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sXCIgJiYgbm9kZS5sb2NhbE5hbWUgPT09ICdvcHRpb24nKTtcbn1cbi8qKlxuICogUmVwcmVzZW50cyBhIHN0YWNrIG9mIG9wZW4gZWxlbWVudHNcbiAqIEBjb25zdHJ1Y3RvclxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBFbGVtZW50U3RhY2soKSB7XG4gIHRoaXMuZWxlbWVudHMgPSBbXTtcbiAgdGhpcy5yb290Tm9kZSA9IG51bGw7XG4gIHRoaXMuaGVhZEVsZW1lbnQgPSBudWxsO1xuICB0aGlzLmJvZHlFbGVtZW50ID0gbnVsbDtcbn1cblxuLyoqXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IGxvY2FsTmFtZVxuICogQHBhcmFtIHtGdW5jdGlvbn0gaXNNYXJrZXJcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKiBAcHJpdmF0ZVxuICovXG5FbGVtZW50U3RhY2sucHJvdG90eXBlLl9pblNjb3BlID0gZnVuY3Rpb24obG9jYWxOYW1lLCBpc01hcmtlcikge1xuICBmb3IgKHZhciBpID0gdGhpcy5lbGVtZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIHZhciBub2RlID0gdGhpcy5lbGVtZW50c1tpXTtcbiAgICBpZiAobm9kZS5sb2NhbE5hbWUgPT09IGxvY2FsTmFtZSlcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIGlmIChpc01hcmtlcihub2RlKSlcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcblxuLyoqXG4gKiBQdXNoZXMgdGhlIGl0ZW0gb24gdGhlIHN0YWNrIHRvcFxuICogQHBhcmFtIHtTdGFja0l0ZW19IGl0ZW1cbiAqL1xuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24oaXRlbSkge1xuICB0aGlzLmVsZW1lbnRzLnB1c2goaXRlbSk7XG59O1xuXG4vKipcbiAqIFB1c2hlcyB0aGUgaXRlbSBvbiB0aGUgc3RhY2sgdG9wXG4gKiBAcGFyYW0ge1N0YWNrSXRlbX0gaXRlbSBIVE1MIGVsZW1lbnQgc3RhY2sgaXRlbVxuICovXG5FbGVtZW50U3RhY2sucHJvdG90eXBlLnB1c2hIdG1sRWxlbWVudCA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgdGhpcy5yb290Tm9kZSA9IGl0ZW0ubm9kZTtcbiAgdGhpcy5wdXNoKGl0ZW0pO1xufTtcblxuLyoqXG4gKiBQdXNoZXMgdGhlIGl0ZW0gb24gdGhlIHN0YWNrIHRvcFxuICogQHBhcmFtIHtTdGFja0l0ZW19IGl0ZW0gSEVBRCBlbGVtZW50IHN0YWNrIGl0ZW1cbiAqL1xuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5wdXNoSGVhZEVsZW1lbnQgPSBmdW5jdGlvbihpdGVtKSB7XG4gIHRoaXMuaGVhZEVsZW1lbnQgPSBpdGVtLm5vZGU7XG4gIHRoaXMucHVzaChpdGVtKTtcbn07XG5cbi8qKlxuICogUHVzaGVzIHRoZSBpdGVtIG9uIHRoZSBzdGFjayB0b3BcbiAqIEBwYXJhbSB7U3RhY2tJdGVtfSBpdGVtIEJPRFkgZWxlbWVudCBzdGFjayBpdGVtXG4gKi9cbkVsZW1lbnRTdGFjay5wcm90b3R5cGUucHVzaEJvZHlFbGVtZW50ID0gZnVuY3Rpb24oaXRlbSkge1xuICB0aGlzLmJvZHlFbGVtZW50ID0gaXRlbS5ub2RlO1xuICB0aGlzLnB1c2goaXRlbSk7XG59O1xuXG4vKipcbiAqIFBvcHMgdGhlIHRvcG1vc3QgaXRlbVxuICogQHJldHVybiB7U3RhY2tJdGVtfVxuICovXG5FbGVtZW50U3RhY2sucHJvdG90eXBlLnBvcCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5lbGVtZW50cy5wb3AoKTtcbn07XG5cbi8qKlxuICogUmVtb3ZlcyB0aGUgaXRlbSBmcm9tIHRoZSBlbGVtZW50IHN0YWNrXG4gKiBAcGFyYW0ge1N0YWNrSXRlbX0gaXRlbSBUaGUgaXRlbSB0byByZW1vdmVcbiAqL1xuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihpdGVtKSB7XG4gIHRoaXMuZWxlbWVudHMuc3BsaWNlKHRoaXMuZWxlbWVudHMuaW5kZXhPZihpdGVtKSwgMSk7XG59O1xuXG4vKipcbiAqIFBvcHMgdW50aWwgYW4gZWxlbWVudCB3aXRoIGEgZ2l2ZW4gbG9jYWxOYW1lIGlzIHBvcHBlZFxuICogQHBhcmFtIHtTdHJpbmd9IGxvY2FsTmFtZVxuICovXG5FbGVtZW50U3RhY2sucHJvdG90eXBlLnBvcFVudGlsUG9wcGVkID0gZnVuY3Rpb24obG9jYWxOYW1lKSB7XG4gIHZhciBlbGVtZW50O1xuICBkbyB7XG4gICAgZWxlbWVudCA9IHRoaXMucG9wKCk7XG4gIH0gd2hpbGUgKGVsZW1lbnQubG9jYWxOYW1lICE9IGxvY2FsTmFtZSk7XG59O1xuXG5FbGVtZW50U3RhY2sucHJvdG90eXBlLnBvcFVudGlsVGFibGVTY29wZU1hcmtlciA9IGZ1bmN0aW9uKCkge1xuICB3aGlsZSAoIWlzVGFibGVTY29wZU1hcmtlcih0aGlzLnRvcCkpXG4gICAgdGhpcy5wb3AoKTtcbn07XG5cbkVsZW1lbnRTdGFjay5wcm90b3R5cGUucG9wVW50aWxUYWJsZUJvZHlTY29wZU1hcmtlciA9IGZ1bmN0aW9uKCkge1xuICB3aGlsZSAoIWlzVGFibGVCb2R5U2NvcGVNYXJrZXIodGhpcy50b3ApKVxuICAgIHRoaXMucG9wKCk7XG59O1xuXG5FbGVtZW50U3RhY2sucHJvdG90eXBlLnBvcFVudGlsVGFibGVSb3dTY29wZU1hcmtlciA9IGZ1bmN0aW9uKCkge1xuICB3aGlsZSAoIWlzVGFibGVSb3dTY29wZU1hcmtlcih0aGlzLnRvcCkpXG4gICAgdGhpcy5wb3AoKTtcbn07XG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleFxuICogQHJldHVybiB7U3RhY2tJdGVtfVxuICovXG5FbGVtZW50U3RhY2sucHJvdG90eXBlLml0ZW0gPSBmdW5jdGlvbihpbmRleCkge1xuICByZXR1cm4gdGhpcy5lbGVtZW50c1tpbmRleF07XG59O1xuXG4vKipcbiAqXG4gKiBAcGFyYW0ge1N0YWNrSXRlbX0gZWxlbWVudFxuICogQHJldHVybiB7Qm9vbGVhbn1cbiAqL1xuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5jb250YWlucyA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgcmV0dXJuIHRoaXMuZWxlbWVudHMuaW5kZXhPZihlbGVtZW50KSAhPT0gLTE7XG59O1xuXG4vKipcbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gbG9jYWxOYW1lXG4gKiBAcmV0dXJuIHtCb29sZWFufVxuICovXG5FbGVtZW50U3RhY2sucHJvdG90eXBlLmluU2NvcGUgPSBmdW5jdGlvbihsb2NhbE5hbWUpIHtcbiAgcmV0dXJuIHRoaXMuX2luU2NvcGUobG9jYWxOYW1lLCBpc1Njb3BlTWFya2VyKTtcbn07XG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSBsb2NhbE5hbWVcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cbkVsZW1lbnRTdGFjay5wcm90b3R5cGUuaW5MaXN0SXRlbVNjb3BlID0gZnVuY3Rpb24obG9jYWxOYW1lKSB7XG4gIHJldHVybiB0aGlzLl9pblNjb3BlKGxvY2FsTmFtZSwgaXNMaXN0SXRlbVNjb3BlTWFya2VyKTtcbn07XG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSBsb2NhbE5hbWVcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cbkVsZW1lbnRTdGFjay5wcm90b3R5cGUuaW5UYWJsZVNjb3BlID0gZnVuY3Rpb24obG9jYWxOYW1lKSB7XG4gIHJldHVybiB0aGlzLl9pblNjb3BlKGxvY2FsTmFtZSwgaXNUYWJsZVNjb3BlTWFya2VyKTtcbn07XG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSBsb2NhbE5hbWVcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cbkVsZW1lbnRTdGFjay5wcm90b3R5cGUuaW5CdXR0b25TY29wZSA9IGZ1bmN0aW9uKGxvY2FsTmFtZSkge1xuICByZXR1cm4gdGhpcy5faW5TY29wZShsb2NhbE5hbWUsIGlzQnV0dG9uU2NvcGVNYXJrZXIpO1xufTtcblxuLyoqXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IGxvY2FsTmFtZVxuICogQHJldHVybiB7Qm9vbGVhbn1cbiAqL1xuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5pblNlbGVjdFNjb3BlID0gZnVuY3Rpb24obG9jYWxOYW1lKSB7XG4gIHJldHVybiB0aGlzLl9pblNjb3BlKGxvY2FsTmFtZSwgaXNTZWxlY3RTY29wZU1hcmtlcik7XG59O1xuXG4vKipcbiAqXG4gKiBAcmV0dXJuIHtCb29sZWFufVxuICovXG5FbGVtZW50U3RhY2sucHJvdG90eXBlLmhhc051bWJlcmVkSGVhZGVyRWxlbWVudEluU2NvcGUgPSBmdW5jdGlvbigpIHtcbiAgZm9yICh2YXIgaSA9IHRoaXMuZWxlbWVudHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICB2YXIgbm9kZSA9IHRoaXMuZWxlbWVudHNbaV07XG4gICAgaWYgKG5vZGUuaXNOdW1iZXJlZEhlYWRlcigpKVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgaWYgKGlzU2NvcGVNYXJrZXIobm9kZSkpXG4gICAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBlbGVtZW50XG4gKiBAcmV0dXJuIHtTdGFja0l0ZW19XG4gKi9cbkVsZW1lbnRTdGFjay5wcm90b3R5cGUuZnVydGhlc3RCbG9ja0ZvckZvcm1hdHRpbmdFbGVtZW50ID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICB2YXIgZnVydGhlc3RCbG9jayA9IG51bGw7XG4gIGZvciAodmFyIGkgPSB0aGlzLmVsZW1lbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgdmFyIG5vZGUgPSB0aGlzLmVsZW1lbnRzW2ldO1xuICAgIGlmIChub2RlLm5vZGUgPT09IGVsZW1lbnQpXG4gICAgICBicmVhaztcbiAgICBpZiAobm9kZS5pc1NwZWNpYWwoKSlcbiAgICAgIGZ1cnRoZXN0QmxvY2sgPSBub2RlO1xuICB9XG4gICAgcmV0dXJuIGZ1cnRoZXN0QmxvY2s7XG59O1xuXG4vKipcbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gbG9jYWxOYW1lXG4gKiBAcmV0dXJuIHtOdW1iZXJ9XG4gKi9cbkVsZW1lbnRTdGFjay5wcm90b3R5cGUuZmluZEluZGV4ID0gZnVuY3Rpb24obG9jYWxOYW1lKSB7XG4gIGZvciAodmFyIGkgPSB0aGlzLmVsZW1lbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgaWYgKHRoaXMuZWxlbWVudHNbaV0ubG9jYWxOYW1lID09IGxvY2FsTmFtZSlcbiAgICAgIHJldHVybiBpO1xuICB9XG4gICAgcmV0dXJuIC0xO1xufTtcblxuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5yZW1vdmVfb3BlbkVsZW1lbnRzX3VudGlsID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgdmFyIGZpbmlzaGVkID0gZmFsc2U7XG4gIHZhciBlbGVtZW50O1xuICB3aGlsZSAoIWZpbmlzaGVkKSB7XG4gICAgZWxlbWVudCA9IHRoaXMuZWxlbWVudHMucG9wKCk7XG4gICAgZmluaXNoZWQgPSBjYWxsYmFjayhlbGVtZW50KTtcbiAgfVxuICByZXR1cm4gZWxlbWVudDtcbn07XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShFbGVtZW50U3RhY2sucHJvdG90eXBlLCAndG9wJywge1xuICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW3RoaXMuZWxlbWVudHMubGVuZ3RoIC0gMV07XG4gIH1cbn0pO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoRWxlbWVudFN0YWNrLnByb3RvdHlwZSwgJ2xlbmd0aCcsIHtcbiAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50cy5sZW5ndGg7XG4gIH1cbn0pO1xuIl19