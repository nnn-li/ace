var asserts = require('./asserts');
var base = require('./base');
var tables = require('./tables');
var Tokenizer = require('./Tokenizer');
var OpMap = tables.OpMap;
var ParseTables = tables.ParseTables;
function parseError(message, fileName, begin, end) {
    var e = new SyntaxError(message);
    e.name = "ParseError";
    e['fileName'] = fileName;
    if (base.isDef(begin)) {
        e['lineNumber'] = begin[0];
        e['columnNumber'] = begin[1];
    }
    return e;
}
function findInDfa(a, obj) {
    var i = a.length;
    while (i--) {
        if (a[i][0] === obj[0] && a[i][1] === obj[1]) {
            return true;
        }
    }
    return false;
}
var Node = (function () {
    function Node(type, value, lineno, col_offset, children) {
        this.used_names = {};
        this.type = type;
        this.value = value;
        this.lineno = lineno;
        this.col_offset = col_offset;
        this.children = children;
    }
    return Node;
})();
exports.Node = Node;
var StackEntry = (function () {
    function StackEntry(dfa, state, node) {
        this.dfa = dfa;
        this.state = state;
        this.node = node;
    }
    return StackEntry;
})();
var Parser = (function () {
    function Parser(fileName, grammar) {
        this.fileName = fileName;
        this.grammar = grammar;
    }
    Parser.prototype.setup = function (start) {
        start = start || this.grammar.start;
        var newnode = new Node(start, null, null, null, []);
        this.stack = [new StackEntry(this.grammar.dfas[start], 0, newnode)];
        this.used_names = {};
    };
    Parser.prototype.addtoken = function (type, value, context) {
        var iLabel = this.classify(type, value, context);
        OUTERWHILE: while (true) {
            var tp = this.stack[this.stack.length - 1];
            var states = tp.dfa[0];
            var first = tp.dfa[1];
            var arcs = states[tp.state];
            for (var a = 0; a < arcs.length; ++a) {
                var i = arcs[a][0];
                var newstate = arcs[a][1];
                var t = this.grammar.labels[i][0];
                var v = this.grammar.labels[i][1];
                if (iLabel === i) {
                    asserts.assert(t < 256);
                    this.shift(type, value, newstate, context);
                    var state = newstate;
                    while (states[state].length === 1
                        && states[state][0][0] === 0
                        && states[state][0][1] === state) {
                        this.pop();
                        if (this.stack.length === 0) {
                            return true;
                        }
                        tp = this.stack[this.stack.length - 1];
                        state = tp.state;
                        states = tp.dfa[0];
                        first = tp.dfa[1];
                    }
                    return false;
                }
                else if (t >= 256) {
                    var itsdfa = this.grammar.dfas[t];
                    var itsfirst = itsdfa[1];
                    if (itsfirst.hasOwnProperty(iLabel)) {
                        this.push(t, this.grammar.dfas[t], newstate, context);
                        continue OUTERWHILE;
                    }
                }
            }
            if (findInDfa(arcs, [0, tp.state])) {
                this.pop();
                if (this.stack.length === 0) {
                    throw parseError("too much input", this.fileName);
                }
            }
            else {
                throw parseError("bad input", this.fileName, context[0], context[1]);
            }
        }
    };
    Parser.prototype.classify = function (type, value, context) {
        var iLabel;
        if (type === Tokenizer.Tokens.T_NAME) {
            this.used_names[value] = true;
            iLabel = this.grammar.keywords.hasOwnProperty(value) && this.grammar.keywords[value];
            if (iLabel) {
                return iLabel;
            }
        }
        iLabel = this.grammar.tokens.hasOwnProperty(type) && this.grammar.tokens[type];
        if (!iLabel) {
            throw parseError("bad token", this.fileName, context[0], context[1]);
        }
        return iLabel;
    };
    Parser.prototype.shift = function (type, value, newstate, context) {
        var dfa = this.stack[this.stack.length - 1].dfa;
        var state = this.stack[this.stack.length - 1].state;
        var node = this.stack[this.stack.length - 1].node;
        var newnode = new Node(type, value, context[0][0], context[0][1], []);
        if (newnode) {
            node.children.push(newnode);
        }
        this.stack[this.stack.length - 1] = { dfa: dfa, state: newstate, node: node };
    };
    Parser.prototype.push = function (type, newdfa, newstate, context) {
        var dfa = this.stack[this.stack.length - 1].dfa;
        var node = this.stack[this.stack.length - 1].node;
        this.stack[this.stack.length - 1] = { dfa: dfa, state: newstate, node: node };
        var newnode = new Node(type, null, context[0][0], context[0][1], []);
        this.stack.push({ dfa: newdfa, state: 0, node: newnode });
    };
    Parser.prototype.pop = function () {
        var pop = this.stack.pop();
        var newnode = pop.node;
        if (newnode) {
            if (this.stack.length !== 0) {
                var node = this.stack[this.stack.length - 1].node;
                node.children.push(newnode);
            }
            else {
                this.rootnode = newnode;
                this.rootnode.used_names = this.used_names;
            }
        }
    };
    return Parser;
})();
function makeParser(fileName, style) {
    if (style === undefined)
        style = "file_input";
    var p = new Parser(fileName, ParseTables);
    if (style === "file_input") {
        p.setup(ParseTables.sym.file_input);
    }
    else {
        asserts.fail("todo;");
    }
    var curIndex = 0;
    var lineno = 1;
    var column = 0;
    var prefix = "";
    var T_COMMENT = Tokenizer.Tokens.T_COMMENT;
    var T_NL = Tokenizer.Tokens.T_NL;
    var T_OP = Tokenizer.Tokens.T_OP;
    var tokenizer = new Tokenizer(fileName, style === "single_input", function (type, value, start, end, line) {
        var s_lineno = start[0];
        var s_column = start[1];
        if (type === T_COMMENT || type === T_NL) {
            prefix += value;
            lineno = end[0];
            column = end[1];
            if (value[value.length - 1] === "\n") {
                lineno += 1;
                column = 0;
            }
            return undefined;
        }
        if (type === T_OP) {
            type = OpMap[value];
        }
        if (p.addtoken(type, value, [start, end, line])) {
            return true;
        }
    });
    return function (line) {
        var ret = tokenizer.generateTokens(line);
        if (ret) {
            if (ret !== "done") {
                throw parseError("incomplete input", this.fileName);
            }
            return p.rootnode;
        }
        return null;
    };
}
function parse(fileName, source) {
    var parseFunc = makeParser(fileName);
    if (source.substr(source.length - 1, 1) !== "\n")
        source += "\n";
    var lines = source.split("\n");
    var ret;
    for (var i = 0; i < lines.length; ++i) {
        ret = parseFunc(lines[i] + ((i === lines.length - 1) ? "" : "\n"));
    }
    return ret;
}
exports.parse = parse;
function parseTreeDump(node) {
    var ret = "";
    if (node.type >= 256) {
        ret += ParseTables.number2symbol[node.type] + "\n";
        for (var i = 0; i < node.children.length; ++i) {
            ret += parseTreeDump(node.children[i]);
        }
    }
    else {
        ret += Tokenizer.tokenNames[node.type] + ": " + node.value + "\n";
    }
    return ret;
}
exports.parseTreeDump = parseTreeDump;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGFyc2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL21vZGUvcHl0aG9uL1BhcnNlci50cyJdLCJuYW1lcyI6WyJwYXJzZUVycm9yIiwiZmluZEluRGZhIiwiTm9kZSIsIk5vZGUuY29uc3RydWN0b3IiLCJTdGFja0VudHJ5IiwiU3RhY2tFbnRyeS5jb25zdHJ1Y3RvciIsIlBhcnNlciIsIlBhcnNlci5jb25zdHJ1Y3RvciIsIlBhcnNlci5zZXR1cCIsIlBhcnNlci5hZGR0b2tlbiIsIlBhcnNlci5jbGFzc2lmeSIsIlBhcnNlci5zaGlmdCIsIlBhcnNlci5wdXNoIiwiUGFyc2VyLnBvcCIsIm1ha2VQYXJzZXIiLCJwYXJzZSIsInBhcnNlVHJlZUR1bXAiXSwibWFwcGluZ3MiOiJBQUFBLElBQU8sT0FBTyxXQUFXLFdBQVcsQ0FBQyxDQUFDO0FBQ3RDLElBQU8sSUFBSSxXQUFXLFFBQVEsQ0FBQyxDQUFDO0FBQ2hDLElBQU8sTUFBTSxXQUFXLFVBQVUsQ0FBQyxDQUFDO0FBQ3BDLElBQU8sU0FBUyxXQUFXLGFBQWEsQ0FBQyxDQUFDO0FBRTFDLElBQUksS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7QUFDekIsSUFBSSxXQUFXLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQztBQVFyQyxvQkFBb0IsT0FBZSxFQUFFLFFBQWdCLEVBQUUsS0FBTSxFQUFFLEdBQUk7SUFDL0RBLElBQUlBLENBQUNBLEdBQUdBLElBQUlBLFdBQVdBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO0lBQ2pDQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxZQUFZQSxDQUFDQTtJQUN0QkEsQ0FBQ0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsR0FBR0EsUUFBUUEsQ0FBQ0E7SUFDekJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ3BCQSxDQUFDQSxDQUFDQSxZQUFZQSxD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LElBQUlBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLEVBQUVBLEtBQUtBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBO1FBRWpEQSxVQUFVQSxFQUNWQSxPQUFPQSxJQUFJQSxFQUFFQSxDQUFDQTtZQUNWQSxJQUFJQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMzQ0EsSUFBSUEsTUFBTUEsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdkJBLElBQUlBLEtBQUtBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3RCQSxJQUFJQSxJQUFJQSxHQUFHQSxNQUFNQSxDQUFDQSxFQUFFQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtZQUc1QkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7Z0JBQ25DQSxJQUFJQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDbkJBLElBQUlBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUMxQkEsSUFBSUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2xDQSxJQUFJQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDbENBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO29CQUVmQSxPQUFPQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtvQkFFeEJBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLEVBQUVBLEtBQUtBLEVBQUVBLFFBQVFBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBO29CQUUzQ0EsSUFBSUEsS0FBS0EsR0FBR0EsUUFBUUEsQ0FBQ0E7b0JBQ3JCQSxPQUFPQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxNQUFNQSxLQUFLQSxDQUFDQTsyQkFDMUJBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBOzJCQUN6QkEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsS0FBS0EsRUFBRUEsQ0FBQ0E7d0JBQ25DQSxJQUFJQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTt3QkFDWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7NEJBRTFCQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTt3QkFDaEJBLENBQUNBO3dCQUNEQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDdkNBLEtBQUtBLEdBQUdBLEVBQUVBLENBQUNBLEtBQUtBLENBQUNBO3dCQUNqQkEsTUFBTUEsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQ25CQSxLQUFLQSxHQUFHQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDdEJBLENBQUNBO29CQUVEQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtnQkFDakJBLENBQUNBO2dCQUNEQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDaEJBLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO29CQUNsQ0EsSUFBSUEsUUFBUUEsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ3pCQSxFQUFFQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQSxjQUFjQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFFbENBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLFFBQVFBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBO3dCQUN0REEsUUFBUUEsQ0FBQ0EsVUFBVUEsQ0FBQ0E7b0JBQ3hCQSxDQUFDQTtnQkFDTEEsQ0FBQ0E7WUFDTEEsQ0FBQ0E7WUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBRWpDQSxJQUFJQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTtnQkFDWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQzFCQSxNQUFNQSxVQUFVQSxDQUFDQSxnQkFBZ0JBLEVBQUVBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO2dCQUN0REEsQ0FBQ0E7WUFDTEEsQ0FBQ0E7WUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBRUZBLE1BQU1BLFVBQVVBLENBQUNBLFdBQVdBLEVBQUVBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3pFQSxDQUFDQTtRQUNMQSxDQUFDQTtJQUNMQSxDQUFDQTtJQUtPSCx5QkFBUUEsR0FBaEJBLFVBQWlCQSxJQUFZQSxFQUFFQSxLQUFhQSxFQUFFQSxPQUFhQTtRQUN2REksSUFBSUEsTUFBY0EsQ0FBQ0E7UUFDbkJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLEtBQUtBLFNBQVNBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1lBQ25DQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUM5QkEsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFDckZBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO2dCQUNUQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUNsQkEsQ0FBQ0E7UUFDTEEsQ0FBQ0E7UUFDREEsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDL0VBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1lBQ1ZBLE1BQU1BLFVBQVVBLENBQUNBLFdBQVdBLEVBQUVBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ3pFQSxDQUFDQTtRQUNEQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUNsQkEsQ0FBQ0E7SUFLT0osc0JBQUtBLEdBQWJBLFVBQWNBLElBQVlBLEVBQUVBLEtBQWFBLEVBQUVBLFFBQVFBLEVBQUVBLE9BQWFBO1FBQzlESyxJQUFJQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQTtRQUNoREEsSUFBSUEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDcERBLElBQUlBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBO1FBQ2xEQSxJQUFJQSxPQUFPQSxHQUFHQSxJQUFJQSxJQUFJQSxDQUFDQSxJQUFJQSxFQUFFQSxLQUFLQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUN0RUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDVkEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7UUFDaENBLENBQUNBO1FBQ0RBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLEdBQUdBLEVBQUVBLEdBQUdBLEVBQUVBLEtBQUtBLEVBQUVBLFFBQVFBLEVBQUVBLElBQUlBLEVBQUVBLElBQUlBLEVBQUVBLENBQUNBO0lBQ2xGQSxDQUFDQTtJQUtPTCxxQkFBSUEsR0FBWkEsVUFBYUEsSUFBWUEsRUFBRUEsTUFBTUEsRUFBRUEsUUFBUUEsRUFBRUEsT0FBYUE7UUFDdERNLElBQUlBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBO1FBQ2hEQSxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQTtRQUVsREEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0EsRUFBRUEsS0FBS0EsRUFBRUEsUUFBUUEsRUFBRUEsSUFBSUEsRUFBRUEsSUFBSUEsRUFBRUEsQ0FBQ0E7UUFFOUVBLElBQUlBLE9BQU9BLEdBQUdBLElBQUlBLElBQUlBLENBQUNBLElBQUlBLEVBQUVBLElBQUlBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1FBRXJFQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxNQUFNQSxFQUFFQSxLQUFLQSxFQUFFQSxDQUFDQSxFQUFFQSxJQUFJQSxFQUFFQSxPQUFPQSxFQUFFQSxDQUFDQSxDQUFDQTtJQUM5REEsQ0FBQ0E7SUFL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LENBQUNBLE1BQU1BLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBO1lBQzVDQSxHQUFHQSxJQUFJQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQ0EsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDRkEsR0FBR0EsSUFBSUEsU0FBU0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7SUFDdEVBLENBQUNBO0lBQ0RBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBO0FBQ2ZBLENBQUNBO0FBYmUscUJBQWEsZ0JBYTVCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXNzZXJ0cyA9IHJlcXVpcmUoJy4vYXNzZXJ0cycpO1xuaW1wb3J0IGJhc2UgPSByZXF1aXJlKCcuL2Jhc2UnKTtcbmltcG9ydCB0YWJsZXMgPSByZXF1aXJlKCcuL3RhYmxlcycpO1xuaW1wb3J0IFRva2VuaXplciA9IHJlcXVpcmUoJy4vVG9rZW5pemVyJyk7XG5cbnZhciBPcE1hcCA9IHRhYmxlcy5PcE1hcDtcbnZhciBQYXJzZVRhYmxlcyA9IHRhYmxlcy5QYXJzZVRhYmxlcztcblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZVxuICogQHBhcmFtIHtzdHJpbmd9IGZpbGVOYW1lXG4gKiBAcGFyYW0ge0FycmF5LjxudW1iZXI+PX0gYmVnaW5cbiAqIEBwYXJhbSB7QXJyYXkuPG51bWJlcj49fSBlbmRcbiAqL1xuZnVuY3Rpb24gcGFyc2VFcnJvcihtZXNzYWdlOiBzdHJpbmcsIGZpbGVOYW1lOiBzdHJpbmcsIGJlZ2luPywgZW5kPykge1xuICAgIHZhciBlID0gbmV3IFN5bnRheEVycm9yKG1lc3NhZ2UpO1xuICAgIGUubmFtZSA9IFwiUGFyc2VFcnJvclwiO1xuICAgIGVbJ2ZpbGVOYW1lJ10gPSBmaWxlTmFtZTtcbiAgICBpZiAoYmFzZS5pc0RlZihiZWdpbikpIHtcbiAgICAgICAgZVsnbGluZU51bWJlciddID0gYmVnaW5bMF07XG4gICAgICAgIGVbJ2NvbHVtbk51bWJlciddID0gYmVnaW5bMV07XG4gICAgfVxuICAgIHJldHVybiBlO1xufVxuXG4vKipcbiAqIEZpbmRzIHRoZSBzcGVjaWZpZWRcbiAqIEBwYXJhbSBhIEFuIGFycmF5IG9mIGFycmF5cyB3aGVyZSBlYWNoIGVsZW1lbnQgaXMgYW4gYXJyYXkgb2YgdHdvIGludGVnZXJzLlxuICogQHBhcmFtIG9iaiBBbiBhcnJheSBjb250YWluaW5nIHR3byBpbnRlZ2Vycy5cbiAqL1xuZnVuY3Rpb24gZmluZEluRGZhKGE6IG51bWJlcltdW10sIG9iajogbnVtYmVyW10pIHtcbiAgICB2YXIgaSA9IGEubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgaWYgKGFbaV1bMF0gPT09IG9ialswXSAmJiBhW2ldWzFdID09PSBvYmpbMV0pIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuZXhwb3J0IGNsYXNzIE5vZGUge1xuICAgIHB1YmxpYyB0eXBlOiBudW1iZXI7XG4gICAgcHVibGljIHZhbHVlOiBzdHJpbmc7XG4gICAgcHVibGljIGxpbmVubzogbnVtYmVyO1xuICAgIHB1YmxpYyBjb2xfb2Zmc2V0OiBudW1iZXI7XG4gICAgcHVibGljIGNoaWxkcmVuOiBOb2RlW107XG4gICAgcHVibGljIHVzZWRfbmFtZXMgPSB7fTtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBudW1iZXIsIHZhbHVlOiBzdHJpbmcsIGxpbmVubzogbnVtYmVyLCBjb2xfb2Zmc2V0OiBudW1iZXIsIGNoaWxkcmVuOiBOb2RlW10pIHtcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmxpbmVubyA9IGxpbmVubztcbiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gY29sX29mZnNldDtcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IGNoaWxkcmVuO1xuICAgIH1cbn1cblxuY2xhc3MgU3RhY2tFbnRyeSB7XG4gICAgcHVibGljIGRmYTtcbiAgICBwdWJsaWMgc3RhdGU6IG51bWJlcjtcbiAgICBwdWJsaWMgbm9kZTogTm9kZTtcbiAgICBjb25zdHJ1Y3RvcihkZmEsIHN0YXRlOiBudW1iZXIsIG5vZGU6IE5vZGUpIHtcbiAgICAgICAgdGhpcy5kZmEgPSBkZmE7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgdGhpcy5ub2RlID0gbm9kZTtcbiAgICB9XG59XG5cbmNsYXNzIFBhcnNlciB7XG4gICAgcHJpdmF0ZSBmaWxlTmFtZTogc3RyaW5nO1xuICAgIHByaXZhdGUgZ3JhbW1hcjtcbiAgICBwcml2YXRlIHN0YWNrOiBTdGFja0VudHJ5W107XG4gICAgcHVibGljIHJvb3Rub2RlOiBOb2RlO1xuICAgIHByaXZhdGUgdXNlZF9uYW1lcztcblxuICAgIGNvbnN0cnVjdG9yKGZpbGVOYW1lOiBzdHJpbmcsIGdyYW1tYXIpIHtcbiAgICAgICAgdGhpcy5maWxlTmFtZSA9IGZpbGVOYW1lO1xuICAgICAgICB0aGlzLmdyYW1tYXIgPSBncmFtbWFyO1xuICAgIH1cblxuICAgIHNldHVwKHN0YXJ0OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgc3RhcnQgPSBzdGFydCB8fCB0aGlzLmdyYW1tYXIuc3RhcnQ7XG4gICAgICAgIHZhciBuZXdub2RlID0gbmV3IE5vZGUoc3RhcnQsIG51bGwsIG51bGwsIG51bGwsIFtdKTtcbiAgICAgICAgdGhpcy5zdGFjayA9IFtuZXcgU3RhY2tFbnRyeSh0aGlzLmdyYW1tYXIuZGZhc1tzdGFydF0sIDAsIG5ld25vZGUpXTtcbiAgICAgICAgdGhpcy51c2VkX25hbWVzID0ge307XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkIGEgdG9rZW47IHJldHVybiB0cnVlIGlmIHdlJ3JlIGRvbmVcbiAgICAgKi9cbiAgICBhZGR0b2tlbih0eXBlOiBudW1iZXIsIHZhbHVlOiBzdHJpbmcsIGNvbnRleHQ6IHt9W10pOiBib29sZWFuIHtcbiAgICAgICAgdmFyIGlMYWJlbCA9IHRoaXMuY2xhc3NpZnkodHlwZSwgdmFsdWUsIGNvbnRleHQpO1xuXG4gICAgICAgIE9VVEVSV0hJTEU6XG4gICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICB2YXIgdHAgPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV07XG4gICAgICAgICAgICB2YXIgc3RhdGVzID0gdHAuZGZhWzBdO1xuICAgICAgICAgICAgdmFyIGZpcnN0ID0gdHAuZGZhWzFdO1xuICAgICAgICAgICAgdmFyIGFyY3MgPSBzdGF0ZXNbdHAuc3RhdGVdO1xuXG4gICAgICAgICAgICAvLyBsb29rIGZvciBhIHN0YXRlIHdpdGggdGhpcyBsYWJlbFxuICAgICAgICAgICAgZm9yICh2YXIgYSA9IDA7IGEgPCBhcmNzLmxlbmd0aDsgKythKSB7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSBhcmNzW2FdWzBdO1xuICAgICAgICAgICAgICAgIHZhciBuZXdzdGF0ZSA9IGFyY3NbYV1bMV07XG4gICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLmdyYW1tYXIubGFiZWxzW2ldWzBdO1xuICAgICAgICAgICAgICAgIHZhciB2ID0gdGhpcy5ncmFtbWFyLmxhYmVsc1tpXVsxXTtcbiAgICAgICAgICAgICAgICBpZiAoaUxhYmVsID09PSBpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGxvb2sgaXQgdXAgaW4gdGhlIGxpc3Qgb2YgbGFiZWxzXG4gICAgICAgICAgICAgICAgICAgIGFzc2VydHMuYXNzZXJ0KHQgPCAyNTYpO1xuICAgICAgICAgICAgICAgICAgICAvLyBzaGlmdCBhIHRva2VuOyB3ZSdyZSBkb25lIHdpdGggaXRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaGlmdCh0eXBlLCB2YWx1ZSwgbmV3c3RhdGUsIGNvbnRleHQpO1xuICAgICAgICAgICAgICAgICAgICAvLyBwb3Agd2hpbGUgd2UgYXJlIGluIGFuIGFjY2VwdC1vbmx5IHN0YXRlXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGF0ZSA9IG5ld3N0YXRlO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoc3RhdGVzW3N0YXRlXS5sZW5ndGggPT09IDFcbiAgICAgICAgICAgICAgICAgICAgICAgICYmIHN0YXRlc1tzdGF0ZV1bMF1bMF0gPT09IDBcbiAgICAgICAgICAgICAgICAgICAgICAgICYmIHN0YXRlc1tzdGF0ZV1bMF1bMV0gPT09IHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG9uZSFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRwID0gdGhpcy5zdGFja1t0aGlzLnN0YWNrLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSB0cC5zdGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlcyA9IHRwLmRmYVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0ID0gdHAuZGZhWzFdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGRvbmUgd2l0aCB0aGlzIHRva2VuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodCA+PSAyNTYpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0c2RmYSA9IHRoaXMuZ3JhbW1hci5kZmFzW3RdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXRzZmlyc3QgPSBpdHNkZmFbMV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdHNmaXJzdC5oYXNPd25Qcm9wZXJ0eShpTGFiZWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBwdXNoIGEgc3ltYm9sXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1c2godCwgdGhpcy5ncmFtbWFyLmRmYXNbdF0sIG5ld3N0YXRlLCBjb250ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIE9VVEVSV0hJTEU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChmaW5kSW5EZmEoYXJjcywgWzAsIHRwLnN0YXRlXSkpIHtcbiAgICAgICAgICAgICAgICAvLyBhbiBhY2NlcHRpbmcgc3RhdGUsIHBvcCBpdCBhbmQgdHJ5IHNvbWV0aGluZyBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy5wb3AoKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFcnJvcihcInRvbyBtdWNoIGlucHV0XCIsIHRoaXMuZmlsZU5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIG5vIHRyYW5zaXRpb25cbiAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUVycm9yKFwiYmFkIGlucHV0XCIsIHRoaXMuZmlsZU5hbWUsIGNvbnRleHRbMF0sIGNvbnRleHRbMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogdHVybiBhIHRva2VuIGludG8gYSBsYWJlbFxuICAgICAqL1xuICAgIHByaXZhdGUgY2xhc3NpZnkodHlwZTogbnVtYmVyLCB2YWx1ZTogc3RyaW5nLCBjb250ZXh0OiB7fVtdKTogbnVtYmVyIHtcbiAgICAgICAgdmFyIGlMYWJlbDogbnVtYmVyO1xuICAgICAgICBpZiAodHlwZSA9PT0gVG9rZW5pemVyLlRva2Vucy5UX05BTUUpIHtcbiAgICAgICAgICAgIHRoaXMudXNlZF9uYW1lc1t2YWx1ZV0gPSB0cnVlO1xuICAgICAgICAgICAgaUxhYmVsID0gdGhpcy5ncmFtbWFyLmtleXdvcmRzLmhhc093blByb3BlcnR5KHZhbHVlKSAmJiB0aGlzLmdyYW1tYXIua2V5d29yZHNbdmFsdWVdO1xuICAgICAgICAgICAgaWYgKGlMYWJlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpTGFiZWw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaUxhYmVsID0gdGhpcy5ncmFtbWFyLnRva2Vucy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSAmJiB0aGlzLmdyYW1tYXIudG9rZW5zW3R5cGVdO1xuICAgICAgICBpZiAoIWlMYWJlbCkge1xuICAgICAgICAgICAgdGhyb3cgcGFyc2VFcnJvcihcImJhZCB0b2tlblwiLCB0aGlzLmZpbGVOYW1lLCBjb250ZXh0WzBdLCBjb250ZXh0WzFdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaUxhYmVsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHNoaWZ0IGEgdG9rZW5cbiAgICAgKi9cbiAgICBwcml2YXRlIHNoaWZ0KHR5cGU6IG51bWJlciwgdmFsdWU6IHN0cmluZywgbmV3c3RhdGUsIGNvbnRleHQ6IHt9W10pIHtcbiAgICAgICAgdmFyIGRmYSA9IHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXS5kZmE7XG4gICAgICAgIHZhciBzdGF0ZSA9IHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXS5zdGF0ZTtcbiAgICAgICAgdmFyIG5vZGUgPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV0ubm9kZTtcbiAgICAgICAgdmFyIG5ld25vZGUgPSBuZXcgTm9kZSh0eXBlLCB2YWx1ZSwgY29udGV4dFswXVswXSwgY29udGV4dFswXVsxXSwgW10pO1xuICAgICAgICBpZiAobmV3bm9kZSkge1xuICAgICAgICAgICAgbm9kZS5jaGlsZHJlbi5wdXNoKG5ld25vZGUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXSA9IHsgZGZhOiBkZmEsIHN0YXRlOiBuZXdzdGF0ZSwgbm9kZTogbm9kZSB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHB1c2ggYSBub250ZXJtaW5hbFxuICAgICAqL1xuICAgIHByaXZhdGUgcHVzaCh0eXBlOiBudW1iZXIsIG5ld2RmYSwgbmV3c3RhdGUsIGNvbnRleHQ6IHt9W10pIHtcbiAgICAgICAgdmFyIGRmYSA9IHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXS5kZmE7XG4gICAgICAgIHZhciBub2RlID0gdGhpcy5zdGFja1t0aGlzLnN0YWNrLmxlbmd0aCAtIDFdLm5vZGU7XG5cbiAgICAgICAgdGhpcy5zdGFja1t0aGlzLnN0YWNrLmxlbmd0aCAtIDFdID0geyBkZmE6IGRmYSwgc3RhdGU6IG5ld3N0YXRlLCBub2RlOiBub2RlIH07XG5cbiAgICAgICAgdmFyIG5ld25vZGUgPSBuZXcgTm9kZSh0eXBlLCBudWxsLCBjb250ZXh0WzBdWzBdLCBjb250ZXh0WzBdWzFdLCBbXSk7XG5cbiAgICAgICAgdGhpcy5zdGFjay5wdXNoKHsgZGZhOiBuZXdkZmEsIHN0YXRlOiAwLCBub2RlOiBuZXdub2RlIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHBvcCBhIG5vbnRlcm1pbmFsXG4gICAgICovXG4gICAgcHJpdmF0ZSBwb3AoKSB7XG4gICAgICAgIHZhciBwb3AgPSB0aGlzLnN0YWNrLnBvcCgpO1xuICAgICAgICB2YXIgbmV3bm9kZSA9IHBvcC5ub2RlO1xuICAgICAgICBpZiAobmV3bm9kZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5vZGUgPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV0ubm9kZTtcbiAgICAgICAgICAgICAgICBub2RlLmNoaWxkcmVuLnB1c2gobmV3bm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJvb3Rub2RlID0gbmV3bm9kZTtcbiAgICAgICAgICAgICAgICB0aGlzLnJvb3Rub2RlLnVzZWRfbmFtZXMgPSB0aGlzLnVzZWRfbmFtZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogcGFyc2VyIGZvciBpbnRlcmFjdGl2ZSBpbnB1dC4gcmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgc2hvdWxkIGJlIGNhbGxlZCB3aXRoXG4gKiBsaW5lcyBvZiBpbnB1dCBhcyB0aGV5IGFyZSBlbnRlcmVkLiB0aGUgZnVuY3Rpb24gd2lsbCByZXR1cm4gZmFsc2VcbiAqIHVudGlsIHRoZSBpbnB1dCBpcyBjb21wbGV0ZSwgd2hlbiBpdCB3aWxsIHJldHVybiB0aGUgcm9vdG5vZGUgb2YgdGhlIHBhcnNlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlTmFtZVxuICogQHBhcmFtIHtzdHJpbmc9fSBzdHlsZSByb290IG9mIHBhcnNlIHRyZWUgKG9wdGlvbmFsKVxuICovXG5mdW5jdGlvbiBtYWtlUGFyc2VyKGZpbGVOYW1lOiBzdHJpbmcsIHN0eWxlPykge1xuICAgIGlmIChzdHlsZSA9PT0gdW5kZWZpbmVkKSBzdHlsZSA9IFwiZmlsZV9pbnB1dFwiO1xuXG4gICAgdmFyIHAgPSBuZXcgUGFyc2VyKGZpbGVOYW1lLCBQYXJzZVRhYmxlcyk7XG4gICAgLy8gZm9yIGNsb3N1cmUncyBiZW5lZml0XG4gICAgaWYgKHN0eWxlID09PSBcImZpbGVfaW5wdXRcIikge1xuICAgICAgICBwLnNldHVwKFBhcnNlVGFibGVzLnN5bS5maWxlX2lucHV0KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGFzc2VydHMuZmFpbChcInRvZG87XCIpO1xuICAgIH1cbiAgICB2YXIgY3VySW5kZXggPSAwO1xuICAgIHZhciBsaW5lbm8gPSAxO1xuICAgIHZhciBjb2x1bW4gPSAwO1xuICAgIHZhciBwcmVmaXggPSBcIlwiO1xuICAgIHZhciBUX0NPTU1FTlQgPSBUb2tlbml6ZXIuVG9rZW5zLlRfQ09NTUVOVDtcbiAgICB2YXIgVF9OTCA9IFRva2VuaXplci5Ub2tlbnMuVF9OTDtcbiAgICB2YXIgVF9PUCA9IFRva2VuaXplci5Ub2tlbnMuVF9PUDtcbiAgICB2YXIgdG9rZW5pemVyID0gbmV3IFRva2VuaXplcihmaWxlTmFtZSwgc3R5bGUgPT09IFwic2luZ2xlX2lucHV0XCIsIGZ1bmN0aW9uKHR5cGUsIHZhbHVlLCBzdGFydCwgZW5kLCBsaW5lKSB7XG4gICAgICAgIHZhciBzX2xpbmVubyA9IHN0YXJ0WzBdO1xuICAgICAgICB2YXIgc19jb2x1bW4gPSBzdGFydFsxXTtcbiAgICAgICAgLypcbiAgICAgICAgaWYgKHNfbGluZW5vICE9PSBsaW5lbm8gJiYgc19jb2x1bW4gIT09IGNvbHVtbilcbiAgICAgICAge1xuICAgICAgICAgICAgLy8gdG9kbzsgdXBkYXRlIHByZWZpeCBhbmQgbGluZS9jb2xcbiAgICAgICAgfVxuICAgICAgICAqL1xuICAgICAgICBpZiAodHlwZSA9PT0gVF9DT01NRU5UIHx8IHR5cGUgPT09IFRfTkwpIHtcbiAgICAgICAgICAgIHByZWZpeCArPSB2YWx1ZTtcbiAgICAgICAgICAgIGxpbmVubyA9IGVuZFswXTtcbiAgICAgICAgICAgIGNvbHVtbiA9IGVuZFsxXTtcbiAgICAgICAgICAgIGlmICh2YWx1ZVt2YWx1ZS5sZW5ndGggLSAxXSA9PT0gXCJcXG5cIikge1xuICAgICAgICAgICAgICAgIGxpbmVubyArPSAxO1xuICAgICAgICAgICAgICAgIGNvbHVtbiA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlID09PSBUX09QKSB7XG4gICAgICAgICAgICB0eXBlID0gT3BNYXBbdmFsdWVdO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwLmFkZHRva2VuKHR5cGUsIHZhbHVlLCBbc3RhcnQsIGVuZCwgbGluZV0pKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBmdW5jdGlvbihsaW5lKTogTm9kZSB7XG4gICAgICAgIHZhciByZXQgPSB0b2tlbml6ZXIuZ2VuZXJhdGVUb2tlbnMobGluZSk7XG4gICAgICAgIGlmIChyZXQpIHtcbiAgICAgICAgICAgIGlmIChyZXQgIT09IFwiZG9uZVwiKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFcnJvcihcImluY29tcGxldGUgaW5wdXRcIiwgdGhpcy5maWxlTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcC5yb290bm9kZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xufVxuXG4vKipcbiAqIFxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2UoZmlsZU5hbWU6IHN0cmluZywgc291cmNlOiBzdHJpbmcpOiBOb2RlIHtcbiAgICB2YXIgcGFyc2VGdW5jID0gbWFrZVBhcnNlcihmaWxlTmFtZSk7XG4gICAgaWYgKHNvdXJjZS5zdWJzdHIoc291cmNlLmxlbmd0aCAtIDEsIDEpICE9PSBcIlxcblwiKSBzb3VyY2UgKz0gXCJcXG5cIjtcbiAgICB2YXIgbGluZXMgPSBzb3VyY2Uuc3BsaXQoXCJcXG5cIik7XG4gICAgdmFyIHJldDogTm9kZTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIHJldCA9IHBhcnNlRnVuYyhsaW5lc1tpXSArICgoaSA9PT0gbGluZXMubGVuZ3RoIC0gMSkgPyBcIlwiIDogXCJcXG5cIikpO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuXG4vKipcbiAqIFxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VUcmVlRHVtcChub2RlOiBOb2RlKTogc3RyaW5nIHtcbiAgICB2YXIgcmV0ID0gXCJcIjtcbiAgICBpZiAobm9kZS50eXBlID49IDI1NikgLy8gbm9uLXRlcm1cbiAgICB7XG4gICAgICAgIHJldCArPSBQYXJzZVRhYmxlcy5udW1iZXIyc3ltYm9sW25vZGUudHlwZV0gKyBcIlxcblwiO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHJldCArPSBwYXJzZVRyZWVEdW1wKG5vZGUuY2hpbGRyZW5baV0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXQgKz0gVG9rZW5pemVyLnRva2VuTmFtZXNbbm9kZS50eXBlXSArIFwiOiBcIiArIG5vZGUudmFsdWUgKyBcIlxcblwiO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuIl19