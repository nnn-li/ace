import { arrayToMap } from "../lib/lang";
import TextMode from "./Mode";
import JavaScriptMode from "./JavaScriptMode";
import CssMode from "./CssMode";
import HtmlHighlightRules from "./HtmlHighlightRules";
import XmlBehaviour from "./behaviour/XmlBehaviour";
import HtmlFoldMode from "./folding/HtmlFoldMode";
import HtmlCompletions from "./HtmlCompletions";
import WorkerClient from "../worker/WorkerClient";
var voidElements = ["area", "base", "br", "col", "embed", "hr", "img", "input", "keygen", "link", "meta", "param", "source", "track", "wbr"];
var optionalEndTags = ["li", "dt", "dd", "p", "rt", "rp", "optgroup", "option", "colgroup", "td", "th"];
export default class HtmlMode extends TextMode {
    constructor(options) {
        super();
        this.blockComment = { start: "<!--", end: "-->" };
        this.voidElements = arrayToMap(voidElements);
        this.$id = "ace/mode/html";
        this.fragmentContext = options && options.fragmentContext;
        this.HighlightRules = HtmlHighlightRules;
        this.$behaviour = new XmlBehaviour();
        this.$completer = new HtmlCompletions();
        this.createModeDelegates({
            "js-": JavaScriptMode,
            "css-": CssMode
        });
        this.foldingRules = new HtmlFoldMode(this.voidElements, arrayToMap(optionalEndTags));
    }
    getNextLineIndent(state, line, tab) {
        return this.$getIndent(line);
    }
    checkOutdent(state, line, input) {
        return false;
    }
    getCompletions(state, session, pos, prefix) {
        return this.$completer.getCompletions(state, session, pos, prefix);
    }
    createWorker(session) {
        var worker = new WorkerClient("lib/worker/worker-systemjs.js");
        var mode = this;
        worker.on("initAfter", function () {
            worker.attachToDocument(session.getDocument());
            if (mode.fragmentContext)
                worker.call("setOptions", [{ context: mode.fragmentContext }]);
        });
        worker.on("error", function (e) {
            session.setAnnotations(e.data);
        });
        worker.on("terminate", function () {
            session.clearAnnotations();
        });
        worker.init("lib/mode/HtmlWorker", "default");
        return worker;
    }
    ;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSHRtbE1vZGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbW9kZS9IdG1sTW9kZS50cyJdLCJuYW1lcyI6WyJIdG1sTW9kZSIsIkh0bWxNb2RlLmNvbnN0cnVjdG9yIiwiSHRtbE1vZGUuZ2V0TmV4dExpbmVJbmRlbnQiLCJIdG1sTW9kZS5jaGVja091dGRlbnQiLCJIdG1sTW9kZS5nZXRDb21wbGV0aW9ucyIsIkh0bWxNb2RlLmNyZWF0ZVdvcmtlciJdLCJtYXBwaW5ncyI6Ik9BK0JPLEVBQUMsVUFBVSxFQUFDLE1BQU0sYUFBYTtPQUMvQixRQUFRLE1BQU0sUUFBUTtPQUN0QixjQUFjLE1BQU0sa0JBQWtCO09BQ3RDLE9BQU8sTUFBTSxXQUFXO09BQ3hCLGtCQUFrQixNQUFNLHNCQUFzQjtPQUM5QyxZQUFZLE1BQU0sMEJBQTBCO09BQzVDLFlBQVksTUFBTSx3QkFBd0I7T0FDMUMsZUFBZSxNQUFNLG1CQUFtQjtPQUN4QyxZQUFZLE1BQU0sd0JBQXdCO0FBR2pELElBQUksWUFBWSxHQUFHLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztBQUM3SSxJQUFJLGVBQWUsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztBQUV4RyxzQ0FBc0MsUUFBUTtJQU0xQ0EsWUFBWUEsT0FBT0E7UUFDZkMsT0FBT0EsQ0FBQ0E7UUFOWkEsaUJBQVlBLEdBQUdBLEVBQUVBLEtBQUtBLEVBQUVBLE1BQU1BLEVBQUVBLEdBQUdBLEVBQUVBLEtBQUtBLEVBQUVBLENBQUNBO1FBQzdDQSxpQkFBWUEsR0FBR0EsVUFBVUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0E7UUFDeENBLFFBQUdBLEdBQUdBLGVBQWVBLENBQUNBO1FBS2xCQSxJQUFJQSxDQUFDQSxlQUFlQSxHQUFHQSxPQUFPQSxJQUFJQSxPQUFPQSxDQUFDQSxlQUFlQSxDQUFDQTtRQUMxREEsSUFBSUEsQ0FBQ0EsY0FBY0EsR0FBR0Esa0JBQWtCQSxDQUFDQTtRQUN6Q0EsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsSUFBSUEsWUFBWUEsRUFBRUEsQ0FBQ0E7UUFDckNBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLElBQUlBLGVBQWVBLEVBQUVBLENBQUNBO1FBRXhDQSxJQUFJQSxDQUFDQSxtQkFBbUJBLENBQUNBO1lBQ3JCQSxLQUFLQSxFQUFFQSxjQUFjQTtZQUNyQkEsTUFBTUEsRUFBRUEsT0FBT0E7U0FDbEJBLENBQUNBLENBQUNBO1FBRUhBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLElBQUlBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLEVBQUVBLFVBQVVBLENBQUNBLGVBQWVBLENBQUNBLENBQUNBLENBQUNBO0lBQ3pGQSxDQUFDQTtJQUNERCxpQkFBaUJBLENBQUNBLEtBQUtBLEVBQUVBLElBQUlBLEVBQUVBLEdBQUdBO1FBQzlCRSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtJQUNqQ0EsQ0FBQ0E7SUFFREYsWUFBWUEsQ0FBQ0EsS0FBS0EsRUFBRUEsSUFBSUEsRUFBRUEsS0FBS0E7UUFDM0JHLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBO0lBQ2pCQSxDQUFDQTtJQUVESCxjQUFjQSxDQUFDQSxLQUFLQSxFQUFFQSxPQUFPQSxFQUFFQSxHQUFHQSxFQUFFQSxNQUFNQTtRQUN0Q0ksTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsS0FBS0EsRUFBRUEsT0FBT0EsRUFBRUEsR0FBR0EsRUFBRUEsTUFBTUEsQ0FBQ0EsQ0FBQ0E7SUFDdkVBLENBQUNBO0lBRURKLFlBQVlBLENBQUNBLE9BQU9BO1FBQ2hCSyxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxZQUFZQSxDQUFDQSwrQkFBK0JBLENBQUNBLENBQUNBO1FBQy9EQSxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUVoQkEsTUFBTUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsV0FBV0EsRUFBRUE7WUFDbkIsTUFBTSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDO1lBQy9DLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUM7Z0JBQ3JCLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN2RSxDQUFDLENBQUNBLENBQUNBO1FBRUhBLE1BQU1BLENBQUNBLEVBQUVBLENBQUNBLE9BQU9BLEVBQUVBLFVBQVNBLENBQUNBO1lBQ3pCLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25DLENBQUMsQ0FBQ0EsQ0FBQ0E7UUFFSEEsTUFBTUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsV0FBV0EsRUFBRUE7WUFDbkIsT0FBTyxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDL0IsQ0FBQyxDQUFDQSxDQUFDQTtRQUVIQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxxQkFBcUJBLEVBQUVBLFNBQVNBLENBQUNBLENBQUNBO1FBRTlDQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUNsQkEsQ0FBQ0E7O0FBQ0xMLENBQUNBO0FBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiAqKioqKiBCRUdJTiBMSUNFTlNFIEJMT0NLICoqKioqXG4gKiBEaXN0cmlidXRlZCB1bmRlciB0aGUgQlNEIGxpY2Vuc2U6XG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEwLCBBamF4Lm9yZyBCLlYuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogXG4gKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXRcbiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuICogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlXG4gKiAgICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICogICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBBamF4Lm9yZyBCLlYuIG5vciB0aGVcbiAqICAgICAgIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzXG4gKiAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cbiAqIFxuICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyBcIkFTIElTXCIgQU5EXG4gKiBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRFxuICogV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRVxuICogRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgQUpBWC5PUkcgQi5WLiBCRSBMSUFCTEUgRk9SIEFOWVxuICogRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVNcbiAqIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUztcbiAqIExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORFxuICogT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbiAqIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTXG4gKiBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cbiAqXG4gKiAqKioqKiBFTkQgTElDRU5TRSBCTE9DSyAqKioqKiAqL1xuXG5pbXBvcnQge2luaGVyaXRzfSBmcm9tIFwiLi4vbGliL29vcFwiO1xuaW1wb3J0IHthcnJheVRvTWFwfSBmcm9tIFwiLi4vbGliL2xhbmdcIjtcbmltcG9ydCBUZXh0TW9kZSBmcm9tIFwiLi9Nb2RlXCI7XG5pbXBvcnQgSmF2YVNjcmlwdE1vZGUgZnJvbSBcIi4vSmF2YVNjcmlwdE1vZGVcIjtcbmltcG9ydCBDc3NNb2RlIGZyb20gXCIuL0Nzc01vZGVcIjtcbmltcG9ydCBIdG1sSGlnaGxpZ2h0UnVsZXMgZnJvbSBcIi4vSHRtbEhpZ2hsaWdodFJ1bGVzXCI7XG5pbXBvcnQgWG1sQmVoYXZpb3VyIGZyb20gXCIuL2JlaGF2aW91ci9YbWxCZWhhdmlvdXJcIjtcbmltcG9ydCBIdG1sRm9sZE1vZGUgZnJvbSBcIi4vZm9sZGluZy9IdG1sRm9sZE1vZGVcIjtcbmltcG9ydCBIdG1sQ29tcGxldGlvbnMgZnJvbSBcIi4vSHRtbENvbXBsZXRpb25zXCI7XG5pbXBvcnQgV29ya2VyQ2xpZW50IGZyb20gXCIuLi93b3JrZXIvV29ya2VyQ2xpZW50XCI7XG5cbi8vIGh0dHA6Ly93d3cudzMub3JnL1RSL2h0bWw1L3N5bnRheC5odG1sI3ZvaWQtZWxlbWVudHNcbnZhciB2b2lkRWxlbWVudHMgPSBbXCJhcmVhXCIsIFwiYmFzZVwiLCBcImJyXCIsIFwiY29sXCIsIFwiZW1iZWRcIiwgXCJoclwiLCBcImltZ1wiLCBcImlucHV0XCIsIFwia2V5Z2VuXCIsIFwibGlua1wiLCBcIm1ldGFcIiwgXCJwYXJhbVwiLCBcInNvdXJjZVwiLCBcInRyYWNrXCIsIFwid2JyXCJdO1xudmFyIG9wdGlvbmFsRW5kVGFncyA9IFtcImxpXCIsIFwiZHRcIiwgXCJkZFwiLCBcInBcIiwgXCJydFwiLCBcInJwXCIsIFwib3B0Z3JvdXBcIiwgXCJvcHRpb25cIiwgXCJjb2xncm91cFwiLCBcInRkXCIsIFwidGhcIl07XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEh0bWxNb2RlIGV4dGVuZHMgVGV4dE1vZGUge1xuICAgIGJsb2NrQ29tbWVudCA9IHsgc3RhcnQ6IFwiPCEtLVwiLCBlbmQ6IFwiLS0+XCIgfTtcbiAgICB2b2lkRWxlbWVudHMgPSBhcnJheVRvTWFwKHZvaWRFbGVtZW50cyk7XG4gICAgJGlkID0gXCJhY2UvbW9kZS9odG1sXCI7XG4gICAgZnJhZ21lbnRDb250ZXh0O1xuICAgICRjb21wbGV0ZXI7XG4gICAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmZyYWdtZW50Q29udGV4dCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mcmFnbWVudENvbnRleHQ7XG4gICAgICAgIHRoaXMuSGlnaGxpZ2h0UnVsZXMgPSBIdG1sSGlnaGxpZ2h0UnVsZXM7XG4gICAgICAgIHRoaXMuJGJlaGF2aW91ciA9IG5ldyBYbWxCZWhhdmlvdXIoKTtcbiAgICAgICAgdGhpcy4kY29tcGxldGVyID0gbmV3IEh0bWxDb21wbGV0aW9ucygpO1xuXG4gICAgICAgIHRoaXMuY3JlYXRlTW9kZURlbGVnYXRlcyh7XG4gICAgICAgICAgICBcImpzLVwiOiBKYXZhU2NyaXB0TW9kZSxcbiAgICAgICAgICAgIFwiY3NzLVwiOiBDc3NNb2RlXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuZm9sZGluZ1J1bGVzID0gbmV3IEh0bWxGb2xkTW9kZSh0aGlzLnZvaWRFbGVtZW50cywgYXJyYXlUb01hcChvcHRpb25hbEVuZFRhZ3MpKTtcbiAgICB9XG4gICAgZ2V0TmV4dExpbmVJbmRlbnQoc3RhdGUsIGxpbmUsIHRhYikge1xuICAgICAgICByZXR1cm4gdGhpcy4kZ2V0SW5kZW50KGxpbmUpO1xuICAgIH1cblxuICAgIGNoZWNrT3V0ZGVudChzdGF0ZSwgbGluZSwgaW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGdldENvbXBsZXRpb25zKHN0YXRlLCBzZXNzaW9uLCBwb3MsIHByZWZpeCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kY29tcGxldGVyLmdldENvbXBsZXRpb25zKHN0YXRlLCBzZXNzaW9uLCBwb3MsIHByZWZpeCk7XG4gICAgfVxuXG4gICAgY3JlYXRlV29ya2VyKHNlc3Npb24pIHtcbiAgICAgICAgdmFyIHdvcmtlciA9IG5ldyBXb3JrZXJDbGllbnQoXCJsaWIvd29ya2VyL3dvcmtlci1zeXN0ZW1qcy5qc1wiKTtcbiAgICAgICAgdmFyIG1vZGUgPSB0aGlzO1xuXG4gICAgICAgIHdvcmtlci5vbihcImluaXRBZnRlclwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHdvcmtlci5hdHRhY2hUb0RvY3VtZW50KHNlc3Npb24uZ2V0RG9jdW1lbnQoKSk7XG4gICAgICAgICAgICBpZiAobW9kZS5mcmFnbWVudENvbnRleHQpXG4gICAgICAgICAgICAgICAgd29ya2VyLmNhbGwoXCJzZXRPcHRpb25zXCIsIFt7IGNvbnRleHQ6IG1vZGUuZnJhZ21lbnRDb250ZXh0IH1dKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgd29ya2VyLm9uKFwiZXJyb3JcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgc2Vzc2lvbi5zZXRBbm5vdGF0aW9ucyhlLmRhdGEpO1xuICAgICAgICB9KTtcblxuICAgICAgICB3b3JrZXIub24oXCJ0ZXJtaW5hdGVcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZXNzaW9uLmNsZWFyQW5ub3RhdGlvbnMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgd29ya2VyLmluaXQoXCJsaWIvbW9kZS9IdG1sV29ya2VyXCIsIFwiZGVmYXVsdFwiKTtcblxuICAgICAgICByZXR1cm4gd29ya2VyO1xuICAgIH07XG59XG4iXX0=