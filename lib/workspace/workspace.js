import { WorkerClient } from '../worker/worker_client';
import { EVENT_NAME_COMPLETIONS } from './workspace_protocol';
export var workspace = function () {
    var workerProxy = new WorkerClient(['ace'], 'ace/workspace/workspace_worker', 'WorkspaceWorker');
    var callbacks = {};
    var callbackId = 1;
    workerProxy.on("initAfter", function (event) {
    });
    workerProxy.on("fileNames", function (response) {
        var data = response.data;
        var names = data.names;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        callback(null, names);
    });
    workerProxy.on("syntaxErrors", function (response) {
        var data = response.data;
        var errors = data.errors;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        callback(null, errors);
    });
    workerProxy.on("semanticErrors", function (response) {
        var data = response.data;
        var errors = data.errors;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        callback(null, errors);
    });
    workerProxy.on(EVENT_NAME_COMPLETIONS, function (response) {
        var data = response.data;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        if ('err' in data) {
            callback(data.err);
        }
        else {
            callback(null, data.completions);
        }
    });
    workerProxy.on("typeAtDocumentPosition", function (response) {
        doCallback(response.data);
    });
    workerProxy.on("outputFiles", function (response) {
        doCallback(response.data);
    });
    function doCallback(data) {
        var info = data.results;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        if (data.err) {
            callback(data.err);
        }
        else {
            callback(null, data.results);
        }
    }
    function ensureScript(fileName, content) {
        var message = {
            data: { 'fileName': fileName, 'content': content.replace(/\r\n?/g, '\n') }
        };
        workerProxy.emit("ensureScript", message);
    }
    function editScript(fileName, start, end, text) {
        var message = {
            data: { fileName: fileName, start: start, end: end, text: text }
        };
        workerProxy.emit("editScript", message);
    }
    function removeScript(fileName) {
        workerProxy.emit("removeScript", { data: { 'fileName': fileName } });
    }
    function getFileNames(callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { callbackId: id } };
        workerProxy.emit("getFileNames", message);
    }
    function getSyntaxErrors(fileName, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, callbackId: id } };
        workerProxy.emit("getSyntaxErrors", message);
    }
    function getSemanticErrors(fileName, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, callbackId: id } };
        workerProxy.emit("getSemanticErrors", message);
    }
    function getCompletionsAtPosition(fileName, position, memberMode, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, position: position, memberMode: memberMode, callbackId: id } };
        workerProxy.emit("getCompletionsAtPosition", message);
    }
    function getTypeAtDocumentPosition(fileName, documentPosition, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, documentPosition: documentPosition, callbackId: id } };
        workerProxy.emit("getTypeAtDocumentPosition", message);
    }
    function getOutputFiles(fileName, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, callbackId: id } };
        workerProxy.emit("getOutputFiles", message);
    }
    var that = {
        ensureScript: ensureScript,
        editScript: editScript,
        removeScript: removeScript,
        getFileNames: getFileNames,
        getSyntaxErrors: getSyntaxErrors,
        getSemanticErrors: getSemanticErrors,
        getCompletionsAtPosition: getCompletionsAtPosition,
        getTypeAtDocumentPosition: getTypeAtDocumentPosition,
        getOutputFiles: getOutputFiles
    };
    return that;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya3NwYWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3dvcmtzcGFjZS93b3Jrc3BhY2UudHMiXSwibmFtZXMiOlsiZG9DYWxsYmFjayIsImVuc3VyZVNjcmlwdCIsImVkaXRTY3JpcHQiLCJyZW1vdmVTY3JpcHQiLCJnZXRGaWxlTmFtZXMiLCJnZXRTeW50YXhFcnJvcnMiLCJnZXRTZW1hbnRpY0Vycm9ycyIsImdldENvbXBsZXRpb25zQXRQb3NpdGlvbiIsImdldFR5cGVBdERvY3VtZW50UG9zaXRpb24iLCJnZXRPdXRwdXRGaWxlcyJdLCJtYXBwaW5ncyI6Ik9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSx5QkFBeUI7T0FDN0MsRUFBQyxzQkFBc0IsRUFBQyxNQUFNLHNCQUFzQjtBQTREM0QsV0FBVyxTQUFTLEdBQUc7SUFHbkIsSUFBSSxXQUFXLEdBQUcsSUFBSSxZQUFZLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxnQ0FBZ0MsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0lBQ2pHLElBQUksU0FBUyxHQUFHLEVBQUUsQ0FBQztJQUNuQixJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUM7SUFFbkIsV0FBVyxDQUFDLEVBQUUsQ0FBQyxXQUFXLEVBQUUsVUFBUyxLQUFLO0lBRzFDLENBQUMsQ0FBQyxDQUFDO0lBRUgsV0FBVyxDQUFDLEVBQUUsQ0FBQyxXQUFXLEVBQUUsVUFBUyxRQUEyRDtRQUM1RixJQUFJLElBQUksR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDO1FBQ3pCLElBQUksS0FBSyxHQUFhLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDakMsSUFBSSxFQUFFLEdBQVcsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQUNqQyxJQUFJLFFBQVEsR0FBMkIsU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3JELE9BQU8sU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3JCLFFBQVEsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFD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RSx5QkFBeUI7UUFDcEQsY0FBYyxFQUFFLGNBQWM7S0FDakMsQ0FBQztJQUNGLE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDaEIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtXb3JrZXJDbGllbnR9IGZyb20gJy4uL3dvcmtlci93b3JrZXJfY2xpZW50JztcbmltcG9ydCB7RVZFTlRfTkFNRV9DT01QTEVUSU9OU30gZnJvbSAnLi93b3Jrc3BhY2VfcHJvdG9jb2wnO1xuLyoqXG4gKiBBIHdvcmtzcGFjZSBpcyBhIGNvbGxlY3Rpb24gb2Ygc291cmNlIGZpbGVzIGlkZW50aWZpZWQgYnkgbmFtZS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBXb3Jrc3BhY2Uge1xuXG4gICAgLyoqXG4gICAgICogSW5zZXJ0IG9yIHVwZGF0ZSBhIHNjcmlwdC5cbiAgICAgKiBUaGlzIGlzIHR5cGljYWxseSBjYWxsZWQgYnkgdGhlIGVkaXRpbmcgYXBwbGljYXRpb24uXG4gICAgICovXG4gICAgZW5zdXJlU2NyaXB0KGZpbGVOYW1lOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZyk6IHZvaWQ7XG5cbiAgICAvKipcbiAgICAgKiBOb3RpZnkgdGhlIHdvcmtzcGFjZSBvZiBhbiBlZGl0IHRvIGEgc2NyaXB0LlxuICAgICAqL1xuICAgIGVkaXRTY3JpcHQoZmlsZU5hbWU6IHN0cmluZywgbWluQ2hhcjogbnVtYmVyLCBsaW1DaGFyOiBudW1iZXIsIG5ld1RleHQ6IHN0cmluZyk6IHZvaWQ7XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgYSBzY3JpcHQuXG4gICAgICogVGhpcyBpcyB0eXBpY2FsbHkgY2FsbGVkIGJ5IHRoZSBlZGl0aW5nIGFwcGxpY2F0aW9uLlxuICAgICAqL1xuICAgIHJlbW92ZVNjcmlwdChmaWxlTmFtZTogc3RyaW5nKTogdm9pZDtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgZ2V0RmlsZU5hbWVzKGNhbGxiYWNrKTogdm9pZDtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgZ2V0U3ludGF4RXJyb3JzKGZpbGVOYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzKSA9PiB2b2lkKTogdm9pZDtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgZ2V0U2VtYW50aWNFcnJvcnMoZmlsZU5hbWU6IHN0cmluZywgY2FsbGJhY2s6IChlcnIsIHJlc3VsdHMpID0+IHZvaWQpOiB2b2lkO1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBnZXRDb21wbGV0aW9uc0F0UG9zaXRpb24oZmlsZU5hbWU6IHN0cmluZywgcG9zaXRpb246IG51bWJlciwgbWVtYmVyTW9kZTogYm9vbGVhbiwgY2FsbGJhY2s6IChlcnIsIHJlc3VsdHMpID0+IHZvaWQpOiB2b2lkO1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBnZXRUeXBlQXREb2N1bWVudFBvc2l0aW9uKGZpbGVOYW1lOiBzdHJpbmcsIGRvY3VtZW50UG9zaXRpb246IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0sIGNhbGxiYWNrOiAoZXJyLCB0eXBlSW5mbzogdHMuVHlwZSkgPT4gdm9pZCk6IHZvaWQ7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGdldE91dHB1dEZpbGVzKGZpbGVOYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzKSA9PiB2b2lkKTogdm9pZDtcbn1cblxuLyoqXG4gKiBAcmV0dXJuIGEgd29ya3NwYWNlIGluc3RhbmNlLlxuICogXG4gKiBUaGlzIGlzIGEgZnVuY3Rpb25hbCBjb25zdHJ1Y3RvcjsgZG8gbm90IHVzZSB0aGUgJ25ldycgb3BlcmF0b3IgdG8gY2FsbCBpdC5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyBub3QgdXNlICd0aGlzJyBpbiB0aGUgY29kZSBiZWxvdy5cbiAqL1xuZXhwb3J0IHZhciB3b3Jrc3BhY2UgPSBmdW5jdGlvbigpIHtcblxuICAgIC8vIE4uQi4gVGhlIG1vZCBwYXJhbWV0ZXIgbXVzdCBiZSBhYnNvbHV0ZSBpbiBvcmRlciB0byB3b3JrIHdoZW4gcmVxdWlyZWpzIGlzIHVzaW5nIGluZGl2aWR1YWwgZmlsZXMuXG4gICAgdmFyIHdvcmtlclByb3h5ID0gbmV3IFdvcmtlckNsaWVudChbJ2FjZSddLCAnYWNlL3dvcmtzcGFjZS93b3Jrc3BhY2Vfd29ya2VyJywgJ1dvcmtzcGFjZVdvcmtlcicpO1xuICAgIHZhciBjYWxsYmFja3MgPSB7fTtcbiAgICB2YXIgY2FsbGJhY2tJZCA9IDE7XG5cbiAgICB3b3JrZXJQcm94eS5vbihcImluaXRBZnRlclwiLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAvLyBOb3QgdXNpbmcgdGhpcyBjYXBhYmlsaXR5IHJpZ2h0IG5vdy5cbiAgICAgICAgLy8gV29ya3NwYWNlV29ya2VyIHNlbmRzIHRoaXMgbm90aWZpY2F0aW9uIHRoYXQgY29uc3RydWN0b3IgZmluaXNoZWQuXG4gICAgfSk7XG5cbiAgICB3b3JrZXJQcm94eS5vbihcImZpbGVOYW1lc1wiLCBmdW5jdGlvbihyZXNwb25zZTogeyBkYXRhOiB7IG5hbWVzOiBzdHJpbmdbXTsgY2FsbGJhY2tJZDogbnVtYmVyIH0gfSkge1xuICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIHZhciBuYW1lczogc3RyaW5nW10gPSBkYXRhLm5hbWVzO1xuICAgICAgICB2YXIgaWQ6IG51bWJlciA9IGRhdGEuY2FsbGJhY2tJZDtcbiAgICAgICAgdmFyIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzKSA9PiB2b2lkID0gY2FsbGJhY2tzW2lkXTtcbiAgICAgICAgZGVsZXRlIGNhbGxiYWNrc1tpZF07XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIG5hbWVzKTtcbiAgICB9KTtcblxuICAgIHdvcmtlclByb3h5Lm9uKFwic3ludGF4RXJyb3JzXCIsIGZ1bmN0aW9uKHJlc3BvbnNlOiB7IGRhdGE6IHsgZXJyb3JzOiBhbnlbXTsgY2FsbGJhY2tJZDogbnVtYmVyIH0gfSkge1xuICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIHZhciBlcnJvcnMgPSBkYXRhLmVycm9ycztcbiAgICAgICAgdmFyIGlkOiBudW1iZXIgPSBkYXRhLmNhbGxiYWNrSWQ7XG4gICAgICAgIHZhciBjYWxsYmFjazogKGVyciwgcmVzdWx0cykgPT4gdm9pZCA9IGNhbGxiYWNrc1tpZF07XG4gICAgICAgIGRlbGV0ZSBjYWxsYmFja3NbaWRdO1xuICAgICAgICBjYWxsYmFjayhudWxsLCBlcnJvcnMpO1xuICAgIH0pO1xuXG4gICAgd29ya2VyUHJveHkub24oXCJzZW1hbnRpY0Vycm9yc1wiLCBmdW5jdGlvbihyZXNwb25zZTogeyBkYXRhOiB7IGVycm9yczogYW55W107IGNhbGxiYWNrSWQ6IG51bWJlciB9IH0pIHtcbiAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICB2YXIgZXJyb3JzID0gZGF0YS5lcnJvcnM7XG4gICAgICAgIHZhciBpZDogbnVtYmVyID0gZGF0YS5jYWxsYmFja0lkO1xuICAgICAgICB2YXIgY2FsbGJhY2s6IChlcnIsIHJlc3VsdHMpID0+IHZvaWQgPSBjYWxsYmFja3NbaWRdO1xuICAgICAgICBkZWxldGUgY2FsbGJhY2tzW2lkXTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgZXJyb3JzKTtcbiAgICB9KTtcblxuICAgIHdvcmtlclByb3h5Lm9uKEVWRU5UX05BTUVfQ09NUExFVElPTlMsIGZ1bmN0aW9uKHJlc3BvbnNlOiB7IGRhdGE6IHsgZXJyOiBhbnk7IGNvbXBsZXRpb25zOiBhbnlbXTsgY2FsbGJhY2tJZDogbnVtYmVyIH0gfSkge1xuICAgICAgICAvLyBUT0RPOiBTdGFuZGFyZGl6ZSBhbmQgaW50cm9kdWNlIGFzc2VydGlvbnMgYW5kIGxvZ2dpbmcuXG4gICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgdmFyIGlkOiBudW1iZXIgPSBkYXRhLmNhbGxiYWNrSWQ7XG4gICAgICAgIHZhciBjYWxsYmFjazogKGVyciwgcmVzdWx0cz8pID0+IHZvaWQgPSBjYWxsYmFja3NbaWRdO1xuICAgICAgICBkZWxldGUgY2FsbGJhY2tzW2lkXTtcbiAgICAgICAgaWYgKCdlcnInIGluIGRhdGEpIHtcblxuICAgICAgICAgICAgY2FsbGJhY2soZGF0YS5lcnIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YS5jb21wbGV0aW9ucyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHdvcmtlclByb3h5Lm9uKFwidHlwZUF0RG9jdW1lbnRQb3NpdGlvblwiLCBmdW5jdGlvbihyZXNwb25zZTogeyBkYXRhOiB7IGVycjogc3RyaW5nOyByZXN1bHRzOiB7IGRlc2NyaXB0aW9uOiBzdHJpbmc7IGRvY0NvbW1lbnQ6IHN0cmluZyB9OyBjYWxsYmFja0lkOiBudW1iZXIgfSB9KSB7XG4gICAgICAgIGRvQ2FsbGJhY2socmVzcG9uc2UuZGF0YSk7XG4gICAgfSk7XG5cbiAgICB3b3JrZXJQcm94eS5vbihcIm91dHB1dEZpbGVzXCIsIGZ1bmN0aW9uKHJlc3BvbnNlOiB7IGRhdGE6IHsgZXJyOiBzdHJpbmc7IHJlc3VsdHM6IGFueTsgY2FsbGJhY2tJZDogbnVtYmVyIH0gfSkge1xuICAgICAgICBkb0NhbGxiYWNrKHJlc3BvbnNlLmRhdGEpO1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gZG9DYWxsYmFjayhkYXRhOiB7IGVycjogc3RyaW5nOyByZXN1bHRzOiBhbnk7IGNhbGxiYWNrSWQ6IG51bWJlciB9KSB7XG4gICAgICAgIHZhciBpbmZvID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICB2YXIgaWQ6IG51bWJlciA9IGRhdGEuY2FsbGJhY2tJZDtcbiAgICAgICAgdmFyIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzPykgPT4gdm9pZCA9IGNhbGxiYWNrc1tpZF07XG4gICAgICAgIGRlbGV0ZSBjYWxsYmFja3NbaWRdO1xuICAgICAgICBpZiAoZGF0YS5lcnIpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEuZXJyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEucmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBlbnN1cmVTY3JpcHQoZmlsZU5hbWU6IHN0cmluZywgY29udGVudDogc3RyaW5nKSB7XG4gICAgICAgIHZhciBtZXNzYWdlID1cbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBkYXRhOiB7ICdmaWxlTmFtZSc6IGZpbGVOYW1lLCAnY29udGVudCc6IGNvbnRlbnQucmVwbGFjZSgvXFxyXFxuPy9nLCAnXFxuJykgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcImVuc3VyZVNjcmlwdFwiLCBtZXNzYWdlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBlZGl0U2NyaXB0KGZpbGVOYW1lOiBzdHJpbmcsIHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyLCB0ZXh0OiBzdHJpbmcpIHtcbiAgICAgICAgdmFyIG1lc3NhZ2UgPVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGRhdGE6IHsgZmlsZU5hbWU6IGZpbGVOYW1lLCBzdGFydDogc3RhcnQsIGVuZDogZW5kLCB0ZXh0OiB0ZXh0IH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIHdvcmtlclByb3h5LmVtaXQoXCJlZGl0U2NyaXB0XCIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlbW92ZVNjcmlwdChmaWxlTmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHdvcmtlclByb3h5LmVtaXQoXCJyZW1vdmVTY3JpcHRcIiwgeyBkYXRhOiB7ICdmaWxlTmFtZSc6IGZpbGVOYW1lIH0gfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0RmlsZU5hbWVzKGNhbGxiYWNrKTogdm9pZCB7XG4gICAgICAgIHZhciBpZCA9IGNhbGxiYWNrSWQrKztcbiAgICAgICAgY2FsbGJhY2tzW2lkXSA9IGNhbGxiYWNrO1xuICAgICAgICB2YXIgbWVzc2FnZSA9IHsgZGF0YTogeyBjYWxsYmFja0lkOiBpZCB9IH07XG4gICAgICAgIHdvcmtlclByb3h5LmVtaXQoXCJnZXRGaWxlTmFtZXNcIiwgbWVzc2FnZSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0U3ludGF4RXJyb3JzKGZpbGVOYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgICAgIHZhciBpZCA9IGNhbGxiYWNrSWQrKztcbiAgICAgICAgY2FsbGJhY2tzW2lkXSA9IGNhbGxiYWNrO1xuICAgICAgICB2YXIgbWVzc2FnZSA9IHsgZGF0YTogeyBmaWxlTmFtZTogZmlsZU5hbWUsIGNhbGxiYWNrSWQ6IGlkIH0gfTtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcImdldFN5bnRheEVycm9yc1wiLCBtZXNzYWdlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRTZW1hbnRpY0Vycm9ycyhmaWxlTmFtZTogc3RyaW5nLCBjYWxsYmFjazogKGVyciwgcmVzdWx0cykgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICB2YXIgaWQgPSBjYWxsYmFja0lkKys7XG4gICAgICAgIGNhbGxiYWNrc1tpZF0gPSBjYWxsYmFjaztcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSB7IGRhdGE6IHsgZmlsZU5hbWU6IGZpbGVOYW1lLCBjYWxsYmFja0lkOiBpZCB9IH07XG4gICAgICAgIHdvcmtlclByb3h5LmVtaXQoXCJnZXRTZW1hbnRpY0Vycm9yc1wiLCBtZXNzYWdlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRDb21wbGV0aW9uc0F0UG9zaXRpb24oZmlsZU5hbWU6IHN0cmluZywgcG9zaXRpb246IG51bWJlciwgbWVtYmVyTW9kZTogYm9vbGVhbiwgY2FsbGJhY2s6IChlcnIsIHJlc3VsdHMpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgdmFyIGlkID0gY2FsbGJhY2tJZCsrO1xuICAgICAgICBjYWxsYmFja3NbaWRdID0gY2FsbGJhY2s7XG4gICAgICAgIHZhciBtZXNzYWdlID0geyBkYXRhOiB7IGZpbGVOYW1lOiBmaWxlTmFtZSwgcG9zaXRpb246IHBvc2l0aW9uLCBtZW1iZXJNb2RlOiBtZW1iZXJNb2RlLCBjYWxsYmFja0lkOiBpZCB9IH07XG4gICAgICAgIHdvcmtlclByb3h5LmVtaXQoXCJnZXRDb21wbGV0aW9uc0F0UG9zaXRpb25cIiwgbWVzc2FnZSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0VHlwZUF0RG9jdW1lbnRQb3NpdGlvbihmaWxlTmFtZTogc3RyaW5nLCBkb2N1bWVudFBvc2l0aW9uOiB7IHJvdzogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9LCBjYWxsYmFjazogKGVyciwgdHlwZUluZm86IHRzLlR5cGUpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgdmFyIGlkID0gY2FsbGJhY2tJZCsrO1xuICAgICAgICBjYWxsYmFja3NbaWRdID0gY2FsbGJhY2s7XG4gICAgICAgIHZhciBtZXNzYWdlID0geyBkYXRhOiB7IGZpbGVOYW1lOiBmaWxlTmFtZSwgZG9jdW1lbnRQb3NpdGlvbjogZG9jdW1lbnRQb3NpdGlvbiwgY2FsbGJhY2tJZDogaWQgfSB9O1xuICAgICAgICB3b3JrZXJQcm94eS5lbWl0KFwiZ2V0VHlwZUF0RG9jdW1lbnRQb3NpdGlvblwiLCBtZXNzYWdlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRPdXRwdXRGaWxlcyhmaWxlTmFtZTogc3RyaW5nLCBjYWxsYmFjazogKGVyciwgcmVzdWx0cykgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICB2YXIgaWQgPSBjYWxsYmFja0lkKys7XG4gICAgICAgIGNhbGxiYWNrc1tpZF0gPSBjYWxsYmFjaztcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSB7IGRhdGE6IHsgZmlsZU5hbWU6IGZpbGVOYW1lLCBjYWxsYmFja0lkOiBpZCB9IH07XG4gICAgICAgIHdvcmtlclByb3h5LmVtaXQoXCJnZXRPdXRwdXRGaWxlc1wiLCBtZXNzYWdlKTtcbiAgICB9XG5cbiAgICB2YXIgdGhhdDogV29ya3NwYWNlID0ge1xuICAgICAgICBlbnN1cmVTY3JpcHQ6IGVuc3VyZVNjcmlwdCxcbiAgICAgICAgZWRpdFNjcmlwdDogZWRpdFNjcmlwdCxcbiAgICAgICAgcmVtb3ZlU2NyaXB0OiByZW1vdmVTY3JpcHQsXG4gICAgICAgIGdldEZpbGVOYW1lczogZ2V0RmlsZU5hbWVzLFxuICAgICAgICBnZXRTeW50YXhFcnJvcnM6IGdldFN5bnRheEVycm9ycyxcbiAgICAgICAgZ2V0U2VtYW50aWNFcnJvcnM6IGdldFNlbWFudGljRXJyb3JzLFxuICAgICAgICBnZXRDb21wbGV0aW9uc0F0UG9zaXRpb246IGdldENvbXBsZXRpb25zQXRQb3NpdGlvbixcbiAgICAgICAgZ2V0VHlwZUF0RG9jdW1lbnRQb3NpdGlvbjogZ2V0VHlwZUF0RG9jdW1lbnRQb3NpdGlvbixcbiAgICAgICAgZ2V0T3V0cHV0RmlsZXM6IGdldE91dHB1dEZpbGVzXG4gICAgfTtcbiAgICByZXR1cm4gdGhhdDtcbn07XG4iXX0=