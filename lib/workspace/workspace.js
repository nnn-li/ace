import WorkerClient from '../worker/WorkerClient';
import { EVENT_NAME_COMPLETIONS } from './workspace_protocol';
export var workspace = function () {
    var workerProxy = new WorkerClient('ace/workspace/workspace_worker');
    var callbacks = {};
    var callbackId = 1;
    workerProxy.on("initAfter", function (event) {
    });
    workerProxy.on("fileNames", function (response) {
        var data = response.data;
        var names = data.names;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        callback(null, names);
    });
    workerProxy.on("syntaxErrors", function (response) {
        var data = response.data;
        var errors = data.errors;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        callback(null, errors);
    });
    workerProxy.on("semanticErrors", function (response) {
        var data = response.data;
        var errors = data.errors;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        callback(null, errors);
    });
    workerProxy.on(EVENT_NAME_COMPLETIONS, function (response) {
        var data = response.data;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        if ('err' in data) {
            callback(data.err);
        }
        else {
            callback(null, data.completions);
        }
    });
    workerProxy.on("typeAtDocumentPosition", function (response) {
        doCallback(response.data);
    });
    workerProxy.on("outputFiles", function (response) {
        doCallback(response.data);
    });
    workerProxy.init('ace/workspace/workspace_worker', 'WorkspaceWorker');
    function doCallback(data) {
        var info = data.results;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        if (data.err) {
            callback(data.err);
        }
        else {
            callback(null, data.results);
        }
    }
    function ensureScript(fileName, content) {
        var message = {
            data: { 'fileName': fileName, 'content': content.replace(/\r\n?/g, '\n') }
        };
        workerProxy.emit("ensureScript", message);
    }
    function editScript(fileName, start, end, text) {
        var message = {
            data: { fileName: fileName, start: start, end: end, text: text }
        };
        workerProxy.emit("editScript", message);
    }
    function removeScript(fileName) {
        workerProxy.emit("removeScript", { data: { 'fileName': fileName } });
    }
    function getFileNames(callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { callbackId: id } };
        workerProxy.emit("getFileNames", message);
    }
    function getSyntaxErrors(fileName, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, callbackId: id } };
        workerProxy.emit("getSyntaxErrors", message);
    }
    function getSemanticErrors(fileName, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, callbackId: id } };
        workerProxy.emit("getSemanticErrors", message);
    }
    function getCompletionsAtPosition(fileName, position, memberMode, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, position: position, memberMode: memberMode, callbackId: id } };
        workerProxy.emit("getCompletionsAtPosition", message);
    }
    function getTypeAtDocumentPosition(fileName, documentPosition, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, documentPosition: documentPosition, callbackId: id } };
        workerProxy.emit("getTypeAtDocumentPosition", message);
    }
    function getOutputFiles(fileName, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, callbackId: id } };
        workerProxy.emit("getOutputFiles", message);
    }
    var that = {
        ensureScript: ensureScript,
        editScript: editScript,
        removeScript: removeScript,
        getFileNames: getFileNames,
        getSyntaxErrors: getSyntaxErrors,
        getSemanticErrors: getSemanticErrors,
        getCompletionsAtPosition: getCompletionsAtPosition,
        getTypeAtDocumentPosition: getTypeAtDocumentPosition,
        getOutputFiles: getOutputFiles
    };
    return that;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya3NwYWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3dvcmtzcGFjZS93b3Jrc3BhY2UudHMiXSwibmFtZXMiOlsiZG9DYWxsYmFjayIsImVuc3VyZVNjcmlwdCIsImVkaXRTY3JpcHQiLCJyZW1vdmVTY3JpcHQiLCJnZXRGaWxlTmFtZXMiLCJnZXRTeW50YXhFcnJvcnMiLCJnZXRTZW1hbnRpY0Vycm9ycyIsImdldENvbXBsZXRpb25zQXRQb3NpdGlvbiIsImdldFR5cGVBdERvY3VtZW50UG9zaXRpb24iLCJnZXRPdXRwdXRGaWxlcyJdLCJtYXBwaW5ncyI6Ik9BQU8sWUFBWSxNQUFNLHdCQUF3QjtPQUMxQyxFQUFDLHNCQUFzQixFQUFDLE1BQU0sc0JBQXNCO0FBNEQzRCxXQUFXLFNBQVMsR0FBRztJQUduQixJQUFJLFdBQVcsR0FBRyxJQUFJLFlBQVksQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0lBRXJFLElBQUksU0FBUyxHQUFHLEVBQUUsQ0FBQztJQUNuQixJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUM7SUFFbkIsV0FBVyxDQUFDLEVBQUUsQ0FBQyxXQUFXLEVBQUUsVUFBUyxLQUFLO0lBRzFDLENBQUMsQ0FBQyxDQUFDO0lBRUgsV0FBVyxDQUFDLEVBQUUsQ0FBQyxXQUFXLEVBQUUsVUFBUyxRQUEyRDtRQUM1RixJQUFJLElBQUksR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDO1FBQ3pCLElBQUksS0FBSyxHQUFhLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDakMsSUFBSSxFQUFFLEdBQVcsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQUNqQyxJQUFJLFFBQVEsR0FBMkIsU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3JELE9BQU8sU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3JCLFFBQVEsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDMUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxXQUFXLENBQUMsRUFBRSxDQUFD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bEQseUJBQXlCLEVBQUUseUJBQXlCO1FBQ3BELGNBQWMsRUFBRSxjQUFjO0tBQ2pDLENBQUM7SUFDRixNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ2hCLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBXb3JrZXJDbGllbnQgZnJvbSAnLi4vd29ya2VyL1dvcmtlckNsaWVudCc7XG5pbXBvcnQge0VWRU5UX05BTUVfQ09NUExFVElPTlN9IGZyb20gJy4vd29ya3NwYWNlX3Byb3RvY29sJztcbi8qKlxuICogQSB3b3Jrc3BhY2UgaXMgYSBjb2xsZWN0aW9uIG9mIHNvdXJjZSBmaWxlcyBpZGVudGlmaWVkIGJ5IG5hbWUuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgV29ya3NwYWNlIHtcblxuICAgIC8qKlxuICAgICAqIEluc2VydCBvciB1cGRhdGUgYSBzY3JpcHQuXG4gICAgICogVGhpcyBpcyB0eXBpY2FsbHkgY2FsbGVkIGJ5IHRoZSBlZGl0aW5nIGFwcGxpY2F0aW9uLlxuICAgICAqL1xuICAgIGVuc3VyZVNjcmlwdChmaWxlTmFtZTogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiB2b2lkO1xuXG4gICAgLyoqXG4gICAgICogTm90aWZ5IHRoZSB3b3Jrc3BhY2Ugb2YgYW4gZWRpdCB0byBhIHNjcmlwdC5cbiAgICAgKi9cbiAgICBlZGl0U2NyaXB0KGZpbGVOYW1lOiBzdHJpbmcsIG1pbkNoYXI6IG51bWJlciwgbGltQ2hhcjogbnVtYmVyLCBuZXdUZXh0OiBzdHJpbmcpOiB2b2lkO1xuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGEgc2NyaXB0LlxuICAgICAqIFRoaXMgaXMgdHlwaWNhbGx5IGNhbGxlZCBieSB0aGUgZWRpdGluZyBhcHBsaWNhdGlvbi5cbiAgICAgKi9cbiAgICByZW1vdmVTY3JpcHQoZmlsZU5hbWU6IHN0cmluZyk6IHZvaWQ7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGdldEZpbGVOYW1lcyhjYWxsYmFjayk6IHZvaWQ7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGdldFN5bnRheEVycm9ycyhmaWxlTmFtZTogc3RyaW5nLCBjYWxsYmFjazogKGVyciwgcmVzdWx0cykgPT4gdm9pZCk6IHZvaWQ7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGdldFNlbWFudGljRXJyb3JzKGZpbGVOYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzKSA9PiB2b2lkKTogdm9pZDtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgZ2V0Q29tcGxldGlvbnNBdFBvc2l0aW9uKGZpbGVOYW1lOiBzdHJpbmcsIHBvc2l0aW9uOiBudW1iZXIsIG1lbWJlck1vZGU6IGJvb2xlYW4sIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzKSA9PiB2b2lkKTogdm9pZDtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgZ2V0VHlwZUF0RG9jdW1lbnRQb3NpdGlvbihmaWxlTmFtZTogc3RyaW5nLCBkb2N1bWVudFBvc2l0aW9uOiB7IHJvdzogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9LCBjYWxsYmFjazogKGVyciwgdHlwZUluZm86IHRzLlR5cGUpID0+IHZvaWQpOiB2b2lkO1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBnZXRPdXRwdXRGaWxlcyhmaWxlTmFtZTogc3RyaW5nLCBjYWxsYmFjazogKGVyciwgcmVzdWx0cykgPT4gdm9pZCk6IHZvaWQ7XG59XG5cbi8qKlxuICogQHJldHVybiBhIHdvcmtzcGFjZSBpbnN0YW5jZS5cbiAqIFxuICogVGhpcyBpcyBhIGZ1bmN0aW9uYWwgY29uc3RydWN0b3I7IGRvIG5vdCB1c2UgdGhlICduZXcnIG9wZXJhdG9yIHRvIGNhbGwgaXQuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8gbm90IHVzZSAndGhpcycgaW4gdGhlIGNvZGUgYmVsb3cuXG4gKi9cbmV4cG9ydCB2YXIgd29ya3NwYWNlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAvLyBOLkIuIFRoZSBtb2QgcGFyYW1ldGVyIG11c3QgYmUgYWJzb2x1dGUgaW4gb3JkZXIgdG8gd29yayB3aGVuIHJlcXVpcmVqcyBpcyB1c2luZyBpbmRpdmlkdWFsIGZpbGVzLlxuICAgIHZhciB3b3JrZXJQcm94eSA9IG5ldyBXb3JrZXJDbGllbnQoJ2FjZS93b3Jrc3BhY2Uvd29ya3NwYWNlX3dvcmtlcicpO1xuXG4gICAgdmFyIGNhbGxiYWNrcyA9IHt9O1xuICAgIHZhciBjYWxsYmFja0lkID0gMTtcblxuICAgIHdvcmtlclByb3h5Lm9uKFwiaW5pdEFmdGVyXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIC8vIE5vdCB1c2luZyB0aGlzIGNhcGFiaWxpdHkgcmlnaHQgbm93LlxuICAgICAgICAvLyBXb3Jrc3BhY2VXb3JrZXIgc2VuZHMgdGhpcyBub3RpZmljYXRpb24gdGhhdCBjb25zdHJ1Y3RvciBmaW5pc2hlZC5cbiAgICB9KTtcblxuICAgIHdvcmtlclByb3h5Lm9uKFwiZmlsZU5hbWVzXCIsIGZ1bmN0aW9uKHJlc3BvbnNlOiB7IGRhdGE6IHsgbmFtZXM6IHN0cmluZ1tdOyBjYWxsYmFja0lkOiBudW1iZXIgfSB9KSB7XG4gICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgdmFyIG5hbWVzOiBzdHJpbmdbXSA9IGRhdGEubmFtZXM7XG4gICAgICAgIHZhciBpZDogbnVtYmVyID0gZGF0YS5jYWxsYmFja0lkO1xuICAgICAgICB2YXIgY2FsbGJhY2s6IChlcnIsIHJlc3VsdHMpID0+IHZvaWQgPSBjYWxsYmFja3NbaWRdO1xuICAgICAgICBkZWxldGUgY2FsbGJhY2tzW2lkXTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgbmFtZXMpO1xuICAgIH0pO1xuXG4gICAgd29ya2VyUHJveHkub24oXCJzeW50YXhFcnJvcnNcIiwgZnVuY3Rpb24ocmVzcG9uc2U6IHsgZGF0YTogeyBlcnJvcnM6IGFueVtdOyBjYWxsYmFja0lkOiBudW1iZXIgfSB9KSB7XG4gICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgdmFyIGVycm9ycyA9IGRhdGEuZXJyb3JzO1xuICAgICAgICB2YXIgaWQ6IG51bWJlciA9IGRhdGEuY2FsbGJhY2tJZDtcbiAgICAgICAgdmFyIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzKSA9PiB2b2lkID0gY2FsbGJhY2tzW2lkXTtcbiAgICAgICAgZGVsZXRlIGNhbGxiYWNrc1tpZF07XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIGVycm9ycyk7XG4gICAgfSk7XG5cbiAgICB3b3JrZXJQcm94eS5vbihcInNlbWFudGljRXJyb3JzXCIsIGZ1bmN0aW9uKHJlc3BvbnNlOiB7IGRhdGE6IHsgZXJyb3JzOiBhbnlbXTsgY2FsbGJhY2tJZDogbnVtYmVyIH0gfSkge1xuICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIHZhciBlcnJvcnMgPSBkYXRhLmVycm9ycztcbiAgICAgICAgdmFyIGlkOiBudW1iZXIgPSBkYXRhLmNhbGxiYWNrSWQ7XG4gICAgICAgIHZhciBjYWxsYmFjazogKGVyciwgcmVzdWx0cykgPT4gdm9pZCA9IGNhbGxiYWNrc1tpZF07XG4gICAgICAgIGRlbGV0ZSBjYWxsYmFja3NbaWRdO1xuICAgICAgICBjYWxsYmFjayhudWxsLCBlcnJvcnMpO1xuICAgIH0pO1xuXG4gICAgd29ya2VyUHJveHkub24oRVZFTlRfTkFNRV9DT01QTEVUSU9OUywgZnVuY3Rpb24ocmVzcG9uc2U6IHsgZGF0YTogeyBlcnI6IGFueTsgY29tcGxldGlvbnM6IGFueVtdOyBjYWxsYmFja0lkOiBudW1iZXIgfSB9KSB7XG4gICAgICAgIC8vIFRPRE86IFN0YW5kYXJkaXplIGFuZCBpbnRyb2R1Y2UgYXNzZXJ0aW9ucyBhbmQgbG9nZ2luZy5cbiAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICB2YXIgaWQ6IG51bWJlciA9IGRhdGEuY2FsbGJhY2tJZDtcbiAgICAgICAgdmFyIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzPykgPT4gdm9pZCA9IGNhbGxiYWNrc1tpZF07XG4gICAgICAgIGRlbGV0ZSBjYWxsYmFja3NbaWRdO1xuICAgICAgICBpZiAoJ2VycicgaW4gZGF0YSkge1xuXG4gICAgICAgICAgICBjYWxsYmFjayhkYXRhLmVycik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhLmNvbXBsZXRpb25zKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgd29ya2VyUHJveHkub24oXCJ0eXBlQXREb2N1bWVudFBvc2l0aW9uXCIsIGZ1bmN0aW9uKHJlc3BvbnNlOiB7IGRhdGE6IHsgZXJyOiBzdHJpbmc7IHJlc3VsdHM6IHsgZGVzY3JpcHRpb246IHN0cmluZzsgZG9jQ29tbWVudDogc3RyaW5nIH07IGNhbGxiYWNrSWQ6IG51bWJlciB9IH0pIHtcbiAgICAgICAgZG9DYWxsYmFjayhyZXNwb25zZS5kYXRhKTtcbiAgICB9KTtcblxuICAgIHdvcmtlclByb3h5Lm9uKFwib3V0cHV0RmlsZXNcIiwgZnVuY3Rpb24ocmVzcG9uc2U6IHsgZGF0YTogeyBlcnI6IHN0cmluZzsgcmVzdWx0czogYW55OyBjYWxsYmFja0lkOiBudW1iZXIgfSB9KSB7XG4gICAgICAgIGRvQ2FsbGJhY2socmVzcG9uc2UuZGF0YSk7XG4gICAgfSk7XG5cbiAgICAvLyBGSVhNRTogUHJvYmFibHkgc2hvdWxkIGJlIHVwcGVyY2FzZSwgYW5kIHVzZSBkZWZhdWx0IGV4cG9ydC5cbiAgICB3b3JrZXJQcm94eS5pbml0KCdhY2Uvd29ya3NwYWNlL3dvcmtzcGFjZV93b3JrZXInLCAnV29ya3NwYWNlV29ya2VyJyk7XG5cbiAgICBmdW5jdGlvbiBkb0NhbGxiYWNrKGRhdGE6IHsgZXJyOiBzdHJpbmc7IHJlc3VsdHM6IGFueTsgY2FsbGJhY2tJZDogbnVtYmVyIH0pIHtcbiAgICAgICAgdmFyIGluZm8gPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgIHZhciBpZDogbnVtYmVyID0gZGF0YS5jYWxsYmFja0lkO1xuICAgICAgICB2YXIgY2FsbGJhY2s6IChlcnIsIHJlc3VsdHM/KSA9PiB2b2lkID0gY2FsbGJhY2tzW2lkXTtcbiAgICAgICAgZGVsZXRlIGNhbGxiYWNrc1tpZF07XG4gICAgICAgIGlmIChkYXRhLmVycikge1xuICAgICAgICAgICAgY2FsbGJhY2soZGF0YS5lcnIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVuc3VyZVNjcmlwdChmaWxlTmFtZTogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpIHtcbiAgICAgICAgdmFyIG1lc3NhZ2UgPVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGRhdGE6IHsgJ2ZpbGVOYW1lJzogZmlsZU5hbWUsICdjb250ZW50JzogY29udGVudC5yZXBsYWNlKC9cXHJcXG4/L2csICdcXG4nKSB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB3b3JrZXJQcm94eS5lbWl0KFwiZW5zdXJlU2NyaXB0XCIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVkaXRTY3JpcHQoZmlsZU5hbWU6IHN0cmluZywgc3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXIsIHRleHQ6IHN0cmluZykge1xuICAgICAgICB2YXIgbWVzc2FnZSA9XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZGF0YTogeyBmaWxlTmFtZTogZmlsZU5hbWUsIHN0YXJ0OiBzdGFydCwgZW5kOiBlbmQsIHRleHQ6IHRleHQgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcImVkaXRTY3JpcHRcIiwgbWVzc2FnZSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVtb3ZlU2NyaXB0KGZpbGVOYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcInJlbW92ZVNjcmlwdFwiLCB7IGRhdGE6IHsgJ2ZpbGVOYW1lJzogZmlsZU5hbWUgfSB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRGaWxlTmFtZXMoY2FsbGJhY2spOiB2b2lkIHtcbiAgICAgICAgdmFyIGlkID0gY2FsbGJhY2tJZCsrO1xuICAgICAgICBjYWxsYmFja3NbaWRdID0gY2FsbGJhY2s7XG4gICAgICAgIHZhciBtZXNzYWdlID0geyBkYXRhOiB7IGNhbGxiYWNrSWQ6IGlkIH0gfTtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcImdldEZpbGVOYW1lc1wiLCBtZXNzYWdlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRTeW50YXhFcnJvcnMoZmlsZU5hbWU6IHN0cmluZywgY2FsbGJhY2s6IChlcnIsIHJlc3VsdHMpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgdmFyIGlkID0gY2FsbGJhY2tJZCsrO1xuICAgICAgICBjYWxsYmFja3NbaWRdID0gY2FsbGJhY2s7XG4gICAgICAgIHZhciBtZXNzYWdlID0geyBkYXRhOiB7IGZpbGVOYW1lOiBmaWxlTmFtZSwgY2FsbGJhY2tJZDogaWQgfSB9O1xuICAgICAgICB3b3JrZXJQcm94eS5lbWl0KFwiZ2V0U3ludGF4RXJyb3JzXCIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFNlbWFudGljRXJyb3JzKGZpbGVOYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgICAgIHZhciBpZCA9IGNhbGxiYWNrSWQrKztcbiAgICAgICAgY2FsbGJhY2tzW2lkXSA9IGNhbGxiYWNrO1xuICAgICAgICB2YXIgbWVzc2FnZSA9IHsgZGF0YTogeyBmaWxlTmFtZTogZmlsZU5hbWUsIGNhbGxiYWNrSWQ6IGlkIH0gfTtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcImdldFNlbWFudGljRXJyb3JzXCIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldENvbXBsZXRpb25zQXRQb3NpdGlvbihmaWxlTmFtZTogc3RyaW5nLCBwb3NpdGlvbjogbnVtYmVyLCBtZW1iZXJNb2RlOiBib29sZWFuLCBjYWxsYmFjazogKGVyciwgcmVzdWx0cykgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICB2YXIgaWQgPSBjYWxsYmFja0lkKys7XG4gICAgICAgIGNhbGxiYWNrc1tpZF0gPSBjYWxsYmFjaztcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSB7IGRhdGE6IHsgZmlsZU5hbWU6IGZpbGVOYW1lLCBwb3NpdGlvbjogcG9zaXRpb24sIG1lbWJlck1vZGU6IG1lbWJlck1vZGUsIGNhbGxiYWNrSWQ6IGlkIH0gfTtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcImdldENvbXBsZXRpb25zQXRQb3NpdGlvblwiLCBtZXNzYWdlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRUeXBlQXREb2N1bWVudFBvc2l0aW9uKGZpbGVOYW1lOiBzdHJpbmcsIGRvY3VtZW50UG9zaXRpb246IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0sIGNhbGxiYWNrOiAoZXJyLCB0eXBlSW5mbzogdHMuVHlwZSkgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICB2YXIgaWQgPSBjYWxsYmFja0lkKys7XG4gICAgICAgIGNhbGxiYWNrc1tpZF0gPSBjYWxsYmFjaztcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSB7IGRhdGE6IHsgZmlsZU5hbWU6IGZpbGVOYW1lLCBkb2N1bWVudFBvc2l0aW9uOiBkb2N1bWVudFBvc2l0aW9uLCBjYWxsYmFja0lkOiBpZCB9IH07XG4gICAgICAgIHdvcmtlclByb3h5LmVtaXQoXCJnZXRUeXBlQXREb2N1bWVudFBvc2l0aW9uXCIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldE91dHB1dEZpbGVzKGZpbGVOYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgICAgIHZhciBpZCA9IGNhbGxiYWNrSWQrKztcbiAgICAgICAgY2FsbGJhY2tzW2lkXSA9IGNhbGxiYWNrO1xuICAgICAgICB2YXIgbWVzc2FnZSA9IHsgZGF0YTogeyBmaWxlTmFtZTogZmlsZU5hbWUsIGNhbGxiYWNrSWQ6IGlkIH0gfTtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcImdldE91dHB1dEZpbGVzXCIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIHZhciB0aGF0OiBXb3Jrc3BhY2UgPSB7XG4gICAgICAgIGVuc3VyZVNjcmlwdDogZW5zdXJlU2NyaXB0LFxuICAgICAgICBlZGl0U2NyaXB0OiBlZGl0U2NyaXB0LFxuICAgICAgICByZW1vdmVTY3JpcHQ6IHJlbW92ZVNjcmlwdCxcbiAgICAgICAgZ2V0RmlsZU5hbWVzOiBnZXRGaWxlTmFtZXMsXG4gICAgICAgIGdldFN5bnRheEVycm9yczogZ2V0U3ludGF4RXJyb3JzLFxuICAgICAgICBnZXRTZW1hbnRpY0Vycm9yczogZ2V0U2VtYW50aWNFcnJvcnMsXG4gICAgICAgIGdldENvbXBsZXRpb25zQXRQb3NpdGlvbjogZ2V0Q29tcGxldGlvbnNBdFBvc2l0aW9uLFxuICAgICAgICBnZXRUeXBlQXREb2N1bWVudFBvc2l0aW9uOiBnZXRUeXBlQXREb2N1bWVudFBvc2l0aW9uLFxuICAgICAgICBnZXRPdXRwdXRGaWxlczogZ2V0T3V0cHV0RmlsZXNcbiAgICB9O1xuICAgIHJldHVybiB0aGF0O1xufTtcbiJdfQ==