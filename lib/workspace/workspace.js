import WorkerClient from '../worker/WorkerClient';
import { EVENT_NAME_COMPLETIONS } from './workspace_protocol';
export var workspace = function () {
    var workerProxy = new WorkerClient(['ace'], 'ace/workspace/workspace_worker', 'WorkspaceWorker');
    var callbacks = {};
    var callbackId = 1;
    workerProxy.on("initAfter", function (event) {
    });
    workerProxy.on("fileNames", function (response) {
        var data = response.data;
        var names = data.names;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        callback(null, names);
    });
    workerProxy.on("syntaxErrors", function (response) {
        var data = response.data;
        var errors = data.errors;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        callback(null, errors);
    });
    workerProxy.on("semanticErrors", function (response) {
        var data = response.data;
        var errors = data.errors;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        callback(null, errors);
    });
    workerProxy.on(EVENT_NAME_COMPLETIONS, function (response) {
        var data = response.data;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        if ('err' in data) {
            callback(data.err);
        }
        else {
            callback(null, data.completions);
        }
    });
    workerProxy.on("typeAtDocumentPosition", function (response) {
        doCallback(response.data);
    });
    workerProxy.on("outputFiles", function (response) {
        doCallback(response.data);
    });
    function doCallback(data) {
        var info = data.results;
        var id = data.callbackId;
        var callback = callbacks[id];
        delete callbacks[id];
        if (data.err) {
            callback(data.err);
        }
        else {
            callback(null, data.results);
        }
    }
    function ensureScript(fileName, content) {
        var message = {
            data: { 'fileName': fileName, 'content': content.replace(/\r\n?/g, '\n') }
        };
        workerProxy.emit("ensureScript", message);
    }
    function editScript(fileName, start, end, text) {
        var message = {
            data: { fileName: fileName, start: start, end: end, text: text }
        };
        workerProxy.emit("editScript", message);
    }
    function removeScript(fileName) {
        workerProxy.emit("removeScript", { data: { 'fileName': fileName } });
    }
    function getFileNames(callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { callbackId: id } };
        workerProxy.emit("getFileNames", message);
    }
    function getSyntaxErrors(fileName, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, callbackId: id } };
        workerProxy.emit("getSyntaxErrors", message);
    }
    function getSemanticErrors(fileName, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, callbackId: id } };
        workerProxy.emit("getSemanticErrors", message);
    }
    function getCompletionsAtPosition(fileName, position, memberMode, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, position: position, memberMode: memberMode, callbackId: id } };
        workerProxy.emit("getCompletionsAtPosition", message);
    }
    function getTypeAtDocumentPosition(fileName, documentPosition, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, documentPosition: documentPosition, callbackId: id } };
        workerProxy.emit("getTypeAtDocumentPosition", message);
    }
    function getOutputFiles(fileName, callback) {
        var id = callbackId++;
        callbacks[id] = callback;
        var message = { data: { fileName: fileName, callbackId: id } };
        workerProxy.emit("getOutputFiles", message);
    }
    var that = {
        ensureScript: ensureScript,
        editScript: editScript,
        removeScript: removeScript,
        getFileNames: getFileNames,
        getSyntaxErrors: getSyntaxErrors,
        getSemanticErrors: getSemanticErrors,
        getCompletionsAtPosition: getCompletionsAtPosition,
        getTypeAtDocumentPosition: getTypeAtDocumentPosition,
        getOutputFiles: getOutputFiles
    };
    return that;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya3NwYWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3dvcmtzcGFjZS93b3Jrc3BhY2UudHMiXSwibmFtZXMiOlsiZG9DYWxsYmFjayIsImVuc3VyZVNjcmlwdCIsImVkaXRTY3JpcHQiLCJyZW1vdmVTY3JpcHQiLCJnZXRGaWxlTmFtZXMiLCJnZXRTeW50YXhFcnJvcnMiLCJnZXRTZW1hbnRpY0Vycm9ycyIsImdldENvbXBsZXRpb25zQXRQb3NpdGlvbiIsImdldFR5cGVBdERvY3VtZW50UG9zaXRpb24iLCJnZXRPdXRwdXRGaWxlcyJdLCJtYXBwaW5ncyI6Ik9BQU8sWUFBWSxNQUFNLHdCQUF3QjtPQUMxQyxFQUFDLHNCQUFzQixFQUFDLE1BQU0sc0JBQXNCO0FBNEQzRCxXQUFXLFNBQVMsR0FBRztJQUduQixJQUFJLFdBQVcsR0FBRyxJQUFJLFlBQVksQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLGdDQUFnQyxFQUFFLGlCQUFpQixDQUFDLENBQUM7SUFDakcsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBQ25CLElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQztJQUVuQixXQUFXLENBQUMsRUFBRSxDQUFDLFdBQVcsRUFBRSxVQUFTLEtBQUs7SUFHMUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxXQUFXLENBQUMsRUFBRSxDQUFDLFdBQVcsRUFBRSxVQUFTLFFBQTJEO1FBQzVGLElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUM7UUFDekIsSUFBSSxLQUFLLEdBQWEsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNqQyxJQUFJLEVBQUUsR0FBVyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ2pDLElBQUksUUFBUSxHQUEyQixTQUFTLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDckQsT0FBTyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDckIsUUFBUSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztJQUMxQixDQUFDLENB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QUNwRCxjQUFjLEVBQUUsY0FBYztLQUNqQyxDQUFDO0lBQ0YsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNoQixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgV29ya2VyQ2xpZW50IGZyb20gJy4uL3dvcmtlci9Xb3JrZXJDbGllbnQnO1xuaW1wb3J0IHtFVkVOVF9OQU1FX0NPTVBMRVRJT05TfSBmcm9tICcuL3dvcmtzcGFjZV9wcm90b2NvbCc7XG4vKipcbiAqIEEgd29ya3NwYWNlIGlzIGEgY29sbGVjdGlvbiBvZiBzb3VyY2UgZmlsZXMgaWRlbnRpZmllZCBieSBuYW1lLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFdvcmtzcGFjZSB7XG5cbiAgICAvKipcbiAgICAgKiBJbnNlcnQgb3IgdXBkYXRlIGEgc2NyaXB0LlxuICAgICAqIFRoaXMgaXMgdHlwaWNhbGx5IGNhbGxlZCBieSB0aGUgZWRpdGluZyBhcHBsaWNhdGlvbi5cbiAgICAgKi9cbiAgICBlbnN1cmVTY3JpcHQoZmlsZU5hbWU6IHN0cmluZywgY29udGVudDogc3RyaW5nKTogdm9pZDtcblxuICAgIC8qKlxuICAgICAqIE5vdGlmeSB0aGUgd29ya3NwYWNlIG9mIGFuIGVkaXQgdG8gYSBzY3JpcHQuXG4gICAgICovXG4gICAgZWRpdFNjcmlwdChmaWxlTmFtZTogc3RyaW5nLCBtaW5DaGFyOiBudW1iZXIsIGxpbUNoYXI6IG51bWJlciwgbmV3VGV4dDogc3RyaW5nKTogdm9pZDtcblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhIHNjcmlwdC5cbiAgICAgKiBUaGlzIGlzIHR5cGljYWxseSBjYWxsZWQgYnkgdGhlIGVkaXRpbmcgYXBwbGljYXRpb24uXG4gICAgICovXG4gICAgcmVtb3ZlU2NyaXB0KGZpbGVOYW1lOiBzdHJpbmcpOiB2b2lkO1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBnZXRGaWxlTmFtZXMoY2FsbGJhY2spOiB2b2lkO1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBnZXRTeW50YXhFcnJvcnMoZmlsZU5hbWU6IHN0cmluZywgY2FsbGJhY2s6IChlcnIsIHJlc3VsdHMpID0+IHZvaWQpOiB2b2lkO1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBnZXRTZW1hbnRpY0Vycm9ycyhmaWxlTmFtZTogc3RyaW5nLCBjYWxsYmFjazogKGVyciwgcmVzdWx0cykgPT4gdm9pZCk6IHZvaWQ7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGdldENvbXBsZXRpb25zQXRQb3NpdGlvbihmaWxlTmFtZTogc3RyaW5nLCBwb3NpdGlvbjogbnVtYmVyLCBtZW1iZXJNb2RlOiBib29sZWFuLCBjYWxsYmFjazogKGVyciwgcmVzdWx0cykgPT4gdm9pZCk6IHZvaWQ7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGdldFR5cGVBdERvY3VtZW50UG9zaXRpb24oZmlsZU5hbWU6IHN0cmluZywgZG9jdW1lbnRQb3NpdGlvbjogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfSwgY2FsbGJhY2s6IChlcnIsIHR5cGVJbmZvOiB0cy5UeXBlKSA9PiB2b2lkKTogdm9pZDtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgZ2V0T3V0cHV0RmlsZXMoZmlsZU5hbWU6IHN0cmluZywgY2FsbGJhY2s6IChlcnIsIHJlc3VsdHMpID0+IHZvaWQpOiB2b2lkO1xufVxuXG4vKipcbiAqIEByZXR1cm4gYSB3b3Jrc3BhY2UgaW5zdGFuY2UuXG4gKiBcbiAqIFRoaXMgaXMgYSBmdW5jdGlvbmFsIGNvbnN0cnVjdG9yOyBkbyBub3QgdXNlIHRoZSAnbmV3JyBvcGVyYXRvciB0byBjYWxsIGl0LlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIG5vdCB1c2UgJ3RoaXMnIGluIHRoZSBjb2RlIGJlbG93LlxuICovXG5leHBvcnQgdmFyIHdvcmtzcGFjZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgLy8gTi5CLiBUaGUgbW9kIHBhcmFtZXRlciBtdXN0IGJlIGFic29sdXRlIGluIG9yZGVyIHRvIHdvcmsgd2hlbiByZXF1aXJlanMgaXMgdXNpbmcgaW5kaXZpZHVhbCBmaWxlcy5cbiAgICB2YXIgd29ya2VyUHJveHkgPSBuZXcgV29ya2VyQ2xpZW50KFsnYWNlJ10sICdhY2Uvd29ya3NwYWNlL3dvcmtzcGFjZV93b3JrZXInLCAnV29ya3NwYWNlV29ya2VyJyk7XG4gICAgdmFyIGNhbGxiYWNrcyA9IHt9O1xuICAgIHZhciBjYWxsYmFja0lkID0gMTtcblxuICAgIHdvcmtlclByb3h5Lm9uKFwiaW5pdEFmdGVyXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIC8vIE5vdCB1c2luZyB0aGlzIGNhcGFiaWxpdHkgcmlnaHQgbm93LlxuICAgICAgICAvLyBXb3Jrc3BhY2VXb3JrZXIgc2VuZHMgdGhpcyBub3RpZmljYXRpb24gdGhhdCBjb25zdHJ1Y3RvciBmaW5pc2hlZC5cbiAgICB9KTtcblxuICAgIHdvcmtlclByb3h5Lm9uKFwiZmlsZU5hbWVzXCIsIGZ1bmN0aW9uKHJlc3BvbnNlOiB7IGRhdGE6IHsgbmFtZXM6IHN0cmluZ1tdOyBjYWxsYmFja0lkOiBudW1iZXIgfSB9KSB7XG4gICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgdmFyIG5hbWVzOiBzdHJpbmdbXSA9IGRhdGEubmFtZXM7XG4gICAgICAgIHZhciBpZDogbnVtYmVyID0gZGF0YS5jYWxsYmFja0lkO1xuICAgICAgICB2YXIgY2FsbGJhY2s6IChlcnIsIHJlc3VsdHMpID0+IHZvaWQgPSBjYWxsYmFja3NbaWRdO1xuICAgICAgICBkZWxldGUgY2FsbGJhY2tzW2lkXTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgbmFtZXMpO1xuICAgIH0pO1xuXG4gICAgd29ya2VyUHJveHkub24oXCJzeW50YXhFcnJvcnNcIiwgZnVuY3Rpb24ocmVzcG9uc2U6IHsgZGF0YTogeyBlcnJvcnM6IGFueVtdOyBjYWxsYmFja0lkOiBudW1iZXIgfSB9KSB7XG4gICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgdmFyIGVycm9ycyA9IGRhdGEuZXJyb3JzO1xuICAgICAgICB2YXIgaWQ6IG51bWJlciA9IGRhdGEuY2FsbGJhY2tJZDtcbiAgICAgICAgdmFyIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzKSA9PiB2b2lkID0gY2FsbGJhY2tzW2lkXTtcbiAgICAgICAgZGVsZXRlIGNhbGxiYWNrc1tpZF07XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIGVycm9ycyk7XG4gICAgfSk7XG5cbiAgICB3b3JrZXJQcm94eS5vbihcInNlbWFudGljRXJyb3JzXCIsIGZ1bmN0aW9uKHJlc3BvbnNlOiB7IGRhdGE6IHsgZXJyb3JzOiBhbnlbXTsgY2FsbGJhY2tJZDogbnVtYmVyIH0gfSkge1xuICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIHZhciBlcnJvcnMgPSBkYXRhLmVycm9ycztcbiAgICAgICAgdmFyIGlkOiBudW1iZXIgPSBkYXRhLmNhbGxiYWNrSWQ7XG4gICAgICAgIHZhciBjYWxsYmFjazogKGVyciwgcmVzdWx0cykgPT4gdm9pZCA9IGNhbGxiYWNrc1tpZF07XG4gICAgICAgIGRlbGV0ZSBjYWxsYmFja3NbaWRdO1xuICAgICAgICBjYWxsYmFjayhudWxsLCBlcnJvcnMpO1xuICAgIH0pO1xuXG4gICAgd29ya2VyUHJveHkub24oRVZFTlRfTkFNRV9DT01QTEVUSU9OUywgZnVuY3Rpb24ocmVzcG9uc2U6IHsgZGF0YTogeyBlcnI6IGFueTsgY29tcGxldGlvbnM6IGFueVtdOyBjYWxsYmFja0lkOiBudW1iZXIgfSB9KSB7XG4gICAgICAgIC8vIFRPRE86IFN0YW5kYXJkaXplIGFuZCBpbnRyb2R1Y2UgYXNzZXJ0aW9ucyBhbmQgbG9nZ2luZy5cbiAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICB2YXIgaWQ6IG51bWJlciA9IGRhdGEuY2FsbGJhY2tJZDtcbiAgICAgICAgdmFyIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzPykgPT4gdm9pZCA9IGNhbGxiYWNrc1tpZF07XG4gICAgICAgIGRlbGV0ZSBjYWxsYmFja3NbaWRdO1xuICAgICAgICBpZiAoJ2VycicgaW4gZGF0YSkge1xuXG4gICAgICAgICAgICBjYWxsYmFjayhkYXRhLmVycik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhLmNvbXBsZXRpb25zKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgd29ya2VyUHJveHkub24oXCJ0eXBlQXREb2N1bWVudFBvc2l0aW9uXCIsIGZ1bmN0aW9uKHJlc3BvbnNlOiB7IGRhdGE6IHsgZXJyOiBzdHJpbmc7IHJlc3VsdHM6IHsgZGVzY3JpcHRpb246IHN0cmluZzsgZG9jQ29tbWVudDogc3RyaW5nIH07IGNhbGxiYWNrSWQ6IG51bWJlciB9IH0pIHtcbiAgICAgICAgZG9DYWxsYmFjayhyZXNwb25zZS5kYXRhKTtcbiAgICB9KTtcblxuICAgIHdvcmtlclByb3h5Lm9uKFwib3V0cHV0RmlsZXNcIiwgZnVuY3Rpb24ocmVzcG9uc2U6IHsgZGF0YTogeyBlcnI6IHN0cmluZzsgcmVzdWx0czogYW55OyBjYWxsYmFja0lkOiBudW1iZXIgfSB9KSB7XG4gICAgICAgIGRvQ2FsbGJhY2socmVzcG9uc2UuZGF0YSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBkb0NhbGxiYWNrKGRhdGE6IHsgZXJyOiBzdHJpbmc7IHJlc3VsdHM6IGFueTsgY2FsbGJhY2tJZDogbnVtYmVyIH0pIHtcbiAgICAgICAgdmFyIGluZm8gPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgIHZhciBpZDogbnVtYmVyID0gZGF0YS5jYWxsYmFja0lkO1xuICAgICAgICB2YXIgY2FsbGJhY2s6IChlcnIsIHJlc3VsdHM/KSA9PiB2b2lkID0gY2FsbGJhY2tzW2lkXTtcbiAgICAgICAgZGVsZXRlIGNhbGxiYWNrc1tpZF07XG4gICAgICAgIGlmIChkYXRhLmVycikge1xuICAgICAgICAgICAgY2FsbGJhY2soZGF0YS5lcnIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVuc3VyZVNjcmlwdChmaWxlTmFtZTogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpIHtcbiAgICAgICAgdmFyIG1lc3NhZ2UgPVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGRhdGE6IHsgJ2ZpbGVOYW1lJzogZmlsZU5hbWUsICdjb250ZW50JzogY29udGVudC5yZXBsYWNlKC9cXHJcXG4/L2csICdcXG4nKSB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB3b3JrZXJQcm94eS5lbWl0KFwiZW5zdXJlU2NyaXB0XCIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVkaXRTY3JpcHQoZmlsZU5hbWU6IHN0cmluZywgc3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXIsIHRleHQ6IHN0cmluZykge1xuICAgICAgICB2YXIgbWVzc2FnZSA9XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZGF0YTogeyBmaWxlTmFtZTogZmlsZU5hbWUsIHN0YXJ0OiBzdGFydCwgZW5kOiBlbmQsIHRleHQ6IHRleHQgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcImVkaXRTY3JpcHRcIiwgbWVzc2FnZSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVtb3ZlU2NyaXB0KGZpbGVOYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcInJlbW92ZVNjcmlwdFwiLCB7IGRhdGE6IHsgJ2ZpbGVOYW1lJzogZmlsZU5hbWUgfSB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRGaWxlTmFtZXMoY2FsbGJhY2spOiB2b2lkIHtcbiAgICAgICAgdmFyIGlkID0gY2FsbGJhY2tJZCsrO1xuICAgICAgICBjYWxsYmFja3NbaWRdID0gY2FsbGJhY2s7XG4gICAgICAgIHZhciBtZXNzYWdlID0geyBkYXRhOiB7IGNhbGxiYWNrSWQ6IGlkIH0gfTtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcImdldEZpbGVOYW1lc1wiLCBtZXNzYWdlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRTeW50YXhFcnJvcnMoZmlsZU5hbWU6IHN0cmluZywgY2FsbGJhY2s6IChlcnIsIHJlc3VsdHMpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgdmFyIGlkID0gY2FsbGJhY2tJZCsrO1xuICAgICAgICBjYWxsYmFja3NbaWRdID0gY2FsbGJhY2s7XG4gICAgICAgIHZhciBtZXNzYWdlID0geyBkYXRhOiB7IGZpbGVOYW1lOiBmaWxlTmFtZSwgY2FsbGJhY2tJZDogaWQgfSB9O1xuICAgICAgICB3b3JrZXJQcm94eS5lbWl0KFwiZ2V0U3ludGF4RXJyb3JzXCIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFNlbWFudGljRXJyb3JzKGZpbGVOYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgICAgIHZhciBpZCA9IGNhbGxiYWNrSWQrKztcbiAgICAgICAgY2FsbGJhY2tzW2lkXSA9IGNhbGxiYWNrO1xuICAgICAgICB2YXIgbWVzc2FnZSA9IHsgZGF0YTogeyBmaWxlTmFtZTogZmlsZU5hbWUsIGNhbGxiYWNrSWQ6IGlkIH0gfTtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcImdldFNlbWFudGljRXJyb3JzXCIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldENvbXBsZXRpb25zQXRQb3NpdGlvbihmaWxlTmFtZTogc3RyaW5nLCBwb3NpdGlvbjogbnVtYmVyLCBtZW1iZXJNb2RlOiBib29sZWFuLCBjYWxsYmFjazogKGVyciwgcmVzdWx0cykgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICB2YXIgaWQgPSBjYWxsYmFja0lkKys7XG4gICAgICAgIGNhbGxiYWNrc1tpZF0gPSBjYWxsYmFjaztcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSB7IGRhdGE6IHsgZmlsZU5hbWU6IGZpbGVOYW1lLCBwb3NpdGlvbjogcG9zaXRpb24sIG1lbWJlck1vZGU6IG1lbWJlck1vZGUsIGNhbGxiYWNrSWQ6IGlkIH0gfTtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcImdldENvbXBsZXRpb25zQXRQb3NpdGlvblwiLCBtZXNzYWdlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRUeXBlQXREb2N1bWVudFBvc2l0aW9uKGZpbGVOYW1lOiBzdHJpbmcsIGRvY3VtZW50UG9zaXRpb246IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0sIGNhbGxiYWNrOiAoZXJyLCB0eXBlSW5mbzogdHMuVHlwZSkgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICB2YXIgaWQgPSBjYWxsYmFja0lkKys7XG4gICAgICAgIGNhbGxiYWNrc1tpZF0gPSBjYWxsYmFjaztcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSB7IGRhdGE6IHsgZmlsZU5hbWU6IGZpbGVOYW1lLCBkb2N1bWVudFBvc2l0aW9uOiBkb2N1bWVudFBvc2l0aW9uLCBjYWxsYmFja0lkOiBpZCB9IH07XG4gICAgICAgIHdvcmtlclByb3h5LmVtaXQoXCJnZXRUeXBlQXREb2N1bWVudFBvc2l0aW9uXCIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldE91dHB1dEZpbGVzKGZpbGVOYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyLCByZXN1bHRzKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgICAgIHZhciBpZCA9IGNhbGxiYWNrSWQrKztcbiAgICAgICAgY2FsbGJhY2tzW2lkXSA9IGNhbGxiYWNrO1xuICAgICAgICB2YXIgbWVzc2FnZSA9IHsgZGF0YTogeyBmaWxlTmFtZTogZmlsZU5hbWUsIGNhbGxiYWNrSWQ6IGlkIH0gfTtcbiAgICAgICAgd29ya2VyUHJveHkuZW1pdChcImdldE91dHB1dEZpbGVzXCIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIHZhciB0aGF0OiBXb3Jrc3BhY2UgPSB7XG4gICAgICAgIGVuc3VyZVNjcmlwdDogZW5zdXJlU2NyaXB0LFxuICAgICAgICBlZGl0U2NyaXB0OiBlZGl0U2NyaXB0LFxuICAgICAgICByZW1vdmVTY3JpcHQ6IHJlbW92ZVNjcmlwdCxcbiAgICAgICAgZ2V0RmlsZU5hbWVzOiBnZXRGaWxlTmFtZXMsXG4gICAgICAgIGdldFN5bnRheEVycm9yczogZ2V0U3ludGF4RXJyb3JzLFxuICAgICAgICBnZXRTZW1hbnRpY0Vycm9yczogZ2V0U2VtYW50aWNFcnJvcnMsXG4gICAgICAgIGdldENvbXBsZXRpb25zQXRQb3NpdGlvbjogZ2V0Q29tcGxldGlvbnNBdFBvc2l0aW9uLFxuICAgICAgICBnZXRUeXBlQXREb2N1bWVudFBvc2l0aW9uOiBnZXRUeXBlQXREb2N1bWVudFBvc2l0aW9uLFxuICAgICAgICBnZXRPdXRwdXRGaWxlczogZ2V0T3V0cHV0RmlsZXNcbiAgICB9O1xuICAgIHJldHVybiB0aGF0O1xufTtcbiJdfQ==