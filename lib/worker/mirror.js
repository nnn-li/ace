var dcm = require("../document");
var lang = require("../lib/lang");
var Mirror = (function () {
    function Mirror(sender, timeout) {
        this.sender = sender;
        this.$timeout = timeout;
        var doc = this.doc = new dcm.Document("");
        var deferredUpdate = this.deferredUpdate = lang.delayedCall(this.onUpdate.bind(this));
        var _self = this;
        sender.on('change', function (e) {
            doc.applyDeltas(e.data);
            if (_self.$timeout) {
                return deferredUpdate.schedule(_self.$timeout);
            }
            else {
                _self.onUpdate();
            }
        });
    }
    Mirror.prototype.setTimeout = function (timeout) {
        this.$timeout = timeout;
    };
    Mirror.prototype.setValue = function (value) {
        this.doc.setValue(value);
        this.deferredUpdate.schedule(this.$timeout);
    };
    Mirror.prototype.getValue = function (callbackId) {
        this.sender.callback(this.doc.getValue(), callbackId);
    };
    Mirror.prototype.onUpdate = function () {
    };
    Mirror.prototype.isPending = function () {
        return this.deferredUpdate.isPending();
    };
    return Mirror;
})();
exports.Mirror = Mirror;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWlycm9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3dvcmtlci9taXJyb3IudHMiXSwibmFtZXMiOlsiTWlycm9yIiwiTWlycm9yLmNvbnN0cnVjdG9yIiwiTWlycm9yLnNldFRpbWVvdXQiLCJNaXJyb3Iuc2V0VmFsdWUiLCJNaXJyb3IuZ2V0VmFsdWUiLCJNaXJyb3Iub25VcGRhdGUiLCJNaXJyb3IuaXNQZW5kaW5nIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFPLEdBQUcsV0FBVyxhQUFhLENBQUMsQ0FBQztBQUNwQyxJQUFPLElBQUksV0FBVyxhQUFhLENBQUMsQ0FBQztBQUVyQztJQVdJQSxnQkFBWUEsTUFBTUEsRUFBNkJBLE9BQWdCQTtRQUMzREMsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFDckJBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLE9BQU9BLENBQUNBO1FBRXhCQSxJQUFJQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxHQUFHQSxJQUFJQSxHQUFHQSxDQUFDQSxRQUFRQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUUxQ0EsSUFBSUEsY0FBY0EsR0FBR0EsSUFBSUEsQ0FBQ0EsY0FBY0EsR0FBR0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFHdEZBLElBQUlBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO1FBRWpCQSxNQUFNQSxDQUFDQSxFQUFFQSxDQUFDQSxRQUFRQSxFQUFFQSxVQUFTQSxDQUF5SkE7WUFFbEwsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFeEIsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pCLE1BQU0sQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNuRCxDQUFDO1lBQ0QsSUFBSSxDQUFDLENBQUM7Z0JBRUYsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ3JCLENBQUM7UUFDTCxDQUFDLENBQUNBLENBQUNBO0lBQ1BBLENBQUNBO0lBRURELDJCQUFVQSxHQUFWQSxVQUFXQSxPQUFlQTtRQUN0QkUsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsT0FBT0EsQ0FBQ0E7SUFDNUJBLENBQUNBO0lBRURGLHlCQUFRQSxHQUFSQSxVQUFTQSxLQUFhQTtRQUNsQkcsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFDekJBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO0lBQ2hEQSxDQUFDQTtJQUVESCx5QkFBUUEsR0FBUkEsVUFBU0EsVUFBVUE7UUFDZkksSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsUUFBUUEsRUFBRUEsRUFBRUEsVUFBVUEsQ0FBQ0EsQ0FBQ0E7SUFDMURBLENBQUNBO0lBT0RKLHlCQUFRQSxHQUFSQTtJQUVBSyxDQUFDQTtJQUVETCwwQkFBU0EsR0FBVEE7UUFDSU0sTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0E7SUFDM0NBLENBQUNBO0lBQ0xOLGFBQUNBO0FBQURBLENBQUNBLEFBN0RELElBNkRDO0FBN0RZLGNBQU0sU0E2RGxCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZGNtID0gcmVxdWlyZShcIi4uL2RvY3VtZW50XCIpO1xuaW1wb3J0IGxhbmcgPSByZXF1aXJlKFwiLi4vbGliL2xhbmdcIik7XG5cbmV4cG9ydCBjbGFzcyBNaXJyb3Ige1xuICAgIHB1YmxpYyBzZW5kZXIvKkZJWE1FOiBhY2UuV29ya2VyU2VuZGVyKi87XG4gICAgcHVibGljIGRvYzogZGNtLkRvY3VtZW50O1xuICAgIHB1YmxpYyBkZWZlcnJlZFVwZGF0ZTtcbiAgICBwdWJsaWMgJHRpbWVvdXQ6IG51bWJlcjtcbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyB0aGUgJ3NlbmRlcicgcHJvcGVydHkgdG8gdGhlIHNwZWNpZmllZCBhcmd1bWVudC5cbiAgICAgKiBJbml0aWFsaXplcyB0aGUgJ2RvYycgcHJvcGVydHkgdG8gYSBuZXcgRG9jdW1lbnQuXG4gICAgICogSW5pdGlhbGl6ZXMgdGhlICdkZWZlcnJlZFVwZGF0ZScgcHJvcGVydHkgdG8gYSBkZWxheWVkIGNhbGwgdG8gJ29uVXBkYXRlJy5cbiAgICAgKiBCaW5kcyB0aGUgJ3NlbmRlcicgXCJjaGFuZ2VcIiBldmVudCB0byBhIGZ1bmN0aW9uXG4gICAgICovXG4gICAgY29uc3RydWN0b3Ioc2VuZGVyLypGSVhNRTogYWNlLldvcmtlclNlbmRlciovLCB0aW1lb3V0PzogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuc2VuZGVyID0gc2VuZGVyO1xuICAgICAgICB0aGlzLiR0aW1lb3V0ID0gdGltZW91dDtcblxuICAgICAgICB2YXIgZG9jID0gdGhpcy5kb2MgPSBuZXcgZGNtLkRvY3VtZW50KFwiXCIpO1xuXG4gICAgICAgIHZhciBkZWZlcnJlZFVwZGF0ZSA9IHRoaXMuZGVmZXJyZWRVcGRhdGUgPSBsYW5nLmRlbGF5ZWRDYWxsKHRoaXMub25VcGRhdGUuYmluZCh0aGlzKSk7XG5cbiAgICAgICAgLy8gQmluZGluZyBmb3IgdXNlIGluIHRoZSBmb2xsb3dpbmcgY2FsbGJhY2suICAgICAgICBcbiAgICAgICAgdmFyIF9zZWxmID0gdGhpcztcblxuICAgICAgICBzZW5kZXIub24oJ2NoYW5nZScsIGZ1bmN0aW9uKGU6IHsgZGF0YTogeyBhY3Rpb246IHN0cmluZzsgcmFuZ2U6IHsgc3RhcnQ6IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH07IGVuZDogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfSB9OyB0ZXh0OiBzdHJpbmc7IGxpbmVzOiBzdHJpbmdbXSB9W10gfSkge1xuXG4gICAgICAgICAgICBkb2MuYXBwbHlEZWx0YXMoZS5kYXRhKTtcblxuICAgICAgICAgICAgaWYgKF9zZWxmLiR0aW1lb3V0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkVXBkYXRlLnNjaGVkdWxlKF9zZWxmLiR0aW1lb3V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEknbSBub3Qgc3VyZSB0aGF0IHdlIG5lZWQgdG8gc3BlY2lhbC1jYXNlIHRoaXMgY29kZS5cbiAgICAgICAgICAgICAgICBfc2VsZi5vblVwZGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzZXRUaW1lb3V0KHRpbWVvdXQ6IG51bWJlcik6IHZvaWQge1xuICAgICAgICB0aGlzLiR0aW1lb3V0ID0gdGltZW91dDtcbiAgICB9XG5cbiAgICBzZXRWYWx1ZSh2YWx1ZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZG9jLnNldFZhbHVlKHZhbHVlKTtcbiAgICAgICAgdGhpcy5kZWZlcnJlZFVwZGF0ZS5zY2hlZHVsZSh0aGlzLiR0aW1lb3V0KTtcbiAgICB9XG5cbiAgICBnZXRWYWx1ZShjYWxsYmFja0lkKSB7XG4gICAgICAgIHRoaXMuc2VuZGVyLmNhbGxiYWNrKHRoaXMuZG9jLmdldFZhbHVlKCksIGNhbGxiYWNrSWQpO1xuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBDYWxsZWQgYWZ0ZXIgdGhlIHRpbWVvdXQgcGVyaW9kLiBEZXJpdmVkIGNsYXNzZXMgd2lsbCBub3JtYWxseSBwZXJmb3JtXG4gICAgICogYSBjb21wdXRhdGlvbmFsbHkgZXhwZW5zaXZlIGFuYWx5c2lzIHRoZW4gcmVwb3J0IGFubm90YXRpb25zIHRvIHRoZVxuICAgICAqIHNlbmRlci5cbiAgICAgKi9cbiAgICBvblVwZGF0ZSgpIHtcbiAgICAgICAgLy8gYWJzdHJhY3QgbWV0aG9kXG4gICAgfVxuXG4gICAgaXNQZW5kaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kZWZlcnJlZFVwZGF0ZS5pc1BlbmRpbmcoKTtcbiAgICB9XG59XG4iXX0=