import { copyObject } from "./lib/lang";
import { implement } from "./lib/oop";
import { loadScript } from "./lib/net";
import { EventEmitter } from './lib/event_emitter';
var global = (function () {
    return this || typeof window !== 'undefined' && window;
})();
var options = {
    packaged: false,
    workerPath: null,
    modePath: null,
    themePath: null,
    basePath: "",
    suffix: ".js",
    $moduleUrls: {}
};
export function get(key) {
    if (!options.hasOwnProperty(key))
        throw new Error("Unknown config key: " + key);
    return options[key];
}
export function set(key, value) {
    if (!options.hasOwnProperty(key))
        throw new Error("Unknown config key: " + key);
    options[key] = value;
}
export function all() {
    return copyObject(options);
}
implement(exports, EventEmitter);
export function _emit(eventName, e) {
    return EventEmitter._emit(eventName, e);
}
export function _signal(eventName, e) {
    return EventEmitter._signal(eventName, e);
}
export function moduleUrl(name, component) {
    if (options.$moduleUrls[name]) {
        return options.$moduleUrls[name];
    }
    var parts = name.split("/");
    component = component || parts[parts.length - 2] || "";
    var sep = component == "snippets" ? "/" : "-";
    var base = parts[parts.length - 1];
    if (component === 'worker' && sep === '-') {
        var re = new RegExp("^" + component + "[\\-_]|[\\-_]" + component + "$", "g");
        base = base.replace(re, "");
    }
    if ((!base || base == component) && parts.length > 1) {
        base = parts[parts.length - 2];
    }
    var path = options[component + "Path"];
    if (path == null) {
        path = options.basePath;
    }
    else if (sep == "/") {
        component = sep = "";
    }
    if (path && path.slice(-1) != "/") {
        path += "/";
    }
    return path + component + sep + base + this.get("suffix");
}
export function setModuleUrl(name, subst) {
    return options.$moduleUrls[name] = subst;
}
export var $loading = {};
export function loadModule(moduleName, onLoad) {
    var module;
    var moduleType;
    if (Array.isArray(moduleName)) {
        moduleType = moduleName[0];
        moduleName = moduleName[1];
    }
    try {
    }
    catch (e) { }
    if (module && !$loading[moduleName])
        return onLoad && onLoad(module);
    if (!$loading[moduleName]) {
        $loading[moduleName] = [];
    }
    $loading[moduleName].push(onLoad);
    if ($loading[moduleName].length > 1)
        return;
    var afterLoad = function () {
    };
    if (!get("packaged")) {
        return afterLoad();
    }
    loadScript(moduleUrl(moduleName, moduleType), afterLoad);
}
export function init(packaged) {
    options.packaged = packaged || module.packaged;
    if (!global.document)
        return "";
    var scriptOptions = {};
    var scriptUrl = "";
    var currentScript = (document['currentScript'] || document['_currentScript']);
    var currentDocument = currentScript && currentScript.ownerDocument || document;
    var scripts = currentDocument.getElementsByTagName("script");
    for (var i = 0; i < scripts.length; i++) {
        var script = scripts[i];
        var src = script.src || script.getAttribute("src");
        if (!src)
            continue;
        var attributes = script.attributes;
        for (var j = 0, l = attributes.length; j < l; j++) {
            var attr = attributes[j];
            if (attr.name.indexOf("data-ace-") === 0) {
                scriptOptions[deHyphenate(attr.name.replace(/^data-ace-/, ""))] = attr.value;
            }
        }
        var m = src.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);
        if (m) {
            scriptUrl = m[1];
        }
    }
    if (scriptUrl) {
        scriptOptions['base'] = scriptOptions['base'] || scriptUrl;
        scriptOptions['packaged'] = true;
    }
    scriptOptions['basePath'] = scriptOptions['base'];
    scriptOptions['workerPath'] = scriptOptions['workerPath'] || scriptOptions['base'];
    scriptOptions['modePath'] = scriptOptions['modePath'] || scriptOptions['base'];
    scriptOptions['themePath'] = scriptOptions['themePath'] || scriptOptions['base'];
    delete scriptOptions['base'];
    for (var key in scriptOptions)
        if (typeof scriptOptions[key] !== "undefined")
            set(key, scriptOptions[key]);
}
;
function deHyphenate(str) {
    return str.replace(/-(.)/g, function (m, m1) { return m1.toUpperCase(); });
}
var optionsProvider = {
    setOptions: function (optList) {
        Object.keys(optList).forEach(function (key) {
            this.setOption(key, optList[key]);
        }, this);
    },
    getOptions: function (optionNames) {
        var result = {};
        if (!optionNames) {
            optionNames = Object.keys(this.$options);
        }
        else if (!Array.isArray(optionNames)) {
            result = optionNames;
            optionNames = Object.keys(result);
        }
        optionNames.forEach(function (key) {
            result[key] = this.getOption(key);
        }, this);
        return result;
    },
    setOption: function (name, value) {
        if (this["$" + name] === value)
            return;
        var opt = this.$options[name];
        if (!opt) {
            if (typeof console != "undefined" && console.warn)
                console.warn('misspelled option "' + name + '"');
            return undefined;
        }
        if (opt.forwardTo)
            return this[opt.forwardTo] && this[opt.forwardTo].setOption(name, value);
        if (!opt.handlesSet)
            this["$" + name] = value;
        if (opt && opt.set)
            opt.set.call(this, value);
    },
    getOption: function (name) {
        var opt = this.$options[name];
        if (!opt) {
            if (typeof console != "undefined" && console.warn)
                console.warn('misspelled option "' + name + '"');
            return undefined;
        }
        if (opt.forwardTo)
            return this[opt.forwardTo] && this[opt.forwardTo].getOption(name);
        return opt && opt.get ? opt.get.call(this) : this["$" + name];
    }
};
var defaultOptions = {};
export function defineOptions(obj, path, options) {
    if (!obj.$options)
        defaultOptions[path] = obj.$options = {};
    Object.keys(options).forEach(function (key) {
        var opt = options[key];
        if (typeof opt == "string")
            opt = { forwardTo: opt };
        opt.name || (opt.name = key);
        obj.$options[opt.name] = opt;
        if ("initialValue" in opt)
            obj["$" + opt.name] = opt.initialValue;
    });
    implement(obj, optionsProvider);
    return this;
}
export function resetOptions(obj) {
    Object.keys(obj.$options).forEach(function (key) {
        var opt = obj.$options[key];
        if ("value" in opt)
            obj.setOption(key, opt.value);
    });
}
export function setDefaultValue(path, name, value) {
    var opts = defaultOptions[path] || (defaultOptions[path] = {});
    if (opts[name]) {
        if (opts.forwardTo)
            setDefaultValue(opts.forwardTo, name, value);
        else
            opts[name].value = value;
    }
}
export function setDefaultValues(path, optionHash) {
    Object.keys(optionHash).forEach(function (key) {
        setDefaultValue(path, key, optionHash[key]);
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NvbmZpZy50cyJdLCJuYW1lcyI6WyJnZXQiLCJzZXQiLCJhbGwiLCJfZW1pdCIsIl9zaWduYWwiLCJtb2R1bGVVcmwiLCJzZXRNb2R1bGVVcmwiLCJsb2FkTW9kdWxlIiwiaW5pdCIsImRlSHlwaGVuYXRlIiwiZGVmaW5lT3B0aW9ucyIsInJlc2V0T3B0aW9ucyIsInNldERlZmF1bHRWYWx1ZSIsInNldERlZmF1bHRWYWx1ZXMiXSwibWFwcGluZ3MiOiJPQThCTyxFQUFDLFVBQVUsRUFBQyxNQUFNLFlBQVk7T0FDOUIsRUFBQyxTQUFTLEVBQUMsTUFBTSxXQUFXO09BQzVCLEVBQUMsVUFBVSxFQUFDLE1BQU0sV0FBVztPQUM3QixFQUFDLFlBQVksRUFBQyxNQUFNLHFCQUFxQjtBQUVoRCxJQUFJLE1BQU0sR0FBRyxDQUFDO0lBQ1YsTUFBTSxDQUFDLElBQUksSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLElBQUksTUFBTSxDQUFDO0FBQzNELENBQUMsQ0FBQyxFQUFFLENBQUM7QUFHTCxJQUFJLE9BQU8sR0FBRztJQUNWLFFBQVEsRUFBRSxLQUFLO0lBQ2YsVUFBVSxFQUFFLElBQUk7SUFDaEIsUUFBUSxFQUFFLElBQUk7SUFDZCxTQUFTLEVBQUUsSUFBSTtJQUNmLFFBQVEsRUFBRSxFQUFFO0lBQ1osTUFBTSxFQUFFLEtBQUs7SUFDYixXQUFXLEVBQUUsRUFBRTtDQUNsQixDQUFDO0FBRUYsb0JBQW9CLEdBQVc7SUFDM0JBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLGNBQWNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQzdCQSxNQUFNQSxJQUFJQSxLQUFLQSxDQUFDQSxzQkFBc0JBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBO0lBRWxEQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtBQUN4QkEsQ0FBQ0E7QUFFRCxvQkFBb0IsR0FBVyxFQUFFLEtBQUs7SUFDbENDLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLGNBQWNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQzdCQSxNQUFNQSxJQUFJQSxLQUFLQSxDQUFDQSxzQkFBc0JBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBO0lBRWxEQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQTtBQUN6QkEsQ0FBQ0E7QUFFRDtJQUNJQyxNQUFNQSxDQUFDQSxVQUFVQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtBQUMvQkEsQ0FBQ0E7QUFNRCxTQUFTLENBQUMsT0FBTyxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBRWpDLHNCQUFzQixTQUFpQixFQUFFLENBQU87SUFDNUNDLE1BQU1BLENBQUNBLFlBQVlBLENBQUNBLEtBQUtBLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO0FBQzVDQSxDQUFDQTtBQUVELHdCQUF3QixTQUFpQixFQUFFLENBQU87SUFDOUNDLE1BQU1BLENBQUNBLFlBQVlBLENBQUNBLE9BQU9BLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO0FBQzlDQSxDQUFDQTtBQUtELDBCQUEwQixJQUFZLEVBQUUsU0FBaUI7SUFDckRDLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQzVCQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtJQUNyQ0EsQ0FBQ0E7SUFFREEsSUFBSUEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFDNUJBLFNBQVNBLEdBQUdBLFNBQVNBLElBQUlBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBO0lBR3ZEQSxJQUFJQSxHQUFHQSxHQUFXQSxTQUFTQSxJQUFJQSxVQUFVQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtJQUN0REEsSUFBSUEsSUFBSUEsR0FBV0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDM0NBLEVBQUVBLENBQUNBLENBQUNBLFNBQVNBLEtBQUtBLFFBQVFBLElBQUlBLEdBQUdBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBQ3hDQSxJQUFJQSxFQUFFQSxHQUFHQSxJQUFJQSxNQUFNQSxDQUFDQSxHQUFHQSxHQUFHQSxTQUFTQSxHQUFHQSxlQUFlQSxHQUFHQSxTQUFTQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUM5RUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsRUFBRUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7SUFDaENBLENBQUNBO0lBRURBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLElBQUlBLElBQUlBLFNBQVNBLENBQUNBLElBQUlBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ25EQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUNuQ0EsQ0FBQ0E7SUFDREEsSUFBSUEsSUFBSUEsR0FBR0EsT0FBT0EsQ0FBQ0EsU0FBU0EsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7SUFDdkNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1FBQ2ZBLElBQUlBLEdBQUdBLE9BQU9BLENBQUNBLFFBQVFBLENBQUNBO0lBQzVCQSxDQUFDQTtJQUNEQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxD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LElBQUlBLElBQUlBLEdBQUdBLGNBQWNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBO0lBQy9EQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQTtZQUNmQSxlQUFlQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxFQUFFQSxJQUFJQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUNqREEsSUFBSUE7WUFDQUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsR0FBR0EsS0FBS0EsQ0FBQ0E7SUFDakNBLENBQUNBO0FBQ0xBLENBQUNBO0FBRUQsaUNBQWlDLElBQUksRUFBRSxVQUFVO0lBQzdDQyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxVQUFTQSxHQUFHQTtRQUN4QyxlQUFlLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNoRCxDQUFDLENBQUNBLENBQUNBO0FBQ1BBLENBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMCwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIFxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0XG4gKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDpcbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuXG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZVxuICogICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cbiAqICAgICAqIE5laXRoZXIgdGhlIG5hbWUgb2YgQWpheC5vcmcgQi5WLiBub3IgdGhlXG4gKiAgICAgICBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0c1xuICogICAgICAgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXG4gKiBcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiIEFORFxuICogQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRURcbiAqIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkVcbiAqIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIEFKQVguT1JHIEIuVi4gQkUgTElBQkxFIEZPUiBBTllcbiAqIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTXG4gKiAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7XG4gKiBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkRcbiAqIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUXG4gKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJU1xuICogU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG4gKlxuICogKioqKiogRU5EIExJQ0VOU0UgQkxPQ0sgKioqKiogKi9cblxuaW1wb3J0IHtjb3B5T2JqZWN0fSBmcm9tIFwiLi9saWIvbGFuZ1wiO1xuaW1wb3J0IHtpbXBsZW1lbnR9IGZyb20gXCIuL2xpYi9vb3BcIjtcbmltcG9ydCB7bG9hZFNjcmlwdH0gZnJvbSBcIi4vbGliL25ldFwiO1xuaW1wb3J0IHtFdmVudEVtaXR0ZXJ9IGZyb20gJy4vbGliL2V2ZW50X2VtaXR0ZXInO1xuXG52YXIgZ2xvYmFsID0gKGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzIHx8IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdztcbn0pKCk7XG5cbi8vIEZJWE1FOiBNYWtlIHRoaXMgdHlwZS1zYWZlLlxudmFyIG9wdGlvbnMgPSB7XG4gICAgcGFja2FnZWQ6IGZhbHNlLFxuICAgIHdvcmtlclBhdGg6IG51bGwsXG4gICAgbW9kZVBhdGg6IG51bGwsXG4gICAgdGhlbWVQYXRoOiBudWxsLFxuICAgIGJhc2VQYXRoOiBcIlwiLFxuICAgIHN1ZmZpeDogXCIuanNcIixcbiAgICAkbW9kdWxlVXJsczoge31cbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXQoa2V5OiBzdHJpbmcpIHtcbiAgICBpZiAoIW9wdGlvbnMuaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5rbm93biBjb25maWcga2V5OiBcIiArIGtleSk7XG5cbiAgICByZXR1cm4gb3B0aW9uc1trZXldO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0KGtleTogc3RyaW5nLCB2YWx1ZSkge1xuICAgIGlmICghb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIGNvbmZpZyBrZXk6IFwiICsga2V5KTtcblxuICAgIG9wdGlvbnNba2V5XSA9IHZhbHVlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWxsKCkge1xuICAgIHJldHVybiBjb3B5T2JqZWN0KG9wdGlvbnMpO1xufVxuXG4vLyBtb2R1bGUgbG9hZGluZ1xuLy8gRklYTUU6IFRoaXMgaXMgYSBsYXp5IHdheSBvZiB0cmFuc2ZlcnJpbmcgZnVuY3Rpb25zIGZyb20gRXZlbnRFbWl0dGVyIHRvIGNvbmZpZy5cbi8vIEl0IGJyZWFrcyBUeXBlU2NyaXB0IGFuYWx5c2lzLiBVc2UgdGhlIGV4cGxpY2l0IGFwcHJvYWNoIGFzIGJlbG93LCBhcyBuZWVkZWQuXG5kZWNsYXJlIHZhciBleHBvcnRzOiBhbnk7XG5pbXBsZW1lbnQoZXhwb3J0cywgRXZlbnRFbWl0dGVyKTtcblxuZXhwb3J0IGZ1bmN0aW9uIF9lbWl0KGV2ZW50TmFtZTogc3RyaW5nLCBlPzogYW55KSB7XG4gICAgcmV0dXJuIEV2ZW50RW1pdHRlci5fZW1pdChldmVudE5hbWUsIGUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX3NpZ25hbChldmVudE5hbWU6IHN0cmluZywgZT86IGFueSkge1xuICAgIHJldHVybiBFdmVudEVtaXR0ZXIuX3NpZ25hbChldmVudE5hbWUsIGUpO1xufVxuXG4vKipcbiAqXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtb2R1bGVVcmwobmFtZTogc3RyaW5nLCBjb21wb25lbnQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKG9wdGlvbnMuJG1vZHVsZVVybHNbbmFtZV0pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuJG1vZHVsZVVybHNbbmFtZV07XG4gICAgfVxuXG4gICAgdmFyIHBhcnRzID0gbmFtZS5zcGxpdChcIi9cIik7XG4gICAgY29tcG9uZW50ID0gY29tcG9uZW50IHx8IHBhcnRzW3BhcnRzLmxlbmd0aCAtIDJdIHx8IFwiXCI7XG5cbiAgICAvLyB0b2RvIG1ha2UgdGhpcyBjb25maWd1cmFibGUgb3IgZ2V0IHJpZCBvZiAnLSdcbiAgICB2YXIgc2VwOiBzdHJpbmcgPSBjb21wb25lbnQgPT0gXCJzbmlwcGV0c1wiID8gXCIvXCIgOiBcIi1cIjtcbiAgICB2YXIgYmFzZTogc3RyaW5nID0gcGFydHNbcGFydHMubGVuZ3RoIC0gMV07XG4gICAgaWYgKGNvbXBvbmVudCA9PT0gJ3dvcmtlcicgJiYgc2VwID09PSAnLScpIHtcbiAgICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cChcIl5cIiArIGNvbXBvbmVudCArIFwiW1xcXFwtX118W1xcXFwtX11cIiArIGNvbXBvbmVudCArIFwiJFwiLCBcImdcIik7XG4gICAgICAgIGJhc2UgPSBiYXNlLnJlcGxhY2UocmUsIFwiXCIpO1xuICAgIH1cblxuICAgIGlmICgoIWJhc2UgfHwgYmFzZSA9PSBjb21wb25lbnQpICYmIHBhcnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgYmFzZSA9IHBhcnRzW3BhcnRzLmxlbmd0aCAtIDJdO1xuICAgIH1cbiAgICB2YXIgcGF0aCA9IG9wdGlvbnNbY29tcG9uZW50ICsgXCJQYXRoXCJdO1xuICAgIGlmIChwYXRoID09IG51bGwpIHtcbiAgICAgICAgcGF0aCA9IG9wdGlvbnMuYmFzZVBhdGg7XG4gICAgfVxuICAgIGVsc2UgaWYgKHNlcCA9PSBcIi9cIikge1xuICAgICAgICBjb21wb25lbnQgPSBzZXAgPSBcIlwiO1xuICAgIH1cbiAgICBpZiAocGF0aCAmJiBwYXRoLnNsaWNlKC0xKSAhPSBcIi9cIikge1xuICAgICAgICBwYXRoICs9IFwiL1wiO1xuICAgIH1cbiAgICByZXR1cm4gcGF0aCArIGNvbXBvbmVudCArIHNlcCArIGJhc2UgKyB0aGlzLmdldChcInN1ZmZpeFwiKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldE1vZHVsZVVybChuYW1lOiBzdHJpbmcsIHN1YnN0OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gb3B0aW9ucy4kbW9kdWxlVXJsc1tuYW1lXSA9IHN1YnN0O1xufVxuXG4vKipcbiAqIEEgbWFwIGZyb20gbW9kdWxlIG5hbWUgdG8gYW4gYXJyYXkgb2YgY2FsbGJhY2tzLlxuICovXG5leHBvcnQgdmFyICRsb2FkaW5nOiB7IFtuYW1lOiBzdHJpbmddOiAoKG0pID0+IGFueSlbXSB9ID0ge307XG5cbi8vIFRoaXMgaXMgYW4gaW1wb3J0YW50IGZ1bmN0aW9uLlxuLy8gRklYTUUuIEl0IHdvdWxkIGJlIG1vcmUgdHlwZS1zYWZlIGlmIHRoZSBmaXJzdCBhcmd1bWVudCB3aGVyZSBhbiBhcnJheSBvZiBzdHJpbmdzLlxuLy8gV2hhdCBpcyB0aGUgdHlwZSBvZiB0aGUgbW9kdWxlIHJldHVybmVkIGJ5IHRoZSByZXF1aXJlIGZ1bmN0aW9uP1xuZXhwb3J0IGZ1bmN0aW9uIGxvYWRNb2R1bGUobW9kdWxlTmFtZSwgb25Mb2FkOiAobTogYW55KSA9PiBhbnkpIHtcbiAgICB2YXIgbW9kdWxlO1xuICAgIHZhciBtb2R1bGVUeXBlOiBzdHJpbmc7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobW9kdWxlTmFtZSkpIHtcbiAgICAgICAgbW9kdWxlVHlwZSA9IG1vZHVsZU5hbWVbMF07XG4gICAgICAgIG1vZHVsZU5hbWUgPSBtb2R1bGVOYW1lWzFdO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIC8vIEZJWE1FOiBXaGF0IGRvZXMgdGhpcyBkbz9cbiAgICAgICAgLy8gbW9kdWxlID0gcmVxdWlyZShtb2R1bGVOYW1lKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfVxuICAgIC8vIHJlcXVpcmUobW9kdWxlTmFtZSkgY2FuIHJldHVybiBlbXB0eSBvYmplY3QgaWYgY2FsbGVkIGFmdGVyIHJlcXVpcmUoW21vZHVsZU5hbWVdLCBjYWxsYmFjaylcbiAgICBpZiAobW9kdWxlICYmICEkbG9hZGluZ1ttb2R1bGVOYW1lXSlcbiAgICAgICAgcmV0dXJuIG9uTG9hZCAmJiBvbkxvYWQobW9kdWxlKTtcblxuICAgIGlmICghJGxvYWRpbmdbbW9kdWxlTmFtZV0pIHtcbiAgICAgICAgJGxvYWRpbmdbbW9kdWxlTmFtZV0gPSBbXTtcbiAgICB9XG5cbiAgICAkbG9hZGluZ1ttb2R1bGVOYW1lXS5wdXNoKG9uTG9hZCk7XG5cbiAgICBpZiAoJGxvYWRpbmdbbW9kdWxlTmFtZV0ubGVuZ3RoID4gMSlcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgdmFyIGFmdGVyTG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBGSVhNRTogUmUtaW5zdGF0ZVxuICAgICAgICAvKlxuICAgICAgICByZXF1aXJlKFttb2R1bGVOYW1lXSwgZnVuY3Rpb24obW9kdWxlKSB7XG4gICAgICAgICAgICBleHBvcnRzLl9lbWl0KFwibG9hZC5tb2R1bGVcIiwgeyBuYW1lOiBtb2R1bGVOYW1lLCBtb2R1bGU6IG1vZHVsZSB9KTtcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBBIGxvY2FsIGNvcHkgb2YgYWxsIHRoZSBsaXN0ZW5lcnMgd2hvIHdhbnQgdG8gaGVhciB3aGVuIHRoZSBtb2R1bGUgaGFzIGxvYWRlZC5cbiAgICAgICAgICAgIC8vIFdlIG1ha2UgYSBsb2NhbCBjb3B5IGJlY2F1c2Ugd2UgYXJlIGdvaW5nIHRvIGNsZWFyIHRoZSBlbnRyeSBmb3IgdGhlIG1vZHVsZS5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICB2YXIgbGlzdGVuZXJzID0gJGxvYWRpbmdbbW9kdWxlTmFtZV07XG4gICAgICAgICAgICAkbG9hZGluZ1ttb2R1bGVOYW1lXSA9IG51bGw7XG4gICAgICAgICAgICBsaXN0ZW5lcnMuZm9yRWFjaChmdW5jdGlvbihvbkxvYWQpIHtcbiAgICAgICAgICAgICAgICBvbkxvYWQgJiYgb25Mb2FkKG1vZHVsZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgICovXG4gICAgfTtcblxuICAgIC8vIFdoYXQgaXMgdGhpcyBzcGVjaWFsIG5hbWU/XG4gICAgaWYgKCFnZXQoXCJwYWNrYWdlZFwiKSkge1xuICAgICAgICByZXR1cm4gYWZ0ZXJMb2FkKCk7XG4gICAgfVxuXG4gICAgLy8gRGVsZWdhdGUgdGhlIGxvYWRpbmcgb2YgdGhlIHNjcmlwdCBidXQgaG9vayB0aGUgbm90aWZpY2F0aW9uLlxuICAgIGxvYWRTY3JpcHQobW9kdWxlVXJsKG1vZHVsZU5hbWUsIG1vZHVsZVR5cGUpLCBhZnRlckxvYWQpO1xufVxuXG5cbi8vIGluaXRpYWxpemF0aW9uXG5kZWNsYXJlIHZhciBtb2R1bGU6IGFueTtcbi8qKlxuICogV2hvIGNhbGxzIHRoaXMgZnVuY3Rpb24/XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbml0KHBhY2thZ2VkOiBib29sZWFuKSB7XG4gICAgLy8gRklYTUU6IFJlc3RvcmUgcmVxdWlyZSBvZiAncGFja2FnZWQnIGFuZCBkZWZpbmUuXG4gICAgb3B0aW9ucy5wYWNrYWdlZCA9IHBhY2thZ2VkIC8qfHwgcmVxdWlyZVsncGFja2FnZWQnXSovIHx8IG1vZHVsZS5wYWNrYWdlZCAvKnx8IChnbG9iYWwuZGVmaW5lICYmIGRlZmluZVsncGFja2FnZWQnXSkqLztcblxuICAgIGlmICghZ2xvYmFsLmRvY3VtZW50KVxuICAgICAgICByZXR1cm4gXCJcIjtcblxuICAgIHZhciBzY3JpcHRPcHRpb25zOiB7IFtuYW1lOiBzdHJpbmddOiBhbnkgfSA9IHt9O1xuICAgIHZhciBzY3JpcHRVcmwgPSBcIlwiO1xuXG4gICAgLy8gVXNlIGN1cnJlbnRTY3JpcHQub3duZXJEb2N1bWVudCBpbiBjYXNlIHRoaXMgZmlsZSB3YXMgbG9hZGVkIGZyb20gaW1wb3J0ZWQgZG9jdW1lbnQuIChIVE1MIEltcG9ydHMpXG4gICAgdmFyIGN1cnJlbnRTY3JpcHQ6IEhUTUxTY3JpcHRFbGVtZW50ID0gKGRvY3VtZW50WydjdXJyZW50U2NyaXB0J10gfHwgZG9jdW1lbnRbJ19jdXJyZW50U2NyaXB0J10pOyAvLyBuYXRpdmUgb3IgcG9seWZpbGxcbiAgICB2YXIgY3VycmVudERvY3VtZW50ID0gY3VycmVudFNjcmlwdCAmJiBjdXJyZW50U2NyaXB0Lm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQ7XG5cbiAgICB2YXIgc2NyaXB0czogTm9kZUxpc3RPZjxIVE1MU2NyaXB0RWxlbWVudD4gPSBjdXJyZW50RG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzY3JpcHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBzY3JpcHQgPSBzY3JpcHRzW2ldO1xuXG4gICAgICAgIHZhciBzcmMgPSBzY3JpcHQuc3JjIHx8IHNjcmlwdC5nZXRBdHRyaWJ1dGUoXCJzcmNcIik7XG4gICAgICAgIGlmICghc3JjKVxuICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgdmFyIGF0dHJpYnV0ZXM6IE5hbWVkTm9kZU1hcCA9IHNjcmlwdC5hdHRyaWJ1dGVzO1xuICAgICAgICBmb3IgKHZhciBqID0gMCwgbCA9IGF0dHJpYnV0ZXMubGVuZ3RoOyBqIDwgbDsgaisrKSB7XG4gICAgICAgICAgICB2YXIgYXR0cjogQXR0ciA9IGF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICBpZiAoYXR0ci5uYW1lLmluZGV4T2YoXCJkYXRhLWFjZS1cIikgPT09IDApIHtcbiAgICAgICAgICAgICAgICBzY3JpcHRPcHRpb25zW2RlSHlwaGVuYXRlKGF0dHIubmFtZS5yZXBsYWNlKC9eZGF0YS1hY2UtLywgXCJcIikpXSA9IGF0dHIudmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbTogUmVnRXhwTWF0Y2hBcnJheSA9IHNyYy5tYXRjaCgvXiguKilcXC9hY2UoXFwtXFx3Kyk/XFwuanMoXFw/fCQpLyk7XG4gICAgICAgIGlmIChtKSB7XG4gICAgICAgICAgICBzY3JpcHRVcmwgPSBtWzFdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHNjcmlwdFVybCkge1xuICAgICAgICBzY3JpcHRPcHRpb25zWydiYXNlJ10gPSBzY3JpcHRPcHRpb25zWydiYXNlJ10gfHwgc2NyaXB0VXJsO1xuICAgICAgICBzY3JpcHRPcHRpb25zWydwYWNrYWdlZCddID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBzY3JpcHRPcHRpb25zWydiYXNlUGF0aCddID0gc2NyaXB0T3B0aW9uc1snYmFzZSddO1xuICAgIHNjcmlwdE9wdGlvbnNbJ3dvcmtlclBhdGgnXSA9IHNjcmlwdE9wdGlvbnNbJ3dvcmtlclBhdGgnXSB8fCBzY3JpcHRPcHRpb25zWydiYXNlJ107XG4gICAgc2NyaXB0T3B0aW9uc1snbW9kZVBhdGgnXSA9IHNjcmlwdE9wdGlvbnNbJ21vZGVQYXRoJ10gfHwgc2NyaXB0T3B0aW9uc1snYmFzZSddO1xuICAgIHNjcmlwdE9wdGlvbnNbJ3RoZW1lUGF0aCddID0gc2NyaXB0T3B0aW9uc1sndGhlbWVQYXRoJ10gfHwgc2NyaXB0T3B0aW9uc1snYmFzZSddO1xuICAgIGRlbGV0ZSBzY3JpcHRPcHRpb25zWydiYXNlJ107XG5cbiAgICBmb3IgKHZhciBrZXkgaW4gc2NyaXB0T3B0aW9ucylcbiAgICAgICAgaWYgKHR5cGVvZiBzY3JpcHRPcHRpb25zW2tleV0gIT09IFwidW5kZWZpbmVkXCIpXG4gICAgICAgICAgICBzZXQoa2V5LCBzY3JpcHRPcHRpb25zW2tleV0pO1xufTtcblxuZnVuY3Rpb24gZGVIeXBoZW5hdGUoc3RyOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBzdHIucmVwbGFjZSgvLSguKS9nLCBmdW5jdGlvbihtOiBzdHJpbmcsIG0xOiBzdHJpbmcpIHsgcmV0dXJuIG0xLnRvVXBwZXJDYXNlKCk7IH0pO1xufVxuXG52YXIgb3B0aW9uc1Byb3ZpZGVyID0ge1xuICAgIHNldE9wdGlvbnM6IGZ1bmN0aW9uKG9wdExpc3QpIHtcbiAgICAgICAgT2JqZWN0LmtleXMob3B0TGlzdCkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0T3B0aW9uKGtleSwgb3B0TGlzdFtrZXldKTtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfSxcbiAgICBnZXRPcHRpb25zOiBmdW5jdGlvbihvcHRpb25OYW1lcykge1xuICAgICAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgICAgIGlmICghb3B0aW9uTmFtZXMpIHtcbiAgICAgICAgICAgIG9wdGlvbk5hbWVzID0gT2JqZWN0LmtleXModGhpcy4kb3B0aW9ucyk7XG4gICAgICAgIH0gZWxzZSBpZiAoIUFycmF5LmlzQXJyYXkob3B0aW9uTmFtZXMpKSB7XG4gICAgICAgICAgICByZXN1bHQgPSBvcHRpb25OYW1lcztcbiAgICAgICAgICAgIG9wdGlvbk5hbWVzID0gT2JqZWN0LmtleXMocmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgICBvcHRpb25OYW1lcy5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB0aGlzLmdldE9wdGlvbihrZXkpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuICAgIHNldE9wdGlvbjogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXNbXCIkXCIgKyBuYW1lXSA9PT0gdmFsdWUpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHZhciBvcHQgPSB0aGlzLiRvcHRpb25zW25hbWVdO1xuICAgICAgICBpZiAoIW9wdCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9IFwidW5kZWZpbmVkXCIgJiYgY29uc29sZS53YXJuKVxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignbWlzc3BlbGxlZCBvcHRpb24gXCInICsgbmFtZSArICdcIicpO1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0LmZvcndhcmRUbylcbiAgICAgICAgICAgIHJldHVybiB0aGlzW29wdC5mb3J3YXJkVG9dICYmIHRoaXNbb3B0LmZvcndhcmRUb10uc2V0T3B0aW9uKG5hbWUsIHZhbHVlKTtcblxuICAgICAgICBpZiAoIW9wdC5oYW5kbGVzU2V0KVxuICAgICAgICAgICAgdGhpc1tcIiRcIiArIG5hbWVdID0gdmFsdWU7XG4gICAgICAgIGlmIChvcHQgJiYgb3B0LnNldClcbiAgICAgICAgICAgIG9wdC5zZXQuY2FsbCh0aGlzLCB2YWx1ZSk7XG4gICAgfSxcbiAgICBnZXRPcHRpb246IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgdmFyIG9wdCA9IHRoaXMuJG9wdGlvbnNbbmFtZV07XG4gICAgICAgIGlmICghb3B0KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT0gXCJ1bmRlZmluZWRcIiAmJiBjb25zb2xlLndhcm4pXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdtaXNzcGVsbGVkIG9wdGlvbiBcIicgKyBuYW1lICsgJ1wiJyk7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHQuZm9yd2FyZFRvKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNbb3B0LmZvcndhcmRUb10gJiYgdGhpc1tvcHQuZm9yd2FyZFRvXS5nZXRPcHRpb24obmFtZSk7XG4gICAgICAgIHJldHVybiBvcHQgJiYgb3B0LmdldCA/IG9wdC5nZXQuY2FsbCh0aGlzKSA6IHRoaXNbXCIkXCIgKyBuYW1lXTtcbiAgICB9XG59O1xuXG52YXIgZGVmYXVsdE9wdGlvbnMgPSB7fTtcbi8qXG4gKiBvcHRpb24ge25hbWUsIHZhbHVlLCBpbml0aWFsVmFsdWUsIHNldHRlck5hbWUsIHNldCwgZ2V0IH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlZmluZU9wdGlvbnMob2JqLCBwYXRoOiBzdHJpbmcsIG9wdGlvbnMpIHtcbiAgICBpZiAoIW9iai4kb3B0aW9ucylcbiAgICAgICAgZGVmYXVsdE9wdGlvbnNbcGF0aF0gPSBvYmouJG9wdGlvbnMgPSB7fTtcblxuICAgIE9iamVjdC5rZXlzKG9wdGlvbnMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgIHZhciBvcHQgPSBvcHRpb25zW2tleV07XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0ID09IFwic3RyaW5nXCIpXG4gICAgICAgICAgICBvcHQgPSB7IGZvcndhcmRUbzogb3B0IH07XG5cbiAgICAgICAgb3B0Lm5hbWUgfHwgKG9wdC5uYW1lID0ga2V5KTtcbiAgICAgICAgb2JqLiRvcHRpb25zW29wdC5uYW1lXSA9IG9wdDtcbiAgICAgICAgaWYgKFwiaW5pdGlhbFZhbHVlXCIgaW4gb3B0KVxuICAgICAgICAgICAgb2JqW1wiJFwiICsgb3B0Lm5hbWVdID0gb3B0LmluaXRpYWxWYWx1ZTtcbiAgICB9KTtcblxuICAgIC8vIGltcGxlbWVudCBvcHRpb24gcHJvdmlkZXIgaW50ZXJmYWNlXG4gICAgaW1wbGVtZW50KG9iaiwgb3B0aW9uc1Byb3ZpZGVyKTtcblxuICAgIHJldHVybiB0aGlzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVzZXRPcHRpb25zKG9iaikge1xuICAgIE9iamVjdC5rZXlzKG9iai4kb3B0aW9ucykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgdmFyIG9wdCA9IG9iai4kb3B0aW9uc1trZXldO1xuICAgICAgICBpZiAoXCJ2YWx1ZVwiIGluIG9wdClcbiAgICAgICAgICAgIG9iai5zZXRPcHRpb24oa2V5LCBvcHQudmFsdWUpO1xuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0RGVmYXVsdFZhbHVlKHBhdGgsIG5hbWUsIHZhbHVlKSB7XG4gICAgdmFyIG9wdHMgPSBkZWZhdWx0T3B0aW9uc1twYXRoXSB8fCAoZGVmYXVsdE9wdGlvbnNbcGF0aF0gPSB7fSk7XG4gICAgaWYgKG9wdHNbbmFtZV0pIHtcbiAgICAgICAgaWYgKG9wdHMuZm9yd2FyZFRvKVxuICAgICAgICAgICAgc2V0RGVmYXVsdFZhbHVlKG9wdHMuZm9yd2FyZFRvLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG9wdHNbbmFtZV0udmFsdWUgPSB2YWx1ZTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXREZWZhdWx0VmFsdWVzKHBhdGgsIG9wdGlvbkhhc2gpIHtcbiAgICBPYmplY3Qua2V5cyhvcHRpb25IYXNoKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICBzZXREZWZhdWx0VmFsdWUocGF0aCwga2V5LCBvcHRpb25IYXNoW2tleV0pO1xuICAgIH0pO1xufVxuIl19