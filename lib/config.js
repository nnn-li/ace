var global = (function () {
    return this || typeof window !== 'undefined' && window;
})();
var options = {
    packaged: false,
    workerPath: null,
    modePath: null,
    themePath: null,
    basePath: "",
    suffix: ".js",
    $moduleUrls: {}
};
export function get(key) {
    if (!options.hasOwnProperty(key))
        throw new Error("Unknown config key: " + key);
    return options[key];
}
export function set(key, value) {
    if (!options.hasOwnProperty(key))
        throw new Error("Unknown config key: " + key);
    options[key] = value;
}
export function all() {
    return lang.copyObject(options);
}
oop.implement(exports, eve.EventEmitter);
export function _emit(eventName, e) {
    return eve.EventEmitter._emit(eventName, e);
}
export function _signal(eventName, e) {
    return eve.EventEmitter._signal(eventName, e);
}
export function moduleUrl(name, component) {
    if (options.$moduleUrls[name]) {
        return options.$moduleUrls[name];
    }
    var parts = name.split("/");
    component = component || parts[parts.length - 2] || "";
    var sep = component == "snippets" ? "/" : "-";
    var base = parts[parts.length - 1];
    if (component === 'worker' && sep === '-') {
        var re = new RegExp("^" + component + "[\\-_]|[\\-_]" + component + "$", "g");
        base = base.replace(re, "");
    }
    if ((!base || base == component) && parts.length > 1) {
        base = parts[parts.length - 2];
    }
    var path = options[component + "Path"];
    if (path == null) {
        path = options.basePath;
    }
    else if (sep == "/") {
        component = sep = "";
    }
    if (path && path.slice(-1) != "/") {
        path += "/";
    }
    return path + component + sep + base + this.get("suffix");
}
export function setModuleUrl(name, subst) {
    return options.$moduleUrls[name] = subst;
}
export var $loading = {};
export function loadModule(moduleName, onLoad) {
    var module;
    var moduleType;
    if (Array.isArray(moduleName)) {
        moduleType = moduleName[0];
        moduleName = moduleName[1];
    }
    try {
        module = require(moduleName);
    }
    catch (e) { }
    if (module && !$loading[moduleName])
        return onLoad && onLoad(module);
    if (!$loading[moduleName]) {
        $loading[moduleName] = [];
    }
    $loading[moduleName].push(onLoad);
    if ($loading[moduleName].length > 1)
        return;
    var afterLoad = function () {
        require([moduleName], function (module) {
            exports._emit("load.module", { name: moduleName, module: module });
            var listeners = $loading[moduleName];
            $loading[moduleName] = null;
            listeners.forEach(function (onLoad) {
                onLoad && onLoad(module);
            });
        });
    };
    if (!get("packaged")) {
        return afterLoad();
    }
    net.loadScript(moduleUrl(moduleName, moduleType), afterLoad);
}
export function init(packaged) {
    options.packaged = packaged || require['packaged'] || module.packaged || (global.define && define['packaged']);
    if (!global.document)
        return "";
    var scriptOptions = {};
    var scriptUrl = "";
    var currentScript = (document['currentScript'] || document['_currentScript']);
    var currentDocument = currentScript && currentScript.ownerDocument || document;
    var scripts = currentDocument.getElementsByTagName("script");
    for (var i = 0; i < scripts.length; i++) {
        var script = scripts[i];
        var src = script.src || script.getAttribute("src");
        if (!src)
            continue;
        var attributes = script.attributes;
        for (var j = 0, l = attributes.length; j < l; j++) {
            var attr = attributes[j];
            if (attr.name.indexOf("data-ace-") === 0) {
                scriptOptions[deHyphenate(attr.name.replace(/^data-ace-/, ""))] = attr.value;
            }
        }
        var m = src.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);
        if (m) {
            scriptUrl = m[1];
        }
    }
    if (scriptUrl) {
        scriptOptions['base'] = scriptOptions['base'] || scriptUrl;
        scriptOptions['packaged'] = true;
    }
    scriptOptions['basePath'] = scriptOptions['base'];
    scriptOptions['workerPath'] = scriptOptions['workerPath'] || scriptOptions['base'];
    scriptOptions['modePath'] = scriptOptions['modePath'] || scriptOptions['base'];
    scriptOptions['themePath'] = scriptOptions['themePath'] || scriptOptions['base'];
    delete scriptOptions['base'];
    for (var key in scriptOptions)
        if (typeof scriptOptions[key] !== "undefined")
            set(key, scriptOptions[key]);
}
;
function deHyphenate(str) {
    return str.replace(/-(.)/g, function (m, m1) { return m1.toUpperCase(); });
}
var optionsProvider = {
    setOptions: function (optList) {
        Object.keys(optList).forEach(function (key) {
            this.setOption(key, optList[key]);
        }, this);
    },
    getOptions: function (optionNames) {
        var result = {};
        if (!optionNames) {
            optionNames = Object.keys(this.$options);
        }
        else if (!Array.isArray(optionNames)) {
            result = optionNames;
            optionNames = Object.keys(result);
        }
        optionNames.forEach(function (key) {
            result[key] = this.getOption(key);
        }, this);
        return result;
    },
    setOption: function (name, value) {
        if (this["$" + name] === value)
            return;
        var opt = this.$options[name];
        if (!opt) {
            if (typeof console != "undefined" && console.warn)
                console.warn('misspelled option "' + name + '"');
            return undefined;
        }
        if (opt.forwardTo)
            return this[opt.forwardTo] && this[opt.forwardTo].setOption(name, value);
        if (!opt.handlesSet)
            this["$" + name] = value;
        if (opt && opt.set)
            opt.set.call(this, value);
    },
    getOption: function (name) {
        var opt = this.$options[name];
        if (!opt) {
            if (typeof console != "undefined" && console.warn)
                console.warn('misspelled option "' + name + '"');
            return undefined;
        }
        if (opt.forwardTo)
            return this[opt.forwardTo] && this[opt.forwardTo].getOption(name);
        return opt && opt.get ? opt.get.call(this) : this["$" + name];
    }
};
var defaultOptions = {};
export function defineOptions(obj, path, options) {
    if (!obj.$options)
        defaultOptions[path] = obj.$options = {};
    Object.keys(options).forEach(function (key) {
        var opt = options[key];
        if (typeof opt == "string")
            opt = { forwardTo: opt };
        opt.name || (opt.name = key);
        obj.$options[opt.name] = opt;
        if ("initialValue" in opt)
            obj["$" + opt.name] = opt.initialValue;
    });
    oop.implement(obj, optionsProvider);
    return this;
}
export function resetOptions(obj) {
    Object.keys(obj.$options).forEach(function (key) {
        var opt = obj.$options[key];
        if ("value" in opt)
            obj.setOption(key, opt.value);
    });
}
export function setDefaultValue(path, name, value) {
    var opts = defaultOptions[path] || (defaultOptions[path] = {});
    if (opts[name]) {
        if (opts.forwardTo)
            setDefaultValue(opts.forwardTo, name, value);
        else
            opts[name].value = value;
    }
}
export function setDefaultValues(path, optionHash) {
    Object.keys(optionHash).forEach(function (key) {
        setDefaultValue(path, key, optionHash[key]);
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NvbmZpZy50cyJdLCJuYW1lcyI6WyJnZXQiLCJzZXQiLCJhbGwiLCJfZW1pdCIsIl9zaWduYWwiLCJtb2R1bGVVcmwiLCJzZXRNb2R1bGVVcmwiLCJsb2FkTW9kdWxlIiwiaW5pdCIsImRlSHlwaGVuYXRlIiwiZGVmaW5lT3B0aW9ucyIsInJlc2V0T3B0aW9ucyIsInNldERlZmF1bHRWYWx1ZSIsInNldERlZmF1bHRWYWx1ZXMiXSwibWFwcGluZ3MiOiJBQW1DQSxJQUFJLE1BQU0sR0FBRyxDQUFDO0lBQ1YsTUFBTSxDQUFDLElBQUksSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLElBQUksTUFBTSxDQUFDO0FBQzNELENBQUMsQ0FBQyxFQUFFLENBQUM7QUFHTCxJQUFJLE9BQU8sR0FBRztJQUNWLFFBQVEsRUFBRSxLQUFLO0lBQ2YsVUFBVSxFQUFFLElBQUk7SUFDaEIsUUFBUSxFQUFFLElBQUk7SUFDZCxTQUFTLEVBQUUsSUFBSTtJQUNmLFFBQVEsRUFBRSxFQUFFO0lBQ1osTUFBTSxFQUFFLEtBQUs7SUFDYixXQUFXLEVBQUUsRUFBRTtDQUNsQixDQUFDO0FBRUYsb0JBQW9CLEdBQVc7SUFDM0JBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLGNBQWNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQzdCQSxNQUFNQSxJQUFJQSxLQUFLQSxDQUFDQSxzQkFBc0JBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBO0lBRWxEQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtBQUN4QkEsQ0FBQ0E7QUFFRCxvQkFBb0IsR0FBVyxFQUFFLEtBQUs7SUFDbENDLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLGNBQWNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQzdCQSxNQUFNQSxJQUFJQSxLQUFLQSxDQUFDQSxzQkFBc0JBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBO0lBRWxEQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQTtBQUN6QkEsQ0FBQ0E7QUFFRDtJQUNJQyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtBQUNwQ0EsQ0FBQ0E7QUFNRCxHQUFHLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7QUFFekMsc0JBQXNCLFNBQWlCLEVBQUUsQ0FBTztJQUM1Q0MsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7QUFDaERBLENBQUNBO0FBRUQsd0JBQXdCLFNBQWlCLEVBQUUsQ0FBTztJQUM5Q0MsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7QUFDbERBLENBQUNBO0FBS0QsMEJBQTBCLElBQVksRUFBRSxTQUFpQjtJQUNyREMsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDNUJBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO0lBQ3JDQSxDQUFDQTtJQUVEQSxJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUM1QkEsU0FBU0EsR0FBR0EsU0FBU0EsSUFBSUEsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0E7SUFHdkRBLElBQUlBLEdBQUdBLEdBQVdBLFNBQVNBLElBQUlBLFVBQVVBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBO0lBQ3REQSxJQUFJQSxJQUFJQSxHQUFXQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUMzQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsU0FBU0EsS0FBS0EsUUFBUUEsSUFBSUEsR0FBR0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDeENBLElBQUlBLEVBQUVBLEdBQUdBLElBQUlBLE1BQU1BLENBQUNBLEdBQUdBLEdBQUdBLFNBQVNBLEdBQUdBLGVBQWVBLEdBQUdBLFNBQVNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBO1FBQzlFQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtJQUNoQ0EsQ0FBQ0E7SUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsSUFBSUEsSUFBSUEsSUFBSUEsU0FBU0EsQ0FBQ0EsSUFBSUEsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbkRBLElBQUlBLEdBQUdBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO0lBQ25DQSxDQUFDQTtJQUNEQSxJQUFJQSxJQUFJQSxHQUFHQSxPQUFPQSxDQUFDQSxTQUFTQSxHQUFHQSxNQUFNQSxDQUFDQSxDQUFDQTtJQUN2Q0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsSUFBSUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDZkEsSUFBSUEsR0FBR0EsT0FBT0EsQ0FBQ0EsUUFBUUEsQ0FBQ0E7SUFDNUJBLENBQUNBO0lBQ0RBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBQ2xCQSxTQUFTQSxHQUFHQSxHQUFHQSxHQUFHQSxFQUFFQSxDQUFDQTtJQUN6QkEsQ0FBQ0E7SUFDREEsRUFB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LE9BQU9BLENBQUNBLFVBQVNBLEdBQUdBO1FBQ3hDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ2hELENBQUMsQ0FBQ0EsQ0FBQ0E7QUFDUEEsQ0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIvKiAqKioqKiBCRUdJTiBMSUNFTlNFIEJMT0NLICoqKioqXG4gKiBEaXN0cmlidXRlZCB1bmRlciB0aGUgQlNEIGxpY2Vuc2U6XG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEwLCBBamF4Lm9yZyBCLlYuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogXG4gKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXRcbiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuICogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlXG4gKiAgICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICogICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBBamF4Lm9yZyBCLlYuIG5vciB0aGVcbiAqICAgICAgIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzXG4gKiAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cbiAqIFxuICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyBcIkFTIElTXCIgQU5EXG4gKiBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRFxuICogV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRVxuICogRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgQUpBWC5PUkcgQi5WLiBCRSBMSUFCTEUgRk9SIEFOWVxuICogRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVNcbiAqIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUztcbiAqIExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORFxuICogT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbiAqIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTXG4gKiBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cbiAqXG4gKiAqKioqKiBFTkQgTElDRU5TRSBCTE9DSyAqKioqKiAqL1xuXG5pbXBvcnQgbGFuZyA9IHJlcXVpcmUoXCIuL2xpYi9sYW5nXCIpO1xuaW1wb3J0IG9vcCA9IHJlcXVpcmUoXCIuL2xpYi9vb3BcIik7XG5pbXBvcnQgbmV0ID0gcmVxdWlyZShcIi4vbGliL25ldFwiKTtcbmltcG9ydCBldmUgPSByZXF1aXJlKCcuL2xpYi9ldmVudF9lbWl0dGVyJyk7XG5cbnZhciBnbG9iYWwgPSAoZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMgfHwgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93O1xufSkoKTtcblxuLy8gRklYTUU6IE1ha2UgdGhpcyB0eXBlLXNhZmUuXG52YXIgb3B0aW9ucyA9IHtcbiAgICBwYWNrYWdlZDogZmFsc2UsXG4gICAgd29ya2VyUGF0aDogbnVsbCxcbiAgICBtb2RlUGF0aDogbnVsbCxcbiAgICB0aGVtZVBhdGg6IG51bGwsXG4gICAgYmFzZVBhdGg6IFwiXCIsXG4gICAgc3VmZml4OiBcIi5qc1wiLFxuICAgICRtb2R1bGVVcmxzOiB7fVxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldChrZXk6IHN0cmluZykge1xuICAgIGlmICghb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIGNvbmZpZyBrZXk6IFwiICsga2V5KTtcblxuICAgIHJldHVybiBvcHRpb25zW2tleV07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXQoa2V5OiBzdHJpbmcsIHZhbHVlKSB7XG4gICAgaWYgKCFvcHRpb25zLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVua25vd24gY29uZmlnIGtleTogXCIgKyBrZXkpO1xuXG4gICAgb3B0aW9uc1trZXldID0gdmFsdWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhbGwoKSB7XG4gICAgcmV0dXJuIGxhbmcuY29weU9iamVjdChvcHRpb25zKTtcbn1cblxuLy8gbW9kdWxlIGxvYWRpbmdcbi8vIEZJWE1FOiBUaGlzIGlzIGEgbGF6eSB3YXkgb2YgdHJhbnNmZXJyaW5nIGZ1bmN0aW9ucyBmcm9tIEV2ZW50RW1pdHRlciB0byBjb25maWcuXG4vLyBJdCBicmVha3MgVHlwZVNjcmlwdCBhbmFseXNpcy4gVXNlIHRoZSBleHBsaWNpdCBhcHByb2FjaCBhcyBiZWxvdywgYXMgbmVlZGVkLlxuZGVjbGFyZSB2YXIgZXhwb3J0czogYW55O1xub29wLmltcGxlbWVudChleHBvcnRzLCBldmUuRXZlbnRFbWl0dGVyKTtcblxuZXhwb3J0IGZ1bmN0aW9uIF9lbWl0KGV2ZW50TmFtZTogc3RyaW5nLCBlPzogYW55KSB7XG4gICAgcmV0dXJuIGV2ZS5FdmVudEVtaXR0ZXIuX2VtaXQoZXZlbnROYW1lLCBlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9zaWduYWwoZXZlbnROYW1lOiBzdHJpbmcsIGU/OiBhbnkpIHtcbiAgICByZXR1cm4gZXZlLkV2ZW50RW1pdHRlci5fc2lnbmFsKGV2ZW50TmFtZSwgZSk7XG59XG5cbi8qKlxuICpcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1vZHVsZVVybChuYW1lOiBzdHJpbmcsIGNvbXBvbmVudDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBpZiAob3B0aW9ucy4kbW9kdWxlVXJsc1tuYW1lXSkge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy4kbW9kdWxlVXJsc1tuYW1lXTtcbiAgICB9XG5cbiAgICB2YXIgcGFydHMgPSBuYW1lLnNwbGl0KFwiL1wiKTtcbiAgICBjb21wb25lbnQgPSBjb21wb25lbnQgfHwgcGFydHNbcGFydHMubGVuZ3RoIC0gMl0gfHwgXCJcIjtcblxuICAgIC8vIHRvZG8gbWFrZSB0aGlzIGNvbmZpZ3VyYWJsZSBvciBnZXQgcmlkIG9mICctJ1xuICAgIHZhciBzZXA6IHN0cmluZyA9IGNvbXBvbmVudCA9PSBcInNuaXBwZXRzXCIgPyBcIi9cIiA6IFwiLVwiO1xuICAgIHZhciBiYXNlOiBzdHJpbmcgPSBwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXTtcbiAgICBpZiAoY29tcG9uZW50ID09PSAnd29ya2VyJyAmJiBzZXAgPT09ICctJykge1xuICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKFwiXlwiICsgY29tcG9uZW50ICsgXCJbXFxcXC1fXXxbXFxcXC1fXVwiICsgY29tcG9uZW50ICsgXCIkXCIsIFwiZ1wiKTtcbiAgICAgICAgYmFzZSA9IGJhc2UucmVwbGFjZShyZSwgXCJcIik7XG4gICAgfVxuXG4gICAgaWYgKCghYmFzZSB8fCBiYXNlID09IGNvbXBvbmVudCkgJiYgcGFydHMubGVuZ3RoID4gMSkge1xuICAgICAgICBiYXNlID0gcGFydHNbcGFydHMubGVuZ3RoIC0gMl07XG4gICAgfVxuICAgIHZhciBwYXRoID0gb3B0aW9uc1tjb21wb25lbnQgKyBcIlBhdGhcIl07XG4gICAgaWYgKHBhdGggPT0gbnVsbCkge1xuICAgICAgICBwYXRoID0gb3B0aW9ucy5iYXNlUGF0aDtcbiAgICB9XG4gICAgZWxzZSBpZiAoc2VwID09IFwiL1wiKSB7XG4gICAgICAgIGNvbXBvbmVudCA9IHNlcCA9IFwiXCI7XG4gICAgfVxuICAgIGlmIChwYXRoICYmIHBhdGguc2xpY2UoLTEpICE9IFwiL1wiKSB7XG4gICAgICAgIHBhdGggKz0gXCIvXCI7XG4gICAgfVxuICAgIHJldHVybiBwYXRoICsgY29tcG9uZW50ICsgc2VwICsgYmFzZSArIHRoaXMuZ2V0KFwic3VmZml4XCIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0TW9kdWxlVXJsKG5hbWU6IHN0cmluZywgc3Vic3Q6IHN0cmluZykge1xuICAgIHJldHVybiBvcHRpb25zLiRtb2R1bGVVcmxzW25hbWVdID0gc3Vic3Q7XG59XG5cbi8qKlxuICogQSBtYXAgZnJvbSBtb2R1bGUgbmFtZSB0byBhbiBhcnJheSBvZiBjYWxsYmFja3MuXG4gKi9cbmV4cG9ydCB2YXIgJGxvYWRpbmc6IHsgW25hbWU6IHN0cmluZ106ICgobSkgPT4gYW55KVtdIH0gPSB7fTtcblxuLy8gVGhpcyBpcyBhbiBpbXBvcnRhbnQgZnVuY3Rpb24uXG4vLyBGSVhNRS4gSXQgd291bGQgYmUgbW9yZSB0eXBlLXNhZmUgaWYgdGhlIGZpcnN0IGFyZ3VtZW50IHdoZXJlIGFuIGFycmF5IG9mIHN0cmluZ3MuXG4vLyBXaGF0IGlzIHRoZSB0eXBlIG9mIHRoZSBtb2R1bGUgcmV0dXJuZWQgYnkgdGhlIHJlcXVpcmUgZnVuY3Rpb24/XG5leHBvcnQgZnVuY3Rpb24gbG9hZE1vZHVsZShtb2R1bGVOYW1lLCBvbkxvYWQ6IChtOiBhbnkpID0+IGFueSkge1xuICAgIHZhciBtb2R1bGU7XG4gICAgdmFyIG1vZHVsZVR5cGU6IHN0cmluZztcbiAgICBpZiAoQXJyYXkuaXNBcnJheShtb2R1bGVOYW1lKSkge1xuICAgICAgICBtb2R1bGVUeXBlID0gbW9kdWxlTmFtZVswXTtcbiAgICAgICAgbW9kdWxlTmFtZSA9IG1vZHVsZU5hbWVbMV07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgbW9kdWxlID0gcmVxdWlyZShtb2R1bGVOYW1lKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfVxuICAgIC8vIHJlcXVpcmUobW9kdWxlTmFtZSkgY2FuIHJldHVybiBlbXB0eSBvYmplY3QgaWYgY2FsbGVkIGFmdGVyIHJlcXVpcmUoW21vZHVsZU5hbWVdLCBjYWxsYmFjaylcbiAgICBpZiAobW9kdWxlICYmICEkbG9hZGluZ1ttb2R1bGVOYW1lXSlcbiAgICAgICAgcmV0dXJuIG9uTG9hZCAmJiBvbkxvYWQobW9kdWxlKTtcblxuICAgIGlmICghJGxvYWRpbmdbbW9kdWxlTmFtZV0pIHtcbiAgICAgICAgJGxvYWRpbmdbbW9kdWxlTmFtZV0gPSBbXTtcbiAgICB9XG5cbiAgICAkbG9hZGluZ1ttb2R1bGVOYW1lXS5wdXNoKG9uTG9hZCk7XG5cbiAgICBpZiAoJGxvYWRpbmdbbW9kdWxlTmFtZV0ubGVuZ3RoID4gMSlcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgdmFyIGFmdGVyTG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXF1aXJlKFttb2R1bGVOYW1lXSwgZnVuY3Rpb24obW9kdWxlKSB7XG4gICAgICAgICAgICBleHBvcnRzLl9lbWl0KFwibG9hZC5tb2R1bGVcIiwgeyBuYW1lOiBtb2R1bGVOYW1lLCBtb2R1bGU6IG1vZHVsZSB9KTtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQSBsb2NhbCBjb3B5IG9mIGFsbCB0aGUgbGlzdGVuZXJzIHdobyB3YW50IHRvIGhlYXIgd2hlbiB0aGUgbW9kdWxlIGhhcyBsb2FkZWQuXG4gICAgICAgICAgICAgKiBXZSBtYWtlIGEgbG9jYWwgY29weSBiZWNhdXNlIHdlIGFyZSBnb2luZyB0byBjbGVhciB0aGUgZW50cnkgZm9yIHRoZSBtb2R1bGUuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHZhciBsaXN0ZW5lcnMgPSAkbG9hZGluZ1ttb2R1bGVOYW1lXTtcbiAgICAgICAgICAgICRsb2FkaW5nW21vZHVsZU5hbWVdID0gbnVsbDtcbiAgICAgICAgICAgIGxpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uKG9uTG9hZCkge1xuICAgICAgICAgICAgICAgIG9uTG9hZCAmJiBvbkxvYWQobW9kdWxlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLy8gV2hhdCBpcyB0aGlzIHNwZWNpYWwgbmFtZT9cbiAgICBpZiAoIWdldChcInBhY2thZ2VkXCIpKSB7XG4gICAgICAgIHJldHVybiBhZnRlckxvYWQoKTtcbiAgICB9XG5cbiAgICAvLyBEZWxlZ2F0ZSB0aGUgbG9hZGluZyBvZiB0aGUgc2NyaXB0IGJ1dCBob29rIHRoZSBub3RpZmljYXRpb24uXG4gICAgbmV0LmxvYWRTY3JpcHQobW9kdWxlVXJsKG1vZHVsZU5hbWUsIG1vZHVsZVR5cGUpLCBhZnRlckxvYWQpO1xufVxuXG5cbi8vIGluaXRpYWxpemF0aW9uXG5kZWNsYXJlIHZhciBtb2R1bGU6IGFueTtcbi8qKlxuICogV2hvIGNhbGxzIHRoaXMgZnVuY3Rpb24/XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbml0KHBhY2thZ2VkOiBib29sZWFuKSB7XG4gICAgb3B0aW9ucy5wYWNrYWdlZCA9IHBhY2thZ2VkIHx8IHJlcXVpcmVbJ3BhY2thZ2VkJ10gfHwgbW9kdWxlLnBhY2thZ2VkIHx8IChnbG9iYWwuZGVmaW5lICYmIGRlZmluZVsncGFja2FnZWQnXSk7XG5cbiAgICBpZiAoIWdsb2JhbC5kb2N1bWVudClcbiAgICAgICAgcmV0dXJuIFwiXCI7XG5cbiAgICB2YXIgc2NyaXB0T3B0aW9uczogeyBbbmFtZTogc3RyaW5nXTogYW55IH0gPSB7fTtcbiAgICB2YXIgc2NyaXB0VXJsID0gXCJcIjtcblxuICAgIC8vIFVzZSBjdXJyZW50U2NyaXB0Lm93bmVyRG9jdW1lbnQgaW4gY2FzZSB0aGlzIGZpbGUgd2FzIGxvYWRlZCBmcm9tIGltcG9ydGVkIGRvY3VtZW50LiAoSFRNTCBJbXBvcnRzKVxuICAgIHZhciBjdXJyZW50U2NyaXB0OiBIVE1MU2NyaXB0RWxlbWVudCA9IChkb2N1bWVudFsnY3VycmVudFNjcmlwdCddIHx8IGRvY3VtZW50WydfY3VycmVudFNjcmlwdCddKTsgLy8gbmF0aXZlIG9yIHBvbHlmaWxsXG4gICAgdmFyIGN1cnJlbnREb2N1bWVudCA9IGN1cnJlbnRTY3JpcHQgJiYgY3VycmVudFNjcmlwdC5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50O1xuXG4gICAgdmFyIHNjcmlwdHM6IE5vZGVMaXN0T2Y8SFRNTFNjcmlwdEVsZW1lbnQ+ID0gY3VycmVudERvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2NyaXB0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgc2NyaXB0ID0gc2NyaXB0c1tpXTtcblxuICAgICAgICB2YXIgc3JjID0gc2NyaXB0LnNyYyB8fCBzY3JpcHQuZ2V0QXR0cmlidXRlKFwic3JjXCIpO1xuICAgICAgICBpZiAoIXNyYylcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuXG4gICAgICAgIHZhciBhdHRyaWJ1dGVzOiBOYW1lZE5vZGVNYXAgPSBzY3JpcHQuYXR0cmlidXRlcztcbiAgICAgICAgZm9yICh2YXIgaiA9IDAsIGwgPSBhdHRyaWJ1dGVzLmxlbmd0aDsgaiA8IGw7IGorKykge1xuICAgICAgICAgICAgdmFyIGF0dHI6IEF0dHIgPSBhdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgaWYgKGF0dHIubmFtZS5pbmRleE9mKFwiZGF0YS1hY2UtXCIpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgc2NyaXB0T3B0aW9uc1tkZUh5cGhlbmF0ZShhdHRyLm5hbWUucmVwbGFjZSgvXmRhdGEtYWNlLS8sIFwiXCIpKV0gPSBhdHRyLnZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG06IFJlZ0V4cE1hdGNoQXJyYXkgPSBzcmMubWF0Y2goL14oLiopXFwvYWNlKFxcLVxcdyspP1xcLmpzKFxcP3wkKS8pO1xuICAgICAgICBpZiAobSkge1xuICAgICAgICAgICAgc2NyaXB0VXJsID0gbVsxXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChzY3JpcHRVcmwpIHtcbiAgICAgICAgc2NyaXB0T3B0aW9uc1snYmFzZSddID0gc2NyaXB0T3B0aW9uc1snYmFzZSddIHx8IHNjcmlwdFVybDtcbiAgICAgICAgc2NyaXB0T3B0aW9uc1sncGFja2FnZWQnXSA9IHRydWU7XG4gICAgfVxuXG4gICAgc2NyaXB0T3B0aW9uc1snYmFzZVBhdGgnXSA9IHNjcmlwdE9wdGlvbnNbJ2Jhc2UnXTtcbiAgICBzY3JpcHRPcHRpb25zWyd3b3JrZXJQYXRoJ10gPSBzY3JpcHRPcHRpb25zWyd3b3JrZXJQYXRoJ10gfHwgc2NyaXB0T3B0aW9uc1snYmFzZSddO1xuICAgIHNjcmlwdE9wdGlvbnNbJ21vZGVQYXRoJ10gPSBzY3JpcHRPcHRpb25zWydtb2RlUGF0aCddIHx8IHNjcmlwdE9wdGlvbnNbJ2Jhc2UnXTtcbiAgICBzY3JpcHRPcHRpb25zWyd0aGVtZVBhdGgnXSA9IHNjcmlwdE9wdGlvbnNbJ3RoZW1lUGF0aCddIHx8IHNjcmlwdE9wdGlvbnNbJ2Jhc2UnXTtcbiAgICBkZWxldGUgc2NyaXB0T3B0aW9uc1snYmFzZSddO1xuXG4gICAgZm9yICh2YXIga2V5IGluIHNjcmlwdE9wdGlvbnMpXG4gICAgICAgIGlmICh0eXBlb2Ygc2NyaXB0T3B0aW9uc1trZXldICE9PSBcInVuZGVmaW5lZFwiKVxuICAgICAgICAgICAgc2V0KGtleSwgc2NyaXB0T3B0aW9uc1trZXldKTtcbn07XG5cbmZ1bmN0aW9uIGRlSHlwaGVuYXRlKHN0cjogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UoLy0oLikvZywgZnVuY3Rpb24obTogc3RyaW5nLCBtMTogc3RyaW5nKSB7IHJldHVybiBtMS50b1VwcGVyQ2FzZSgpOyB9KTtcbn1cblxudmFyIG9wdGlvbnNQcm92aWRlciA9IHtcbiAgICBzZXRPcHRpb25zOiBmdW5jdGlvbihvcHRMaXN0KSB7XG4gICAgICAgIE9iamVjdC5rZXlzKG9wdExpc3QpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgICAgICB0aGlzLnNldE9wdGlvbihrZXksIG9wdExpc3Rba2V5XSk7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH0sXG4gICAgZ2V0T3B0aW9uczogZnVuY3Rpb24ob3B0aW9uTmFtZXMpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgICAgICBpZiAoIW9wdGlvbk5hbWVzKSB7XG4gICAgICAgICAgICBvcHRpb25OYW1lcyA9IE9iamVjdC5rZXlzKHRoaXMuJG9wdGlvbnMpO1xuICAgICAgICB9IGVsc2UgaWYgKCFBcnJheS5pc0FycmF5KG9wdGlvbk5hbWVzKSkge1xuICAgICAgICAgICAgcmVzdWx0ID0gb3B0aW9uTmFtZXM7XG4gICAgICAgICAgICBvcHRpb25OYW1lcyA9IE9iamVjdC5rZXlzKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgICAgb3B0aW9uTmFtZXMuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdGhpcy5nZXRPcHRpb24oa2V5KTtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcbiAgICBzZXRPcHRpb246IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzW1wiJFwiICsgbmFtZV0gPT09IHZhbHVlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB2YXIgb3B0ID0gdGhpcy4kb3B0aW9uc1tuYW1lXTtcbiAgICAgICAgaWYgKCFvcHQpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPSBcInVuZGVmaW5lZFwiICYmIGNvbnNvbGUud2FybilcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ21pc3NwZWxsZWQgb3B0aW9uIFwiJyArIG5hbWUgKyAnXCInKTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdC5mb3J3YXJkVG8pXG4gICAgICAgICAgICByZXR1cm4gdGhpc1tvcHQuZm9yd2FyZFRvXSAmJiB0aGlzW29wdC5mb3J3YXJkVG9dLnNldE9wdGlvbihuYW1lLCB2YWx1ZSk7XG5cbiAgICAgICAgaWYgKCFvcHQuaGFuZGxlc1NldClcbiAgICAgICAgICAgIHRoaXNbXCIkXCIgKyBuYW1lXSA9IHZhbHVlO1xuICAgICAgICBpZiAob3B0ICYmIG9wdC5zZXQpXG4gICAgICAgICAgICBvcHQuc2V0LmNhbGwodGhpcywgdmFsdWUpO1xuICAgIH0sXG4gICAgZ2V0T3B0aW9uOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgIHZhciBvcHQgPSB0aGlzLiRvcHRpb25zW25hbWVdO1xuICAgICAgICBpZiAoIW9wdCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9IFwidW5kZWZpbmVkXCIgJiYgY29uc29sZS53YXJuKVxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignbWlzc3BlbGxlZCBvcHRpb24gXCInICsgbmFtZSArICdcIicpO1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0LmZvcndhcmRUbylcbiAgICAgICAgICAgIHJldHVybiB0aGlzW29wdC5mb3J3YXJkVG9dICYmIHRoaXNbb3B0LmZvcndhcmRUb10uZ2V0T3B0aW9uKG5hbWUpO1xuICAgICAgICByZXR1cm4gb3B0ICYmIG9wdC5nZXQgPyBvcHQuZ2V0LmNhbGwodGhpcykgOiB0aGlzW1wiJFwiICsgbmFtZV07XG4gICAgfVxufTtcblxudmFyIGRlZmF1bHRPcHRpb25zID0ge307XG4vKlxuICogb3B0aW9uIHtuYW1lLCB2YWx1ZSwgaW5pdGlhbFZhbHVlLCBzZXR0ZXJOYW1lLCBzZXQsIGdldCB9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWZpbmVPcHRpb25zKG9iaiwgcGF0aDogc3RyaW5nLCBvcHRpb25zKSB7XG4gICAgaWYgKCFvYmouJG9wdGlvbnMpXG4gICAgICAgIGRlZmF1bHRPcHRpb25zW3BhdGhdID0gb2JqLiRvcHRpb25zID0ge307XG5cbiAgICBPYmplY3Qua2V5cyhvcHRpb25zKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICB2YXIgb3B0ID0gb3B0aW9uc1trZXldO1xuICAgICAgICBpZiAodHlwZW9mIG9wdCA9PSBcInN0cmluZ1wiKVxuICAgICAgICAgICAgb3B0ID0geyBmb3J3YXJkVG86IG9wdCB9O1xuXG4gICAgICAgIG9wdC5uYW1lIHx8IChvcHQubmFtZSA9IGtleSk7XG4gICAgICAgIG9iai4kb3B0aW9uc1tvcHQubmFtZV0gPSBvcHQ7XG4gICAgICAgIGlmIChcImluaXRpYWxWYWx1ZVwiIGluIG9wdClcbiAgICAgICAgICAgIG9ialtcIiRcIiArIG9wdC5uYW1lXSA9IG9wdC5pbml0aWFsVmFsdWU7XG4gICAgfSk7XG5cbiAgICAvLyBpbXBsZW1lbnQgb3B0aW9uIHByb3ZpZGVyIGludGVyZmFjZVxuICAgIG9vcC5pbXBsZW1lbnQob2JqLCBvcHRpb25zUHJvdmlkZXIpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXNldE9wdGlvbnMob2JqKSB7XG4gICAgT2JqZWN0LmtleXMob2JqLiRvcHRpb25zKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICB2YXIgb3B0ID0gb2JqLiRvcHRpb25zW2tleV07XG4gICAgICAgIGlmIChcInZhbHVlXCIgaW4gb3B0KVxuICAgICAgICAgICAgb2JqLnNldE9wdGlvbihrZXksIG9wdC52YWx1ZSk7XG4gICAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXREZWZhdWx0VmFsdWUocGF0aCwgbmFtZSwgdmFsdWUpIHtcbiAgICB2YXIgb3B0cyA9IGRlZmF1bHRPcHRpb25zW3BhdGhdIHx8IChkZWZhdWx0T3B0aW9uc1twYXRoXSA9IHt9KTtcbiAgICBpZiAob3B0c1tuYW1lXSkge1xuICAgICAgICBpZiAob3B0cy5mb3J3YXJkVG8pXG4gICAgICAgICAgICBzZXREZWZhdWx0VmFsdWUob3B0cy5mb3J3YXJkVG8sIG5hbWUsIHZhbHVlKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgb3B0c1tuYW1lXS52YWx1ZSA9IHZhbHVlO1xuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldERlZmF1bHRWYWx1ZXMocGF0aCwgb3B0aW9uSGFzaCkge1xuICAgIE9iamVjdC5rZXlzKG9wdGlvbkhhc2gpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgIHNldERlZmF1bHRWYWx1ZShwYXRoLCBrZXksIG9wdGlvbkhhc2hba2V5XSk7XG4gICAgfSk7XG59XG4iXX0=