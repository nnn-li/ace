import { HashHandler } from "./keyboard/hash_handler";
import { ListViewPopup } from "./autocomplete/popup";
import { retrievePrecedingIdentifier } from "./autocomplete/util";
import { delayedCall } from "./lib/lang";
import { snippetManager } from "./snippets";
var EDITOR_EXT_COMPLETER = 'completer';
export function getCompleter(editor) {
    return editor[EDITOR_EXT_COMPLETER];
}
export function setCompleter(editor, completer) {
    editor[EDITOR_EXT_COMPLETER] = completer;
}
export class CompleterAggregate {
    constructor(editor) {
        this.keyboardHandler = new HashHandler();
        this.gatherCompletionsId = 0;
        this.autoSelect = true;
        this.autoInsert = true;
        this.showPopup = function (editor) {
            if (this.editor) {
                this.detach();
            }
            this.activated = true;
            this.editor = editor;
            if (getCompleter(editor) != this) {
                if (getCompleter(editor)) {
                    getCompleter(editor).detach();
                }
                setCompleter(editor, this);
            }
            editor.keyBinding.addKeyboardHandler(this.keyboardHandler);
            editor.on("changeSelection", this.changeListener);
            editor.on("blur", this.blurListener);
            editor.on("mousedown", this.mousedownListener);
            editor.on("mousewheel", this.mousewheelListener);
            this.updateCompletions();
        };
        this.editor = editor;
        this.commands = {
            "Up": function (editor) { getCompleter(editor).goTo("up"); },
            "Down": function (editor) { getCompleter(editor).goTo("down"); },
            "Ctrl-Up|Ctrl-Home": function (editor) { getCompleter(editor).goTo("start"); },
            "Ctrl-Down|Ctrl-End": function (editor) { getCompleter(editor).goTo("end"); },
            "Esc": function (editor) { getCompleter(editor).detach(); },
            "Space": function (editor) { getCompleter(editor).detach(); editor.insert(" "); },
            "Return": function (editor) { return getCompleter(editor).insertMatch(); },
            "Shift-Return": function (editor) { getCompleter(editor).insertMatch(true); },
            "Tab": function (editor) {
                var result = getCompleter(editor).insertMatch();
                if (!result && !editor['tabstopManager']) {
                    getCompleter(editor).goTo("down");
                }
                else
                    return result;
            },
            "PageUp": function (editor) { getCompleter(editor).goTo('pageUp'); },
            "PageDown": function (editor) { getCompleter(editor).goTo('pageDown'); }
        };
        this.keyboardHandler.bindKeys(this.commands);
        this.blurListener = this.blurListener.bind(this);
        this.changeListener = this.changeListener.bind(this);
        this.mousedownListener = this.mousedownListener.bind(this);
        this.mousewheelListener = this.mousewheelListener.bind(this);
        this.changeTimer = delayedCall(function () { this.updateCompletions(true); }.bind(this));
    }
    insertMatch(data) {
        if (!data) {
            data = this.popup.getData(this.popup.getRow());
        }
        if (!data) {
            return;
        }
        if (data.completer && data.completer.insertMatch) {
            data.completer.insertMatch(this.editor);
        }
        else {
            if (this.completions.filterText) {
                var ranges = this.editor.selection['getAllRanges']();
                for (var i = 0, range; range = ranges[i]; i++) {
                    range.start.column -= this.completions.filterText.length;
                    this.editor.session.remove(range);
                }
            }
            if (data.snippet) {
                snippetManager.insertSnippet(this.editor, data.snippet);
            }
            else {
                this.editor.execCommand("insertstring", data.value || data);
            }
        }
        this.detach();
    }
    detach() {
        this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler);
        this.editor.off("changeSelection", this.changeListener);
        this.editor.off("blur", this.blurListener);
        this.editor.off("mousedown", this.mousedownListener);
        this.editor.off("mousewheel", this.mousewheelListener);
        this.changeTimer.cancel();
        if (this.popup && this.popup.isOpen) {
            this.gatherCompletionsId += 1;
            this.popup.hide();
        }
        if (this.base)
            this.base.detach();
        this.activated = false;
        this.completions = this.base = null;
    }
    goTo(where) {
        var row = this.popup.getRow();
        var max = this.popup.getLength() - 1;
        switch (where) {
            case "up":
                row = row <= 0 ? max : row - 1;
                break;
            case "down":
                row = row >= max ? -1 : row + 1;
                break;
            case "start":
                row = 0;
                break;
            case "end":
                row = max;
                break;
        }
        this.popup.setRow(row);
    }
    getCompletions(editor, session, pos, prefix, callback) {
        this.base = session.doc.createAnchor(pos.row, pos.column - prefix.length);
        var matches = [];
        var total = editor.completers.length;
        editor.completers.forEach(function (completer, i) {
            completer.getCompletions(editor, session, pos, prefix, function (err, results) {
                if (!err)
                    matches = matches.concat(results);
                var pos = editor.getCursorPosition();
                var line = session.getLine(pos.row);
                callback(null, {
                    prefix: retrievePrecedingIdentifier(line, pos.column, results[0] && results[0].identifierRegex),
                    matches: matches,
                    finished: (--total === 0)
                });
            });
        });
        return true;
    }
    updateCompletions(keepPopupPosition) {
        var pos = this.editor.getCursorPosition();
        var prefix;
        if (keepPopupPosition && this.base && this.completions) {
            prefix = this.editor.session.getTextRange({ start: this.base, end: pos });
            if (prefix == this.completions.filterText)
                return;
            this.completions.setFilter(prefix);
            if (!this.completions.filtered.length)
                return this.detach();
            if (this.completions.filtered.length == 1 && this.completions.filtered[0].value == prefix && !this.completions.filtered[0].snippet) {
                return this.detach();
            }
            this.openPopup(this.editor, prefix, keepPopupPosition);
        }
        else {
            var _id = this.gatherCompletionsId;
            var editor = this.editor;
            var session = editor.getSession();
            var line = session.getLine(pos.row);
            prefix = retrievePrecedingIdentifier(line, pos.column);
            this.getCompletions(this.editor, session, this.editor.getCursorPosition(), prefix, function (err, results) {
                var detachIfFinished = function () {
                    if (!results.finished)
                        return;
                    return this.detach();
                }.bind(this);
                var prefix = results.prefix;
                var matches = results && results.matches;
                if (!matches || !matches.length)
                    return detachIfFinished();
                if (prefix.indexOf(results.prefix) !== 0 || _id != this.gatherCompletionsId)
                    return;
                this.completions = new FilteredList(matches);
                this.completions.setFilter(prefix);
                var filtered = this.completions.filtered;
                if (!filtered.length)
                    return detachIfFinished();
                if (filtered.length == 1 && filtered[0].value == prefix && !filtered[0].snippet)
                    return detachIfFinished();
                if (this.autoInsert && filtered.length == 1)
                    return this.insertMatch(filtered[0]);
                this.openPopup(this.editor, prefix, keepPopupPosition);
            }.bind(this));
        }
    }
    openPopup(editor, prefix, keepPopupPosition) {
        if (!this.popup) {
            this.popup = new ListViewPopup(document.body || document.documentElement);
            this.popup.on("click", function (e) { this.insertMatch(); e.stop(); }.bind(this));
            this.popup.focus = this.editor.focus.bind(this.editor);
        }
        this.popup.setData(this.completions.filtered);
        this.popup.setRow(this.autoSelect ? 0 : -1);
        if (!keepPopupPosition) {
            this.popup.setTheme(editor.getTheme());
            this.popup.setFontSize(editor.getFontSize());
            var lineHeight = editor.renderer.layerConfig.lineHeight;
            var pos = editor.renderer.$cursorLayer.getPixelPosition(this.base, true);
            pos.left -= this.popup.getTextLeftOffset();
            var rect = editor.container.getBoundingClientRect();
            pos.top += rect.top - editor.renderer.layerConfig.offset;
            pos.left += rect.left - editor.renderer.scrollLeft;
            pos.left += editor.renderer.$gutterLayer.gutterWidth;
            this.popup.show(pos, lineHeight);
        }
    }
    changeListener(e) {
        var cursor = this.editor.selection.lead;
        if (cursor.row != this.base.row || cursor.column < this.base.column) {
            this.detach();
        }
        if (this.activated)
            this.changeTimer.schedule();
        else
            this.detach();
    }
    blurListener() {
        var el = document.activeElement;
        if (el != this.editor.textInput.getElement() && el.parentNode != this.popup.container) {
            this.detach();
        }
    }
    mousedownListener(e) {
        this.detach();
    }
    mousewheelListener(e) {
        this.detach();
    }
    cancelContextMenu() {
        this.editor.cancelMouseContextMenu();
    }
}
export class Autocomplete {
}
Autocomplete.startCommand = {
    name: "startAutocomplete",
    exec: function (editor) {
        var aggregate = getCompleter(editor);
        if (!aggregate) {
            aggregate = new CompleterAggregate(editor);
            setCompleter(editor, aggregate);
        }
        aggregate.autoInsert = true;
        aggregate.autoSelect = true;
        aggregate.showPopup(editor);
        aggregate.cancelContextMenu();
    },
    bindKey: "Ctrl-Space|Ctrl-Shift-Space|Alt-Space"
};
export class FilteredList {
    constructor(all, filterText, mutateData) {
        this.all = all;
        this.filtered = all;
        this.filterText = filterText || "";
    }
    setFilter(str) {
        var matches;
        if (str.length > this.filterText && str.lastIndexOf(this.filterText, 0) === 0)
            matches = this.filtered;
        else
            matches = this.all;
        this.filterText = str;
        matches = this.filterCompletions(matches, this.filterText);
        matches = matches.sort(function (a, b) {
            return b.exactMatch - a.exactMatch || b.score - a.score;
        });
        var prev = null;
        matches = matches.filter(function (item) {
            var caption = item.value || item.caption || item.snippet;
            if (caption === prev)
                return false;
            prev = caption;
            return true;
        });
        this.filtered = matches;
    }
    filterCompletions(items, needle) {
        var results = [];
        var upper = needle.toUpperCase();
        var lower = needle.toLowerCase();
        loop: for (var i = 0, length = items.length; i < length; i++) {
            var item = items[i];
            var caption = item.value || item.caption || item.snippet;
            if (!caption)
                continue;
            var lastIndex = -1;
            var matchMask = 0;
            var penalty = 0;
            var index, distance;
            for (var j = 0; j < needle.length; j++) {
                var i1 = caption.indexOf(lower[j], lastIndex + 1);
                var i2 = caption.indexOf(upper[j], lastIndex + 1);
                index = (i1 >= 0) ? ((i2 < 0 || i1 < i2) ? i1 : i2) : i2;
                if (index < 0)
                    continue loop;
                distance = index - lastIndex - 1;
                if (distance > 0) {
                    if (lastIndex === -1)
                        penalty += 10;
                    penalty += distance;
                }
                matchMask = matchMask | (1 << index);
                lastIndex = index;
            }
            item.matchMask = matchMask;
            item.exactMatch = penalty ? 0 : 1;
            item.score = (item.score || 0) - penalty;
            results.push(item);
        }
        return results;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b2NvbXBsZXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2F1dG9jb21wbGV0ZS50cyJdLCJuYW1lcyI6WyJnZXRDb21wbGV0ZXIiLCJzZXRDb21wbGV0ZXIiLCJDb21wbGV0ZXJBZ2dyZWdhdGUiLCJDb21wbGV0ZXJBZ2dyZWdhdGUuY29uc3RydWN0b3IiLCJDb21wbGV0ZXJBZ2dyZWdhdGUuaW5zZXJ0TWF0Y2giLCJDb21wbGV0ZXJBZ2dyZWdhdGUuZGV0YWNoIiwiQ29tcGxldGVyQWdncmVnYXRlLmdvVG8iLCJDb21wbGV0ZXJBZ2dyZWdhdGUuZ2V0Q29tcGxldGlvbnMiLCJDb21wbGV0ZXJBZ2dyZWdhdGUudXBkYXRlQ29tcGxldGlvbnMiLCJDb21wbGV0ZXJBZ2dyZWdhdGUub3BlblBvcHVwIiwiQ29tcGxldGVyQWdncmVnYXRlLmNoYW5nZUxpc3RlbmVyIiwiQ29tcGxldGVyQWdncmVnYXRlLmJsdXJMaXN0ZW5lciIsIkNvbXBsZXRlckFnZ3JlZ2F0ZS5tb3VzZWRvd25MaXN0ZW5lciIsIkNvbXBsZXRlckFnZ3JlZ2F0ZS5tb3VzZXdoZWVsTGlzdGVuZXIiLCJDb21wbGV0ZXJBZ2dyZWdhdGUuY2FuY2VsQ29udGV4dE1lbnUiLCJBdXRvY29tcGxldGUiLCJGaWx0ZXJlZExpc3QiLCJGaWx0ZXJlZExpc3QuY29uc3RydWN0b3IiLCJGaWx0ZXJlZExpc3Quc2V0RmlsdGVyIiwiRmlsdGVyZWRMaXN0LmZpbHRlckNvbXBsZXRpb25zIl0sIm1hcHBpbmdzIjoiT0E4Qk8sRUFBQyxXQUFXLEVBQUMsTUFBTSx5QkFBeUI7T0FDNUMsRUFBQyxhQUFhLEVBQUMsTUFBTSxzQkFBc0I7T0FDM0MsRUFBQywyQkFBMkIsRUFBQyxNQUFNLHFCQUFxQjtPQUV4RCxFQUFDLFdBQVcsRUFBQyxNQUFNLFlBQVk7T0FDL0IsRUFBQyxjQUFjLEVBQUMsTUFBTSxZQUFZO0FBS3pDLElBQUksb0JBQW9CLEdBQUcsV0FBVyxDQUFDO0FBTXZDLDZCQUE2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LElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBLFlBQVlBLENBQUNBLEVBQUVBLEtBQUtBLEVBQUVBLElBQUlBLENBQUNBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBO1lBQzFFQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxJQUFJQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxVQUFVQSxDQUFDQTtnQkFDdENBLE1BQU1BLENBQUNBO1lBQ1hBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLFNBQVNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1lBQ25DQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxRQUFRQSxDQUFDQSxNQUFNQSxDQUFDQTtnQkFDbENBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO1lBRXpCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxRQUFRQSxDQUFDQSxNQUFNQSxJQUFJQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxLQUFLQSxJQUFJQSxNQUFNQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDaklBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO1lBQ3pCQSxDQUFDQTtZQUVEQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxNQUFNQSxFQUFFQSxpQkFBaUJBLENBQUNBLENBQUNBO1FBQzNEQSxDQUFDQTtRQUNEQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUVGQSxJQUFJQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxtQkFBbUJBLENBQUNBO1lBQ25DQSxJ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QUFDQTtZQUMxRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsT0FBT0EsRUFBRUEsVUFBU0EsQ0FBQ0EsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQ2pGQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUMzREEsQ0FBQ0E7UUFFREEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFFOUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRTVDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxpQkFBaUJBLENBQUNBLENBQUNBLENBQUNBO1lBQ3JCQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxRQUFRQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUN2Q0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFFN0NBLElBQUlBLFVBQVVBLEdBQUdBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLFdBQVdBLENBQUNBLFVBQVVBLENBQUNBO1lBRXhEQSxJQUFJQSxHQUFHQSxHQUFrQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxD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QUFHQSxDQUFDQSxDQUFDQTtnQkFDakNBLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO29CQUVmQSxFQUFFQSxDQUFDQSxDQUFDQSxTQUFTQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDakJBLE9BQU9BLElBQUlBLEVBQUVBLENBQUNBO29CQUNsQkEsT0FBT0EsSUFBSUEsUUFBUUEsQ0FBQ0E7Z0JBQ3hCQSxDQUFDQTtnQkFDREEsU0FBU0EsR0FBR0EsU0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3JDQSxTQUFTQSxHQUFHQSxLQUFLQSxDQUFDQTtZQUN0QkEsQ0FBQ0E7WUFDREEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsU0FBU0EsQ0FBQ0E7WUFDM0JBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLE9BQU9BLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ2xDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQTtZQUN6Q0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDdkJBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBO0lBQ25CQSxDQUFDQTtBQUNMSCxDQUFDQTtBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMiwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXRcbiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuICogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlXG4gKiAgICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICogICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBBamF4Lm9yZyBCLlYuIG5vciB0aGVcbiAqICAgICAgIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzXG4gKiAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cbiAqXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkRcbiAqIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEXG4gKiBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFXG4gKiBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBBSkFYLk9SRyBCLlYuIEJFIExJQUJMRSBGT1IgQU5ZXG4gKiBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFU1xuICogKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTO1xuICogTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EXG4gKiBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVNcbiAqIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICpcbiAqICoqKioqIEVORCBMSUNFTlNFIEJMT0NLICoqKioqICovXG5cbmltcG9ydCB7SGFzaEhhbmRsZXJ9IGZyb20gXCIuL2tleWJvYXJkL2hhc2hfaGFuZGxlclwiO1xuaW1wb3J0IHtMaXN0Vmlld1BvcHVwfSBmcm9tIFwiLi9hdXRvY29tcGxldGUvcG9wdXBcIjtcbmltcG9ydCB7cmV0cmlldmVQcmVjZWRpbmdJZGVudGlmaWVyfSBmcm9tIFwiLi9hdXRvY29tcGxldGUvdXRpbFwiO1xuaW1wb3J0IHt9IGZyb20gXCIuL2xpYi9ldmVudFwiO1xuaW1wb3J0IHtkZWxheWVkQ2FsbH0gZnJvbSBcIi4vbGliL2xhbmdcIjtcbmltcG9ydCB7c25pcHBldE1hbmFnZXJ9IGZyb20gXCIuL3NuaXBwZXRzXCI7XG5pbXBvcnQgRWRpdG9yIGZyb20gJy4vRWRpdG9yJztcbmltcG9ydCB7RWRpdFNlc3Npb259IGZyb20gJy4vZWRpdF9zZXNzaW9uJztcbmltcG9ydCB7QW5jaG9yfSBmcm9tICcuL2FuY2hvcic7XG5cbnZhciBFRElUT1JfRVhUX0NPTVBMRVRFUiA9ICdjb21wbGV0ZXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbXBsZXRlciB7XG4gICAgZ2V0Q29tcGxldGlvbnMoZWRpdG9yOiBFZGl0b3IsIHNlc3Npb246IEVkaXRTZXNzaW9uLCBwb3M6IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0sIHByZWZpeDogc3RyaW5nLCBjYWxsYmFjayk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb21wbGV0ZXIoZWRpdG9yOiBFZGl0b3IpOiBDb21wbGV0ZXJBZ2dyZWdhdGUge1xuICAgIHJldHVybiBlZGl0b3JbRURJVE9SX0VYVF9DT01QTEVURVJdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0Q29tcGxldGVyKGVkaXRvcjogRWRpdG9yLCBjb21wbGV0ZXI6IENvbXBsZXRlckFnZ3JlZ2F0ZSkge1xuICAgIGVkaXRvcltFRElUT1JfRVhUX0NPTVBMRVRFUl0gPSBjb21wbGV0ZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBDb21wbGV0ZXJBZ2dyZWdhdGUgaW1wbGVtZW50cyBDb21wbGV0ZXIge1xuICAgIHByaXZhdGUgZWRpdG9yOiBFZGl0b3I7XG4gICAgcHJpdmF0ZSBrZXlib2FyZEhhbmRsZXIgPSBuZXcgSGFzaEhhbmRsZXIoKTtcbiAgICBwdWJsaWMgYWN0aXZhdGVkOiBib29sZWFuO1xuICAgIHByaXZhdGUgY2hhbmdlVGltZXI7XG4gICAgcHJpdmF0ZSBnYXRoZXJDb21wbGV0aW9uc0lkID0gMDtcbiAgICBwcml2YXRlIGJhc2U6IEFuY2hvcjtcbiAgICBwcml2YXRlIGNvbXBsZXRpb25zOiB7IGZpbHRlcmVkOyBmaWx0ZXJUZXh0OyBzZXRGaWx0ZXIgfTtcbiAgICBwcml2YXRlIGNvbW1hbmRzO1xuICAgIHB1YmxpYyBhdXRvU2VsZWN0ID0gdHJ1ZTtcbiAgICBwdWJsaWMgYXV0b0luc2VydCA9IHRydWU7XG4gICAgY29uc3RydWN0b3IoZWRpdG9yOiBFZGl0b3IpIHtcbiAgICAgICAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG4gICAgICAgIHRoaXMuY29tbWFuZHMgPSB7XG4gICAgICAgICAgICBcIlVwXCI6IGZ1bmN0aW9uKGVkaXRvcjogRWRpdG9yKSB7IGdldENvbXBsZXRlcihlZGl0b3IpLmdvVG8oXCJ1cFwiKTsgfSxcbiAgICAgICAgICAgIFwiRG93blwiOiBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikgeyBnZXRDb21wbGV0ZXIoZWRpdG9yKS5nb1RvKFwiZG93blwiKTsgfSxcbiAgICAgICAgICAgIFwiQ3RybC1VcHxDdHJsLUhvbWVcIjogZnVuY3Rpb24oZWRpdG9yOiBFZGl0b3IpIHsgZ2V0Q29tcGxldGVyKGVkaXRvcikuZ29UbyhcInN0YXJ0XCIpOyB9LFxuICAgICAgICAgICAgXCJDdHJsLURvd258Q3RybC1FbmRcIjogZnVuY3Rpb24oZWRpdG9yOiBFZGl0b3IpIHsgZ2V0Q29tcGxldGVyKGVkaXRvcikuZ29UbyhcImVuZFwiKTsgfSxcblxuICAgICAgICAgICAgXCJFc2NcIjogZnVuY3Rpb24oZWRpdG9yOiBFZGl0b3IpIHsgZ2V0Q29tcGxldGVyKGVkaXRvcikuZGV0YWNoKCk7IH0sXG4gICAgICAgICAgICBcIlNwYWNlXCI6IGZ1bmN0aW9uKGVkaXRvcjogRWRpdG9yKSB7IGdldENvbXBsZXRlcihlZGl0b3IpLmRldGFjaCgpOyBlZGl0b3IuaW5zZXJ0KFwiIFwiKTsgfSxcbiAgICAgICAgICAgIFwiUmV0dXJuXCI6IGZ1bmN0aW9uKGVkaXRvcjogRWRpdG9yKSB7IHJldHVybiBnZXRDb21wbGV0ZXIoZWRpdG9yKS5pbnNlcnRNYXRjaCgpOyB9LFxuICAgICAgICAgICAgXCJTaGlmdC1SZXR1cm5cIjogZnVuY3Rpb24oZWRpdG9yOiBFZGl0b3IpIHsgZ2V0Q29tcGxldGVyKGVkaXRvcikuaW5zZXJ0TWF0Y2godHJ1ZSk7IH0sXG4gICAgICAgICAgICBcIlRhYlwiOiBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikge1xuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBnZXRDb21wbGV0ZXIoZWRpdG9yKS5pbnNlcnRNYXRjaCgpO1xuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0ICYmICFlZGl0b3JbJ3RhYnN0b3BNYW5hZ2VyJ10pIHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0Q29tcGxldGVyKGVkaXRvcikuZ29UbyhcImRvd25cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIFwiUGFnZVVwXCI6IGZ1bmN0aW9uKGVkaXRvcjogRWRpdG9yKSB7IGdldENvbXBsZXRlcihlZGl0b3IpLmdvVG8oJ3BhZ2VVcCcpOyB9LFxuICAgICAgICAgICAgXCJQYWdlRG93blwiOiBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikgeyBnZXRDb21wbGV0ZXIoZWRpdG9yKS5nb1RvKCdwYWdlRG93bicpOyB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5rZXlib2FyZEhhbmRsZXIuYmluZEtleXModGhpcy5jb21tYW5kcyk7XG5cbiAgICAgICAgdGhpcy5ibHVyTGlzdGVuZXIgPSB0aGlzLmJsdXJMaXN0ZW5lci5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLmNoYW5nZUxpc3RlbmVyID0gdGhpcy5jaGFuZ2VMaXN0ZW5lci5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm1vdXNlZG93bkxpc3RlbmVyID0gdGhpcy5tb3VzZWRvd25MaXN0ZW5lci5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm1vdXNld2hlZWxMaXN0ZW5lciA9IHRoaXMubW91c2V3aGVlbExpc3RlbmVyLmJpbmQodGhpcyk7XG5cbiAgICAgICAgdGhpcy5jaGFuZ2VUaW1lciA9IGRlbGF5ZWRDYWxsKGZ1bmN0aW9uKCkgeyB0aGlzLnVwZGF0ZUNvbXBsZXRpb25zKHRydWUpOyB9LmJpbmQodGhpcykpO1xuICAgIH1cbiAgICBwdWJsaWMgcG9wdXA6IExpc3RWaWV3UG9wdXA7XG5cbiAgICAvKipcbiAgICAgKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgQ29tcGxldGVyIGludGVyZmFjZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgaW5zZXJ0TWF0Y2goZGF0YT8pIHtcbiAgICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgICAgICBkYXRhID0gdGhpcy5wb3B1cC5nZXREYXRhKHRoaXMucG9wdXAuZ2V0Um93KCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5jb21wbGV0ZXIgJiYgZGF0YS5jb21wbGV0ZXIuaW5zZXJ0TWF0Y2gpIHtcbiAgICAgICAgICAgIGRhdGEuY29tcGxldGVyLmluc2VydE1hdGNoKHRoaXMuZWRpdG9yKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBsZXRpb25zLmZpbHRlclRleHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmFuZ2VzID0gdGhpcy5lZGl0b3Iuc2VsZWN0aW9uWydnZXRBbGxSYW5nZXMnXSgpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IEFzc2lnbm1lbnQgaW4gY29uZGl0aW9uYWwgZXhwcmVzc2lvbi5cbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBBc3NpZ25tZW50IGluIGNvbmRpdGlvbmFsIGV4cHJlc3Npb24uXG4gICAgICAgICAgICAgICAgLy8gSXQncyBjdXRlIGJ1dCBhbHNvIG1heSBoYWx0IHByZW1hdHVyZWx5IGFuZCBzbyBoaWRlIGJ1Z3MuXG4gICAgICAgICAgICAgICAgLy8gUmVwbGFjZSBieSBsZW5ndGggdmFyaWFibGUgYW5kIHRlc3Q/XG4gICAgICAgICAgICAgICAgLy8gVXNlIGFzc2VydGlvbiB3aXRoaW4gdGhlIGxvb3AgdG8gbG9vayBmb3IgZmFsc2V5IHZhbHVlcy5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgcmFuZ2U7IHJhbmdlID0gcmFuZ2VzW2ldOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2Uuc3RhcnQuY29sdW1uIC09IHRoaXMuY29tcGxldGlvbnMuZmlsdGVyVGV4dC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLnNlc3Npb24ucmVtb3ZlKHJhbmdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGF0YS5zbmlwcGV0KSB7XG4gICAgICAgICAgICAgICAgc25pcHBldE1hbmFnZXIuaW5zZXJ0U25pcHBldCh0aGlzLmVkaXRvciwgZGF0YS5zbmlwcGV0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLmV4ZWNDb21tYW5kKFwiaW5zZXJ0c3RyaW5nXCIsIGRhdGEudmFsdWUgfHwgZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kZXRhY2goKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgQ29tcGxldGVyIGludGVyZmFjZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgZGV0YWNoKCkge1xuICAgICAgICB0aGlzLmVkaXRvci5rZXlCaW5kaW5nLnJlbW92ZUtleWJvYXJkSGFuZGxlcih0aGlzLmtleWJvYXJkSGFuZGxlcik7XG4gICAgICAgIHRoaXMuZWRpdG9yLm9mZihcImNoYW5nZVNlbGVjdGlvblwiLCB0aGlzLmNoYW5nZUxpc3RlbmVyKTtcbiAgICAgICAgdGhpcy5lZGl0b3Iub2ZmKFwiYmx1clwiLCB0aGlzLmJsdXJMaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuZWRpdG9yLm9mZihcIm1vdXNlZG93blwiLCB0aGlzLm1vdXNlZG93bkxpc3RlbmVyKTtcbiAgICAgICAgdGhpcy5lZGl0b3Iub2ZmKFwibW91c2V3aGVlbFwiLCB0aGlzLm1vdXNld2hlZWxMaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuY2hhbmdlVGltZXIuY2FuY2VsKCk7XG5cbiAgICAgICAgaWYgKHRoaXMucG9wdXAgJiYgdGhpcy5wb3B1cC5pc09wZW4pIHtcbiAgICAgICAgICAgIHRoaXMuZ2F0aGVyQ29tcGxldGlvbnNJZCArPSAxO1xuICAgICAgICAgICAgdGhpcy5wb3B1cC5oaWRlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5iYXNlKVxuICAgICAgICAgICAgdGhpcy5iYXNlLmRldGFjaCgpO1xuICAgICAgICB0aGlzLmFjdGl2YXRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNvbXBsZXRpb25zID0gdGhpcy5iYXNlID0gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgQ29tcGxldGVyIGludGVyZmFjZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ29Ubyh3aGVyZTogc3RyaW5nKSB7XG4gICAgICAgIHZhciByb3cgPSB0aGlzLnBvcHVwLmdldFJvdygpO1xuICAgICAgICB2YXIgbWF4ID0gdGhpcy5wb3B1cC5nZXRMZW5ndGgoKSAtIDE7XG5cbiAgICAgICAgc3dpdGNoICh3aGVyZSkge1xuICAgICAgICAgICAgY2FzZSBcInVwXCI6IHJvdyA9IHJvdyA8PSAwID8gbWF4IDogcm93IC0gMTsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZG93blwiOiByb3cgPSByb3cgPj0gbWF4ID8gLTEgOiByb3cgKyAxOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJzdGFydFwiOiByb3cgPSAwOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJlbmRcIjogcm93ID0gbWF4OyBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucG9wdXAuc2V0Um93KHJvdyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW1wbGVtZW50YXRpb24gb2YgdGhlIENvbXBsZXRlciBpbnRlcmZhY2UuXG4gICAgICovXG4gICAgcHVibGljIGdldENvbXBsZXRpb25zKGVkaXRvcjogRWRpdG9yLCBzZXNzaW9uLCBwb3M6IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0sIHByZWZpeDogc3RyaW5nLCBjYWxsYmFjaykge1xuXG4gICAgICAgIHRoaXMuYmFzZSA9IHNlc3Npb24uZG9jLmNyZWF0ZUFuY2hvcihwb3Mucm93LCBwb3MuY29sdW1uIC0gcHJlZml4Lmxlbmd0aCk7XG5cbiAgICAgICAgdmFyIG1hdGNoZXMgPSBbXTtcbiAgICAgICAgdmFyIHRvdGFsID0gZWRpdG9yLmNvbXBsZXRlcnMubGVuZ3RoO1xuICAgICAgICBlZGl0b3IuY29tcGxldGVycy5mb3JFYWNoKGZ1bmN0aW9uKGNvbXBsZXRlcjogQ29tcGxldGVyLCBpKSB7XG4gICAgICAgICAgICBjb21wbGV0ZXIuZ2V0Q29tcGxldGlvbnMoZWRpdG9yLCBzZXNzaW9uLCBwb3MsIHByZWZpeCwgZnVuY3Rpb24oZXJyLCByZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFlcnIpXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZXMgPSBtYXRjaGVzLmNvbmNhdChyZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAvLyBGZXRjaCBwcmVmaXggYWdhaW4sIGJlY2F1c2UgdGhleSBtYXkgaGF2ZSBjaGFuZ2VkIGJ5IG5vd1xuICAgICAgICAgICAgICAgIHZhciBwb3M6IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0gPSBlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICB2YXIgbGluZSA9IHNlc3Npb24uZ2V0TGluZShwb3Mucm93KTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgICAgICAgICAgIHByZWZpeDogcmV0cmlldmVQcmVjZWRpbmdJZGVudGlmaWVyKGxpbmUsIHBvcy5jb2x1bW4sIHJlc3VsdHNbMF0gJiYgcmVzdWx0c1swXS5pZGVudGlmaWVyUmVnZXgpLFxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVzOiBtYXRjaGVzLFxuICAgICAgICAgICAgICAgICAgICBmaW5pc2hlZDogKC0tdG90YWwgPT09IDApXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlQ29tcGxldGlvbnMoa2VlcFBvcHVwUG9zaXRpb246IGJvb2xlYW4pIHtcbiAgICAgICAgdmFyIHBvcyA9IHRoaXMuZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCk7XG4gICAgICAgIHZhciBwcmVmaXg6IHN0cmluZztcbiAgICAgICAgaWYgKGtlZXBQb3B1cFBvc2l0aW9uICYmIHRoaXMuYmFzZSAmJiB0aGlzLmNvbXBsZXRpb25zKSB7XG4gICAgICAgICAgICBwcmVmaXggPSB0aGlzLmVkaXRvci5zZXNzaW9uLmdldFRleHRSYW5nZSh7IHN0YXJ0OiB0aGlzLmJhc2UsIGVuZDogcG9zIH0pO1xuICAgICAgICAgICAgaWYgKHByZWZpeCA9PSB0aGlzLmNvbXBsZXRpb25zLmZpbHRlclRleHQpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0aW9ucy5zZXRGaWx0ZXIocHJlZml4KTtcbiAgICAgICAgICAgIGlmICghdGhpcy5jb21wbGV0aW9ucy5maWx0ZXJlZC5sZW5ndGgpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGV0YWNoKCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBsZXRpb25zLmZpbHRlcmVkLmxlbmd0aCA9PSAxICYmIHRoaXMuY29tcGxldGlvbnMuZmlsdGVyZWRbMF0udmFsdWUgPT0gcHJlZml4ICYmICF0aGlzLmNvbXBsZXRpb25zLmZpbHRlcmVkWzBdLnNuaXBwZXQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kZXRhY2goKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5vcGVuUG9wdXAodGhpcy5lZGl0b3IsIHByZWZpeCwga2VlcFBvcHVwUG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gU2F2ZSBjdXJyZW50IGdhdGhlckNvbXBsZXRpb25zIHNlc3Npb24sIHNlc3Npb24gaXMgY2xvc2Ugd2hlbiBhIG1hdGNoIGlzIGluc2VydFxuICAgICAgICAgICAgdmFyIF9pZCA9IHRoaXMuZ2F0aGVyQ29tcGxldGlvbnNJZDtcbiAgICAgICAgICAgIHZhciBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgICAgIHZhciBzZXNzaW9uID0gZWRpdG9yLmdldFNlc3Npb24oKTtcbiAgICAgICAgICAgIHZhciBsaW5lID0gc2Vzc2lvbi5nZXRMaW5lKHBvcy5yb3cpO1xuICAgICAgICAgICAgcHJlZml4ID0gcmV0cmlldmVQcmVjZWRpbmdJZGVudGlmaWVyKGxpbmUsIHBvcy5jb2x1bW4pO1xuICAgICAgICAgICAgdGhpcy5nZXRDb21wbGV0aW9ucyh0aGlzLmVkaXRvciwgc2Vzc2lvbiwgdGhpcy5lZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKSwgcHJlZml4LCBmdW5jdGlvbihlcnIsIHJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICAvLyBPbmx5IGRldGFjaCBpZiByZXN1bHQgZ2F0aGVyaW5nIGlzIGZpbmlzaGVkXG4gICAgICAgICAgICAgICAgdmFyIGRldGFjaElmRmluaXNoZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXN1bHRzLmZpbmlzaGVkKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRldGFjaCgpO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKTtcblxuICAgICAgICAgICAgICAgIHZhciBwcmVmaXggPSByZXN1bHRzLnByZWZpeDtcbiAgICAgICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHJlc3VsdHMgJiYgcmVzdWx0cy5tYXRjaGVzO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFtYXRjaGVzIHx8ICFtYXRjaGVzLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRldGFjaElmRmluaXNoZWQoKTtcbiAgICBcbiAgICAgICAgICAgICAgICAvLyBXcm9uZyBwcmVmaXggb3Igd3Jvbmcgc2Vzc2lvbiAtPiBpZ25vcmVcbiAgICAgICAgICAgICAgICBpZiAocHJlZml4LmluZGV4T2YocmVzdWx0cy5wcmVmaXgpICE9PSAwIHx8IF9pZCAhPSB0aGlzLmdhdGhlckNvbXBsZXRpb25zSWQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGlvbnMgPSBuZXcgRmlsdGVyZWRMaXN0KG1hdGNoZXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGlvbnMuc2V0RmlsdGVyKHByZWZpeCk7XG4gICAgICAgICAgICAgICAgdmFyIGZpbHRlcmVkID0gdGhpcy5jb21wbGV0aW9ucy5maWx0ZXJlZDtcbiAgICBcbiAgICAgICAgICAgICAgICAvLyBObyByZXN1bHRzXG4gICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXJlZC5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXRhY2hJZkZpbmlzaGVkKCk7XG4gICAgXG4gICAgICAgICAgICAgICAgLy8gT25lIHJlc3VsdCBlcXVhbHMgdG8gdGhlIHByZWZpeFxuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZC5sZW5ndGggPT0gMSAmJiBmaWx0ZXJlZFswXS52YWx1ZSA9PSBwcmVmaXggJiYgIWZpbHRlcmVkWzBdLnNuaXBwZXQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXRhY2hJZkZpbmlzaGVkKCk7XG4gICAgXG4gICAgICAgICAgICAgICAgLy8gQXV0b2luc2VydCBpZiBvbmUgcmVzdWx0XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYXV0b0luc2VydCAmJiBmaWx0ZXJlZC5sZW5ndGggPT0gMSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0TWF0Y2goZmlsdGVyZWRbMF0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuUG9wdXAodGhpcy5lZGl0b3IsIHByZWZpeCwga2VlcFBvcHVwUG9zaXRpb24pO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgb3BlblBvcHVwKGVkaXRvcjogRWRpdG9yLCBwcmVmaXg6IHN0cmluZywga2VlcFBvcHVwUG9zaXRpb246IGJvb2xlYW4pIHtcbiAgICAgICAgaWYgKCF0aGlzLnBvcHVwKSB7XG4gICAgICAgICAgICB0aGlzLnBvcHVwID0gbmV3IExpc3RWaWV3UG9wdXAoZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5wb3B1cC5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpIHsgdGhpcy5pbnNlcnRNYXRjaCgpOyBlLnN0b3AoKTsgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIHRoaXMucG9wdXAuZm9jdXMgPSB0aGlzLmVkaXRvci5mb2N1cy5iaW5kKHRoaXMuZWRpdG9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucG9wdXAuc2V0RGF0YSh0aGlzLmNvbXBsZXRpb25zLmZpbHRlcmVkKTtcblxuICAgICAgICB0aGlzLnBvcHVwLnNldFJvdyh0aGlzLmF1dG9TZWxlY3QgPyAwIDogLTEpO1xuXG4gICAgICAgIGlmICgha2VlcFBvcHVwUG9zaXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMucG9wdXAuc2V0VGhlbWUoZWRpdG9yLmdldFRoZW1lKCkpO1xuICAgICAgICAgICAgdGhpcy5wb3B1cC5zZXRGb250U2l6ZShlZGl0b3IuZ2V0Rm9udFNpemUoKSk7XG5cbiAgICAgICAgICAgIHZhciBsaW5lSGVpZ2h0ID0gZWRpdG9yLnJlbmRlcmVyLmxheWVyQ29uZmlnLmxpbmVIZWlnaHQ7XG5cbiAgICAgICAgICAgIHZhciBwb3M6IHsgbGVmdDogbnVtYmVyOyB0b3A6IG51bWJlciB9ID0gZWRpdG9yLnJlbmRlcmVyLiRjdXJzb3JMYXllci5nZXRQaXhlbFBvc2l0aW9uKHRoaXMuYmFzZSwgdHJ1ZSk7XG4gICAgICAgICAgICBwb3MubGVmdCAtPSB0aGlzLnBvcHVwLmdldFRleHRMZWZ0T2Zmc2V0KCk7XG5cbiAgICAgICAgICAgIHZhciByZWN0ID0gZWRpdG9yLmNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgIHBvcy50b3AgKz0gcmVjdC50b3AgLSBlZGl0b3IucmVuZGVyZXIubGF5ZXJDb25maWcub2Zmc2V0O1xuICAgICAgICAgICAgcG9zLmxlZnQgKz0gcmVjdC5sZWZ0IC0gZWRpdG9yLnJlbmRlcmVyLnNjcm9sbExlZnQ7XG4gICAgICAgICAgICBwb3MubGVmdCArPSBlZGl0b3IucmVuZGVyZXIuJGd1dHRlckxheWVyLmd1dHRlcldpZHRoO1xuXG4gICAgICAgICAgICB0aGlzLnBvcHVwLnNob3cocG9zLCBsaW5lSGVpZ2h0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY2hhbmdlTGlzdGVuZXIoZSkge1xuICAgICAgICB2YXIgY3Vyc29yID0gdGhpcy5lZGl0b3Iuc2VsZWN0aW9uLmxlYWQ7XG4gICAgICAgIGlmIChjdXJzb3Iucm93ICE9IHRoaXMuYmFzZS5yb3cgfHwgY3Vyc29yLmNvbHVtbiA8IHRoaXMuYmFzZS5jb2x1bW4pIHtcbiAgICAgICAgICAgIHRoaXMuZGV0YWNoKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYWN0aXZhdGVkKVxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VUaW1lci5zY2hlZHVsZSgpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLmRldGFjaCgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYmx1ckxpc3RlbmVyKCkge1xuICAgICAgICAvLyB3ZSBoYXZlIHRvIGNoZWNrIGlmIGFjdGl2ZUVsZW1lbnQgaXMgYSBjaGlsZCBvZiBwb3B1cCBiZWNhdXNlXG4gICAgICAgIC8vIG9uIElFIHByZXZlbnREZWZhdWx0IGRvZXNuJ3Qgc3RvcCBzY3JvbGxiYXIgZnJvbSBiZWluZyBmb2N1c3NlZFxuICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuICAgICAgICBpZiAoZWwgIT0gdGhpcy5lZGl0b3IudGV4dElucHV0LmdldEVsZW1lbnQoKSAmJiBlbC5wYXJlbnROb2RlICE9IHRoaXMucG9wdXAuY29udGFpbmVyKSB7XG4gICAgICAgICAgICB0aGlzLmRldGFjaCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBtb3VzZWRvd25MaXN0ZW5lcihlKSB7XG4gICAgICAgIHRoaXMuZGV0YWNoKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBtb3VzZXdoZWVsTGlzdGVuZXIoZSkge1xuICAgICAgICB0aGlzLmRldGFjaCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzaG93UG9wdXAgPSBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikge1xuXG4gICAgICAgIGlmICh0aGlzLmVkaXRvcikge1xuICAgICAgICAgICAgdGhpcy5kZXRhY2goKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYWN0aXZhdGVkID0gdHJ1ZTtcblxuICAgICAgICB0aGlzLmVkaXRvciA9IGVkaXRvcjtcblxuICAgICAgICBpZiAoZ2V0Q29tcGxldGVyKGVkaXRvcikgIT0gdGhpcykge1xuICAgICAgICAgICAgaWYgKGdldENvbXBsZXRlcihlZGl0b3IpKSB7XG4gICAgICAgICAgICAgICAgZ2V0Q29tcGxldGVyKGVkaXRvcikuZGV0YWNoKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRDb21wbGV0ZXIoZWRpdG9yLCB0aGlzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVkaXRvci5rZXlCaW5kaW5nLmFkZEtleWJvYXJkSGFuZGxlcih0aGlzLmtleWJvYXJkSGFuZGxlcik7XG4gICAgICAgIGVkaXRvci5vbihcImNoYW5nZVNlbGVjdGlvblwiLCB0aGlzLmNoYW5nZUxpc3RlbmVyKTtcbiAgICAgICAgZWRpdG9yLm9uKFwiYmx1clwiLCB0aGlzLmJsdXJMaXN0ZW5lcik7XG4gICAgICAgIGVkaXRvci5vbihcIm1vdXNlZG93blwiLCB0aGlzLm1vdXNlZG93bkxpc3RlbmVyKTtcbiAgICAgICAgZWRpdG9yLm9uKFwibW91c2V3aGVlbFwiLCB0aGlzLm1vdXNld2hlZWxMaXN0ZW5lcik7XG5cbiAgICAgICAgdGhpcy51cGRhdGVDb21wbGV0aW9ucygpO1xuICAgIH1cbiAgICBwdWJsaWMgY2FuY2VsQ29udGV4dE1lbnUoKSB7XG4gICAgICAgIHRoaXMuZWRpdG9yLmNhbmNlbE1vdXNlQ29udGV4dE1lbnUoKTtcbiAgICB9XG59XG5cbi8vIFRPRE86IFNob3VsZCB3ZSBpbXBsZW1lbnQgQ29tcGxldGVyIG9yIGlzIGl0IHJlYWxseSBqdXN0IGltcGxlbWVudGF0aW9uP1xuZXhwb3J0IGNsYXNzIEF1dG9jb21wbGV0ZSB7XG4gICAgc3RhdGljIHN0YXJ0Q29tbWFuZCA9IHtcbiAgICAgICAgbmFtZTogXCJzdGFydEF1dG9jb21wbGV0ZVwiLFxuICAgICAgICBleGVjOiBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikge1xuICAgICAgICAgICAgdmFyIGFnZ3JlZ2F0ZTogQ29tcGxldGVyQWdncmVnYXRlID0gZ2V0Q29tcGxldGVyKGVkaXRvcik7XG4gICAgICAgICAgICBpZiAoIWFnZ3JlZ2F0ZSkge1xuICAgICAgICAgICAgICAgIGFnZ3JlZ2F0ZSA9IG5ldyBDb21wbGV0ZXJBZ2dyZWdhdGUoZWRpdG9yKTtcbiAgICAgICAgICAgICAgICBzZXRDb21wbGV0ZXIoZWRpdG9yLCBhZ2dyZWdhdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWdncmVnYXRlLmF1dG9JbnNlcnQgPSB0cnVlO1xuICAgICAgICAgICAgYWdncmVnYXRlLmF1dG9TZWxlY3QgPSB0cnVlO1xuICAgICAgICAgICAgYWdncmVnYXRlLnNob3dQb3B1cChlZGl0b3IpO1xuICAgICAgICAgICAgLy8gbmVlZGVkIGZvciBmaXJlZm94IG9uIG1hY1xuICAgICAgICAgICAgYWdncmVnYXRlLmNhbmNlbENvbnRleHRNZW51KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGJpbmRLZXk6IFwiQ3RybC1TcGFjZXxDdHJsLVNoaWZ0LVNwYWNlfEFsdC1TcGFjZVwiXG4gICAgfTtcbn1cblxuZXhwb3J0IGNsYXNzIEZpbHRlcmVkTGlzdCB7XG4gICAgcHJpdmF0ZSBhbGw7XG4gICAgcHJpdmF0ZSBmaWx0ZXJlZDtcbiAgICBwcml2YXRlIGZpbHRlclRleHQ6IHN0cmluZztcbiAgICBjb25zdHJ1Y3RvcihhbGwsIGZpbHRlclRleHQ/OiBzdHJpbmcsIG11dGF0ZURhdGE/KSB7XG4gICAgICAgIHRoaXMuYWxsID0gYWxsO1xuICAgICAgICB0aGlzLmZpbHRlcmVkID0gYWxsO1xuICAgICAgICB0aGlzLmZpbHRlclRleHQgPSBmaWx0ZXJUZXh0IHx8IFwiXCI7XG4gICAgfVxuICAgIHByaXZhdGUgc2V0RmlsdGVyKHN0cikge1xuICAgICAgICB2YXIgbWF0Y2hlcztcbiAgICAgICAgaWYgKHN0ci5sZW5ndGggPiB0aGlzLmZpbHRlclRleHQgJiYgc3RyLmxhc3RJbmRleE9mKHRoaXMuZmlsdGVyVGV4dCwgMCkgPT09IDApXG4gICAgICAgICAgICBtYXRjaGVzID0gdGhpcy5maWx0ZXJlZDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgbWF0Y2hlcyA9IHRoaXMuYWxsO1xuXG4gICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHN0cjtcbiAgICAgICAgbWF0Y2hlcyA9IHRoaXMuZmlsdGVyQ29tcGxldGlvbnMobWF0Y2hlcywgdGhpcy5maWx0ZXJUZXh0KTtcbiAgICAgICAgbWF0Y2hlcyA9IG1hdGNoZXMuc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gYi5leGFjdE1hdGNoIC0gYS5leGFjdE1hdGNoIHx8IGIuc2NvcmUgLSBhLnNjb3JlO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBtYWtlIHVuaXF1ZVxuICAgICAgICB2YXIgcHJldiA9IG51bGw7XG4gICAgICAgIG1hdGNoZXMgPSBtYXRjaGVzLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICB2YXIgY2FwdGlvbiA9IGl0ZW0udmFsdWUgfHwgaXRlbS5jYXB0aW9uIHx8IGl0ZW0uc25pcHBldDtcbiAgICAgICAgICAgIGlmIChjYXB0aW9uID09PSBwcmV2KSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBwcmV2ID0gY2FwdGlvbjtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmZpbHRlcmVkID0gbWF0Y2hlcztcbiAgICB9XG4gICAgcHJpdmF0ZSBmaWx0ZXJDb21wbGV0aW9ucyhpdGVtczogeyBjYXB0aW9uOyB2YWx1ZTsgc25pcHBldCB9W10sIG5lZWRsZTogc3RyaW5nKSB7XG4gICAgICAgIHZhciByZXN1bHRzID0gW107XG4gICAgICAgIHZhciB1cHBlciA9IG5lZWRsZS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICB2YXIgbG93ZXIgPSBuZWVkbGUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgLy8gVE9ETzogQXNzaWdubWVudCBpbiBjb25kaXRpb25hbCBleHByZXNzaW9uLlxuICAgICAgICAvLyBJdCdzIGN1dGUgYnV0IGFsc28gbWF5IGhhbHQgcHJlbWF0dXJlbHkgYW5kIHNvIGhpZGUgYnVncy5cbiAgICAgICAgLy8gUmVwbGFjZSBieSBsZW5ndGggdmFyaWFibGUgYW5kIHRlc3Q/XG4gICAgICAgIC8vIFVzZSBhc3NlcnRpb24gd2l0aGluIHRoZSBsb29wIHRvIGxvb2sgZm9yIGZhbHNleSB2YWx1ZXMuXG4gICAgICAgIGxvb3A6IGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBpdGVtcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW06IGFueSA9IGl0ZW1zW2ldO1xuICAgICAgICAgICAgdmFyIGNhcHRpb24gPSBpdGVtLnZhbHVlIHx8IGl0ZW0uY2FwdGlvbiB8fCBpdGVtLnNuaXBwZXQ7XG4gICAgICAgICAgICBpZiAoIWNhcHRpb24pIGNvbnRpbnVlO1xuICAgICAgICAgICAgdmFyIGxhc3RJbmRleCA9IC0xO1xuICAgICAgICAgICAgdmFyIG1hdGNoTWFzayA9IDA7XG4gICAgICAgICAgICB2YXIgcGVuYWx0eSA9IDA7XG4gICAgICAgICAgICB2YXIgaW5kZXgsIGRpc3RhbmNlO1xuICAgICAgICAgICAgLy8gY2FwdGlvbiBjaGFyIGl0ZXJhdGlvbiBpcyBmYXN0ZXIgaW4gQ2hyb21lIGJ1dCBzbG93ZXIgaW4gRmlyZWZveCwgc28gbGV0cyB1c2UgaW5kZXhPZlxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBuZWVkbGUubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPIGFkZCBwZW5hbHR5IG9uIGNhc2UgbWlzbWF0Y2hcbiAgICAgICAgICAgICAgICB2YXIgaTEgPSBjYXB0aW9uLmluZGV4T2YobG93ZXJbal0sIGxhc3RJbmRleCArIDEpO1xuICAgICAgICAgICAgICAgIHZhciBpMiA9IGNhcHRpb24uaW5kZXhPZih1cHBlcltqXSwgbGFzdEluZGV4ICsgMSk7XG4gICAgICAgICAgICAgICAgaW5kZXggPSAoaTEgPj0gMCkgPyAoKGkyIDwgMCB8fCBpMSA8IGkyKSA/IGkxIDogaTIpIDogaTI7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgMClcbiAgICAgICAgICAgICAgICAgICAgY29udGludWUgbG9vcDtcbiAgICAgICAgICAgICAgICBkaXN0YW5jZSA9IGluZGV4IC0gbGFzdEluZGV4IC0gMTtcbiAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGZpcnN0IGNoYXIgbWlzbWF0Y2ggc2hvdWxkIGJlIG1vcmUgc2Vuc2l0aXZlXG4gICAgICAgICAgICAgICAgICAgIGlmIChsYXN0SW5kZXggPT09IC0xKVxuICAgICAgICAgICAgICAgICAgICAgICAgcGVuYWx0eSArPSAxMDtcbiAgICAgICAgICAgICAgICAgICAgcGVuYWx0eSArPSBkaXN0YW5jZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbWF0Y2hNYXNrID0gbWF0Y2hNYXNrIHwgKDEgPDwgaW5kZXgpO1xuICAgICAgICAgICAgICAgIGxhc3RJbmRleCA9IGluZGV4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaXRlbS5tYXRjaE1hc2sgPSBtYXRjaE1hc2s7XG4gICAgICAgICAgICBpdGVtLmV4YWN0TWF0Y2ggPSBwZW5hbHR5ID8gMCA6IDE7XG4gICAgICAgICAgICBpdGVtLnNjb3JlID0gKGl0ZW0uc2NvcmUgfHwgMCkgLSBwZW5hbHR5O1xuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cbn1cbiJdfQ==