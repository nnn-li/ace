var hhm = require("./keyboard/hash_handler");
var pop = require("./autocomplete/popup");
var util = require("./autocomplete/util");
var lang = require("./lib/lang");
var snm = require("./snippets");
var EDITOR_EXT_COMPLETER = 'completer';
function getCompleter(editor) {
    return editor[EDITOR_EXT_COMPLETER];
}
exports.getCompleter = getCompleter;
function setCompleter(editor, completer) {
    editor[EDITOR_EXT_COMPLETER] = completer;
}
exports.setCompleter = setCompleter;
var CompleterAggregate = (function () {
    function CompleterAggregate(editor) {
        this.keyboardHandler = new hhm.HashHandler();
        this.gatherCompletionsId = 0;
        this.autoSelect = true;
        this.autoInsert = true;
        this.showPopup = function (editor) {
            if (this.editor) {
                this.detach();
            }
            this.activated = true;
            this.editor = editor;
            if (getCompleter(editor) != this) {
                if (getCompleter(editor)) {
                    getCompleter(editor).detach();
                }
                setCompleter(editor, this);
            }
            editor.keyBinding.addKeyboardHandler(this.keyboardHandler);
            editor.on("changeSelection", this.changeListener);
            editor.on("blur", this.blurListener);
            editor.on("mousedown", this.mousedownListener);
            editor.on("mousewheel", this.mousewheelListener);
            this.updateCompletions();
        };
        this.editor = editor;
        this.commands = {
            "Up": function (editor) { getCompleter(editor).goTo("up"); },
            "Down": function (editor) { getCompleter(editor).goTo("down"); },
            "Ctrl-Up|Ctrl-Home": function (editor) { getCompleter(editor).goTo("start"); },
            "Ctrl-Down|Ctrl-End": function (editor) { getCompleter(editor).goTo("end"); },
            "Esc": function (editor) { getCompleter(editor).detach(); },
            "Space": function (editor) { getCompleter(editor).detach(); editor.insert(" "); },
            "Return": function (editor) { return getCompleter(editor).insertMatch(); },
            "Shift-Return": function (editor) { getCompleter(editor).insertMatch(true); },
            "Tab": function (editor) {
                var result = getCompleter(editor).insertMatch();
                if (!result && !editor['tabstopManager']) {
                    getCompleter(editor).goTo("down");
                }
                else
                    return result;
            },
            "PageUp": function (editor) { getCompleter(editor).goTo('pageUp'); },
            "PageDown": function (editor) { getCompleter(editor).goTo('pageDown'); }
        };
        this.keyboardHandler.bindKeys(this.commands);
        this.blurListener = this.blurListener.bind(this);
        this.changeListener = this.changeListener.bind(this);
        this.mousedownListener = this.mousedownListener.bind(this);
        this.mousewheelListener = this.mousewheelListener.bind(this);
        this.changeTimer = lang.delayedCall(function () { this.updateCompletions(true); }.bind(this));
    }
    CompleterAggregate.prototype.insertMatch = function (data) {
        if (!data) {
            data = this.popup.getData(this.popup.getRow());
        }
        if (!data) {
            return;
        }
        if (data.completer && data.completer.insertMatch) {
            data.completer.insertMatch(this.editor);
        }
        else {
            if (this.completions.filterText) {
                var ranges = this.editor.selection['getAllRanges']();
                for (var i = 0, range; range = ranges[i]; i++) {
                    range.start.column -= this.completions.filterText.length;
                    this.editor.session.remove(range);
                }
            }
            if (data.snippet) {
                snm.snippetManager.insertSnippet(this.editor, data.snippet);
            }
            else {
                this.editor.execCommand("insertstring", data.value || data);
            }
        }
        this.detach();
    };
    CompleterAggregate.prototype.detach = function () {
        this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler);
        this.editor.off("changeSelection", this.changeListener);
        this.editor.off("blur", this.blurListener);
        this.editor.off("mousedown", this.mousedownListener);
        this.editor.off("mousewheel", this.mousewheelListener);
        this.changeTimer.cancel();
        if (this.popup && this.popup.isOpen) {
            this.gatherCompletionsId += 1;
            this.popup.hide();
        }
        if (this.base)
            this.base.detach();
        this.activated = false;
        this.completions = this.base = null;
    };
    CompleterAggregate.prototype.goTo = function (where) {
        var row = this.popup.getRow();
        var max = this.popup.getLength() - 1;
        switch (where) {
            case "up":
                row = row <= 0 ? max : row - 1;
                break;
            case "down":
                row = row >= max ? -1 : row + 1;
                break;
            case "start":
                row = 0;
                break;
            case "end":
                row = max;
                break;
        }
        this.popup.setRow(row);
    };
    CompleterAggregate.prototype.getCompletions = function (editor, session, pos, prefix, callback) {
        this.base = session.doc.createAnchor(pos.row, pos.column - prefix.length);
        var matches = [];
        var total = editor.completers.length;
        editor.completers.forEach(function (completer, i) {
            completer.getCompletions(editor, session, pos, prefix, function (err, results) {
                if (!err)
                    matches = matches.concat(results);
                var pos = editor.getCursorPosition();
                var line = session.getLine(pos.row);
                callback(null, {
                    prefix: util.retrievePrecedingIdentifier(line, pos.column, results[0] && results[0].identifierRegex),
                    matches: matches,
                    finished: (--total === 0)
                });
            });
        });
        return true;
    };
    CompleterAggregate.prototype.updateCompletions = function (keepPopupPosition) {
        var pos = this.editor.getCursorPosition();
        var prefix;
        if (keepPopupPosition && this.base && this.completions) {
            prefix = this.editor.session.getTextRange({ start: this.base, end: pos });
            if (prefix == this.completions.filterText)
                return;
            this.completions.setFilter(prefix);
            if (!this.completions.filtered.length)
                return this.detach();
            if (this.completions.filtered.length == 1 && this.completions.filtered[0].value == prefix && !this.completions.filtered[0].snippet) {
                return this.detach();
            }
            this.openPopup(this.editor, prefix, keepPopupPosition);
        }
        else {
            var _id = this.gatherCompletionsId;
            var editor = this.editor;
            var session = editor.getSession();
            var line = session.getLine(pos.row);
            prefix = util.retrievePrecedingIdentifier(line, pos.column);
            this.getCompletions(this.editor, session, this.editor.getCursorPosition(), prefix, function (err, results) {
                var detachIfFinished = function () {
                    if (!results.finished)
                        return;
                    return this.detach();
                }.bind(this);
                var prefix = results.prefix;
                var matches = results && results.matches;
                if (!matches || !matches.length)
                    return detachIfFinished();
                if (prefix.indexOf(results.prefix) !== 0 || _id != this.gatherCompletionsId)
                    return;
                this.completions = new FilteredList(matches);
                this.completions.setFilter(prefix);
                var filtered = this.completions.filtered;
                if (!filtered.length)
                    return detachIfFinished();
                if (filtered.length == 1 && filtered[0].value == prefix && !filtered[0].snippet)
                    return detachIfFinished();
                if (this.autoInsert && filtered.length == 1)
                    return this.insertMatch(filtered[0]);
                this.openPopup(this.editor, prefix, keepPopupPosition);
            }.bind(this));
        }
    };
    CompleterAggregate.prototype.openPopup = function (editor, prefix, keepPopupPosition) {
        if (!this.popup) {
            this.popup = new pop.ListViewPopup(document.body || document.documentElement);
            this.popup.on("click", function (e) { this.insertMatch(); e.stop(); }.bind(this));
            this.popup.focus = this.editor.focus.bind(this.editor);
        }
        this.popup.setData(this.completions.filtered);
        this.popup.setRow(this.autoSelect ? 0 : -1);
        if (!keepPopupPosition) {
            this.popup.setTheme(editor.getTheme());
            this.popup.setFontSize(editor.getFontSize());
            var lineHeight = editor.renderer.layerConfig.lineHeight;
            var pos = editor.renderer.$cursorLayer.getPixelPosition(this.base, true);
            pos.left -= this.popup.getTextLeftOffset();
            var rect = editor.container.getBoundingClientRect();
            pos.top += rect.top - editor.renderer.layerConfig.offset;
            pos.left += rect.left - editor.renderer.scrollLeft;
            pos.left += editor.renderer.$gutterLayer.gutterWidth;
            this.popup.show(pos, lineHeight);
        }
    };
    CompleterAggregate.prototype.changeListener = function (e) {
        var cursor = this.editor.selection.lead;
        if (cursor.row != this.base.row || cursor.column < this.base.column) {
            this.detach();
        }
        if (this.activated)
            this.changeTimer.schedule();
        else
            this.detach();
    };
    CompleterAggregate.prototype.blurListener = function () {
        var el = document.activeElement;
        if (el != this.editor.textInput.getElement() && el.parentNode != this.popup.container) {
            this.detach();
        }
    };
    CompleterAggregate.prototype.mousedownListener = function (e) {
        this.detach();
    };
    CompleterAggregate.prototype.mousewheelListener = function (e) {
        this.detach();
    };
    CompleterAggregate.prototype.cancelContextMenu = function () {
        this.editor.cancelMouseContextMenu();
    };
    return CompleterAggregate;
})();
exports.CompleterAggregate = CompleterAggregate;
var Autocomplete = (function () {
    function Autocomplete() {
    }
    Autocomplete.startCommand = {
        name: "startAutocomplete",
        exec: function (editor) {
            var aggregate = getCompleter(editor);
            if (!aggregate) {
                aggregate = new CompleterAggregate(editor);
                setCompleter(editor, aggregate);
            }
            aggregate.autoInsert = true;
            aggregate.autoSelect = true;
            aggregate.showPopup(editor);
            aggregate.cancelContextMenu();
        },
        bindKey: "Ctrl-Space|Ctrl-Shift-Space|Alt-Space"
    };
    return Autocomplete;
})();
exports.Autocomplete = Autocomplete;
var FilteredList = (function () {
    function FilteredList(all, filterText, mutateData) {
        this.all = all;
        this.filtered = all;
        this.filterText = filterText || "";
    }
    FilteredList.prototype.setFilter = function (str) {
        var matches;
        if (str.length > this.filterText && str.lastIndexOf(this.filterText, 0) === 0)
            matches = this.filtered;
        else
            matches = this.all;
        this.filterText = str;
        matches = this.filterCompletions(matches, this.filterText);
        matches = matches.sort(function (a, b) {
            return b.exactMatch - a.exactMatch || b.score - a.score;
        });
        var prev = null;
        matches = matches.filter(function (item) {
            var caption = item.value || item.caption || item.snippet;
            if (caption === prev)
                return false;
            prev = caption;
            return true;
        });
        this.filtered = matches;
    };
    FilteredList.prototype.filterCompletions = function (items, needle) {
        var results = [];
        var upper = needle.toUpperCase();
        var lower = needle.toLowerCase();
        loop: for (var i = 0, length = items.length; i < length; i++) {
            var item = items[i];
            var caption = item.value || item.caption || item.snippet;
            if (!caption)
                continue;
            var lastIndex = -1;
            var matchMask = 0;
            var penalty = 0;
            var index, distance;
            for (var j = 0; j < needle.length; j++) {
                var i1 = caption.indexOf(lower[j], lastIndex + 1);
                var i2 = caption.indexOf(upper[j], lastIndex + 1);
                index = (i1 >= 0) ? ((i2 < 0 || i1 < i2) ? i1 : i2) : i2;
                if (index < 0)
                    continue loop;
                distance = index - lastIndex - 1;
                if (distance > 0) {
                    if (lastIndex === -1)
                        penalty += 10;
                    penalty += distance;
                }
                matchMask = matchMask | (1 << index);
                lastIndex = index;
            }
            item.matchMask = matchMask;
            item.exactMatch = penalty ? 0 : 1;
            item.score = (item.score || 0) - penalty;
            results.push(item);
        }
        return results;
    };
    return FilteredList;
})();
exports.FilteredList = FilteredList;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b2NvbXBsZXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2F1dG9jb21wbGV0ZS50cyJdLCJuYW1lcyI6WyJnZXRDb21wbGV0ZXIiLCJzZXRDb21wbGV0ZXIiLCJDb21wbGV0ZXJBZ2dyZWdhdGUiLCJDb21wbGV0ZXJBZ2dyZWdhdGUuY29uc3RydWN0b3IiLCJDb21wbGV0ZXJBZ2dyZWdhdGUuaW5zZXJ0TWF0Y2giLCJDb21wbGV0ZXJBZ2dyZWdhdGUuZGV0YWNoIiwiQ29tcGxldGVyQWdncmVnYXRlLmdvVG8iLCJDb21wbGV0ZXJBZ2dyZWdhdGUuZ2V0Q29tcGxldGlvbnMiLCJDb21wbGV0ZXJBZ2dyZWdhdGUudXBkYXRlQ29tcGxldGlvbnMiLCJDb21wbGV0ZXJBZ2dyZWdhdGUub3BlblBvcHVwIiwiQ29tcGxldGVyQWdncmVnYXRlLmNoYW5nZUxpc3RlbmVyIiwiQ29tcGxldGVyQWdncmVnYXRlLmJsdXJMaXN0ZW5lciIsIkNvbXBsZXRlckFnZ3JlZ2F0ZS5tb3VzZWRvd25MaXN0ZW5lciIsIkNvbXBsZXRlckFnZ3JlZ2F0ZS5tb3VzZXdoZWVsTGlzdGVuZXIiLCJDb21wbGV0ZXJBZ2dyZWdhdGUuY2FuY2VsQ29udGV4dE1lbnUiLCJBdXRvY29tcGxldGUiLCJBdXRvY29tcGxldGUuY29uc3RydWN0b3IiLCJGaWx0ZXJlZExpc3QiLCJGaWx0ZXJlZExpc3QuY29uc3RydWN0b3IiLCJGaWx0ZXJlZExpc3Quc2V0RmlsdGVyIiwiRmlsdGVyZWRMaXN0LmZpbHRlckNvbXBsZXRpb25zIl0sIm1hcHBpbmdzIjoiQUE4QkEsSUFBTyxHQUFHLFdBQVcseUJBQXlCLENBQUMsQ0FBQztBQUNoRCxJQUFPLEdBQUcsV0FBVyxzQkFBc0IsQ0FBQyxDQUFDO0FBQzdDLElBQU8sSUFBSSxXQUFXLHFCQUFxQixDQUFDLENBQUM7QUFFN0MsSUFBTyxJQUFJLFdBQVcsWUFBWSxDQUFDLENBQUM7QUFDcEMsSUFBTyxHQUFHLFdBQVcsWUFBWSxDQUFD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QUNsQkEsQ0FBQ0E7SUFLTUYsbUNBQU1BLEdBQWJBO1FBQ0lHLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0E7UUFDbkVBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBLGlCQUFpQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsQ0FBQ0E7UUFDeERBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBO1FBQzNDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxXQUFXQSxFQUFFQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLENBQUNBO1FBQ3JEQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxZQUFZQSxFQUFFQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLENBQUNBO1FBQ3ZEQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtRQUUxQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsSUFBSUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbENBLElBQUlBLENBQUNBLG1CQUFtQkEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDOUJBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBO1FBQ3RCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQTtZQUNWQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtRQUN2QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDdkJBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLElBQUlBLENBQUNBLElB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LENBQUNBLE1BQU1BLENBQUNBLGlCQUFpQkEsRUFBRUEsQ0FBQ0E7UUFDMUNBLElBQUlBLE1BQWNBLENBQUNBO1FBQ25CQSxFQUFFQSxDQUFDQSxDQUFDQSxpQkFBaUJBLElBQUlBLElBQUlBLENBQUNBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBO1lBQ3JEQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxZQUFZQSxDQUFDQSxFQUFFQSxLQUFLQSxFQUFFQSxJQUFJQSxDQUFDQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUMxRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsSUFBSUEsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsVUFBVUEsQ0FBQ0E7Z0JBQ3RDQSxNQUFNQSxDQUFDQTtZQUNYQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxTQUFTQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7Z0JBQ2xDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtZQUV6QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsSUFBSUEsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsSUFBSUEsTUFBTUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2pJQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtZQUN6QkEsQ0FBQ0E7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QUFrQkEsTUFBY0EsRUFBRUEsTUFBY0EsRUFBRUEsaUJBQTBCQTtRQUN4RU8sRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDZEEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsR0FBR0EsQ0FBQ0EsYUFBYUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsSUFBSUEsUUFBUUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0E7WUFDOUVBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEVBQUVBLENBQUNBLE9BQU9BLEVBQUVBLFVBQVNBLENBQUNBLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNqRkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDM0RBLENBQUNBO1FBRURBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO1FBRTlDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUU1Q0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNyQkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFDdkNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLFdBQVdBLENBQUNBLE1B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QSxDQUFDQSxDQUFDQTtnQkFDbERBLElBQUlBLEVBQUVBLEdBQUdBLE9BQU9BLENBQUNBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLFNBQVNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO2dCQUNsREEsS0FBS0EsR0FBR0EsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsQ0FBQ0EsSUFBSUEsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0E7Z0JBQ3pEQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQTtvQkFDVkEsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7Z0JBQ2xCQSxRQUFRQSxHQUFHQSxLQUFLQSxHQUFHQSxTQUFTQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDakNBLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO29CQUVmQSxFQUFFQSxDQUFDQSxDQUFDQSxTQUFTQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDakJBLE9BQU9BLElBQUlBLEVBQUVBLENBQUNBO29CQUNsQkEsT0FBT0EsSUFBSUEsUUFBUUEsQ0FBQ0E7Z0JBQ3hCQSxDQUFDQTtnQkFDREEsU0FBU0EsR0FBR0EsU0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3JDQSxTQUFTQSxHQUFHQSxLQUFLQSxDQUFDQTtZQUN0QkEsQ0FBQ0E7WUFDREEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsU0FBU0EsQ0FBQ0E7WUFDM0JBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLE9BQU9BLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ2xDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQTtZQUN6Q0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDdkJBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBO0lBQ25CQSxDQUFDQTtJQUNMSCxtQkFBQ0E7QUFBREEsQ0FBQ0EsQUExRUQsSUEwRUM7QUExRVksb0JBQVksZUEwRXhCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiAqKioqKiBCRUdJTiBMSUNFTlNFIEJMT0NLICoqKioqXG4gKiBEaXN0cmlidXRlZCB1bmRlciB0aGUgQlNEIGxpY2Vuc2U6XG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEyLCBBamF4Lm9yZyBCLlYuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dFxuICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLlxuICogICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGVcbiAqICAgICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG4gKiAgICAgKiBOZWl0aGVyIHRoZSBuYW1lIG9mIEFqYXgub3JnIEIuVi4gbm9yIHRoZVxuICogICAgICAgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHNcbiAqICAgICAgIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLlxuICpcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiIEFORFxuICogQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRURcbiAqIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkVcbiAqIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIEFKQVguT1JHIEIuVi4gQkUgTElBQkxFIEZPUiBBTllcbiAqIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTXG4gKiAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7XG4gKiBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkRcbiAqIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUXG4gKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJU1xuICogU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG4gKlxuICogKioqKiogRU5EIExJQ0VOU0UgQkxPQ0sgKioqKiogKi9cblxuaW1wb3J0IGhobSA9IHJlcXVpcmUoXCIuL2tleWJvYXJkL2hhc2hfaGFuZGxlclwiKTtcbmltcG9ydCBwb3AgPSByZXF1aXJlKFwiLi9hdXRvY29tcGxldGUvcG9wdXBcIik7XG5pbXBvcnQgdXRpbCA9IHJlcXVpcmUoXCIuL2F1dG9jb21wbGV0ZS91dGlsXCIpO1xuaW1wb3J0IGV2ZW50ID0gcmVxdWlyZShcIi4vbGliL2V2ZW50XCIpO1xuaW1wb3J0IGxhbmcgPSByZXF1aXJlKFwiLi9saWIvbGFuZ1wiKTtcbmltcG9ydCBzbm0gPSByZXF1aXJlKFwiLi9zbmlwcGV0c1wiKTtcbmltcG9ydCBFZGl0b3IgPSByZXF1aXJlKCcuL0VkaXRvcicpO1xuaW1wb3J0IGVzbSA9IHJlcXVpcmUoJy4vZWRpdF9zZXNzaW9uJyk7XG5pbXBvcnQgYW5tID0gcmVxdWlyZSgnLi9hbmNob3InKTtcblxudmFyIEVESVRPUl9FWFRfQ09NUExFVEVSID0gJ2NvbXBsZXRlcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tcGxldGVyIHtcbiAgICBnZXRDb21wbGV0aW9ucyhlZGl0b3I6IEVkaXRvciwgc2Vzc2lvbjogZXNtLkVkaXRTZXNzaW9uLCBwb3M6IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0sIHByZWZpeDogc3RyaW5nLCBjYWxsYmFjayk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb21wbGV0ZXIoZWRpdG9yOiBFZGl0b3IpOiBDb21wbGV0ZXJBZ2dyZWdhdGUge1xuICAgIHJldHVybiBlZGl0b3JbRURJVE9SX0VYVF9DT01QTEVURVJdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0Q29tcGxldGVyKGVkaXRvcjogRWRpdG9yLCBjb21wbGV0ZXI6IENvbXBsZXRlckFnZ3JlZ2F0ZSkge1xuICAgIGVkaXRvcltFRElUT1JfRVhUX0NPTVBMRVRFUl0gPSBjb21wbGV0ZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBDb21wbGV0ZXJBZ2dyZWdhdGUgaW1wbGVtZW50cyBDb21wbGV0ZXIge1xuICAgIHByaXZhdGUgZWRpdG9yOiBFZGl0b3I7XG4gICAgcHJpdmF0ZSBrZXlib2FyZEhhbmRsZXIgPSBuZXcgaGhtLkhhc2hIYW5kbGVyKCk7XG4gICAgcHVibGljIGFjdGl2YXRlZDogYm9vbGVhbjtcbiAgICBwcml2YXRlIGNoYW5nZVRpbWVyO1xuICAgIHByaXZhdGUgZ2F0aGVyQ29tcGxldGlvbnNJZCA9IDA7XG4gICAgcHJpdmF0ZSBiYXNlOiBhbm0uQW5jaG9yO1xuICAgIHByaXZhdGUgY29tcGxldGlvbnM6IHsgZmlsdGVyZWQ7IGZpbHRlclRleHQ7IHNldEZpbHRlciB9O1xuICAgIHByaXZhdGUgY29tbWFuZHM7XG4gICAgcHVibGljIGF1dG9TZWxlY3QgPSB0cnVlO1xuICAgIHB1YmxpYyBhdXRvSW5zZXJ0ID0gdHJ1ZTtcbiAgICBjb25zdHJ1Y3RvcihlZGl0b3I6IEVkaXRvcikge1xuICAgICAgICB0aGlzLmVkaXRvciA9IGVkaXRvcjtcbiAgICAgICAgdGhpcy5jb21tYW5kcyA9IHtcbiAgICAgICAgICAgIFwiVXBcIjogZnVuY3Rpb24oZWRpdG9yOiBFZGl0b3IpIHsgZ2V0Q29tcGxldGVyKGVkaXRvcikuZ29UbyhcInVwXCIpOyB9LFxuICAgICAgICAgICAgXCJEb3duXCI6IGZ1bmN0aW9uKGVkaXRvcjogRWRpdG9yKSB7IGdldENvbXBsZXRlcihlZGl0b3IpLmdvVG8oXCJkb3duXCIpOyB9LFxuICAgICAgICAgICAgXCJDdHJsLVVwfEN0cmwtSG9tZVwiOiBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikgeyBnZXRDb21wbGV0ZXIoZWRpdG9yKS5nb1RvKFwic3RhcnRcIik7IH0sXG4gICAgICAgICAgICBcIkN0cmwtRG93bnxDdHJsLUVuZFwiOiBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikgeyBnZXRDb21wbGV0ZXIoZWRpdG9yKS5nb1RvKFwiZW5kXCIpOyB9LFxuXG4gICAgICAgICAgICBcIkVzY1wiOiBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikgeyBnZXRDb21wbGV0ZXIoZWRpdG9yKS5kZXRhY2goKTsgfSxcbiAgICAgICAgICAgIFwiU3BhY2VcIjogZnVuY3Rpb24oZWRpdG9yOiBFZGl0b3IpIHsgZ2V0Q29tcGxldGVyKGVkaXRvcikuZGV0YWNoKCk7IGVkaXRvci5pbnNlcnQoXCIgXCIpOyB9LFxuICAgICAgICAgICAgXCJSZXR1cm5cIjogZnVuY3Rpb24oZWRpdG9yOiBFZGl0b3IpIHsgcmV0dXJuIGdldENvbXBsZXRlcihlZGl0b3IpLmluc2VydE1hdGNoKCk7IH0sXG4gICAgICAgICAgICBcIlNoaWZ0LVJldHVyblwiOiBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikgeyBnZXRDb21wbGV0ZXIoZWRpdG9yKS5pbnNlcnRNYXRjaCh0cnVlKTsgfSxcbiAgICAgICAgICAgIFwiVGFiXCI6IGZ1bmN0aW9uKGVkaXRvcjogRWRpdG9yKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGdldENvbXBsZXRlcihlZGl0b3IpLmluc2VydE1hdGNoKCk7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQgJiYgIWVkaXRvclsndGFic3RvcE1hbmFnZXInXSkge1xuICAgICAgICAgICAgICAgICAgICBnZXRDb21wbGV0ZXIoZWRpdG9yKS5nb1RvKFwiZG93blwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgXCJQYWdlVXBcIjogZnVuY3Rpb24oZWRpdG9yOiBFZGl0b3IpIHsgZ2V0Q29tcGxldGVyKGVkaXRvcikuZ29UbygncGFnZVVwJyk7IH0sXG4gICAgICAgICAgICBcIlBhZ2VEb3duXCI6IGZ1bmN0aW9uKGVkaXRvcjogRWRpdG9yKSB7IGdldENvbXBsZXRlcihlZGl0b3IpLmdvVG8oJ3BhZ2VEb3duJyk7IH1cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmtleWJvYXJkSGFuZGxlci5iaW5kS2V5cyh0aGlzLmNvbW1hbmRzKTtcblxuICAgICAgICB0aGlzLmJsdXJMaXN0ZW5lciA9IHRoaXMuYmx1ckxpc3RlbmVyLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuY2hhbmdlTGlzdGVuZXIgPSB0aGlzLmNoYW5nZUxpc3RlbmVyLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMubW91c2Vkb3duTGlzdGVuZXIgPSB0aGlzLm1vdXNlZG93bkxpc3RlbmVyLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMubW91c2V3aGVlbExpc3RlbmVyID0gdGhpcy5tb3VzZXdoZWVsTGlzdGVuZXIuYmluZCh0aGlzKTtcblxuICAgICAgICB0aGlzLmNoYW5nZVRpbWVyID0gbGFuZy5kZWxheWVkQ2FsbChmdW5jdGlvbigpIHsgdGhpcy51cGRhdGVDb21wbGV0aW9ucyh0cnVlKTsgfS5iaW5kKHRoaXMpKTtcbiAgICB9XG4gICAgcHVibGljIHBvcHVwOiBwb3AuTGlzdFZpZXdQb3B1cDtcblxuICAgIC8qKlxuICAgICAqIEltcGxlbWVudGF0aW9uIG9mIHRoZSBDb21wbGV0ZXIgaW50ZXJmYWNlLlxuICAgICAqL1xuICAgIHB1YmxpYyBpbnNlcnRNYXRjaChkYXRhPykge1xuICAgICAgICBpZiAoIWRhdGEpIHtcbiAgICAgICAgICAgIGRhdGEgPSB0aGlzLnBvcHVwLmdldERhdGEodGhpcy5wb3B1cC5nZXRSb3coKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLmNvbXBsZXRlciAmJiBkYXRhLmNvbXBsZXRlci5pbnNlcnRNYXRjaCkge1xuICAgICAgICAgICAgZGF0YS5jb21wbGV0ZXIuaW5zZXJ0TWF0Y2godGhpcy5lZGl0b3IpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuY29tcGxldGlvbnMuZmlsdGVyVGV4dCkge1xuICAgICAgICAgICAgICAgIHZhciByYW5nZXMgPSB0aGlzLmVkaXRvci5zZWxlY3Rpb25bJ2dldEFsbFJhbmdlcyddKCk7XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogQXNzaWdubWVudCBpbiBjb25kaXRpb25hbCBleHByZXNzaW9uLlxuICAgICAgICAgICAgICAgIC8vIFRPRE86IEFzc2lnbm1lbnQgaW4gY29uZGl0aW9uYWwgZXhwcmVzc2lvbi5cbiAgICAgICAgICAgICAgICAvLyBJdCdzIGN1dGUgYnV0IGFsc28gbWF5IGhhbHQgcHJlbWF0dXJlbHkgYW5kIHNvIGhpZGUgYnVncy5cbiAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIGJ5IGxlbmd0aCB2YXJpYWJsZSBhbmQgdGVzdD9cbiAgICAgICAgICAgICAgICAvLyBVc2UgYXNzZXJ0aW9uIHdpdGhpbiB0aGUgbG9vcCB0byBsb29rIGZvciBmYWxzZXkgdmFsdWVzLlxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCByYW5nZTsgcmFuZ2UgPSByYW5nZXNbaV07IGkrKykge1xuICAgICAgICAgICAgICAgICAgICByYW5nZS5zdGFydC5jb2x1bW4gLT0gdGhpcy5jb21wbGV0aW9ucy5maWx0ZXJUZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGl0b3Iuc2Vzc2lvbi5yZW1vdmUocmFuZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkYXRhLnNuaXBwZXQpIHtcbiAgICAgICAgICAgICAgICBzbm0uc25pcHBldE1hbmFnZXIuaW5zZXJ0U25pcHBldCh0aGlzLmVkaXRvciwgZGF0YS5zbmlwcGV0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLmV4ZWNDb21tYW5kKFwiaW5zZXJ0c3RyaW5nXCIsIGRhdGEudmFsdWUgfHwgZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kZXRhY2goKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgQ29tcGxldGVyIGludGVyZmFjZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgZGV0YWNoKCkge1xuICAgICAgICB0aGlzLmVkaXRvci5rZXlCaW5kaW5nLnJlbW92ZUtleWJvYXJkSGFuZGxlcih0aGlzLmtleWJvYXJkSGFuZGxlcik7XG4gICAgICAgIHRoaXMuZWRpdG9yLm9mZihcImNoYW5nZVNlbGVjdGlvblwiLCB0aGlzLmNoYW5nZUxpc3RlbmVyKTtcbiAgICAgICAgdGhpcy5lZGl0b3Iub2ZmKFwiYmx1clwiLCB0aGlzLmJsdXJMaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuZWRpdG9yLm9mZihcIm1vdXNlZG93blwiLCB0aGlzLm1vdXNlZG93bkxpc3RlbmVyKTtcbiAgICAgICAgdGhpcy5lZGl0b3Iub2ZmKFwibW91c2V3aGVlbFwiLCB0aGlzLm1vdXNld2hlZWxMaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuY2hhbmdlVGltZXIuY2FuY2VsKCk7XG5cbiAgICAgICAgaWYgKHRoaXMucG9wdXAgJiYgdGhpcy5wb3B1cC5pc09wZW4pIHtcbiAgICAgICAgICAgIHRoaXMuZ2F0aGVyQ29tcGxldGlvbnNJZCArPSAxO1xuICAgICAgICAgICAgdGhpcy5wb3B1cC5oaWRlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5iYXNlKVxuICAgICAgICAgICAgdGhpcy5iYXNlLmRldGFjaCgpO1xuICAgICAgICB0aGlzLmFjdGl2YXRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNvbXBsZXRpb25zID0gdGhpcy5iYXNlID0gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgQ29tcGxldGVyIGludGVyZmFjZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ29Ubyh3aGVyZTogc3RyaW5nKSB7XG4gICAgICAgIHZhciByb3cgPSB0aGlzLnBvcHVwLmdldFJvdygpO1xuICAgICAgICB2YXIgbWF4ID0gdGhpcy5wb3B1cC5nZXRMZW5ndGgoKSAtIDE7XG5cbiAgICAgICAgc3dpdGNoICh3aGVyZSkge1xuICAgICAgICAgICAgY2FzZSBcInVwXCI6IHJvdyA9IHJvdyA8PSAwID8gbWF4IDogcm93IC0gMTsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZG93blwiOiByb3cgPSByb3cgPj0gbWF4ID8gLTEgOiByb3cgKyAxOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJzdGFydFwiOiByb3cgPSAwOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJlbmRcIjogcm93ID0gbWF4OyBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucG9wdXAuc2V0Um93KHJvdyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW1wbGVtZW50YXRpb24gb2YgdGhlIENvbXBsZXRlciBpbnRlcmZhY2UuXG4gICAgICovXG4gICAgcHVibGljIGdldENvbXBsZXRpb25zKGVkaXRvcjogRWRpdG9yLCBzZXNzaW9uLCBwb3M6IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0sIHByZWZpeDogc3RyaW5nLCBjYWxsYmFjaykge1xuXG4gICAgICAgIHRoaXMuYmFzZSA9IHNlc3Npb24uZG9jLmNyZWF0ZUFuY2hvcihwb3Mucm93LCBwb3MuY29sdW1uIC0gcHJlZml4Lmxlbmd0aCk7XG5cbiAgICAgICAgdmFyIG1hdGNoZXMgPSBbXTtcbiAgICAgICAgdmFyIHRvdGFsID0gZWRpdG9yLmNvbXBsZXRlcnMubGVuZ3RoO1xuICAgICAgICBlZGl0b3IuY29tcGxldGVycy5mb3JFYWNoKGZ1bmN0aW9uKGNvbXBsZXRlcjogQ29tcGxldGVyLCBpKSB7XG4gICAgICAgICAgICBjb21wbGV0ZXIuZ2V0Q29tcGxldGlvbnMoZWRpdG9yLCBzZXNzaW9uLCBwb3MsIHByZWZpeCwgZnVuY3Rpb24oZXJyLCByZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFlcnIpXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZXMgPSBtYXRjaGVzLmNvbmNhdChyZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAvLyBGZXRjaCBwcmVmaXggYWdhaW4sIGJlY2F1c2UgdGhleSBtYXkgaGF2ZSBjaGFuZ2VkIGJ5IG5vd1xuICAgICAgICAgICAgICAgIHZhciBwb3M6IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0gPSBlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICB2YXIgbGluZSA9IHNlc3Npb24uZ2V0TGluZShwb3Mucm93KTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgICAgICAgICAgIHByZWZpeDogdXRpbC5yZXRyaWV2ZVByZWNlZGluZ0lkZW50aWZpZXIobGluZSwgcG9zLmNvbHVtbiwgcmVzdWx0c1swXSAmJiByZXN1bHRzWzBdLmlkZW50aWZpZXJSZWdleCksXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoZXMsXG4gICAgICAgICAgICAgICAgICAgIGZpbmlzaGVkOiAoLS10b3RhbCA9PT0gMClcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVDb21wbGV0aW9ucyhrZWVwUG9wdXBQb3NpdGlvbjogYm9vbGVhbikge1xuICAgICAgICB2YXIgcG9zID0gdGhpcy5lZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKTtcbiAgICAgICAgdmFyIHByZWZpeDogc3RyaW5nO1xuICAgICAgICBpZiAoa2VlcFBvcHVwUG9zaXRpb24gJiYgdGhpcy5iYXNlICYmIHRoaXMuY29tcGxldGlvbnMpIHtcbiAgICAgICAgICAgIHByZWZpeCA9IHRoaXMuZWRpdG9yLnNlc3Npb24uZ2V0VGV4dFJhbmdlKHsgc3RhcnQ6IHRoaXMuYmFzZSwgZW5kOiBwb3MgfSk7XG4gICAgICAgICAgICBpZiAocHJlZml4ID09IHRoaXMuY29tcGxldGlvbnMuZmlsdGVyVGV4dClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRpb25zLnNldEZpbHRlcihwcmVmaXgpO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmNvbXBsZXRpb25zLmZpbHRlcmVkLmxlbmd0aClcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kZXRhY2goKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuY29tcGxldGlvbnMuZmlsdGVyZWQubGVuZ3RoID09IDEgJiYgdGhpcy5jb21wbGV0aW9ucy5maWx0ZXJlZFswXS52YWx1ZSA9PSBwcmVmaXggJiYgIXRoaXMuY29tcGxldGlvbnMuZmlsdGVyZWRbMF0uc25pcHBldCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRldGFjaCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLm9wZW5Qb3B1cCh0aGlzLmVkaXRvciwgcHJlZml4LCBrZWVwUG9wdXBQb3NpdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBTYXZlIGN1cnJlbnQgZ2F0aGVyQ29tcGxldGlvbnMgc2Vzc2lvbiwgc2Vzc2lvbiBpcyBjbG9zZSB3aGVuIGEgbWF0Y2ggaXMgaW5zZXJ0XG4gICAgICAgICAgICB2YXIgX2lkID0gdGhpcy5nYXRoZXJDb21wbGV0aW9uc0lkO1xuICAgICAgICAgICAgdmFyIGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICAgICAgdmFyIHNlc3Npb24gPSBlZGl0b3IuZ2V0U2Vzc2lvbigpO1xuICAgICAgICAgICAgdmFyIGxpbmUgPSBzZXNzaW9uLmdldExpbmUocG9zLnJvdyk7XG4gICAgICAgICAgICBwcmVmaXggPSB1dGlsLnJldHJpZXZlUHJlY2VkaW5nSWRlbnRpZmllcihsaW5lLCBwb3MuY29sdW1uKTtcbiAgICAgICAgICAgIHRoaXMuZ2V0Q29tcGxldGlvbnModGhpcy5lZGl0b3IsIHNlc3Npb24sIHRoaXMuZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCksIHByZWZpeCwgZnVuY3Rpb24oZXJyLCByZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgLy8gT25seSBkZXRhY2ggaWYgcmVzdWx0IGdhdGhlcmluZyBpcyBmaW5pc2hlZFxuICAgICAgICAgICAgICAgIHZhciBkZXRhY2hJZkZpbmlzaGVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghcmVzdWx0cy5maW5pc2hlZCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kZXRhY2goKTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcHJlZml4ID0gcmVzdWx0cy5wcmVmaXg7XG4gICAgICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSByZXN1bHRzICYmIHJlc3VsdHMubWF0Y2hlcztcblxuICAgICAgICAgICAgICAgIGlmICghbWF0Y2hlcyB8fCAhbWF0Y2hlcy5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXRhY2hJZkZpbmlzaGVkKCk7XG4gICAgXG4gICAgICAgICAgICAgICAgLy8gV3JvbmcgcHJlZml4IG9yIHdyb25nIHNlc3Npb24gLT4gaWdub3JlXG4gICAgICAgICAgICAgICAgaWYgKHByZWZpeC5pbmRleE9mKHJlc3VsdHMucHJlZml4KSAhPT0gMCB8fCBfaWQgIT0gdGhpcy5nYXRoZXJDb21wbGV0aW9uc0lkKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRpb25zID0gbmV3IEZpbHRlcmVkTGlzdChtYXRjaGVzKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRpb25zLnNldEZpbHRlcihwcmVmaXgpO1xuICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJlZCA9IHRoaXMuY29tcGxldGlvbnMuZmlsdGVyZWQ7XG4gICAgXG4gICAgICAgICAgICAgICAgLy8gTm8gcmVzdWx0c1xuICAgICAgICAgICAgICAgIGlmICghZmlsdGVyZWQubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGV0YWNoSWZGaW5pc2hlZCgpO1xuICAgIFxuICAgICAgICAgICAgICAgIC8vIE9uZSByZXN1bHQgZXF1YWxzIHRvIHRoZSBwcmVmaXhcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWQubGVuZ3RoID09IDEgJiYgZmlsdGVyZWRbMF0udmFsdWUgPT0gcHJlZml4ICYmICFmaWx0ZXJlZFswXS5zbmlwcGV0KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGV0YWNoSWZGaW5pc2hlZCgpO1xuICAgIFxuICAgICAgICAgICAgICAgIC8vIEF1dG9pbnNlcnQgaWYgb25lIHJlc3VsdFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmF1dG9JbnNlcnQgJiYgZmlsdGVyZWQubGVuZ3RoID09IDEpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmluc2VydE1hdGNoKGZpbHRlcmVkWzBdKTtcblxuICAgICAgICAgICAgICAgIHRoaXMub3BlblBvcHVwKHRoaXMuZWRpdG9yLCBwcmVmaXgsIGtlZXBQb3B1cFBvc2l0aW9uKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIG9wZW5Qb3B1cChlZGl0b3I6IEVkaXRvciwgcHJlZml4OiBzdHJpbmcsIGtlZXBQb3B1cFBvc2l0aW9uOiBib29sZWFuKSB7XG4gICAgICAgIGlmICghdGhpcy5wb3B1cCkge1xuICAgICAgICAgICAgdGhpcy5wb3B1cCA9IG5ldyBwb3AuTGlzdFZpZXdQb3B1cChkb2N1bWVudC5ib2R5IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7XG4gICAgICAgICAgICB0aGlzLnBvcHVwLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oZSkgeyB0aGlzLmluc2VydE1hdGNoKCk7IGUuc3RvcCgpOyB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgdGhpcy5wb3B1cC5mb2N1cyA9IHRoaXMuZWRpdG9yLmZvY3VzLmJpbmQodGhpcy5lZGl0b3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5wb3B1cC5zZXREYXRhKHRoaXMuY29tcGxldGlvbnMuZmlsdGVyZWQpO1xuXG4gICAgICAgIHRoaXMucG9wdXAuc2V0Um93KHRoaXMuYXV0b1NlbGVjdCA/IDAgOiAtMSk7XG5cbiAgICAgICAgaWYgKCFrZWVwUG9wdXBQb3NpdGlvbikge1xuICAgICAgICAgICAgdGhpcy5wb3B1cC5zZXRUaGVtZShlZGl0b3IuZ2V0VGhlbWUoKSk7XG4gICAgICAgICAgICB0aGlzLnBvcHVwLnNldEZvbnRTaXplKGVkaXRvci5nZXRGb250U2l6ZSgpKTtcblxuICAgICAgICAgICAgdmFyIGxpbmVIZWlnaHQgPSBlZGl0b3IucmVuZGVyZXIubGF5ZXJDb25maWcubGluZUhlaWdodDtcblxuICAgICAgICAgICAgdmFyIHBvczogeyBsZWZ0OiBudW1iZXI7IHRvcDogbnVtYmVyIH0gPSBlZGl0b3IucmVuZGVyZXIuJGN1cnNvckxheWVyLmdldFBpeGVsUG9zaXRpb24odGhpcy5iYXNlLCB0cnVlKTtcbiAgICAgICAgICAgIHBvcy5sZWZ0IC09IHRoaXMucG9wdXAuZ2V0VGV4dExlZnRPZmZzZXQoKTtcblxuICAgICAgICAgICAgdmFyIHJlY3QgPSBlZGl0b3IuY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgcG9zLnRvcCArPSByZWN0LnRvcCAtIGVkaXRvci5yZW5kZXJlci5sYXllckNvbmZpZy5vZmZzZXQ7XG4gICAgICAgICAgICBwb3MubGVmdCArPSByZWN0LmxlZnQgLSBlZGl0b3IucmVuZGVyZXIuc2Nyb2xsTGVmdDtcbiAgICAgICAgICAgIHBvcy5sZWZ0ICs9IGVkaXRvci5yZW5kZXJlci4kZ3V0dGVyTGF5ZXIuZ3V0dGVyV2lkdGg7XG5cbiAgICAgICAgICAgIHRoaXMucG9wdXAuc2hvdyhwb3MsIGxpbmVIZWlnaHQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGFuZ2VMaXN0ZW5lcihlKSB7XG4gICAgICAgIHZhciBjdXJzb3IgPSB0aGlzLmVkaXRvci5zZWxlY3Rpb24ubGVhZDtcbiAgICAgICAgaWYgKGN1cnNvci5yb3cgIT0gdGhpcy5iYXNlLnJvdyB8fCBjdXJzb3IuY29sdW1uIDwgdGhpcy5iYXNlLmNvbHVtbikge1xuICAgICAgICAgICAgdGhpcy5kZXRhY2goKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5hY3RpdmF0ZWQpXG4gICAgICAgICAgICB0aGlzLmNoYW5nZVRpbWVyLnNjaGVkdWxlKCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMuZGV0YWNoKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBibHVyTGlzdGVuZXIoKSB7XG4gICAgICAgIC8vIHdlIGhhdmUgdG8gY2hlY2sgaWYgYWN0aXZlRWxlbWVudCBpcyBhIGNoaWxkIG9mIHBvcHVwIGJlY2F1c2VcbiAgICAgICAgLy8gb24gSUUgcHJldmVudERlZmF1bHQgZG9lc24ndCBzdG9wIHNjcm9sbGJhciBmcm9tIGJlaW5nIGZvY3Vzc2VkXG4gICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG4gICAgICAgIGlmIChlbCAhPSB0aGlzLmVkaXRvci50ZXh0SW5wdXQuZ2V0RWxlbWVudCgpICYmIGVsLnBhcmVudE5vZGUgIT0gdGhpcy5wb3B1cC5jb250YWluZXIpIHtcbiAgICAgICAgICAgIHRoaXMuZGV0YWNoKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIG1vdXNlZG93bkxpc3RlbmVyKGUpIHtcbiAgICAgICAgdGhpcy5kZXRhY2goKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG1vdXNld2hlZWxMaXN0ZW5lcihlKSB7XG4gICAgICAgIHRoaXMuZGV0YWNoKCk7XG4gICAgfVxuXG4gICAgcHVibGljIHNob3dQb3B1cCA9IGZ1bmN0aW9uKGVkaXRvcjogRWRpdG9yKSB7XG5cbiAgICAgICAgaWYgKHRoaXMuZWRpdG9yKSB7XG4gICAgICAgICAgICB0aGlzLmRldGFjaCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hY3RpdmF0ZWQgPSB0cnVlO1xuXG4gICAgICAgIHRoaXMuZWRpdG9yID0gZWRpdG9yO1xuXG4gICAgICAgIGlmIChnZXRDb21wbGV0ZXIoZWRpdG9yKSAhPSB0aGlzKSB7XG4gICAgICAgICAgICBpZiAoZ2V0Q29tcGxldGVyKGVkaXRvcikpIHtcbiAgICAgICAgICAgICAgICBnZXRDb21wbGV0ZXIoZWRpdG9yKS5kZXRhY2goKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNldENvbXBsZXRlcihlZGl0b3IsIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWRpdG9yLmtleUJpbmRpbmcuYWRkS2V5Ym9hcmRIYW5kbGVyKHRoaXMua2V5Ym9hcmRIYW5kbGVyKTtcbiAgICAgICAgZWRpdG9yLm9uKFwiY2hhbmdlU2VsZWN0aW9uXCIsIHRoaXMuY2hhbmdlTGlzdGVuZXIpO1xuICAgICAgICBlZGl0b3Iub24oXCJibHVyXCIsIHRoaXMuYmx1ckxpc3RlbmVyKTtcbiAgICAgICAgZWRpdG9yLm9uKFwibW91c2Vkb3duXCIsIHRoaXMubW91c2Vkb3duTGlzdGVuZXIpO1xuICAgICAgICBlZGl0b3Iub24oXCJtb3VzZXdoZWVsXCIsIHRoaXMubW91c2V3aGVlbExpc3RlbmVyKTtcblxuICAgICAgICB0aGlzLnVwZGF0ZUNvbXBsZXRpb25zKCk7XG4gICAgfVxuICAgIHB1YmxpYyBjYW5jZWxDb250ZXh0TWVudSgpIHtcbiAgICAgICAgdGhpcy5lZGl0b3IuY2FuY2VsTW91c2VDb250ZXh0TWVudSgpO1xuICAgIH1cbn1cblxuLy8gVE9ETzogU2hvdWxkIHdlIGltcGxlbWVudCBDb21wbGV0ZXIgb3IgaXMgaXQgcmVhbGx5IGp1c3QgaW1wbGVtZW50YXRpb24/XG5leHBvcnQgY2xhc3MgQXV0b2NvbXBsZXRlIHtcbiAgICBzdGF0aWMgc3RhcnRDb21tYW5kID0ge1xuICAgICAgICBuYW1lOiBcInN0YXJ0QXV0b2NvbXBsZXRlXCIsXG4gICAgICAgIGV4ZWM6IGZ1bmN0aW9uKGVkaXRvcjogRWRpdG9yKSB7XG4gICAgICAgICAgICB2YXIgYWdncmVnYXRlOiBDb21wbGV0ZXJBZ2dyZWdhdGUgPSBnZXRDb21wbGV0ZXIoZWRpdG9yKTtcbiAgICAgICAgICAgIGlmICghYWdncmVnYXRlKSB7XG4gICAgICAgICAgICAgICAgYWdncmVnYXRlID0gbmV3IENvbXBsZXRlckFnZ3JlZ2F0ZShlZGl0b3IpO1xuICAgICAgICAgICAgICAgIHNldENvbXBsZXRlcihlZGl0b3IsIGFnZ3JlZ2F0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhZ2dyZWdhdGUuYXV0b0luc2VydCA9IHRydWU7XG4gICAgICAgICAgICBhZ2dyZWdhdGUuYXV0b1NlbGVjdCA9IHRydWU7XG4gICAgICAgICAgICBhZ2dyZWdhdGUuc2hvd1BvcHVwKGVkaXRvcik7XG4gICAgICAgICAgICAvLyBuZWVkZWQgZm9yIGZpcmVmb3ggb24gbWFjXG4gICAgICAgICAgICBhZ2dyZWdhdGUuY2FuY2VsQ29udGV4dE1lbnUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgYmluZEtleTogXCJDdHJsLVNwYWNlfEN0cmwtU2hpZnQtU3BhY2V8QWx0LVNwYWNlXCJcbiAgICB9O1xufVxuXG5leHBvcnQgY2xhc3MgRmlsdGVyZWRMaXN0IHtcbiAgICBwcml2YXRlIGFsbDtcbiAgICBwcml2YXRlIGZpbHRlcmVkO1xuICAgIHByaXZhdGUgZmlsdGVyVGV4dDogc3RyaW5nO1xuICAgIGNvbnN0cnVjdG9yKGFsbCwgZmlsdGVyVGV4dD86IHN0cmluZywgbXV0YXRlRGF0YT8pIHtcbiAgICAgICAgdGhpcy5hbGwgPSBhbGw7XG4gICAgICAgIHRoaXMuZmlsdGVyZWQgPSBhbGw7XG4gICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IGZpbHRlclRleHQgfHwgXCJcIjtcbiAgICB9XG4gICAgcHJpdmF0ZSBzZXRGaWx0ZXIoc3RyKSB7XG4gICAgICAgIHZhciBtYXRjaGVzO1xuICAgICAgICBpZiAoc3RyLmxlbmd0aCA+IHRoaXMuZmlsdGVyVGV4dCAmJiBzdHIubGFzdEluZGV4T2YodGhpcy5maWx0ZXJUZXh0LCAwKSA9PT0gMClcbiAgICAgICAgICAgIG1hdGNoZXMgPSB0aGlzLmZpbHRlcmVkO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBtYXRjaGVzID0gdGhpcy5hbGw7XG5cbiAgICAgICAgdGhpcy5maWx0ZXJUZXh0ID0gc3RyO1xuICAgICAgICBtYXRjaGVzID0gdGhpcy5maWx0ZXJDb21wbGV0aW9ucyhtYXRjaGVzLCB0aGlzLmZpbHRlclRleHQpO1xuICAgICAgICBtYXRjaGVzID0gbWF0Y2hlcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICAgIHJldHVybiBiLmV4YWN0TWF0Y2ggLSBhLmV4YWN0TWF0Y2ggfHwgYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIG1ha2UgdW5pcXVlXG4gICAgICAgIHZhciBwcmV2ID0gbnVsbDtcbiAgICAgICAgbWF0Y2hlcyA9IG1hdGNoZXMuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgIHZhciBjYXB0aW9uID0gaXRlbS52YWx1ZSB8fCBpdGVtLmNhcHRpb24gfHwgaXRlbS5zbmlwcGV0O1xuICAgICAgICAgICAgaWYgKGNhcHRpb24gPT09IHByZXYpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIHByZXYgPSBjYXB0aW9uO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuZmlsdGVyZWQgPSBtYXRjaGVzO1xuICAgIH1cbiAgICBwcml2YXRlIGZpbHRlckNvbXBsZXRpb25zKGl0ZW1zOiB7IGNhcHRpb247IHZhbHVlOyBzbmlwcGV0IH1bXSwgbmVlZGxlOiBzdHJpbmcpIHtcbiAgICAgICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICAgICAgdmFyIHVwcGVyID0gbmVlZGxlLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIHZhciBsb3dlciA9IG5lZWRsZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAvLyBUT0RPOiBBc3NpZ25tZW50IGluIGNvbmRpdGlvbmFsIGV4cHJlc3Npb24uXG4gICAgICAgIC8vIEl0J3MgY3V0ZSBidXQgYWxzbyBtYXkgaGFsdCBwcmVtYXR1cmVseSBhbmQgc28gaGlkZSBidWdzLlxuICAgICAgICAvLyBSZXBsYWNlIGJ5IGxlbmd0aCB2YXJpYWJsZSBhbmQgdGVzdD9cbiAgICAgICAgLy8gVXNlIGFzc2VydGlvbiB3aXRoaW4gdGhlIGxvb3AgdG8gbG9vayBmb3IgZmFsc2V5IHZhbHVlcy5cbiAgICAgICAgbG9vcDogZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGl0ZW1zLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbTogYW55ID0gaXRlbXNbaV07XG4gICAgICAgICAgICB2YXIgY2FwdGlvbiA9IGl0ZW0udmFsdWUgfHwgaXRlbS5jYXB0aW9uIHx8IGl0ZW0uc25pcHBldDtcbiAgICAgICAgICAgIGlmICghY2FwdGlvbikgY29udGludWU7XG4gICAgICAgICAgICB2YXIgbGFzdEluZGV4ID0gLTE7XG4gICAgICAgICAgICB2YXIgbWF0Y2hNYXNrID0gMDtcbiAgICAgICAgICAgIHZhciBwZW5hbHR5ID0gMDtcbiAgICAgICAgICAgIHZhciBpbmRleCwgZGlzdGFuY2U7XG4gICAgICAgICAgICAvLyBjYXB0aW9uIGNoYXIgaXRlcmF0aW9uIGlzIGZhc3RlciBpbiBDaHJvbWUgYnV0IHNsb3dlciBpbiBGaXJlZm94LCBzbyBsZXRzIHVzZSBpbmRleE9mXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG5lZWRsZS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIC8vIFRPRE8gYWRkIHBlbmFsdHkgb24gY2FzZSBtaXNtYXRjaFxuICAgICAgICAgICAgICAgIHZhciBpMSA9IGNhcHRpb24uaW5kZXhPZihsb3dlcltqXSwgbGFzdEluZGV4ICsgMSk7XG4gICAgICAgICAgICAgICAgdmFyIGkyID0gY2FwdGlvbi5pbmRleE9mKHVwcGVyW2pdLCBsYXN0SW5kZXggKyAxKTtcbiAgICAgICAgICAgICAgICBpbmRleCA9IChpMSA+PSAwKSA/ICgoaTIgPCAwIHx8IGkxIDwgaTIpID8gaTEgOiBpMikgOiBpMjtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCAwKVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBsb29wO1xuICAgICAgICAgICAgICAgIGRpc3RhbmNlID0gaW5kZXggLSBsYXN0SW5kZXggLSAxO1xuICAgICAgICAgICAgICAgIGlmIChkaXN0YW5jZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZmlyc3QgY2hhciBtaXNtYXRjaCBzaG91bGQgYmUgbW9yZSBzZW5zaXRpdmVcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RJbmRleCA9PT0gLTEpXG4gICAgICAgICAgICAgICAgICAgICAgICBwZW5hbHR5ICs9IDEwO1xuICAgICAgICAgICAgICAgICAgICBwZW5hbHR5ICs9IGRpc3RhbmNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBtYXRjaE1hc2sgPSBtYXRjaE1hc2sgfCAoMSA8PCBpbmRleCk7XG4gICAgICAgICAgICAgICAgbGFzdEluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpdGVtLm1hdGNoTWFzayA9IG1hdGNoTWFzaztcbiAgICAgICAgICAgIGl0ZW0uZXhhY3RNYXRjaCA9IHBlbmFsdHkgPyAwIDogMTtcbiAgICAgICAgICAgIGl0ZW0uc2NvcmUgPSAoaXRlbS5zY29yZSB8fCAwKSAtIHBlbmFsdHk7XG4gICAgICAgICAgICByZXN1bHRzLnB1c2goaXRlbSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxufVxuIl19