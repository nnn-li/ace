var EDITOR_EXT_COMPLETER = 'completer';
export function getCompleter(editor) {
    return editor[EDITOR_EXT_COMPLETER];
}
export function setCompleter(editor, completer) {
    editor[EDITOR_EXT_COMPLETER] = completer;
}
export class CompleterAggregate {
    constructor(editor) {
        this.keyboardHandler = new hhm.HashHandler();
        this.gatherCompletionsId = 0;
        this.autoSelect = true;
        this.autoInsert = true;
        this.showPopup = function (editor) {
            if (this.editor) {
                this.detach();
            }
            this.activated = true;
            this.editor = editor;
            if (getCompleter(editor) != this) {
                if (getCompleter(editor)) {
                    getCompleter(editor).detach();
                }
                setCompleter(editor, this);
            }
            editor.keyBinding.addKeyboardHandler(this.keyboardHandler);
            editor.on("changeSelection", this.changeListener);
            editor.on("blur", this.blurListener);
            editor.on("mousedown", this.mousedownListener);
            editor.on("mousewheel", this.mousewheelListener);
            this.updateCompletions();
        };
        this.editor = editor;
        this.commands = {
            "Up": function (editor) { getCompleter(editor).goTo("up"); },
            "Down": function (editor) { getCompleter(editor).goTo("down"); },
            "Ctrl-Up|Ctrl-Home": function (editor) { getCompleter(editor).goTo("start"); },
            "Ctrl-Down|Ctrl-End": function (editor) { getCompleter(editor).goTo("end"); },
            "Esc": function (editor) { getCompleter(editor).detach(); },
            "Space": function (editor) { getCompleter(editor).detach(); editor.insert(" "); },
            "Return": function (editor) { return getCompleter(editor).insertMatch(); },
            "Shift-Return": function (editor) { getCompleter(editor).insertMatch(true); },
            "Tab": function (editor) {
                var result = getCompleter(editor).insertMatch();
                if (!result && !editor['tabstopManager']) {
                    getCompleter(editor).goTo("down");
                }
                else
                    return result;
            },
            "PageUp": function (editor) { getCompleter(editor).goTo('pageUp'); },
            "PageDown": function (editor) { getCompleter(editor).goTo('pageDown'); }
        };
        this.keyboardHandler.bindKeys(this.commands);
        this.blurListener = this.blurListener.bind(this);
        this.changeListener = this.changeListener.bind(this);
        this.mousedownListener = this.mousedownListener.bind(this);
        this.mousewheelListener = this.mousewheelListener.bind(this);
        this.changeTimer = lang.delayedCall(function () { this.updateCompletions(true); }.bind(this));
    }
    insertMatch(data) {
        if (!data) {
            data = this.popup.getData(this.popup.getRow());
        }
        if (!data) {
            return;
        }
        if (data.completer && data.completer.insertMatch) {
            data.completer.insertMatch(this.editor);
        }
        else {
            if (this.completions.filterText) {
                var ranges = this.editor.selection['getAllRanges']();
                for (var i = 0, range; range = ranges[i]; i++) {
                    range.start.column -= this.completions.filterText.length;
                    this.editor.session.remove(range);
                }
            }
            if (data.snippet) {
                snm.snippetManager.insertSnippet(this.editor, data.snippet);
            }
            else {
                this.editor.execCommand("insertstring", data.value || data);
            }
        }
        this.detach();
    }
    detach() {
        this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler);
        this.editor.off("changeSelection", this.changeListener);
        this.editor.off("blur", this.blurListener);
        this.editor.off("mousedown", this.mousedownListener);
        this.editor.off("mousewheel", this.mousewheelListener);
        this.changeTimer.cancel();
        if (this.popup && this.popup.isOpen) {
            this.gatherCompletionsId += 1;
            this.popup.hide();
        }
        if (this.base)
            this.base.detach();
        this.activated = false;
        this.completions = this.base = null;
    }
    goTo(where) {
        var row = this.popup.getRow();
        var max = this.popup.getLength() - 1;
        switch (where) {
            case "up":
                row = row <= 0 ? max : row - 1;
                break;
            case "down":
                row = row >= max ? -1 : row + 1;
                break;
            case "start":
                row = 0;
                break;
            case "end":
                row = max;
                break;
        }
        this.popup.setRow(row);
    }
    getCompletions(editor, session, pos, prefix, callback) {
        this.base = session.doc.createAnchor(pos.row, pos.column - prefix.length);
        var matches = [];
        var total = editor.completers.length;
        editor.completers.forEach(function (completer, i) {
            completer.getCompletions(editor, session, pos, prefix, function (err, results) {
                if (!err)
                    matches = matches.concat(results);
                var pos = editor.getCursorPosition();
                var line = session.getLine(pos.row);
                callback(null, {
                    prefix: util.retrievePrecedingIdentifier(line, pos.column, results[0] && results[0].identifierRegex),
                    matches: matches,
                    finished: (--total === 0)
                });
            });
        });
        return true;
    }
    updateCompletions(keepPopupPosition) {
        var pos = this.editor.getCursorPosition();
        var prefix;
        if (keepPopupPosition && this.base && this.completions) {
            prefix = this.editor.session.getTextRange({ start: this.base, end: pos });
            if (prefix == this.completions.filterText)
                return;
            this.completions.setFilter(prefix);
            if (!this.completions.filtered.length)
                return this.detach();
            if (this.completions.filtered.length == 1 && this.completions.filtered[0].value == prefix && !this.completions.filtered[0].snippet) {
                return this.detach();
            }
            this.openPopup(this.editor, prefix, keepPopupPosition);
        }
        else {
            var _id = this.gatherCompletionsId;
            var editor = this.editor;
            var session = editor.getSession();
            var line = session.getLine(pos.row);
            prefix = util.retrievePrecedingIdentifier(line, pos.column);
            this.getCompletions(this.editor, session, this.editor.getCursorPosition(), prefix, function (err, results) {
                var detachIfFinished = function () {
                    if (!results.finished)
                        return;
                    return this.detach();
                }.bind(this);
                var prefix = results.prefix;
                var matches = results && results.matches;
                if (!matches || !matches.length)
                    return detachIfFinished();
                if (prefix.indexOf(results.prefix) !== 0 || _id != this.gatherCompletionsId)
                    return;
                this.completions = new FilteredList(matches);
                this.completions.setFilter(prefix);
                var filtered = this.completions.filtered;
                if (!filtered.length)
                    return detachIfFinished();
                if (filtered.length == 1 && filtered[0].value == prefix && !filtered[0].snippet)
                    return detachIfFinished();
                if (this.autoInsert && filtered.length == 1)
                    return this.insertMatch(filtered[0]);
                this.openPopup(this.editor, prefix, keepPopupPosition);
            }.bind(this));
        }
    }
    openPopup(editor, prefix, keepPopupPosition) {
        if (!this.popup) {
            this.popup = new pop.ListViewPopup(document.body || document.documentElement);
            this.popup.on("click", function (e) { this.insertMatch(); e.stop(); }.bind(this));
            this.popup.focus = this.editor.focus.bind(this.editor);
        }
        this.popup.setData(this.completions.filtered);
        this.popup.setRow(this.autoSelect ? 0 : -1);
        if (!keepPopupPosition) {
            this.popup.setTheme(editor.getTheme());
            this.popup.setFontSize(editor.getFontSize());
            var lineHeight = editor.renderer.layerConfig.lineHeight;
            var pos = editor.renderer.$cursorLayer.getPixelPosition(this.base, true);
            pos.left -= this.popup.getTextLeftOffset();
            var rect = editor.container.getBoundingClientRect();
            pos.top += rect.top - editor.renderer.layerConfig.offset;
            pos.left += rect.left - editor.renderer.scrollLeft;
            pos.left += editor.renderer.$gutterLayer.gutterWidth;
            this.popup.show(pos, lineHeight);
        }
    }
    changeListener(e) {
        var cursor = this.editor.selection.lead;
        if (cursor.row != this.base.row || cursor.column < this.base.column) {
            this.detach();
        }
        if (this.activated)
            this.changeTimer.schedule();
        else
            this.detach();
    }
    blurListener() {
        var el = document.activeElement;
        if (el != this.editor.textInput.getElement() && el.parentNode != this.popup.container) {
            this.detach();
        }
    }
    mousedownListener(e) {
        this.detach();
    }
    mousewheelListener(e) {
        this.detach();
    }
    cancelContextMenu() {
        this.editor.cancelMouseContextMenu();
    }
}
export class Autocomplete {
}
Autocomplete.startCommand = {
    name: "startAutocomplete",
    exec: function (editor) {
        var aggregate = getCompleter(editor);
        if (!aggregate) {
            aggregate = new CompleterAggregate(editor);
            setCompleter(editor, aggregate);
        }
        aggregate.autoInsert = true;
        aggregate.autoSelect = true;
        aggregate.showPopup(editor);
        aggregate.cancelContextMenu();
    },
    bindKey: "Ctrl-Space|Ctrl-Shift-Space|Alt-Space"
};
export class FilteredList {
    constructor(all, filterText, mutateData) {
        this.all = all;
        this.filtered = all;
        this.filterText = filterText || "";
    }
    setFilter(str) {
        var matches;
        if (str.length > this.filterText && str.lastIndexOf(this.filterText, 0) === 0)
            matches = this.filtered;
        else
            matches = this.all;
        this.filterText = str;
        matches = this.filterCompletions(matches, this.filterText);
        matches = matches.sort(function (a, b) {
            return b.exactMatch - a.exactMatch || b.score - a.score;
        });
        var prev = null;
        matches = matches.filter(function (item) {
            var caption = item.value || item.caption || item.snippet;
            if (caption === prev)
                return false;
            prev = caption;
            return true;
        });
        this.filtered = matches;
    }
    filterCompletions(items, needle) {
        var results = [];
        var upper = needle.toUpperCase();
        var lower = needle.toLowerCase();
        loop: for (var i = 0, length = items.length; i < length; i++) {
            var item = items[i];
            var caption = item.value || item.caption || item.snippet;
            if (!caption)
                continue;
            var lastIndex = -1;
            var matchMask = 0;
            var penalty = 0;
            var index, distance;
            for (var j = 0; j < needle.length; j++) {
                var i1 = caption.indexOf(lower[j], lastIndex + 1);
                var i2 = caption.indexOf(upper[j], lastIndex + 1);
                index = (i1 >= 0) ? ((i2 < 0 || i1 < i2) ? i1 : i2) : i2;
                if (index < 0)
                    continue loop;
                distance = index - lastIndex - 1;
                if (distance > 0) {
                    if (lastIndex === -1)
                        penalty += 10;
                    penalty += distance;
                }
                matchMask = matchMask | (1 << index);
                lastIndex = index;
            }
            item.matchMask = matchMask;
            item.exactMatch = penalty ? 0 : 1;
            item.score = (item.score || 0) - penalty;
            results.push(item);
        }
        return results;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b2NvbXBsZXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2F1dG9jb21wbGV0ZS50cyJdLCJuYW1lcyI6WyJnZXRDb21wbGV0ZXIiLCJzZXRDb21wbGV0ZXIiLCJDb21wbGV0ZXJBZ2dyZWdhdGUiLCJDb21wbGV0ZXJBZ2dyZWdhdGUuY29uc3RydWN0b3IiLCJDb21wbGV0ZXJBZ2dyZWdhdGUuaW5zZXJ0TWF0Y2giLCJDb21wbGV0ZXJBZ2dyZWdhdGUuZGV0YWNoIiwiQ29tcGxldGVyQWdncmVnYXRlLmdvVG8iLCJDb21wbGV0ZXJBZ2dyZWdhdGUuZ2V0Q29tcGxldGlvbnMiLCJDb21wbGV0ZXJBZ2dyZWdhdGUudXBkYXRlQ29tcGxldGlvbnMiLCJDb21wbGV0ZXJBZ2dyZWdhdGUub3BlblBvcHVwIiwiQ29tcGxldGVyQWdncmVnYXRlLmNoYW5nZUxpc3RlbmVyIiwiQ29tcGxldGVyQWdncmVnYXRlLmJsdXJMaXN0ZW5lciIsIkNvbXBsZXRlckFnZ3JlZ2F0ZS5tb3VzZWRvd25MaXN0ZW5lciIsIkNvbXBsZXRlckFnZ3JlZ2F0ZS5tb3VzZXdoZWVsTGlzdGVuZXIiLCJDb21wbGV0ZXJBZ2dyZWdhdGUuY2FuY2VsQ29udGV4dE1lbnUiLCJBdXRvY29tcGxldGUiLCJGaWx0ZXJlZExpc3QiLCJGaWx0ZXJlZExpc3QuY29uc3RydWN0b3IiLCJGaWx0ZXJlZExpc3Quc2V0RmlsdGVyIiwiRmlsdGVyZWRMaXN0LmZpbHRlckNvbXBsZXRpb25zIl0sIm1hcHBpbmdzIjoiQUF3Q0EsSUFBSSxvQkFBb0IsR0FBRyxXQUFXLENBQUM7QUFNdkMsNkJBQTZCLE1BQWM7SUFDdkNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0E7QUFDeENBLENBQUNBO0FBRUQsNkJBQTZCLE1BQWMsRUFBRSxTQUE2QjtJQUN0RUMsTUFBTUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxHQUFHQSxTQUFTQSxDQUFDQTtBQUM3Q0EsQ0FBQ0E7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WUEsQ0FBQ0EsQ0FBQ0E7UUFDM0NBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBLFdBQVdBLEVBQUVBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsQ0FBQ0E7UUFDckRBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBLFlBQVlBLEVBQUVBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsQ0FBQ0E7UUFDdkRBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO1FBRTFCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxJQUFJQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNsQ0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUM5QkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0E7UUFDdEJBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO1lBQ1ZBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO1FBQ3ZCQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUN2QkEsSUFBSUEsQ0FBQ0EsV0FBV0EsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7SUFDeENBLENBQUNBO0lBS01ILElBQUlBLENBQUNBLEtBQWFBO1FBQ3JCSSxJQUFJQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtRQUM5QkEsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFckNBLE1BQU1BLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBO1lBQ1pBLEtBQUtBLElBQUlBO2dC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QUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQ2pGQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUMzREEsQ0FBQ0E7UUFFREEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFFOUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRTVDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxpQkFBaUJBLENBQUNBLENBQUNBLENBQUNBO1lBQ3JCQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxRQUFRQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUN2Q0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFFN0NBLElBQUlBLFVBQVVBLEdBQUdBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLFdBQVdBLENBQUNBLFVBQVVBLENBQUNBO1lBRXhEQSxJQUFJQSxHQUFHQSxHQUFrQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUN4R0EsR0FBR0EsQ0FBQ0EsSUFBSUEsSUFBSUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsaUJBQWlCQSxFQUFFQSxDQUFDQTtZQUUzQ0Es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QUFDQSxDQUFDQSxTQUFTQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDakJBLE9BQU9BLElBQUlBLEVBQUVBLENBQUNBO29CQUNsQkEsT0FBT0EsSUFBSUEsUUFBUUEsQ0FBQ0E7Z0JBQ3hCQSxDQUFDQTtnQkFDREEsU0FBU0EsR0FBR0EsU0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3JDQSxTQUFTQSxHQUFHQSxLQUFLQSxDQUFDQTtZQUN0QkEsQ0FBQ0E7WUFDREEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsU0FBU0EsQ0FBQ0E7WUFDM0JBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLE9BQU9BLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ2xDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQTtZQUN6Q0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDdkJBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBO0lBQ25CQSxDQUFDQTtBQUNMSCxDQUFDQTtBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMiwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXRcbiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuICogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlXG4gKiAgICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICogICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBBamF4Lm9yZyBCLlYuIG5vciB0aGVcbiAqICAgICAgIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzXG4gKiAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cbiAqXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkRcbiAqIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEXG4gKiBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFXG4gKiBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBBSkFYLk9SRyBCLlYuIEJFIExJQUJMRSBGT1IgQU5ZXG4gKiBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFU1xuICogKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTO1xuICogTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EXG4gKiBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVNcbiAqIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICpcbiAqICoqKioqIEVORCBMSUNFTlNFIEJMT0NLICoqKioqICovXG5cbmltcG9ydCBoaG0gPSByZXF1aXJlKFwiLi9rZXlib2FyZC9oYXNoX2hhbmRsZXJcIik7XG5pbXBvcnQgcG9wID0gcmVxdWlyZShcIi4vYXV0b2NvbXBsZXRlL3BvcHVwXCIpO1xuaW1wb3J0IHV0aWwgPSByZXF1aXJlKFwiLi9hdXRvY29tcGxldGUvdXRpbFwiKTtcbmltcG9ydCBldmVudCA9IHJlcXVpcmUoXCIuL2xpYi9ldmVudFwiKTtcbmltcG9ydCBsYW5nID0gcmVxdWlyZShcIi4vbGliL2xhbmdcIik7XG5pbXBvcnQgc25tID0gcmVxdWlyZShcIi4vc25pcHBldHNcIik7XG5pbXBvcnQgRWRpdG9yID0gcmVxdWlyZSgnLi9FZGl0b3InKTtcbmltcG9ydCBlc20gPSByZXF1aXJlKCcuL2VkaXRfc2Vzc2lvbicpO1xuaW1wb3J0IGFubSA9IHJlcXVpcmUoJy4vYW5jaG9yJyk7XG5cbnZhciBFRElUT1JfRVhUX0NPTVBMRVRFUiA9ICdjb21wbGV0ZXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbXBsZXRlciB7XG4gICAgZ2V0Q29tcGxldGlvbnMoZWRpdG9yOiBFZGl0b3IsIHNlc3Npb246IGVzbS5FZGl0U2Vzc2lvbiwgcG9zOiB7IHJvdzogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9LCBwcmVmaXg6IHN0cmluZywgY2FsbGJhY2spO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29tcGxldGVyKGVkaXRvcjogRWRpdG9yKTogQ29tcGxldGVyQWdncmVnYXRlIHtcbiAgICByZXR1cm4gZWRpdG9yW0VESVRPUl9FWFRfQ09NUExFVEVSXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldENvbXBsZXRlcihlZGl0b3I6IEVkaXRvciwgY29tcGxldGVyOiBDb21wbGV0ZXJBZ2dyZWdhdGUpIHtcbiAgICBlZGl0b3JbRURJVE9SX0VYVF9DT01QTEVURVJdID0gY29tcGxldGVyO1xufVxuXG5leHBvcnQgY2xhc3MgQ29tcGxldGVyQWdncmVnYXRlIGltcGxlbWVudHMgQ29tcGxldGVyIHtcbiAgICBwcml2YXRlIGVkaXRvcjogRWRpdG9yO1xuICAgIHByaXZhdGUga2V5Ym9hcmRIYW5kbGVyID0gbmV3IGhobS5IYXNoSGFuZGxlcigpO1xuICAgIHB1YmxpYyBhY3RpdmF0ZWQ6IGJvb2xlYW47XG4gICAgcHJpdmF0ZSBjaGFuZ2VUaW1lcjtcbiAgICBwcml2YXRlIGdhdGhlckNvbXBsZXRpb25zSWQgPSAwO1xuICAgIHByaXZhdGUgYmFzZTogYW5tLkFuY2hvcjtcbiAgICBwcml2YXRlIGNvbXBsZXRpb25zOiB7IGZpbHRlcmVkOyBmaWx0ZXJUZXh0OyBzZXRGaWx0ZXIgfTtcbiAgICBwcml2YXRlIGNvbW1hbmRzO1xuICAgIHB1YmxpYyBhdXRvU2VsZWN0ID0gdHJ1ZTtcbiAgICBwdWJsaWMgYXV0b0luc2VydCA9IHRydWU7XG4gICAgY29uc3RydWN0b3IoZWRpdG9yOiBFZGl0b3IpIHtcbiAgICAgICAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG4gICAgICAgIHRoaXMuY29tbWFuZHMgPSB7XG4gICAgICAgICAgICBcIlVwXCI6IGZ1bmN0aW9uKGVkaXRvcjogRWRpdG9yKSB7IGdldENvbXBsZXRlcihlZGl0b3IpLmdvVG8oXCJ1cFwiKTsgfSxcbiAgICAgICAgICAgIFwiRG93blwiOiBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikgeyBnZXRDb21wbGV0ZXIoZWRpdG9yKS5nb1RvKFwiZG93blwiKTsgfSxcbiAgICAgICAgICAgIFwiQ3RybC1VcHxDdHJsLUhvbWVcIjogZnVuY3Rpb24oZWRpdG9yOiBFZGl0b3IpIHsgZ2V0Q29tcGxldGVyKGVkaXRvcikuZ29UbyhcInN0YXJ0XCIpOyB9LFxuICAgICAgICAgICAgXCJDdHJsLURvd258Q3RybC1FbmRcIjogZnVuY3Rpb24oZWRpdG9yOiBFZGl0b3IpIHsgZ2V0Q29tcGxldGVyKGVkaXRvcikuZ29UbyhcImVuZFwiKTsgfSxcblxuICAgICAgICAgICAgXCJFc2NcIjogZnVuY3Rpb24oZWRpdG9yOiBFZGl0b3IpIHsgZ2V0Q29tcGxldGVyKGVkaXRvcikuZGV0YWNoKCk7IH0sXG4gICAgICAgICAgICBcIlNwYWNlXCI6IGZ1bmN0aW9uKGVkaXRvcjogRWRpdG9yKSB7IGdldENvbXBsZXRlcihlZGl0b3IpLmRldGFjaCgpOyBlZGl0b3IuaW5zZXJ0KFwiIFwiKTsgfSxcbiAgICAgICAgICAgIFwiUmV0dXJuXCI6IGZ1bmN0aW9uKGVkaXRvcjogRWRpdG9yKSB7IHJldHVybiBnZXRDb21wbGV0ZXIoZWRpdG9yKS5pbnNlcnRNYXRjaCgpOyB9LFxuICAgICAgICAgICAgXCJTaGlmdC1SZXR1cm5cIjogZnVuY3Rpb24oZWRpdG9yOiBFZGl0b3IpIHsgZ2V0Q29tcGxldGVyKGVkaXRvcikuaW5zZXJ0TWF0Y2godHJ1ZSk7IH0sXG4gICAgICAgICAgICBcIlRhYlwiOiBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikge1xuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBnZXRDb21wbGV0ZXIoZWRpdG9yKS5pbnNlcnRNYXRjaCgpO1xuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0ICYmICFlZGl0b3JbJ3RhYnN0b3BNYW5hZ2VyJ10pIHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0Q29tcGxldGVyKGVkaXRvcikuZ29UbyhcImRvd25cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIFwiUGFnZVVwXCI6IGZ1bmN0aW9uKGVkaXRvcjogRWRpdG9yKSB7IGdldENvbXBsZXRlcihlZGl0b3IpLmdvVG8oJ3BhZ2VVcCcpOyB9LFxuICAgICAgICAgICAgXCJQYWdlRG93blwiOiBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikgeyBnZXRDb21wbGV0ZXIoZWRpdG9yKS5nb1RvKCdwYWdlRG93bicpOyB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5rZXlib2FyZEhhbmRsZXIuYmluZEtleXModGhpcy5jb21tYW5kcyk7XG5cbiAgICAgICAgdGhpcy5ibHVyTGlzdGVuZXIgPSB0aGlzLmJsdXJMaXN0ZW5lci5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLmNoYW5nZUxpc3RlbmVyID0gdGhpcy5jaGFuZ2VMaXN0ZW5lci5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm1vdXNlZG93bkxpc3RlbmVyID0gdGhpcy5tb3VzZWRvd25MaXN0ZW5lci5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm1vdXNld2hlZWxMaXN0ZW5lciA9IHRoaXMubW91c2V3aGVlbExpc3RlbmVyLmJpbmQodGhpcyk7XG5cbiAgICAgICAgdGhpcy5jaGFuZ2VUaW1lciA9IGxhbmcuZGVsYXllZENhbGwoZnVuY3Rpb24oKSB7IHRoaXMudXBkYXRlQ29tcGxldGlvbnModHJ1ZSk7IH0uYmluZCh0aGlzKSk7XG4gICAgfVxuICAgIHB1YmxpYyBwb3B1cDogcG9wLkxpc3RWaWV3UG9wdXA7XG5cbiAgICAvKipcbiAgICAgKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgQ29tcGxldGVyIGludGVyZmFjZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgaW5zZXJ0TWF0Y2goZGF0YT8pIHtcbiAgICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgICAgICBkYXRhID0gdGhpcy5wb3B1cC5nZXREYXRhKHRoaXMucG9wdXAuZ2V0Um93KCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5jb21wbGV0ZXIgJiYgZGF0YS5jb21wbGV0ZXIuaW5zZXJ0TWF0Y2gpIHtcbiAgICAgICAgICAgIGRhdGEuY29tcGxldGVyLmluc2VydE1hdGNoKHRoaXMuZWRpdG9yKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBsZXRpb25zLmZpbHRlclRleHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmFuZ2VzID0gdGhpcy5lZGl0b3Iuc2VsZWN0aW9uWydnZXRBbGxSYW5nZXMnXSgpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IEFzc2lnbm1lbnQgaW4gY29uZGl0aW9uYWwgZXhwcmVzc2lvbi5cbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBBc3NpZ25tZW50IGluIGNvbmRpdGlvbmFsIGV4cHJlc3Npb24uXG4gICAgICAgICAgICAgICAgLy8gSXQncyBjdXRlIGJ1dCBhbHNvIG1heSBoYWx0IHByZW1hdHVyZWx5IGFuZCBzbyBoaWRlIGJ1Z3MuXG4gICAgICAgICAgICAgICAgLy8gUmVwbGFjZSBieSBsZW5ndGggdmFyaWFibGUgYW5kIHRlc3Q/XG4gICAgICAgICAgICAgICAgLy8gVXNlIGFzc2VydGlvbiB3aXRoaW4gdGhlIGxvb3AgdG8gbG9vayBmb3IgZmFsc2V5IHZhbHVlcy5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgcmFuZ2U7IHJhbmdlID0gcmFuZ2VzW2ldOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2Uuc3RhcnQuY29sdW1uIC09IHRoaXMuY29tcGxldGlvbnMuZmlsdGVyVGV4dC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLnNlc3Npb24ucmVtb3ZlKHJhbmdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGF0YS5zbmlwcGV0KSB7XG4gICAgICAgICAgICAgICAgc25tLnNuaXBwZXRNYW5hZ2VyLmluc2VydFNuaXBwZXQodGhpcy5lZGl0b3IsIGRhdGEuc25pcHBldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVkaXRvci5leGVjQ29tbWFuZChcImluc2VydHN0cmluZ1wiLCBkYXRhLnZhbHVlIHx8IGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGV0YWNoKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW1wbGVtZW50YXRpb24gb2YgdGhlIENvbXBsZXRlciBpbnRlcmZhY2UuXG4gICAgICovXG4gICAgcHVibGljIGRldGFjaCgpIHtcbiAgICAgICAgdGhpcy5lZGl0b3Iua2V5QmluZGluZy5yZW1vdmVLZXlib2FyZEhhbmRsZXIodGhpcy5rZXlib2FyZEhhbmRsZXIpO1xuICAgICAgICB0aGlzLmVkaXRvci5vZmYoXCJjaGFuZ2VTZWxlY3Rpb25cIiwgdGhpcy5jaGFuZ2VMaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuZWRpdG9yLm9mZihcImJsdXJcIiwgdGhpcy5ibHVyTGlzdGVuZXIpO1xuICAgICAgICB0aGlzLmVkaXRvci5vZmYoXCJtb3VzZWRvd25cIiwgdGhpcy5tb3VzZWRvd25MaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuZWRpdG9yLm9mZihcIm1vdXNld2hlZWxcIiwgdGhpcy5tb3VzZXdoZWVsTGlzdGVuZXIpO1xuICAgICAgICB0aGlzLmNoYW5nZVRpbWVyLmNhbmNlbCgpO1xuXG4gICAgICAgIGlmICh0aGlzLnBvcHVwICYmIHRoaXMucG9wdXAuaXNPcGVuKSB7XG4gICAgICAgICAgICB0aGlzLmdhdGhlckNvbXBsZXRpb25zSWQgKz0gMTtcbiAgICAgICAgICAgIHRoaXMucG9wdXAuaGlkZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuYmFzZSlcbiAgICAgICAgICAgIHRoaXMuYmFzZS5kZXRhY2goKTtcbiAgICAgICAgdGhpcy5hY3RpdmF0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jb21wbGV0aW9ucyA9IHRoaXMuYmFzZSA9IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW1wbGVtZW50YXRpb24gb2YgdGhlIENvbXBsZXRlciBpbnRlcmZhY2UuXG4gICAgICovXG4gICAgcHVibGljIGdvVG8od2hlcmU6IHN0cmluZykge1xuICAgICAgICB2YXIgcm93ID0gdGhpcy5wb3B1cC5nZXRSb3coKTtcbiAgICAgICAgdmFyIG1heCA9IHRoaXMucG9wdXAuZ2V0TGVuZ3RoKCkgLSAxO1xuXG4gICAgICAgIHN3aXRjaCAod2hlcmUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJ1cFwiOiByb3cgPSByb3cgPD0gMCA/IG1heCA6IHJvdyAtIDE7IGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImRvd25cIjogcm93ID0gcm93ID49IG1heCA/IC0xIDogcm93ICsgMTsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwic3RhcnRcIjogcm93ID0gMDsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZW5kXCI6IHJvdyA9IG1heDsgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnBvcHVwLnNldFJvdyhyb3cpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEltcGxlbWVudGF0aW9uIG9mIHRoZSBDb21wbGV0ZXIgaW50ZXJmYWNlLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRDb21wbGV0aW9ucyhlZGl0b3I6IEVkaXRvciwgc2Vzc2lvbiwgcG9zOiB7IHJvdzogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9LCBwcmVmaXg6IHN0cmluZywgY2FsbGJhY2spIHtcblxuICAgICAgICB0aGlzLmJhc2UgPSBzZXNzaW9uLmRvYy5jcmVhdGVBbmNob3IocG9zLnJvdywgcG9zLmNvbHVtbiAtIHByZWZpeC5sZW5ndGgpO1xuXG4gICAgICAgIHZhciBtYXRjaGVzID0gW107XG4gICAgICAgIHZhciB0b3RhbCA9IGVkaXRvci5jb21wbGV0ZXJzLmxlbmd0aDtcbiAgICAgICAgZWRpdG9yLmNvbXBsZXRlcnMuZm9yRWFjaChmdW5jdGlvbihjb21wbGV0ZXI6IENvbXBsZXRlciwgaSkge1xuICAgICAgICAgICAgY29tcGxldGVyLmdldENvbXBsZXRpb25zKGVkaXRvciwgc2Vzc2lvbiwgcG9zLCBwcmVmaXgsIGZ1bmN0aW9uKGVyciwgcmVzdWx0cykge1xuICAgICAgICAgICAgICAgIGlmICghZXJyKVxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVzID0gbWF0Y2hlcy5jb25jYXQocmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgLy8gRmV0Y2ggcHJlZml4IGFnYWluLCBiZWNhdXNlIHRoZXkgbWF5IGhhdmUgY2hhbmdlZCBieSBub3dcbiAgICAgICAgICAgICAgICB2YXIgcG9zOiB7IHJvdzogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9ID0gZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgdmFyIGxpbmUgPSBzZXNzaW9uLmdldExpbmUocG9zLnJvdyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgICAgICAgICAgICAgICBwcmVmaXg6IHV0aWwucmV0cmlldmVQcmVjZWRpbmdJZGVudGlmaWVyKGxpbmUsIHBvcy5jb2x1bW4sIHJlc3VsdHNbMF0gJiYgcmVzdWx0c1swXS5pZGVudGlmaWVyUmVnZXgpLFxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVzOiBtYXRjaGVzLFxuICAgICAgICAgICAgICAgICAgICBmaW5pc2hlZDogKC0tdG90YWwgPT09IDApXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlQ29tcGxldGlvbnMoa2VlcFBvcHVwUG9zaXRpb246IGJvb2xlYW4pIHtcbiAgICAgICAgdmFyIHBvcyA9IHRoaXMuZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCk7XG4gICAgICAgIHZhciBwcmVmaXg6IHN0cmluZztcbiAgICAgICAgaWYgKGtlZXBQb3B1cFBvc2l0aW9uICYmIHRoaXMuYmFzZSAmJiB0aGlzLmNvbXBsZXRpb25zKSB7XG4gICAgICAgICAgICBwcmVmaXggPSB0aGlzLmVkaXRvci5zZXNzaW9uLmdldFRleHRSYW5nZSh7IHN0YXJ0OiB0aGlzLmJhc2UsIGVuZDogcG9zIH0pO1xuICAgICAgICAgICAgaWYgKHByZWZpeCA9PSB0aGlzLmNvbXBsZXRpb25zLmZpbHRlclRleHQpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0aW9ucy5zZXRGaWx0ZXIocHJlZml4KTtcbiAgICAgICAgICAgIGlmICghdGhpcy5jb21wbGV0aW9ucy5maWx0ZXJlZC5sZW5ndGgpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGV0YWNoKCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBsZXRpb25zLmZpbHRlcmVkLmxlbmd0aCA9PSAxICYmIHRoaXMuY29tcGxldGlvbnMuZmlsdGVyZWRbMF0udmFsdWUgPT0gcHJlZml4ICYmICF0aGlzLmNvbXBsZXRpb25zLmZpbHRlcmVkWzBdLnNuaXBwZXQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kZXRhY2goKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5vcGVuUG9wdXAodGhpcy5lZGl0b3IsIHByZWZpeCwga2VlcFBvcHVwUG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gU2F2ZSBjdXJyZW50IGdhdGhlckNvbXBsZXRpb25zIHNlc3Npb24sIHNlc3Npb24gaXMgY2xvc2Ugd2hlbiBhIG1hdGNoIGlzIGluc2VydFxuICAgICAgICAgICAgdmFyIF9pZCA9IHRoaXMuZ2F0aGVyQ29tcGxldGlvbnNJZDtcbiAgICAgICAgICAgIHZhciBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgICAgIHZhciBzZXNzaW9uID0gZWRpdG9yLmdldFNlc3Npb24oKTtcbiAgICAgICAgICAgIHZhciBsaW5lID0gc2Vzc2lvbi5nZXRMaW5lKHBvcy5yb3cpO1xuICAgICAgICAgICAgcHJlZml4ID0gdXRpbC5yZXRyaWV2ZVByZWNlZGluZ0lkZW50aWZpZXIobGluZSwgcG9zLmNvbHVtbik7XG4gICAgICAgICAgICB0aGlzLmdldENvbXBsZXRpb25zKHRoaXMuZWRpdG9yLCBzZXNzaW9uLCB0aGlzLmVkaXRvci5nZXRDdXJzb3JQb3NpdGlvbigpLCBwcmVmaXgsIGZ1bmN0aW9uKGVyciwgcmVzdWx0cykge1xuICAgICAgICAgICAgICAgIC8vIE9ubHkgZGV0YWNoIGlmIHJlc3VsdCBnYXRoZXJpbmcgaXMgZmluaXNoZWRcbiAgICAgICAgICAgICAgICB2YXIgZGV0YWNoSWZGaW5pc2hlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdHMuZmluaXNoZWQpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGV0YWNoKCk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHByZWZpeCA9IHJlc3VsdHMucHJlZml4O1xuICAgICAgICAgICAgICAgIHZhciBtYXRjaGVzID0gcmVzdWx0cyAmJiByZXN1bHRzLm1hdGNoZXM7XG5cbiAgICAgICAgICAgICAgICBpZiAoIW1hdGNoZXMgfHwgIW1hdGNoZXMubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGV0YWNoSWZGaW5pc2hlZCgpO1xuICAgIFxuICAgICAgICAgICAgICAgIC8vIFdyb25nIHByZWZpeCBvciB3cm9uZyBzZXNzaW9uIC0+IGlnbm9yZVxuICAgICAgICAgICAgICAgIGlmIChwcmVmaXguaW5kZXhPZihyZXN1bHRzLnByZWZpeCkgIT09IDAgfHwgX2lkICE9IHRoaXMuZ2F0aGVyQ29tcGxldGlvbnNJZClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0aW9ucyA9IG5ldyBGaWx0ZXJlZExpc3QobWF0Y2hlcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0aW9ucy5zZXRGaWx0ZXIocHJlZml4KTtcbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyZWQgPSB0aGlzLmNvbXBsZXRpb25zLmZpbHRlcmVkO1xuICAgIFxuICAgICAgICAgICAgICAgIC8vIE5vIHJlc3VsdHNcbiAgICAgICAgICAgICAgICBpZiAoIWZpbHRlcmVkLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRldGFjaElmRmluaXNoZWQoKTtcbiAgICBcbiAgICAgICAgICAgICAgICAvLyBPbmUgcmVzdWx0IGVxdWFscyB0byB0aGUgcHJlZml4XG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkLmxlbmd0aCA9PSAxICYmIGZpbHRlcmVkWzBdLnZhbHVlID09IHByZWZpeCAmJiAhZmlsdGVyZWRbMF0uc25pcHBldClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRldGFjaElmRmluaXNoZWQoKTtcbiAgICBcbiAgICAgICAgICAgICAgICAvLyBBdXRvaW5zZXJ0IGlmIG9uZSByZXN1bHRcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hdXRvSW5zZXJ0ICYmIGZpbHRlcmVkLmxlbmd0aCA9PSAxKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbnNlcnRNYXRjaChmaWx0ZXJlZFswXSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLm9wZW5Qb3B1cCh0aGlzLmVkaXRvciwgcHJlZml4LCBrZWVwUG9wdXBQb3NpdGlvbik7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvcGVuUG9wdXAoZWRpdG9yOiBFZGl0b3IsIHByZWZpeDogc3RyaW5nLCBrZWVwUG9wdXBQb3NpdGlvbjogYm9vbGVhbikge1xuICAgICAgICBpZiAoIXRoaXMucG9wdXApIHtcbiAgICAgICAgICAgIHRoaXMucG9wdXAgPSBuZXcgcG9wLkxpc3RWaWV3UG9wdXAoZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5wb3B1cC5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpIHsgdGhpcy5pbnNlcnRNYXRjaCgpOyBlLnN0b3AoKTsgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIHRoaXMucG9wdXAuZm9jdXMgPSB0aGlzLmVkaXRvci5mb2N1cy5iaW5kKHRoaXMuZWRpdG9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucG9wdXAuc2V0RGF0YSh0aGlzLmNvbXBsZXRpb25zLmZpbHRlcmVkKTtcblxuICAgICAgICB0aGlzLnBvcHVwLnNldFJvdyh0aGlzLmF1dG9TZWxlY3QgPyAwIDogLTEpO1xuXG4gICAgICAgIGlmICgha2VlcFBvcHVwUG9zaXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMucG9wdXAuc2V0VGhlbWUoZWRpdG9yLmdldFRoZW1lKCkpO1xuICAgICAgICAgICAgdGhpcy5wb3B1cC5zZXRGb250U2l6ZShlZGl0b3IuZ2V0Rm9udFNpemUoKSk7XG5cbiAgICAgICAgICAgIHZhciBsaW5lSGVpZ2h0ID0gZWRpdG9yLnJlbmRlcmVyLmxheWVyQ29uZmlnLmxpbmVIZWlnaHQ7XG5cbiAgICAgICAgICAgIHZhciBwb3M6IHsgbGVmdDogbnVtYmVyOyB0b3A6IG51bWJlciB9ID0gZWRpdG9yLnJlbmRlcmVyLiRjdXJzb3JMYXllci5nZXRQaXhlbFBvc2l0aW9uKHRoaXMuYmFzZSwgdHJ1ZSk7XG4gICAgICAgICAgICBwb3MubGVmdCAtPSB0aGlzLnBvcHVwLmdldFRleHRMZWZ0T2Zmc2V0KCk7XG5cbiAgICAgICAgICAgIHZhciByZWN0ID0gZWRpdG9yLmNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgIHBvcy50b3AgKz0gcmVjdC50b3AgLSBlZGl0b3IucmVuZGVyZXIubGF5ZXJDb25maWcub2Zmc2V0O1xuICAgICAgICAgICAgcG9zLmxlZnQgKz0gcmVjdC5sZWZ0IC0gZWRpdG9yLnJlbmRlcmVyLnNjcm9sbExlZnQ7XG4gICAgICAgICAgICBwb3MubGVmdCArPSBlZGl0b3IucmVuZGVyZXIuJGd1dHRlckxheWVyLmd1dHRlcldpZHRoO1xuXG4gICAgICAgICAgICB0aGlzLnBvcHVwLnNob3cocG9zLCBsaW5lSGVpZ2h0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY2hhbmdlTGlzdGVuZXIoZSkge1xuICAgICAgICB2YXIgY3Vyc29yID0gdGhpcy5lZGl0b3Iuc2VsZWN0aW9uLmxlYWQ7XG4gICAgICAgIGlmIChjdXJzb3Iucm93ICE9IHRoaXMuYmFzZS5yb3cgfHwgY3Vyc29yLmNvbHVtbiA8IHRoaXMuYmFzZS5jb2x1bW4pIHtcbiAgICAgICAgICAgIHRoaXMuZGV0YWNoKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYWN0aXZhdGVkKVxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VUaW1lci5zY2hlZHVsZSgpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLmRldGFjaCgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYmx1ckxpc3RlbmVyKCkge1xuICAgICAgICAvLyB3ZSBoYXZlIHRvIGNoZWNrIGlmIGFjdGl2ZUVsZW1lbnQgaXMgYSBjaGlsZCBvZiBwb3B1cCBiZWNhdXNlXG4gICAgICAgIC8vIG9uIElFIHByZXZlbnREZWZhdWx0IGRvZXNuJ3Qgc3RvcCBzY3JvbGxiYXIgZnJvbSBiZWluZyBmb2N1c3NlZFxuICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuICAgICAgICBpZiAoZWwgIT0gdGhpcy5lZGl0b3IudGV4dElucHV0LmdldEVsZW1lbnQoKSAmJiBlbC5wYXJlbnROb2RlICE9IHRoaXMucG9wdXAuY29udGFpbmVyKSB7XG4gICAgICAgICAgICB0aGlzLmRldGFjaCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBtb3VzZWRvd25MaXN0ZW5lcihlKSB7XG4gICAgICAgIHRoaXMuZGV0YWNoKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBtb3VzZXdoZWVsTGlzdGVuZXIoZSkge1xuICAgICAgICB0aGlzLmRldGFjaCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzaG93UG9wdXAgPSBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikge1xuXG4gICAgICAgIGlmICh0aGlzLmVkaXRvcikge1xuICAgICAgICAgICAgdGhpcy5kZXRhY2goKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYWN0aXZhdGVkID0gdHJ1ZTtcblxuICAgICAgICB0aGlzLmVkaXRvciA9IGVkaXRvcjtcblxuICAgICAgICBpZiAoZ2V0Q29tcGxldGVyKGVkaXRvcikgIT0gdGhpcykge1xuICAgICAgICAgICAgaWYgKGdldENvbXBsZXRlcihlZGl0b3IpKSB7XG4gICAgICAgICAgICAgICAgZ2V0Q29tcGxldGVyKGVkaXRvcikuZGV0YWNoKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRDb21wbGV0ZXIoZWRpdG9yLCB0aGlzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVkaXRvci5rZXlCaW5kaW5nLmFkZEtleWJvYXJkSGFuZGxlcih0aGlzLmtleWJvYXJkSGFuZGxlcik7XG4gICAgICAgIGVkaXRvci5vbihcImNoYW5nZVNlbGVjdGlvblwiLCB0aGlzLmNoYW5nZUxpc3RlbmVyKTtcbiAgICAgICAgZWRpdG9yLm9uKFwiYmx1clwiLCB0aGlzLmJsdXJMaXN0ZW5lcik7XG4gICAgICAgIGVkaXRvci5vbihcIm1vdXNlZG93blwiLCB0aGlzLm1vdXNlZG93bkxpc3RlbmVyKTtcbiAgICAgICAgZWRpdG9yLm9uKFwibW91c2V3aGVlbFwiLCB0aGlzLm1vdXNld2hlZWxMaXN0ZW5lcik7XG5cbiAgICAgICAgdGhpcy51cGRhdGVDb21wbGV0aW9ucygpO1xuICAgIH1cbiAgICBwdWJsaWMgY2FuY2VsQ29udGV4dE1lbnUoKSB7XG4gICAgICAgIHRoaXMuZWRpdG9yLmNhbmNlbE1vdXNlQ29udGV4dE1lbnUoKTtcbiAgICB9XG59XG5cbi8vIFRPRE86IFNob3VsZCB3ZSBpbXBsZW1lbnQgQ29tcGxldGVyIG9yIGlzIGl0IHJlYWxseSBqdXN0IGltcGxlbWVudGF0aW9uP1xuZXhwb3J0IGNsYXNzIEF1dG9jb21wbGV0ZSB7XG4gICAgc3RhdGljIHN0YXJ0Q29tbWFuZCA9IHtcbiAgICAgICAgbmFtZTogXCJzdGFydEF1dG9jb21wbGV0ZVwiLFxuICAgICAgICBleGVjOiBmdW5jdGlvbihlZGl0b3I6IEVkaXRvcikge1xuICAgICAgICAgICAgdmFyIGFnZ3JlZ2F0ZTogQ29tcGxldGVyQWdncmVnYXRlID0gZ2V0Q29tcGxldGVyKGVkaXRvcik7XG4gICAgICAgICAgICBpZiAoIWFnZ3JlZ2F0ZSkge1xuICAgICAgICAgICAgICAgIGFnZ3JlZ2F0ZSA9IG5ldyBDb21wbGV0ZXJBZ2dyZWdhdGUoZWRpdG9yKTtcbiAgICAgICAgICAgICAgICBzZXRDb21wbGV0ZXIoZWRpdG9yLCBhZ2dyZWdhdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWdncmVnYXRlLmF1dG9JbnNlcnQgPSB0cnVlO1xuICAgICAgICAgICAgYWdncmVnYXRlLmF1dG9TZWxlY3QgPSB0cnVlO1xuICAgICAgICAgICAgYWdncmVnYXRlLnNob3dQb3B1cChlZGl0b3IpO1xuICAgICAgICAgICAgLy8gbmVlZGVkIGZvciBmaXJlZm94IG9uIG1hY1xuICAgICAgICAgICAgYWdncmVnYXRlLmNhbmNlbENvbnRleHRNZW51KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGJpbmRLZXk6IFwiQ3RybC1TcGFjZXxDdHJsLVNoaWZ0LVNwYWNlfEFsdC1TcGFjZVwiXG4gICAgfTtcbn1cblxuZXhwb3J0IGNsYXNzIEZpbHRlcmVkTGlzdCB7XG4gICAgcHJpdmF0ZSBhbGw7XG4gICAgcHJpdmF0ZSBmaWx0ZXJlZDtcbiAgICBwcml2YXRlIGZpbHRlclRleHQ6IHN0cmluZztcbiAgICBjb25zdHJ1Y3RvcihhbGwsIGZpbHRlclRleHQ/OiBzdHJpbmcsIG11dGF0ZURhdGE/KSB7XG4gICAgICAgIHRoaXMuYWxsID0gYWxsO1xuICAgICAgICB0aGlzLmZpbHRlcmVkID0gYWxsO1xuICAgICAgICB0aGlzLmZpbHRlclRleHQgPSBmaWx0ZXJUZXh0IHx8IFwiXCI7XG4gICAgfVxuICAgIHByaXZhdGUgc2V0RmlsdGVyKHN0cikge1xuICAgICAgICB2YXIgbWF0Y2hlcztcbiAgICAgICAgaWYgKHN0ci5sZW5ndGggPiB0aGlzLmZpbHRlclRleHQgJiYgc3RyLmxhc3RJbmRleE9mKHRoaXMuZmlsdGVyVGV4dCwgMCkgPT09IDApXG4gICAgICAgICAgICBtYXRjaGVzID0gdGhpcy5maWx0ZXJlZDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgbWF0Y2hlcyA9IHRoaXMuYWxsO1xuXG4gICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHN0cjtcbiAgICAgICAgbWF0Y2hlcyA9IHRoaXMuZmlsdGVyQ29tcGxldGlvbnMobWF0Y2hlcywgdGhpcy5maWx0ZXJUZXh0KTtcbiAgICAgICAgbWF0Y2hlcyA9IG1hdGNoZXMuc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gYi5leGFjdE1hdGNoIC0gYS5leGFjdE1hdGNoIHx8IGIuc2NvcmUgLSBhLnNjb3JlO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBtYWtlIHVuaXF1ZVxuICAgICAgICB2YXIgcHJldiA9IG51bGw7XG4gICAgICAgIG1hdGNoZXMgPSBtYXRjaGVzLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICB2YXIgY2FwdGlvbiA9IGl0ZW0udmFsdWUgfHwgaXRlbS5jYXB0aW9uIHx8IGl0ZW0uc25pcHBldDtcbiAgICAgICAgICAgIGlmIChjYXB0aW9uID09PSBwcmV2KSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBwcmV2ID0gY2FwdGlvbjtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmZpbHRlcmVkID0gbWF0Y2hlcztcbiAgICB9XG4gICAgcHJpdmF0ZSBmaWx0ZXJDb21wbGV0aW9ucyhpdGVtczogeyBjYXB0aW9uOyB2YWx1ZTsgc25pcHBldCB9W10sIG5lZWRsZTogc3RyaW5nKSB7XG4gICAgICAgIHZhciByZXN1bHRzID0gW107XG4gICAgICAgIHZhciB1cHBlciA9IG5lZWRsZS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICB2YXIgbG93ZXIgPSBuZWVkbGUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgLy8gVE9ETzogQXNzaWdubWVudCBpbiBjb25kaXRpb25hbCBleHByZXNzaW9uLlxuICAgICAgICAvLyBJdCdzIGN1dGUgYnV0IGFsc28gbWF5IGhhbHQgcHJlbWF0dXJlbHkgYW5kIHNvIGhpZGUgYnVncy5cbiAgICAgICAgLy8gUmVwbGFjZSBieSBsZW5ndGggdmFyaWFibGUgYW5kIHRlc3Q/XG4gICAgICAgIC8vIFVzZSBhc3NlcnRpb24gd2l0aGluIHRoZSBsb29wIHRvIGxvb2sgZm9yIGZhbHNleSB2YWx1ZXMuXG4gICAgICAgIGxvb3A6IGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBpdGVtcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW06IGFueSA9IGl0ZW1zW2ldO1xuICAgICAgICAgICAgdmFyIGNhcHRpb24gPSBpdGVtLnZhbHVlIHx8IGl0ZW0uY2FwdGlvbiB8fCBpdGVtLnNuaXBwZXQ7XG4gICAgICAgICAgICBpZiAoIWNhcHRpb24pIGNvbnRpbnVlO1xuICAgICAgICAgICAgdmFyIGxhc3RJbmRleCA9IC0xO1xuICAgICAgICAgICAgdmFyIG1hdGNoTWFzayA9IDA7XG4gICAgICAgICAgICB2YXIgcGVuYWx0eSA9IDA7XG4gICAgICAgICAgICB2YXIgaW5kZXgsIGRpc3RhbmNlO1xuICAgICAgICAgICAgLy8gY2FwdGlvbiBjaGFyIGl0ZXJhdGlvbiBpcyBmYXN0ZXIgaW4gQ2hyb21lIGJ1dCBzbG93ZXIgaW4gRmlyZWZveCwgc28gbGV0cyB1c2UgaW5kZXhPZlxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBuZWVkbGUubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPIGFkZCBwZW5hbHR5IG9uIGNhc2UgbWlzbWF0Y2hcbiAgICAgICAgICAgICAgICB2YXIgaTEgPSBjYXB0aW9uLmluZGV4T2YobG93ZXJbal0sIGxhc3RJbmRleCArIDEpO1xuICAgICAgICAgICAgICAgIHZhciBpMiA9IGNhcHRpb24uaW5kZXhPZih1cHBlcltqXSwgbGFzdEluZGV4ICsgMSk7XG4gICAgICAgICAgICAgICAgaW5kZXggPSAoaTEgPj0gMCkgPyAoKGkyIDwgMCB8fCBpMSA8IGkyKSA/IGkxIDogaTIpIDogaTI7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgMClcbiAgICAgICAgICAgICAgICAgICAgY29udGludWUgbG9vcDtcbiAgICAgICAgICAgICAgICBkaXN0YW5jZSA9IGluZGV4IC0gbGFzdEluZGV4IC0gMTtcbiAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGZpcnN0IGNoYXIgbWlzbWF0Y2ggc2hvdWxkIGJlIG1vcmUgc2Vuc2l0aXZlXG4gICAgICAgICAgICAgICAgICAgIGlmIChsYXN0SW5kZXggPT09IC0xKVxuICAgICAgICAgICAgICAgICAgICAgICAgcGVuYWx0eSArPSAxMDtcbiAgICAgICAgICAgICAgICAgICAgcGVuYWx0eSArPSBkaXN0YW5jZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbWF0Y2hNYXNrID0gbWF0Y2hNYXNrIHwgKDEgPDwgaW5kZXgpO1xuICAgICAgICAgICAgICAgIGxhc3RJbmRleCA9IGluZGV4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaXRlbS5tYXRjaE1hc2sgPSBtYXRjaE1hc2s7XG4gICAgICAgICAgICBpdGVtLmV4YWN0TWF0Y2ggPSBwZW5hbHR5ID8gMCA6IDE7XG4gICAgICAgICAgICBpdGVtLnNjb3JlID0gKGl0ZW0uc2NvcmUgfHwgMCkgLSBwZW5hbHR5O1xuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cbn1cbiJdfQ==