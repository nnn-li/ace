import { createElement } from "../lib/dom";
import { addListener, preventDefault, removeListener } from "../lib/event";
import { isMac, isOpera } from "../lib/useragent";
var AUTOSCROLL_DELAY = 200;
var SCROLL_CURSOR_DELAY = 200;
var SCROLL_CURSOR_HYSTERESIS = 5;
class DragdropHandler {
    constructor(mouseHandler) {
        var editor = mouseHandler.editor;
        var blankImage = createElement("img");
        blankImage.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";
        if (isOpera)
            blankImage.style.cssText = "width:1px;height:1px;position:fixed;top:0;left:0;z-index:2147483647;opacity:0;";
        var exports = ["dragWait", "dragWaitEnd", "startDrag", "dragReadyEnd", "onMouseDrag"];
        exports.forEach(function (x) {
            mouseHandler[x] = this[x];
        }, this);
        editor.addEventListener("mousedown", this.onMouseDown.bind(mouseHandler));
        var mouseTarget = editor.container;
        var dragSelectionMarker, x, y;
        var timerId, range;
        var dragCursor, counter = 0;
        var dragOperation;
        var isInternal;
        var autoScrollStartTime;
        var cursorMovedTime;
        var cursorPointOnCaretMoved;
        this.onDragStart = function (e) {
            if (this.cancelDrag || !mouseTarget.draggable) {
                var self = this;
                setTimeout(function () {
                    self.startSelect();
                    self.captureMouse(e);
                }, 0);
                return preventDefault(e);
            }
            range = editor.getSelectionRange();
            var dataTransfer = e.dataTransfer;
            dataTransfer.effectAllowed = editor.getReadOnly() ? "copy" : "copyMove";
            if (isOpera) {
                editor.container.appendChild(blankImage);
                blankImage.scrollTop = 0;
            }
            dataTransfer.setDragImage && dataTransfer.setDragImage(blankImage, 0, 0);
            if (isOpera) {
                editor.container.removeChild(blankImage);
            }
            dataTransfer.clearData();
            dataTransfer.setData("Text", editor.session.getTextRange());
            isInternal = true;
            this.setState("drag");
        };
        this.onDragEnd = function (e) {
            mouseTarget.draggable = false;
            isInternal = false;
            this.setState(null);
            if (!editor.getReadOnly()) {
                var dropEffect = e.dataTransfer.dropEffect;
                if (!dragOperation && dropEffect == "move")
                    editor.session.remove(editor.getSelectionRange());
                editor.renderer.$cursorLayer.setBlinking(true);
            }
            this.editor.unsetStyle("ace_dragging");
        };
        this.onDragEnter = function (e) {
            if (editor.getReadOnly() || !canAccept(e.dataTransfer))
                return;
            x = e.clientX;
            y = e.clientY;
            if (!dragSelectionMarker)
                addDragMarker();
            counter++;
            e.dataTransfer.dropEffect = dragOperation = getDropEffect(e);
            return preventDefault(e);
        };
        this.onDragOver = function (e) {
            if (editor.getReadOnly() || !canAccept(e.dataTransfer))
                return;
            x = e.clientX;
            y = e.clientY;
            if (!dragSelectionMarker) {
                addDragMarker();
                counter++;
            }
            if (onMouseMoveTimer !== null)
                onMouseMoveTimer = null;
            e.dataTransfer.dropEffect = dragOperation = getDropEffect(e);
            return preventDefault(e);
        };
        this.onDragLeave = function (e) {
            counter--;
            if (counter <= 0 && dragSelectionMarker) {
                clearDragMarker();
                dragOperation = null;
                return preventDefault(e);
            }
        };
        this.onDrop = function (e) {
            if (!dragCursor)
                return;
            var dataTransfer = e.dataTransfer;
            if (isInternal) {
                switch (dragOperation) {
                    case "move":
                        if (range.contains(dragCursor.row, dragCursor.column)) {
                            range = {
                                start: dragCursor,
                                end: dragCursor
                            };
                        }
                        else {
                            range = editor.moveText(range, dragCursor);
                        }
                        break;
                    case "copy":
                        range = editor.moveText(range, dragCursor, true);
                        break;
                }
            }
            else {
                var dropData = dataTransfer.getData('Text');
                range = {
                    start: dragCursor,
                    end: editor.session.insert(dragCursor, dropData)
                };
                editor.focus();
                dragOperation = null;
            }
            clearDragMarker();
            return preventDefault(e);
        };
        addListener(mouseTarget, "dragstart", this.onDragStart.bind(mouseHandler));
        addListener(mouseTarget, "dragend", this.onDragEnd.bind(mouseHandler));
        addListener(mouseTarget, "dragenter", this.onDragEnter.bind(mouseHandler));
        addListener(mouseTarget, "dragover", this.onDragOver.bind(mouseHandler));
        addListener(mouseTarget, "dragleave", this.onDragLeave.bind(mouseHandler));
        addListener(mouseTarget, "drop", this.onDrop.bind(mouseHandler));
        function scrollCursorIntoView(cursor, prevCursor) {
            var now = Date.now();
            var vMovement = !prevCursor || cursor.row != prevCursor.row;
            var hMovement = !prevCursor || cursor.column != prevCursor.column;
            if (!cursorMovedTime || vMovement || hMovement) {
                editor.$blockScrolling += 1;
                editor.moveCursorToPosition(cursor);
                editor.$blockScrolling -= 1;
                cursorMovedTime = now;
                cursorPointOnCaretMoved = { x: x, y: y };
            }
            else {
                var distance = calcDistance(cursorPointOnCaretMoved.x, cursorPointOnCaretMoved.y, x, y);
                if (distance > SCROLL_CURSOR_HYSTERESIS) {
                    cursorMovedTime = null;
                }
                else if (now - cursorMovedTime >= SCROLL_CURSOR_DELAY) {
                    editor.renderer.scrollCursorIntoView();
                    cursorMovedTime = null;
                }
            }
        }
        function autoScroll(cursor, prevCursor) {
            var now = Date.now();
            var lineHeight = editor.renderer.layerConfig.lineHeight;
            var characterWidth = editor.renderer.layerConfig.characterWidth;
            var editorRect = editor.renderer.scroller.getBoundingClientRect();
            var offsets = {
                x: {
                    left: x - editorRect.left,
                    right: editorRect.right - x
                },
                y: {
                    top: y - editorRect.top,
                    bottom: editorRect.bottom - y
                }
            };
            var nearestXOffset = Math.min(offsets.x.left, offsets.x.right);
            var nearestYOffset = Math.min(offsets.y.top, offsets.y.bottom);
            var scrollCursor = { row: cursor.row, column: cursor.column };
            if (nearestXOffset / characterWidth <= 2) {
                scrollCursor.column += (offsets.x.left < offsets.x.right ? -3 : +2);
            }
            if (nearestYOffset / lineHeight <= 1) {
                scrollCursor.row += (offsets.y.top < offsets.y.bottom ? -1 : +1);
            }
            var vScroll = cursor.row != scrollCursor.row;
            var hScroll = cursor.column != scrollCursor.column;
            var vMovement = !prevCursor || cursor.row != prevCursor.row;
            if (vScroll || (hScroll && !vMovement)) {
                if (!autoScrollStartTime)
                    autoScrollStartTime = now;
                else if (now - autoScrollStartTime >= AUTOSCROLL_DELAY)
                    editor.renderer.scrollCursorIntoView(scrollCursor);
            }
            else {
                autoScrollStartTime = null;
            }
        }
        function onDragInterval() {
            var prevCursor = dragCursor;
            dragCursor = editor.renderer.screenToTextCoordinates(x, y);
            scrollCursorIntoView(dragCursor, prevCursor);
            autoScroll(dragCursor, prevCursor);
        }
        function addDragMarker() {
            range = editor.selection.toOrientedRange();
            dragSelectionMarker = editor.session.addMarker(range, "ace_selection", editor.getSelectionStyle());
            editor.clearSelection();
            if (editor.isFocused())
                editor.renderer.$cursorLayer.setBlinking(false);
            clearInterval(timerId);
            onDragInterval();
            timerId = setInterval(onDragInterval, 20);
            counter = 0;
            addListener(document, "mousemove", onMouseMove);
        }
        function clearDragMarker() {
            clearInterval(timerId);
            editor.session.removeMarker(dragSelectionMarker);
            dragSelectionMarker = null;
            editor.$blockScrolling += 1;
            editor.selection.fromOrientedRange(range);
            editor.$blockScrolling -= 1;
            if (editor.isFocused() && !isInternal)
                editor.renderer.$cursorLayer.setBlinking(!editor.getReadOnly());
            range = null;
            dragCursor = null;
            counter = 0;
            autoScrollStartTime = null;
            cursorMovedTime = null;
            removeListener(document, "mousemove", onMouseMove);
        }
        var onMouseMoveTimer = null;
        function onMouseMove() {
            if (onMouseMoveTimer == null) {
                onMouseMoveTimer = setTimeout(function () {
                    if (onMouseMoveTimer != null && dragSelectionMarker)
                        clearDragMarker();
                }, 20);
            }
        }
        function canAccept(dataTransfer) {
            var types = dataTransfer.types;
            return !types || Array.prototype.some.call(types, function (type) {
                return type == 'text/plain' || type == 'Text';
            });
        }
        function getDropEffect(e) {
            var copyAllowed = ['copy', 'copymove', 'all', 'uninitialized'];
            var moveAllowed = ['move', 'copymove', 'linkmove', 'all', 'uninitialized'];
            var copyModifierState = isMac ? e.altKey : e.ctrlKey;
            var effectAllowed = "uninitialized";
            try {
                effectAllowed = e.dataTransfer.effectAllowed.toLowerCase();
            }
            catch (e) { }
            var dropEffect = "none";
            if (copyModifierState && copyAllowed.indexOf(effectAllowed) >= 0)
                dropEffect = "copy";
            else if (moveAllowed.indexOf(effectAllowed) >= 0)
                dropEffect = "move";
            else if (copyAllowed.indexOf(effectAllowed) >= 0)
                dropEffect = "copy";
            return dropEffect;
        }
    }
    onDragStart(e) { }
    ;
    onDragEnd(e) { }
    ;
    onDragEnter(e) { }
    ;
    onDragLeave(e) { }
    ;
    onDragOver(e) { }
    ;
    onDrop(e) { }
    ;
    dragWait() {
        var interval = Date.now() - this.mousedownEvent.time;
        if (interval > this.editor.getDragDelay())
            this.startDrag();
    }
    dragWaitEnd() {
        var target = this.editor.container;
        target.draggable = false;
        this.startSelect(this.mousedownEvent.getDocumentPosition());
        this.selectEnd();
    }
    dragReadyEnd(e) {
        this.editor.renderer.$cursorLayer.setBlinking(!this.editor.getReadOnly());
        this.editor.unsetStyle("ace_dragging");
        this.dragWaitEnd();
    }
    startDrag() {
        this.cancelDrag = false;
        var target = this.editor.container;
        target.draggable = true;
        this.editor.renderer.$cursorLayer.setBlinking(false);
        this.editor.setStyle("ace_dragging");
        this.setState("dragReady");
    }
    onMouseDrag(e) {
        var target = this.editor.container;
        if (useragent.isIE && this.state == "dragReady") {
            var distance = calcDistance(this.mousedownEvent.x, this.mousedownEvent.y, this.x, this.y);
            if (distance > 3)
                target.dragDrop();
        }
        if (this.state === "dragWait") {
            var distance = calcDistance(this.mousedownEvent.x, this.mousedownEvent.y, this.x, this.y);
            if (distance > 0) {
                target.draggable = false;
                this.startSelect(this.mousedownEvent.getDocumentPosition());
            }
        }
    }
    onMouseDown(e) {
        if (!this.$dragEnabled)
            return;
        this.mousedownEvent = e;
        var editor = this.editor;
        var inSelection = e.inSelection();
        var button = e.getButton();
        var clickCount = e.domEvent.detail || 1;
        if (clickCount === 1 && button === 0 && inSelection) {
            if (e.editor.inMultiSelectMode && (e.getAccelKey() || e.getShiftKey()))
                return;
            this.mousedownEvent.time = Date.now();
            var eventTarget = e.domEvent.target || e.domEvent.srcElement;
            if ("unselectable" in eventTarget)
                eventTarget.unselectable = "on";
            if (editor.getDragDelay()) {
                if (useragent.isWebKit) {
                    this.cancelDrag = true;
                    var mouseTarget = editor.container;
                    mouseTarget.draggable = true;
                }
                this.setState("dragWait");
            }
            else {
                this.startDrag();
            }
            this.captureMouse(e, this.onMouseDrag.bind(this));
            e.defaultPrevented = true;
        }
    }
}
function calcDistance(ax, ay, bx, by) {
    return Math.sqrt(Math.pow(bx - ax, 2) + Math.pow(by - ay, 2));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhZ2Ryb3BfaGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb3VzZS9kcmFnZHJvcF9oYW5kbGVyLnRzIl0sIm5hbWVzIjpbIkRyYWdkcm9wSGFuZGxlciIsIkRyYWdkcm9wSGFuZGxlci5jb25zdHJ1Y3RvciIsIkRyYWdkcm9wSGFuZGxlci5jb25zdHJ1Y3Rvci5zY3JvbGxDdXJzb3JJbnRvVmlldyIsIkRyYWdkcm9wSGFuZGxlci5jb25zdHJ1Y3Rvci5hdXRvU2Nyb2xsIiwiRHJhZ2Ryb3BIYW5kbGVyLmNvbnN0cnVjdG9yLm9uRHJhZ0ludGVydmFsIiwiRHJhZ2Ryb3BIYW5kbGVyLmNvbnN0cnVjdG9yLmFkZERyYWdNYXJrZXIiLCJEcmFnZHJvcEhhbmRsZXIuY29uc3RydWN0b3IuY2xlYXJEcmFnTWFya2VyIiwiRHJhZ2Ryb3BIYW5kbGVyLmNvbnN0cnVjdG9yLm9uTW91c2VNb3ZlIiwiRHJhZ2Ryb3BIYW5kbGVyLmNvbnN0cnVjdG9yLmNhbkFjY2VwdCIsIkRyYWdkcm9wSGFuZGxlci5jb25zdHJ1Y3Rvci5nZXREcm9wRWZmZWN0IiwiRHJhZ2Ryb3BIYW5kbGVyLm9uRHJhZ1N0YXJ0IiwiRHJhZ2Ryb3BIYW5kbGVyLm9uRHJhZ0VuZCIsIkRyYWdkcm9wSGFuZGxlci5vbkRyYWdFbnRlciIsIkRyYWdkcm9wSGFuZGxlci5vbkRyYWdMZWF2ZSIsIkRyYWdkcm9wSGFuZGxlci5vbkRyYWdPdmVyIiwiRHJhZ2Ryb3BIYW5kbGVyLm9uRHJvcCIsIkRyYWdkcm9wSGFuZGxlci5kcmFnV2FpdCIsIkRyYWdkcm9wSGFuZGxlci5kcmFnV2FpdEVuZCIsIkRyYWdkcm9wSGFuZGxlci5kcmFnUmVhZHlFbmQiLCJEcmFnZHJvcEhhbmRsZXIuc3RhcnREcmFnIiwiRHJhZ2Ryb3BIYW5kbGVyLm9uTW91c2VEcmFnIiwiRHJhZ2Ryb3BIYW5kbGVyLm9uTW91c2VEb3duIiwiY2FsY0Rpc3RhbmNlIl0sIm1hcHBpbmdzIjoiT0E4Qk8s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QSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtZQUMvREEsSUFBSUEsY0FBY0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDL0RBLElBQUlBLFlBQVlBLEdBQUdBLEVBQUVBLEdBQUdBLEVBQUVBLE1BQU1BLENBQUNBLEdBQUdBLEVBQUVBLE1BQU1BLEVBQUVBLE1BQU1BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO1lBQzlEQSxFQUFFQSxDQUFDQSxDQUFDQSxjQUFjQSxHQUFHQSxjQUFjQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDdkNBLFlBQVlBLENBQUNBLE1BQU1BLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3hFQSxDQUFDQTtZQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxjQUFjQSxHQUFHQSxVQUFVQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDbkNBLFlBQVlBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3JFQSxDQUFDQTtZQUNEQSxJQUFJQSxPQUFPQSxHQUFHQSxNQUFNQSxDQUFDQSxHQUFHQSxJQUFJQSxZQUFZQSxDQUFDQSxHQUFHQSxDQUFDQTtZQUM3Q0EsSUFBSUEsT0FBT0EsR0FBR0EsTUFBTUEsQ0FBQ0EsTUFBTUEsSUFBSUEsWUFBWUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7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UUFDOUJBLENBQUNBO0lBQ0xBLENBQUNBO0FBQ0xyQixDQUFDQTtBQUVELHNCQUFzQixFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFO0lBQ2hDc0IsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7QUFDbEVBLENBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMCwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXRcbiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuICogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlXG4gKiAgICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICogICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBBamF4Lm9yZyBCLlYuIG5vciB0aGVcbiAqICAgICAgIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzXG4gKiAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cbiAqXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkRcbiAqIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEXG4gKiBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFXG4gKiBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBBSkFYLk9SRyBCLlYuIEJFIExJQUJMRSBGT1IgQU5ZXG4gKiBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFU1xuICogKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTO1xuICogTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EXG4gKiBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVNcbiAqIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICpcbiAqICoqKioqIEVORCBMSUNFTlNFIEJMT0NLICoqKioqICovXG5cbmltcG9ydCB7IGNyZWF0ZUVsZW1lbnQgfSBmcm9tIFwiLi4vbGliL2RvbVwiO1xuaW1wb3J0IHsgYWRkTGlzdGVuZXIsIHByZXZlbnREZWZhdWx0LCByZW1vdmVMaXN0ZW5lciB9IGZyb20gXCIuLi9saWIvZXZlbnRcIjtcbmltcG9ydCB7IGlzTWFjLCBpc09wZXJhIH0gZnJvbSBcIi4uL2xpYi91c2VyYWdlbnRcIjtcblxudmFyIEFVVE9TQ1JPTExfREVMQVkgPSAyMDA7XG52YXIgU0NST0xMX0NVUlNPUl9ERUxBWSA9IDIwMDtcbnZhciBTQ1JPTExfQ1VSU09SX0hZU1RFUkVTSVMgPSA1O1xuXG4vLyBGSVhNRTogSSB0aGluayB0aGUgaXNzdWUgbWF5IGJlIHRoYXQgdGhpcyBpcyBhIG1peGluP1xuXG5jbGFzcyBEcmFnZHJvcEhhbmRsZXIge1xuICAgIC8vIFRoaXMgaXMga2V5OiBUaGUgZXZlbnQgaXMgbm90IGFuIG9yZGluYXJ5IG1vdXNlIGV2ZW50LlxuICAgIG1vdXNlZG93bkV2ZW50OiBFZGl0b3JNb3VzZUV2ZW50O1xuICAgIGVkaXRvcjtcbiAgICAkZHJhZ0VuYWJsZWQ7XG4gICAgY2FuY2VsRHJhZztcbiAgICBzdGF0ZTtcblxuICAgIG9uRHJhZ1N0YXJ0KGU6IERyYWdFdmVudCkgeyB9O1xuICAgIG9uRHJhZ0VuZChlOiBEcmFnRXZlbnQpIHsgfTtcbiAgICBvbkRyYWdFbnRlcihlOiBEcmFnRXZlbnQpIHsgfTtcbiAgICBvbkRyYWdMZWF2ZShlOiBEcmFnRXZlbnQpIHsgfTtcbiAgICBvbkRyYWdPdmVyKGU6IERyYWdFdmVudCkgeyB9O1xuICAgIG9uRHJvcChlOiBEcmFnRXZlbnQpIHsgfTtcbiAgICAvKipcbiAgICAgKiBXZSBjb25zdHJ1Y3Qgb24gYSBjbGFzcyBkZWZpbmVkIGluIHRoZSBFZGl0b3IhXG4gICAgICogRG9lcyB0aGlzIGNsYXNzIGhhdmUgdG8gZ28gaW4gdGhlIHNhbWUgbW9kdWxlIGFzIHRoZSBFZGl0b3I/XG4gICAgICovXG4gICAgY29uc3RydWN0b3IobW91c2VIYW5kbGVyOiBNb3VzZUhhbmRsZXIpIHtcblxuICAgICAgICB2YXIgZWRpdG9yID0gbW91c2VIYW5kbGVyLmVkaXRvcjtcblxuICAgICAgICB2YXIgYmxhbmtJbWFnZSA9IDxIVE1MSW1hZ2VFbGVtZW50PmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XG4gICAgICAgIC8vIFNhZmFyaSBjcmFzaGVzIHdpdGhvdXQgaW1hZ2UgZGF0YVxuICAgICAgICBibGFua0ltYWdlLnNyYyA9IFwiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFBQUFBQ0g1QkFFS0FBRUFMQUFBQUFBQkFBRUFBQUlDVEFFQU93PT1cIjtcbiAgICAgICAgaWYgKGlzT3BlcmEpXG4gICAgICAgICAgICBibGFua0ltYWdlLnN0eWxlLmNzc1RleHQgPSBcIndpZHRoOjFweDtoZWlnaHQ6MXB4O3Bvc2l0aW9uOmZpeGVkO3RvcDowO2xlZnQ6MDt6LWluZGV4OjIxNDc0ODM2NDc7b3BhY2l0eTowO1wiO1xuXG4gICAgICAgIHZhciBleHBvcnRzID0gW1wiZHJhZ1dhaXRcIiwgXCJkcmFnV2FpdEVuZFwiLCBcInN0YXJ0RHJhZ1wiLCBcImRyYWdSZWFkeUVuZFwiLCBcIm9uTW91c2VEcmFnXCJdO1xuXG4gICAgICAgIGV4cG9ydHMuZm9yRWFjaChmdW5jdGlvbih4KSB7XG4gICAgICAgICAgICBtb3VzZUhhbmRsZXJbeF0gPSB0aGlzW3hdO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5vbk1vdXNlRG93bi5iaW5kKG1vdXNlSGFuZGxlcikpO1xuXG5cbiAgICAgICAgdmFyIG1vdXNlVGFyZ2V0ID0gZWRpdG9yLmNvbnRhaW5lcjtcbiAgICAgICAgdmFyIGRyYWdTZWxlY3Rpb25NYXJrZXIsIHgsIHk7XG4gICAgICAgIHZhciB0aW1lcklkLCByYW5nZTtcbiAgICAgICAgdmFyIGRyYWdDdXJzb3IsIGNvdW50ZXIgPSAwO1xuICAgICAgICB2YXIgZHJhZ09wZXJhdGlvbjtcbiAgICAgICAgdmFyIGlzSW50ZXJuYWw7XG4gICAgICAgIHZhciBhdXRvU2Nyb2xsU3RhcnRUaW1lO1xuICAgICAgICB2YXIgY3Vyc29yTW92ZWRUaW1lO1xuICAgICAgICB2YXIgY3Vyc29yUG9pbnRPbkNhcmV0TW92ZWQ7XG5cbiAgICAgICAgdGhpcy5vbkRyYWdTdGFydCA9IGZ1bmN0aW9uKGU6IERyYWdFdmVudCkge1xuICAgICAgICAgICAgLy8gd2Via2l0IHdvcmthcm91bmQsIHNlZSB0aGlzLm9uTW91c2VEb3duXG4gICAgICAgICAgICBpZiAodGhpcy5jYW5jZWxEcmFnIHx8ICFtb3VzZVRhcmdldC5kcmFnZ2FibGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zdGFydFNlbGVjdCgpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmNhcHR1cmVNb3VzZShlKTtcbiAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJldmVudERlZmF1bHQoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByYW5nZSA9IGVkaXRvci5nZXRTZWxlY3Rpb25SYW5nZSgpO1xuXG4gICAgICAgICAgICB2YXIgZGF0YVRyYW5zZmVyID0gZS5kYXRhVHJhbnNmZXI7XG4gICAgICAgICAgICBkYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9IGVkaXRvci5nZXRSZWFkT25seSgpID8gXCJjb3B5XCIgOiBcImNvcHlNb3ZlXCI7XG4gICAgICAgICAgICBpZiAoaXNPcGVyYSkge1xuICAgICAgICAgICAgICAgIGVkaXRvci5jb250YWluZXIuYXBwZW5kQ2hpbGQoYmxhbmtJbWFnZSk7XG4gICAgICAgICAgICAgICAgLy8gZm9yY2UgbGF5b3V0XG4gICAgICAgICAgICAgICAgYmxhbmtJbWFnZS5zY3JvbGxUb3AgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGF0YVRyYW5zZmVyLnNldERyYWdJbWFnZSAmJiBkYXRhVHJhbnNmZXIuc2V0RHJhZ0ltYWdlKGJsYW5rSW1hZ2UsIDAsIDApO1xuICAgICAgICAgICAgaWYgKGlzT3BlcmEpIHtcbiAgICAgICAgICAgICAgICBlZGl0b3IuY29udGFpbmVyLnJlbW92ZUNoaWxkKGJsYW5rSW1hZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gY2xlYXIgT3BlcmEgZ2FyYmFnZVxuICAgICAgICAgICAgZGF0YVRyYW5zZmVyLmNsZWFyRGF0YSgpO1xuICAgICAgICAgICAgZGF0YVRyYW5zZmVyLnNldERhdGEoXCJUZXh0XCIsIGVkaXRvci5zZXNzaW9uLmdldFRleHRSYW5nZSgpKTtcblxuICAgICAgICAgICAgaXNJbnRlcm5hbCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKFwiZHJhZ1wiKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLm9uRHJhZ0VuZCA9IGZ1bmN0aW9uKGU6IERyYWdFdmVudCkge1xuICAgICAgICAgICAgbW91c2VUYXJnZXQuZHJhZ2dhYmxlID0gZmFsc2U7XG4gICAgICAgICAgICBpc0ludGVybmFsID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKG51bGwpO1xuICAgICAgICAgICAgaWYgKCFlZGl0b3IuZ2V0UmVhZE9ubHkoKSkge1xuICAgICAgICAgICAgICAgIHZhciBkcm9wRWZmZWN0ID0gZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdDtcbiAgICAgICAgICAgICAgICBpZiAoIWRyYWdPcGVyYXRpb24gJiYgZHJvcEVmZmVjdCA9PSBcIm1vdmVcIilcbiAgICAgICAgICAgICAgICAgICAgLy8gdGV4dCB3YXMgZHJhZ2dlZCBvdXRzaWRlIHRoZSBlZGl0b3JcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNlc3Npb24ucmVtb3ZlKGVkaXRvci5nZXRTZWxlY3Rpb25SYW5nZSgpKTtcbiAgICAgICAgICAgICAgICBlZGl0b3IucmVuZGVyZXIuJGN1cnNvckxheWVyLnNldEJsaW5raW5nKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5lZGl0b3IudW5zZXRTdHlsZShcImFjZV9kcmFnZ2luZ1wiKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLm9uRHJhZ0VudGVyID0gZnVuY3Rpb24oZTogRHJhZ0V2ZW50KSB7XG4gICAgICAgICAgICBpZiAoZWRpdG9yLmdldFJlYWRPbmx5KCkgfHwgIWNhbkFjY2VwdChlLmRhdGFUcmFuc2ZlcikpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgeCA9IGUuY2xpZW50WDtcbiAgICAgICAgICAgIHkgPSBlLmNsaWVudFk7XG4gICAgICAgICAgICBpZiAoIWRyYWdTZWxlY3Rpb25NYXJrZXIpXG4gICAgICAgICAgICAgICAgYWRkRHJhZ01hcmtlcigpO1xuICAgICAgICAgICAgY291bnRlcisrO1xuICAgICAgICAgICAgLy8gZGF0YVRyYW5zZmVyIG9iamVjdCBkb2VzIG5vdCBzYXZlIGRyb3BFZmZlY3QgYWNyb3NzIGV2ZW50cyBvbiBJRSwgc28gd2Ugc3RvcmUgaXQgaW4gZHJhZ09wZXJhdGlvblxuICAgICAgICAgICAgZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9IGRyYWdPcGVyYXRpb24gPSBnZXREcm9wRWZmZWN0KGUpO1xuICAgICAgICAgICAgcmV0dXJuIHByZXZlbnREZWZhdWx0KGUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMub25EcmFnT3ZlciA9IGZ1bmN0aW9uKGU6IERyYWdFdmVudCkge1xuICAgICAgICAgICAgaWYgKGVkaXRvci5nZXRSZWFkT25seSgpIHx8ICFjYW5BY2NlcHQoZS5kYXRhVHJhbnNmZXIpKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHggPSBlLmNsaWVudFg7XG4gICAgICAgICAgICB5ID0gZS5jbGllbnRZO1xuICAgICAgICAgICAgLy8gT3BlcmEgZG9lc24ndCB0cmlnZ2VyIGRyYWdlbnRlciBldmVudCBvbiBkcmFnIHN0YXJ0XG4gICAgICAgICAgICBpZiAoIWRyYWdTZWxlY3Rpb25NYXJrZXIpIHtcbiAgICAgICAgICAgICAgICBhZGREcmFnTWFya2VyKCk7XG4gICAgICAgICAgICAgICAgY291bnRlcisrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9uTW91c2VNb3ZlVGltZXIgIT09IG51bGwpXG4gICAgICAgICAgICAgICAgb25Nb3VzZU1vdmVUaW1lciA9IG51bGw7XG5cbiAgICAgICAgICAgIGUuZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3QgPSBkcmFnT3BlcmF0aW9uID0gZ2V0RHJvcEVmZmVjdChlKTtcbiAgICAgICAgICAgIHJldHVybiBwcmV2ZW50RGVmYXVsdChlKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLm9uRHJhZ0xlYXZlID0gZnVuY3Rpb24oZTogRHJhZ0V2ZW50KSB7XG4gICAgICAgICAgICBjb3VudGVyLS07XG4gICAgICAgICAgICBpZiAoY291bnRlciA8PSAwICYmIGRyYWdTZWxlY3Rpb25NYXJrZXIpIHtcbiAgICAgICAgICAgICAgICBjbGVhckRyYWdNYXJrZXIoKTtcbiAgICAgICAgICAgICAgICBkcmFnT3BlcmF0aW9uID0gbnVsbDtcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJldmVudERlZmF1bHQoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5vbkRyb3AgPSBmdW5jdGlvbihlOiBEcmFnRXZlbnQpIHtcbiAgICAgICAgICAgIGlmICghZHJhZ0N1cnNvcilcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB2YXIgZGF0YVRyYW5zZmVyID0gZS5kYXRhVHJhbnNmZXI7XG4gICAgICAgICAgICBpZiAoaXNJbnRlcm5hbCkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoZHJhZ09wZXJhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwibW92ZVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJhbmdlLmNvbnRhaW5zKGRyYWdDdXJzb3Iucm93LCBkcmFnQ3Vyc29yLmNvbHVtbikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjbGVhciBzZWxlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGRyYWdDdXJzb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogZHJhZ0N1cnNvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1vdmUgdGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlID0gZWRpdG9yLm1vdmVUZXh0KHJhbmdlLCBkcmFnQ3Vyc29yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiY29weVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29weSB0ZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICByYW5nZSA9IGVkaXRvci5tb3ZlVGV4dChyYW5nZSwgZHJhZ0N1cnNvciwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBkcm9wRGF0YSA9IGRhdGFUcmFuc2Zlci5nZXREYXRhKCdUZXh0Jyk7XG4gICAgICAgICAgICAgICAgcmFuZ2UgPSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBkcmFnQ3Vyc29yLFxuICAgICAgICAgICAgICAgICAgICBlbmQ6IGVkaXRvci5zZXNzaW9uLmluc2VydChkcmFnQ3Vyc29yLCBkcm9wRGF0YSlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGVkaXRvci5mb2N1cygpO1xuICAgICAgICAgICAgICAgIGRyYWdPcGVyYXRpb24gPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYXJEcmFnTWFya2VyKCk7XG4gICAgICAgICAgICByZXR1cm4gcHJldmVudERlZmF1bHQoZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgYWRkTGlzdGVuZXIobW91c2VUYXJnZXQsIFwiZHJhZ3N0YXJ0XCIsIHRoaXMub25EcmFnU3RhcnQuYmluZChtb3VzZUhhbmRsZXIpKTtcbiAgICAgICAgYWRkTGlzdGVuZXIobW91c2VUYXJnZXQsIFwiZHJhZ2VuZFwiLCB0aGlzLm9uRHJhZ0VuZC5iaW5kKG1vdXNlSGFuZGxlcikpO1xuICAgICAgICBhZGRMaXN0ZW5lcihtb3VzZVRhcmdldCwgXCJkcmFnZW50ZXJcIiwgdGhpcy5vbkRyYWdFbnRlci5iaW5kKG1vdXNlSGFuZGxlcikpO1xuICAgICAgICBhZGRMaXN0ZW5lcihtb3VzZVRhcmdldCwgXCJkcmFnb3ZlclwiLCB0aGlzLm9uRHJhZ092ZXIuYmluZChtb3VzZUhhbmRsZXIpKTtcbiAgICAgICAgYWRkTGlzdGVuZXIobW91c2VUYXJnZXQsIFwiZHJhZ2xlYXZlXCIsIHRoaXMub25EcmFnTGVhdmUuYmluZChtb3VzZUhhbmRsZXIpKTtcbiAgICAgICAgYWRkTGlzdGVuZXIobW91c2VUYXJnZXQsIFwiZHJvcFwiLCB0aGlzLm9uRHJvcC5iaW5kKG1vdXNlSGFuZGxlcikpO1xuXG4gICAgICAgIGZ1bmN0aW9uIHNjcm9sbEN1cnNvckludG9WaWV3KGN1cnNvciwgcHJldkN1cnNvcikge1xuICAgICAgICAgICAgdmFyIG5vdyA9IERhdGUubm93KCk7XG4gICAgICAgICAgICB2YXIgdk1vdmVtZW50ID0gIXByZXZDdXJzb3IgfHwgY3Vyc29yLnJvdyAhPSBwcmV2Q3Vyc29yLnJvdztcbiAgICAgICAgICAgIHZhciBoTW92ZW1lbnQgPSAhcHJldkN1cnNvciB8fCBjdXJzb3IuY29sdW1uICE9IHByZXZDdXJzb3IuY29sdW1uO1xuICAgICAgICAgICAgaWYgKCFjdXJzb3JNb3ZlZFRpbWUgfHwgdk1vdmVtZW50IHx8IGhNb3ZlbWVudCkge1xuICAgICAgICAgICAgICAgIGVkaXRvci4kYmxvY2tTY3JvbGxpbmcgKz0gMTtcbiAgICAgICAgICAgICAgICBlZGl0b3IubW92ZUN1cnNvclRvUG9zaXRpb24oY3Vyc29yKTtcbiAgICAgICAgICAgICAgICBlZGl0b3IuJGJsb2NrU2Nyb2xsaW5nIC09IDE7XG4gICAgICAgICAgICAgICAgY3Vyc29yTW92ZWRUaW1lID0gbm93O1xuICAgICAgICAgICAgICAgIGN1cnNvclBvaW50T25DYXJldE1vdmVkID0geyB4OiB4LCB5OiB5IH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBkaXN0YW5jZSA9IGNhbGNEaXN0YW5jZShjdXJzb3JQb2ludE9uQ2FyZXRNb3ZlZC54LCBjdXJzb3JQb2ludE9uQ2FyZXRNb3ZlZC55LCB4LCB5KTtcbiAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPiBTQ1JPTExfQ1VSU09SX0hZU1RFUkVTSVMpIHtcbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yTW92ZWRUaW1lID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5vdyAtIGN1cnNvck1vdmVkVGltZSA+PSBTQ1JPTExfQ1VSU09SX0RFTEFZKSB7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5yZW5kZXJlci5zY3JvbGxDdXJzb3JJbnRvVmlldygpO1xuICAgICAgICAgICAgICAgICAgICBjdXJzb3JNb3ZlZFRpbWUgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGF1dG9TY3JvbGwoY3Vyc29yLCBwcmV2Q3Vyc29yKSB7XG4gICAgICAgICAgICB2YXIgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIHZhciBsaW5lSGVpZ2h0ID0gZWRpdG9yLnJlbmRlcmVyLmxheWVyQ29uZmlnLmxpbmVIZWlnaHQ7XG4gICAgICAgICAgICB2YXIgY2hhcmFjdGVyV2lkdGggPSBlZGl0b3IucmVuZGVyZXIubGF5ZXJDb25maWcuY2hhcmFjdGVyV2lkdGg7XG4gICAgICAgICAgICB2YXIgZWRpdG9yUmVjdCA9IGVkaXRvci5yZW5kZXJlci5zY3JvbGxlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgIHZhciBvZmZzZXRzID0ge1xuICAgICAgICAgICAgICAgIHg6IHtcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogeCAtIGVkaXRvclJlY3QubGVmdCxcbiAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IGVkaXRvclJlY3QucmlnaHQgLSB4XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB5OiB7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogeSAtIGVkaXRvclJlY3QudG9wLFxuICAgICAgICAgICAgICAgICAgICBib3R0b206IGVkaXRvclJlY3QuYm90dG9tIC0geVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgbmVhcmVzdFhPZmZzZXQgPSBNYXRoLm1pbihvZmZzZXRzLngubGVmdCwgb2Zmc2V0cy54LnJpZ2h0KTtcbiAgICAgICAgICAgIHZhciBuZWFyZXN0WU9mZnNldCA9IE1hdGgubWluKG9mZnNldHMueS50b3AsIG9mZnNldHMueS5ib3R0b20pO1xuICAgICAgICAgICAgdmFyIHNjcm9sbEN1cnNvciA9IHsgcm93OiBjdXJzb3Iucm93LCBjb2x1bW46IGN1cnNvci5jb2x1bW4gfTtcbiAgICAgICAgICAgIGlmIChuZWFyZXN0WE9mZnNldCAvIGNoYXJhY3RlcldpZHRoIDw9IDIpIHtcbiAgICAgICAgICAgICAgICBzY3JvbGxDdXJzb3IuY29sdW1uICs9IChvZmZzZXRzLngubGVmdCA8IG9mZnNldHMueC5yaWdodCA/IC0zIDogKzIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG5lYXJlc3RZT2Zmc2V0IC8gbGluZUhlaWdodCA8PSAxKSB7XG4gICAgICAgICAgICAgICAgc2Nyb2xsQ3Vyc29yLnJvdyArPSAob2Zmc2V0cy55LnRvcCA8IG9mZnNldHMueS5ib3R0b20gPyAtMSA6ICsxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciB2U2Nyb2xsID0gY3Vyc29yLnJvdyAhPSBzY3JvbGxDdXJzb3Iucm93O1xuICAgICAgICAgICAgdmFyIGhTY3JvbGwgPSBjdXJzb3IuY29sdW1uICE9IHNjcm9sbEN1cnNvci5jb2x1bW47XG4gICAgICAgICAgICB2YXIgdk1vdmVtZW50ID0gIXByZXZDdXJzb3IgfHwgY3Vyc29yLnJvdyAhPSBwcmV2Q3Vyc29yLnJvdztcbiAgICAgICAgICAgIGlmICh2U2Nyb2xsIHx8IChoU2Nyb2xsICYmICF2TW92ZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFhdXRvU2Nyb2xsU3RhcnRUaW1lKVxuICAgICAgICAgICAgICAgICAgICBhdXRvU2Nyb2xsU3RhcnRUaW1lID0gbm93O1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKG5vdyAtIGF1dG9TY3JvbGxTdGFydFRpbWUgPj0gQVVUT1NDUk9MTF9ERUxBWSlcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnJlbmRlcmVyLnNjcm9sbEN1cnNvckludG9WaWV3KHNjcm9sbEN1cnNvcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGF1dG9TY3JvbGxTdGFydFRpbWUgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb25EcmFnSW50ZXJ2YWwoKSB7XG4gICAgICAgICAgICB2YXIgcHJldkN1cnNvciA9IGRyYWdDdXJzb3I7XG4gICAgICAgICAgICBkcmFnQ3Vyc29yID0gZWRpdG9yLnJlbmRlcmVyLnNjcmVlblRvVGV4dENvb3JkaW5hdGVzKHgsIHkpO1xuICAgICAgICAgICAgc2Nyb2xsQ3Vyc29ySW50b1ZpZXcoZHJhZ0N1cnNvciwgcHJldkN1cnNvcik7XG4gICAgICAgICAgICBhdXRvU2Nyb2xsKGRyYWdDdXJzb3IsIHByZXZDdXJzb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYWRkRHJhZ01hcmtlcigpIHtcbiAgICAgICAgICAgIHJhbmdlID0gZWRpdG9yLnNlbGVjdGlvbi50b09yaWVudGVkUmFuZ2UoKTtcbiAgICAgICAgICAgIGRyYWdTZWxlY3Rpb25NYXJrZXIgPSBlZGl0b3Iuc2Vzc2lvbi5hZGRNYXJrZXIocmFuZ2UsIFwiYWNlX3NlbGVjdGlvblwiLCBlZGl0b3IuZ2V0U2VsZWN0aW9uU3R5bGUoKSk7XG4gICAgICAgICAgICBlZGl0b3IuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgIGlmIChlZGl0b3IuaXNGb2N1c2VkKCkpXG4gICAgICAgICAgICAgICAgZWRpdG9yLnJlbmRlcmVyLiRjdXJzb3JMYXllci5zZXRCbGlua2luZyhmYWxzZSk7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRpbWVySWQpO1xuICAgICAgICAgICAgb25EcmFnSW50ZXJ2YWwoKTtcbiAgICAgICAgICAgIHRpbWVySWQgPSBzZXRJbnRlcnZhbChvbkRyYWdJbnRlcnZhbCwgMjApO1xuICAgICAgICAgICAgY291bnRlciA9IDA7XG4gICAgICAgICAgICBhZGRMaXN0ZW5lcihkb2N1bWVudCwgXCJtb3VzZW1vdmVcIiwgb25Nb3VzZU1vdmUpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY2xlYXJEcmFnTWFya2VyKCkge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lcklkKTtcbiAgICAgICAgICAgIGVkaXRvci5zZXNzaW9uLnJlbW92ZU1hcmtlcihkcmFnU2VsZWN0aW9uTWFya2VyKTtcbiAgICAgICAgICAgIGRyYWdTZWxlY3Rpb25NYXJrZXIgPSBudWxsO1xuICAgICAgICAgICAgZWRpdG9yLiRibG9ja1Njcm9sbGluZyArPSAxO1xuICAgICAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5mcm9tT3JpZW50ZWRSYW5nZShyYW5nZSk7XG4gICAgICAgICAgICBlZGl0b3IuJGJsb2NrU2Nyb2xsaW5nIC09IDE7XG4gICAgICAgICAgICBpZiAoZWRpdG9yLmlzRm9jdXNlZCgpICYmICFpc0ludGVybmFsKVxuICAgICAgICAgICAgICAgIGVkaXRvci5yZW5kZXJlci4kY3Vyc29yTGF5ZXIuc2V0QmxpbmtpbmcoIWVkaXRvci5nZXRSZWFkT25seSgpKTtcbiAgICAgICAgICAgIHJhbmdlID0gbnVsbDtcbiAgICAgICAgICAgIGRyYWdDdXJzb3IgPSBudWxsO1xuICAgICAgICAgICAgY291bnRlciA9IDA7XG4gICAgICAgICAgICBhdXRvU2Nyb2xsU3RhcnRUaW1lID0gbnVsbDtcbiAgICAgICAgICAgIGN1cnNvck1vdmVkVGltZSA9IG51bGw7XG4gICAgICAgICAgICByZW1vdmVMaXN0ZW5lcihkb2N1bWVudCwgXCJtb3VzZW1vdmVcIiwgb25Nb3VzZU1vdmUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc29tZXRpbWVzIG90aGVyIGNvZGUgb24gdGhlIHBhZ2UgY2FuIHN0b3AgZHJhZ2xlYXZlIGV2ZW50IGxlYXZpbmcgZWRpdG9yIHN0dWNrIGluIHRoZSBkcmFnIHN0YXRlXG4gICAgICAgIHZhciBvbk1vdXNlTW92ZVRpbWVyID0gbnVsbDtcbiAgICAgICAgZnVuY3Rpb24gb25Nb3VzZU1vdmUoKSB7XG4gICAgICAgICAgICBpZiAob25Nb3VzZU1vdmVUaW1lciA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgb25Nb3VzZU1vdmVUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvbk1vdXNlTW92ZVRpbWVyICE9IG51bGwgJiYgZHJhZ1NlbGVjdGlvbk1hcmtlcilcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyRHJhZ01hcmtlcigpO1xuICAgICAgICAgICAgICAgIH0sIDIwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNhbkFjY2VwdChkYXRhVHJhbnNmZXI6IERhdGFUcmFuc2Zlcikge1xuICAgICAgICAgICAgdmFyIHR5cGVzID0gZGF0YVRyYW5zZmVyLnR5cGVzO1xuICAgICAgICAgICAgcmV0dXJuICF0eXBlcyB8fCBBcnJheS5wcm90b3R5cGUuc29tZS5jYWxsKHR5cGVzLCBmdW5jdGlvbih0eXBlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHR5cGUgPT0gJ3RleHQvcGxhaW4nIHx8IHR5cGUgPT0gJ1RleHQnO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXREcm9wRWZmZWN0KGU6IERyYWdFdmVudCk6IHN0cmluZyB7XG4gICAgICAgICAgICB2YXIgY29weUFsbG93ZWQgPSBbJ2NvcHknLCAnY29weW1vdmUnLCAnYWxsJywgJ3VuaW5pdGlhbGl6ZWQnXTtcbiAgICAgICAgICAgIHZhciBtb3ZlQWxsb3dlZCA9IFsnbW92ZScsICdjb3B5bW92ZScsICdsaW5rbW92ZScsICdhbGwnLCAndW5pbml0aWFsaXplZCddO1xuXG4gICAgICAgICAgICB2YXIgY29weU1vZGlmaWVyU3RhdGUgPSBpc01hYyA/IGUuYWx0S2V5IDogZS5jdHJsS2V5O1xuXG4gICAgICAgICAgICAvLyBJRSB0aHJvd3MgZXJyb3Igd2hpbGUgZHJhZ2dpbmcgZnJvbSBhbm90aGVyIGFwcFxuICAgICAgICAgICAgdmFyIGVmZmVjdEFsbG93ZWQgPSBcInVuaW5pdGlhbGl6ZWRcIjtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZWZmZWN0QWxsb3dlZCA9IGUuZGF0YVRyYW5zZmVyLmVmZmVjdEFsbG93ZWQudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgfVxuICAgICAgICAgICAgdmFyIGRyb3BFZmZlY3QgPSBcIm5vbmVcIjtcblxuICAgICAgICAgICAgaWYgKGNvcHlNb2RpZmllclN0YXRlICYmIGNvcHlBbGxvd2VkLmluZGV4T2YoZWZmZWN0QWxsb3dlZCkgPj0gMClcbiAgICAgICAgICAgICAgICBkcm9wRWZmZWN0ID0gXCJjb3B5XCI7XG4gICAgICAgICAgICBlbHNlIGlmIChtb3ZlQWxsb3dlZC5pbmRleE9mKGVmZmVjdEFsbG93ZWQpID49IDApXG4gICAgICAgICAgICAgICAgZHJvcEVmZmVjdCA9IFwibW92ZVwiO1xuICAgICAgICAgICAgZWxzZSBpZiAoY29weUFsbG93ZWQuaW5kZXhPZihlZmZlY3RBbGxvd2VkKSA+PSAwKVxuICAgICAgICAgICAgICAgIGRyb3BFZmZlY3QgPSBcImNvcHlcIjtcblxuICAgICAgICAgICAgcmV0dXJuIGRyb3BFZmZlY3Q7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkcmFnV2FpdCgpIHtcbiAgICAgICAgdmFyIGludGVydmFsID0gRGF0ZS5ub3coKSAtIHRoaXMubW91c2Vkb3duRXZlbnQudGltZTtcbiAgICAgICAgaWYgKGludGVydmFsID4gdGhpcy5lZGl0b3IuZ2V0RHJhZ0RlbGF5KCkpXG4gICAgICAgICAgICB0aGlzLnN0YXJ0RHJhZygpO1xuICAgIH1cblxuICAgIGRyYWdXYWl0RW5kKCkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5lZGl0b3IuY29udGFpbmVyO1xuICAgICAgICB0YXJnZXQuZHJhZ2dhYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RhcnRTZWxlY3QodGhpcy5tb3VzZWRvd25FdmVudC5nZXREb2N1bWVudFBvc2l0aW9uKCkpO1xuICAgICAgICB0aGlzLnNlbGVjdEVuZCgpO1xuICAgIH1cblxuICAgIGRyYWdSZWFkeUVuZChlKSB7XG4gICAgICAgIHRoaXMuZWRpdG9yLnJlbmRlcmVyLiRjdXJzb3JMYXllci5zZXRCbGlua2luZyghdGhpcy5lZGl0b3IuZ2V0UmVhZE9ubHkoKSk7XG4gICAgICAgIHRoaXMuZWRpdG9yLnVuc2V0U3R5bGUoXCJhY2VfZHJhZ2dpbmdcIik7XG4gICAgICAgIHRoaXMuZHJhZ1dhaXRFbmQoKTtcbiAgICB9XG5cbiAgICBzdGFydERyYWcoKSB7XG4gICAgICAgIHRoaXMuY2FuY2VsRHJhZyA9IGZhbHNlO1xuICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5lZGl0b3IuY29udGFpbmVyO1xuICAgICAgICB0YXJnZXQuZHJhZ2dhYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5lZGl0b3IucmVuZGVyZXIuJGN1cnNvckxheWVyLnNldEJsaW5raW5nKGZhbHNlKTtcbiAgICAgICAgdGhpcy5lZGl0b3Iuc2V0U3R5bGUoXCJhY2VfZHJhZ2dpbmdcIik7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoXCJkcmFnUmVhZHlcIik7XG4gICAgfVxuXG4gICAgb25Nb3VzZURyYWcoZSkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5lZGl0b3IuY29udGFpbmVyO1xuICAgICAgICBpZiAodXNlcmFnZW50LmlzSUUgJiYgdGhpcy5zdGF0ZSA9PSBcImRyYWdSZWFkeVwiKSB7XG4gICAgICAgICAgICAvLyBJRSBkb2VzIG5vdCBoYW5kbGUgW2RyYWdnYWJsZV0gYXR0cmlidXRlIHNldCBhZnRlciBtb3VzZWRvd25cbiAgICAgICAgICAgIHZhciBkaXN0YW5jZSA9IGNhbGNEaXN0YW5jZSh0aGlzLm1vdXNlZG93bkV2ZW50LngsIHRoaXMubW91c2Vkb3duRXZlbnQueSwgdGhpcy54LCB0aGlzLnkpO1xuICAgICAgICAgICAgaWYgKGRpc3RhbmNlID4gMylcbiAgICAgICAgICAgICAgICB0YXJnZXQuZHJhZ0Ryb3AoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gXCJkcmFnV2FpdFwiKSB7XG4gICAgICAgICAgICB2YXIgZGlzdGFuY2UgPSBjYWxjRGlzdGFuY2UodGhpcy5tb3VzZWRvd25FdmVudC54LCB0aGlzLm1vdXNlZG93bkV2ZW50LnksIHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgICAgIGlmIChkaXN0YW5jZSA+IDApIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQuZHJhZ2dhYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydFNlbGVjdCh0aGlzLm1vdXNlZG93bkV2ZW50LmdldERvY3VtZW50UG9zaXRpb24oKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbk1vdXNlRG93bihlOiBNb3VzZUV2ZW50KSB7XG4gICAgICAgIGlmICghdGhpcy4kZHJhZ0VuYWJsZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMubW91c2Vkb3duRXZlbnQgPSBlO1xuICAgICAgICB2YXIgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG5cbiAgICAgICAgdmFyIGluU2VsZWN0aW9uID0gZS5pblNlbGVjdGlvbigpO1xuICAgICAgICB2YXIgYnV0dG9uID0gZS5nZXRCdXR0b24oKTtcbiAgICAgICAgdmFyIGNsaWNrQ291bnQgPSBlLmRvbUV2ZW50LmRldGFpbCB8fCAxO1xuICAgICAgICBpZiAoY2xpY2tDb3VudCA9PT0gMSAmJiBidXR0b24gPT09IDAgJiYgaW5TZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIGlmIChlLmVkaXRvci5pbk11bHRpU2VsZWN0TW9kZSAmJiAoZS5nZXRBY2NlbEtleSgpIHx8IGUuZ2V0U2hpZnRLZXkoKSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5tb3VzZWRvd25FdmVudC50aW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIHZhciBldmVudFRhcmdldCA9IGUuZG9tRXZlbnQudGFyZ2V0IHx8IGUuZG9tRXZlbnQuc3JjRWxlbWVudDtcbiAgICAgICAgICAgIGlmIChcInVuc2VsZWN0YWJsZVwiIGluIGV2ZW50VGFyZ2V0KVxuICAgICAgICAgICAgICAgIGV2ZW50VGFyZ2V0LnVuc2VsZWN0YWJsZSA9IFwib25cIjtcbiAgICAgICAgICAgIGlmIChlZGl0b3IuZ2V0RHJhZ0RlbGF5KCkpIHtcbiAgICAgICAgICAgICAgICAvLyBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9Mjg2NzAwXG4gICAgICAgICAgICAgICAgaWYgKHVzZXJhZ2VudC5pc1dlYktpdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbERyYWcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbW91c2VUYXJnZXQgPSBlZGl0b3IuY29udGFpbmVyO1xuICAgICAgICAgICAgICAgICAgICBtb3VzZVRhcmdldC5kcmFnZ2FibGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKFwiZHJhZ1dhaXRcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnREcmFnKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmNhcHR1cmVNb3VzZShlLCB0aGlzLm9uTW91c2VEcmFnLmJpbmQodGhpcykpO1xuICAgICAgICAgICAgLy8gVE9ETzogYSBiZXR0ZXIgd2F5IHRvIHByZXZlbnQgZGVmYXVsdCBoYW5kbGVyIHdpdGhvdXQgcHJldmVudGluZyBicm93c2VyIGRlZmF1bHQgYWN0aW9uXG4gICAgICAgICAgICBlLmRlZmF1bHRQcmV2ZW50ZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBjYWxjRGlzdGFuY2UoYXgsIGF5LCBieCwgYnkpIHtcbiAgICByZXR1cm4gTWF0aC5zcXJ0KE1hdGgucG93KGJ4IC0gYXgsIDIpICsgTWF0aC5wb3coYnkgLSBheSwgMikpO1xufVxuIl19