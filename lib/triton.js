var autoCompleteNew = require('./mode/typescript/autoComplete');
var CompletionService = require('./mode/typescript/CompletionService');
var EditorPosition = require('./mode/typescript/EditorPosition');
var DocumentPositionUtil = require('./mode/typescript/DocumentPositionUtil');
var async = require("./lib/async");
var ram = require('./range');
var lang = require("./lib/lang");
var typeInfoTip = require("./typeInfoTip");
var wsm = require('./workspace/workspace');
var protocol = require('./editor_protocol');
var deferredCall = lang.deferredCall;
function wrap(editor, rootElement, workspace, doc) {
    if (doc === void 0) { doc = window.document; }
    function show() {
        rootElement.style.display = "block";
        editor.focus();
    }
    function hide() {
        rootElement.style.display = 'none';
    }
    var _fileName;
    var _completionService = new CompletionService(editor, workspace);
    var _editorPositionService = new EditorPosition(editor);
    var _syncStop = false;
    var _refMarkers = [];
    var _errorMarkers = [];
    var _typeInfo = typeInfoTip(doc, editor, workspace, function () { return _fileName; }, rootElement);
    var _autoComplete = autoCompleteNew(editor, function () { return _fileName; }, _completionService);
    _typeInfo.startUp();
    function changeFile(content, fileName, cursorPos) {
        if (_fileName) {
            if (workspace) {
                workspace.removeScript(_fileName);
            }
            _fileName = null;
        }
        _fileName = fileName;
        _syncStop = true;
        var data = content.replace(/\r\n?/g, '\n');
        editor.setValue(data, cursorPos);
        if (workspace) {
            workspace.ensureScript(fileName, editor.getSession().getDocument().getValue());
        }
        _syncStop = false;
    }
    editor.commands.addCommands([{
            name: protocol.COMMAND_NAME_AUTO_COMPLETE,
            bindKey: "Ctrl-Space",
            exec: function (editor) {
                if (!_autoComplete.isActive()) {
                    _autoComplete.activate();
                }
            }
        }]);
    editor.addEventListener("mousedown", function (event) {
        if (_autoComplete.isActive()) {
            _autoComplete.deactivate();
        }
    });
    editor.addEventListener("changeCursor", function (event) {
    });
    function showOccurrences() {
    }
    var deferredShowOccurrences = deferredCall(showOccurrences);
    editor.addEventListener("changeSelection", function (event) {
        if (!_syncStop) {
            try {
                deferredShowOccurrences.schedule(200);
            }
            catch (ex) {
            }
        }
    });
    editor.addEventListener("change", function (event) {
        var data = event.data;
        var action = data.action;
        var range = data.range;
        if (_fileName) {
            if (!_syncStop) {
                try {
                    updateWorkspaceFile();
                    updateMarkerModels();
                }
                catch (e) {
                }
            }
        }
        function updateWorkspaceFile() {
            function editLanguageServiceScript(start, end, text) {
                if (workspace) {
                    workspace.editScript(_fileName, start, end, text);
                }
            }
            var end;
            var start = _editorPositionService.getPositionChars(range.start);
            if (action === "insertText") {
                editLanguageServiceScript(start, start, data.text);
            }
            else if (action === "removeText") {
                end = start + data.text.length;
                editLanguageServiceScript(start, end, "");
            }
            else if (action === "insertLines") {
                var text = data.lines.map(function (line) { return line + '\n'; }).join('');
                editLanguageServiceScript(start, start, text);
            }
            else if (action === "removeLines") {
                var len = _editorPositionService.getLinesChars(data.lines);
                end = start + len;
                editLanguageServiceScript(start, end, "");
            }
            else {
            }
        }
        function updateMarkerModels() {
            var markers = editor.getSession().getMarkers(true);
            var line_count = 0;
            var isNewLine = editor.getSession().getDocument().isNewLine;
            if (action === "insertText") {
                if (isNewLine(data.text)) {
                    line_count = 1;
                }
            }
            else if (action === "insertLines") {
                line_count = data.lines.length;
            }
            else if (action === "removeText") {
                if (isNewLine(data.text)) {
                    line_count = -1;
                }
            }
            else if (action === "removeLines") {
                line_count = -data.lines.length;
            }
            if (line_count !== 0) {
                var markerUpdate = function (id) {
                    var marker = markers[id];
                    var row = range.start.row;
                    if (line_count > 0) {
                        row = +1;
                    }
                    if (marker && marker.range.start.row > row) {
                        marker.range.start.row += line_count;
                        marker.range.end.row += line_count;
                    }
                };
                _errorMarkers.forEach(markerUpdate);
                _refMarkers.forEach(markerUpdate);
                editor.onChangeFrontMarker();
            }
        }
    });
    editor.getSession().on("compiled", function (message) {
        var session = editor.getSession();
        var doc = session.getDocument();
        function convertError(error) {
            var minChar = error.start;
            var limChar = minChar + error.length;
            var pos = DocumentPositionUtil.getPosition(doc, minChar);
            return { row: pos.row, column: pos.column, text: error.message, type: 'error' };
        }
        function getSyntaxErrors(callback) {
            if (workspace && typeof _fileName === 'string') {
                workspace.getSyntaxErrors(_fileName, callback);
            }
            else {
                callback(null, []);
            }
        }
        function getSemanticErrors(callback) {
            if (workspace && typeof _fileName === 'string') {
                workspace.getSemanticErrors(_fileName, callback);
            }
            else {
                callback(null, []);
            }
        }
        async.parallel([getSyntaxErrors, getSemanticErrors], function (err, results) {
            if (!err) {
                var errors = results[0].concat(results[1]);
                var annotations = [];
                if (errors && errors.length) {
                    errors.forEach(function (error) {
                        annotations.push(convertError(error));
                    });
                }
                session.setAnnotations(annotations);
                _errorMarkers.forEach(function (id) { session.removeMarker(id); });
                errors.forEach(function (error) {
                    var minChar = error.start;
                    var limChar = minChar + error.length;
                    var start = _editorPositionService.getPositionFromChars(minChar);
                    var end = _editorPositionService.getPositionFromChars(limChar);
                    var range = new ram.Range(start.row, start.column, end.row, end.column);
                    _errorMarkers.push(session.addMarker(range, "typescript-error", "text", true));
                });
            }
            else {
            }
        });
        if (workspace && typeof _fileName === 'string') {
            workspace.getOutputFiles(_fileName, function (err, outputFiles) {
                session._emit("outputFiles", { data: outputFiles });
            });
        }
    });
    var editorWrapper = {
        clearSelection: function () { editor.clearSelection(); },
        get fileName() { return _fileName; },
        set fileName(value) { _fileName = value; },
        get commands() { return editor.commands; },
        get container() { return editor.container; },
        get session() { return editor.session; },
        getCursorPosition: function () { return editor.getCursorPosition(); },
        getSelection: function () { return editor.getSelection(); },
        getValue: function () { return editor.getValue(); },
        gotoLine: function (lineNumber, column, animate) { return editor.gotoLine(lineNumber, column, animate); },
        focus: function () { editor.focus(); },
        indent: function () { editor.indent(); },
        moveCursorTo: function (row, column, animate) { return editor.moveCursorTo(row, column, animate); },
        resize: function (force) { return editor.resize(force); },
        selectAll: function () { editor.selectAll(); },
        setAutoScrollEditorIntoView: function (enable) { return editor.setAutoScrollEditorIntoView(enable); },
        setFontSize: function (fontSize) { return editor.setFontSize(fontSize); },
        setOption: function (name, value) { return editor.setOption(name, value); },
        setOptions: function (options) { return editor.setOptions(options); },
        setShowInvisibles: function (showInvisibles) { return editor.setShowInvisibles(showInvisibles); },
        setTheme: function (theme, callback) { return editor.setTheme(theme, callback); },
        setValue: function (val, cursorPos) { return editor.setValue(val, cursorPos); },
        getSession: function () { return editor.getSession(); },
        addEventListener: function (eventName, callback, capturing) { return editor.addEventListener(eventName, callback, capturing); },
        get onTextInput() { return editor.onTextInput; },
        set onTextInput(value) { editor.onTextInput = value; },
        getDisplayIndentGuides: function () { return editor.getDisplayIndentGuides(); },
        setDisplayIndentGuides: function (displayIndentGuides) { return editor.setDisplayIndentGuides(displayIndentGuides); },
        getShowPrintMargin: function () { return editor.getShowPrintMargin(); },
        setShowPrintMargin: function (showPrintMargin) { return editor.setShowPrintMargin(showPrintMargin); },
        changeFile: changeFile
    };
    return editorWrapper;
}
exports.wrap = wrap;
function edit(source, workspace, doc) {
    if (doc === void 0) { doc = window.document; }
    var rootElement = (function () {
        if (typeof source === "string") {
            var element = doc.getElementById(source);
            if (element) {
                return element;
            }
            else {
                throw new Error(source + " must be an element id");
            }
        }
        else {
            return source;
        }
    })();
    var _editor = (function (element) {
        throw new Error("edit is currently unsupported");
    })(rootElement);
    return wrap(_editor, rootElement, workspace, doc);
}
function workspace() {
    return wsm.workspace();
}
exports.workspace = workspace;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJpdG9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3RyaXRvbi50cyJdLCJuYW1lcyI6WyJ3cmFwIiwid3JhcC5zaG93Iiwid3JhcC5oaWRlIiwid3JhcC5jaGFuZ2VGaWxlIiwid3JhcC5zaG93T2NjdXJyZW5jZXMiLCJ1cGRhdGVXb3Jrc3BhY2VGaWxlIiwidXBkYXRlV29ya3NwYWNlRmlsZS5lZGl0TGFuZ3VhZ2VTZXJ2aWNlU2NyaXB0IiwidXBkYXRlTWFya2VyTW9kZWxzIiwiY29udmVydEVycm9yIiwiZ2V0U3ludGF4RXJyb3JzIiwiZ2V0U2VtYW50aWNFcnJvcnMiLCJ3cmFwLmZpbGVOYW1lIiwid3JhcC5jb21tYW5kcyIsIndyYXAuY29udGFpbmVyIiwid3JhcC5zZXNzaW9uIiwid3JhcC5vblRleHRJbnB1dCIsImVkaXQiLCJ3b3Jrc3BhY2UiXSwibWFwcGluZ3MiOiJBQUFBLElBQU8sZUFBZSxXQUFXLGdDQUFnQyxDQUFDLENBQUM7QUFDbkUsSUFBTyxpQkFBaUIsV0FBVyxxQ0FBcUMsQ0FBQyxDQUFDO0FBQzFFLElBQU8sY0FBYyxXQUFXLGtDQUFrQyxDQUFDLENBQUM7QUFDcEUsSUFBTyxvQkFBb0IsV0FBVyx3Q0FBd0MsQ0FBQyxDQUFDO0FBQ2hGLElBQU8sS0FBSyxXQUFXLGFBQWEsQ0FBQyxDQUFDO0FBSXRDLElBQU8sR0FBRyxXQUFXLFNBQVMsQ0FBQyxDQUFDO0FBQ2hDLElBQU8sSUFBSSxXQUFXLFlBQVksQ0FBQyxDQUFDO0FBQ3BDLElBQU8sV0FBVyxXQUFXLGVBQWUsQ0FBQyxDQUFDO0FBQzlDLElBQU8sR0FBRyxXQUFXLHVCQUF1QixDQUFDLENBQUM7QUFDOUMsSUFBTyxRQUFRLFdBQVcsbUJBQW1CLENBQUMsQ0FBQztBQUkvQyxJQUFJLFlBQVksR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO0FBUXJDLGNBQXFCLE1BQWMsRUFBRSxXQUF3QixFQUFFLFNBQVMsRUFBRSxHQUErQjtJQUEvQkEsbUJBQStCQSxH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QSxXQUFXQSxDQUFDQSxDQUFDQTtJQUVoQkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsV0FBV0EsRUFBRUEsU0FBU0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7QUFDdERBLENBQUNBO0FBRUQ7SUFDSUMsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0E7QUFDM0JBLENBQUNBO0FBRmUsaUJBQVMsWUFFeEIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhdXRvQ29tcGxldGVOZXcgPSByZXF1aXJlKCcuL21vZGUvdHlwZXNjcmlwdC9hdXRvQ29tcGxldGUnKTtcbmltcG9ydCBDb21wbGV0aW9uU2VydmljZSA9IHJlcXVpcmUoJy4vbW9kZS90eXBlc2NyaXB0L0NvbXBsZXRpb25TZXJ2aWNlJyk7XG5pbXBvcnQgRWRpdG9yUG9zaXRpb24gPSByZXF1aXJlKCcuL21vZGUvdHlwZXNjcmlwdC9FZGl0b3JQb3NpdGlvbicpO1xuaW1wb3J0IERvY3VtZW50UG9zaXRpb25VdGlsID0gcmVxdWlyZSgnLi9tb2RlL3R5cGVzY3JpcHQvRG9jdW1lbnRQb3NpdGlvblV0aWwnKTtcbmltcG9ydCBhc3luYyA9IHJlcXVpcmUoXCIuL2xpYi9hc3luY1wiKTtcbmltcG9ydCBkb20gPSByZXF1aXJlKFwiLi9saWIvZG9tXCIpO1xuaW1wb3J0IEVkaXRvciA9IHJlcXVpcmUoJy4vRWRpdG9yJyk7XG5pbXBvcnQgZXNtID0gcmVxdWlyZSgnLi9lZGl0X3Nlc3Npb24nKTtcbmltcG9ydCByYW0gPSByZXF1aXJlKCcuL3JhbmdlJyk7XG5pbXBvcnQgbGFuZyA9IHJlcXVpcmUoXCIuL2xpYi9sYW5nXCIpO1xuaW1wb3J0IHR5cGVJbmZvVGlwID0gcmVxdWlyZShcIi4vdHlwZUluZm9UaXBcIik7XG5pbXBvcnQgd3NtID0gcmVxdWlyZSgnLi93b3Jrc3BhY2Uvd29ya3NwYWNlJyk7XG5pbXBvcnQgcHJvdG9jb2wgPSByZXF1aXJlKCcuL2VkaXRvcl9wcm90b2NvbCcpO1xuLy9pbXBvcnQgQ29tbWFuZE1hbmFnZXIgPSByZXF1aXJlKCcuL2NvbW1hbmRzL0NvbW1hbmRNYW5hZ2VyJyk7XG5pbXBvcnQgc2VtID0gcmVxdWlyZSgnLi9zZWxlY3Rpb24nKTtcblxudmFyIGRlZmVycmVkQ2FsbCA9IGxhbmcuZGVmZXJyZWRDYWxsO1xuXG4vKipcbiAqIFRoZSBmdW5jdGlvbmFsIGNvbnN0cnVjdG9yIHBhdHRlcm4gdXNlZCB0byBjcmVhdGUgYSBmYWNhZGUgdGhhdFxuICogaW5jbHVkZXMgYW4gZWRpdG9yLCB0aGUgSFRNTCBlbGVtZW50IHRoYXQgdGhlIGVkaXRvciB3aWxsIGJlIGJ1aWx0IHVwb24sXG4gKiBhbmQgdGhlIHNoYXJlZCB3b3Jrc3BhY2UuXG4gKiBUaGlzIGlzIGNhbGxlZCBieSBlZGl0aW5nIGFwcGxpY2F0aW9ucy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdyYXAoZWRpdG9yOiBFZGl0b3IsIHJvb3RFbGVtZW50OiBIVE1MRWxlbWVudCwgd29ya3NwYWNlLCBkb2M6IERvY3VtZW50ID0gd2luZG93LmRvY3VtZW50KSB7XG5cbiAgICBmdW5jdGlvbiBzaG93KCkge1xuICAgICAgICByb290RWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICBlZGl0b3IuZm9jdXMoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoaWRlKCkge1xuICAgICAgICByb290RWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIH1cblxuICAgIHZhciBfZmlsZU5hbWU6IHN0cmluZztcbiAgICB2YXIgX2NvbXBsZXRpb25TZXJ2aWNlID0gbmV3IENvbXBsZXRpb25TZXJ2aWNlKGVkaXRvciwgd29ya3NwYWNlKTtcbiAgICB2YXIgX2VkaXRvclBvc2l0aW9uU2VydmljZSA9IG5ldyBFZGl0b3JQb3NpdGlvbihlZGl0b3IpO1xuICAgIHZhciBfc3luY1N0b3AgPSBmYWxzZTsgLy9mb3Igc3RvcCBzeW5jIG9uIGxvYWRmaWxlXG4gICAgdmFyIF9yZWZNYXJrZXJzOiBudW1iZXJbXSA9IFtdO1xuICAgIHZhciBfZXJyb3JNYXJrZXJzOiBudW1iZXJbXSA9IFtdO1xuXG4gICAgdmFyIF90eXBlSW5mbyA9IHR5cGVJbmZvVGlwKGRvYywgZWRpdG9yLCB3b3Jrc3BhY2UsICgpID0+IF9maWxlTmFtZSwgcm9vdEVsZW1lbnQpO1xuICAgIHZhciBfYXV0b0NvbXBsZXRlID0gYXV0b0NvbXBsZXRlTmV3KGVkaXRvciwgKCkgPT4gX2ZpbGVOYW1lLCBfY29tcGxldGlvblNlcnZpY2UpO1xuXG4gICAgX3R5cGVJbmZvLnN0YXJ0VXAoKTtcblxuICAgIC8qKlxuICAgICAqIENoYW5nZXMgdGhlIGVkaXRvciBjb250ZW50cyBhbmQgdXBkYXRlcyB0aGUgd29ya3NwYWNlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNoYW5nZUZpbGUoY29udGVudDogc3RyaW5nLCBmaWxlTmFtZTogc3RyaW5nLCBjdXJzb3JQb3MpIHtcbiAgICAgICAgaWYgKF9maWxlTmFtZSkge1xuICAgICAgICAgICAgaWYgKHdvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgIHdvcmtzcGFjZS5yZW1vdmVTY3JpcHQoX2ZpbGVOYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF9maWxlTmFtZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgX2ZpbGVOYW1lID0gZmlsZU5hbWU7XG4gICAgICAgIF9zeW5jU3RvcCA9IHRydWU7XG4gICAgICAgIHZhciBkYXRhID0gY29udGVudC5yZXBsYWNlKC9cXHJcXG4/L2csICdcXG4nKTtcbiAgICAgICAgZWRpdG9yLnNldFZhbHVlKGRhdGEsIGN1cnNvclBvcyk7XG4gICAgICAgIGlmICh3b3Jrc3BhY2UpIHtcbiAgICAgICAgICAgIHdvcmtzcGFjZS5lbnN1cmVTY3JpcHQoZmlsZU5hbWUsIGVkaXRvci5nZXRTZXNzaW9uKCkuZ2V0RG9jdW1lbnQoKS5nZXRWYWx1ZSgpKTtcbiAgICAgICAgfVxuICAgICAgICBfc3luY1N0b3AgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBlZGl0b3IuY29tbWFuZHMuYWRkQ29tbWFuZHMoW3tcbiAgICAgICAgbmFtZTogcHJvdG9jb2wuQ09NTUFORF9OQU1FX0FVVE9fQ09NUExFVEUsXG4gICAgICAgIGJpbmRLZXk6IFwiQ3RybC1TcGFjZVwiLFxuICAgICAgICBleGVjOiBmdW5jdGlvbihlZGl0b3IpIHtcbiAgICAgICAgICAgIGlmICghX2F1dG9Db21wbGV0ZS5pc0FjdGl2ZSgpKSB7XG4gICAgICAgICAgICAgICAgX2F1dG9Db21wbGV0ZS5hY3RpdmF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfV0pO1xuXG4gICAgZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKF9hdXRvQ29tcGxldGUuaXNBY3RpdmUoKSkge1xuICAgICAgICAgICAgX2F1dG9Db21wbGV0ZS5kZWFjdGl2YXRlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIFRoaXMgZXZlbnQgc2VlbXMgdG8gYmUgcHJldHR5IHJhcmUuXG4gICAgICovXG4gICAgZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VDdXJzb3JcIiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHNob3dPY2N1cnJlbmNlcygpIHtcbiAgICAgICAgLypcbiAgICAgICAgdmFyIHNlc3Npb24gPSBfZWRpdG9yLmdldFNlc3Npb24oKTtcbiAgICAgICAgX3JlZk1hcmtlcnMuZm9yRWFjaChmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgc2Vzc2lvbi5yZW1vdmVNYXJrZXIoaWQpO1xuICAgICAgICB9KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgX2xhbmd1YWdlU2VydmljZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVmZXJlbmNlcyA9IF9sYW5ndWFnZVNlcnZpY2UuZ2V0T2NjdXJyZW5jZXNBdFBvc2l0aW9uKF9jdXJyZW50RmlsZU5hbWUsIF9lZGl0b3JQb3NpdGlvblNlcnZpY2UuZ2V0Q3VycmVudENoYXJQb3NpdGlvbigpKTtcbiAgICAgICAgICAgICAgICBpZiAocmVmZXJlbmNlcykge1xuICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VzLmZvckVhY2goZnVuY3Rpb24ocmVmZXJlbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnQgPSBfZWRpdG9yUG9zaXRpb25TZXJ2aWNlLmdldFBvc2l0aW9uRnJvbUNoYXJzKHJlZmVyZW5jZS5taW5DaGFyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmQgPSBfZWRpdG9yUG9zaXRpb25TZXJ2aWNlLmdldFBvc2l0aW9uRnJvbUNoYXJzKHJlZmVyZW5jZS5saW1DaGFyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IG5ldyBBY2VSYW5nZShzdGFydC5yb3csIHN0YXJ0LmNvbHVtbiwgZW5kLnJvdywgZW5kLmNvbHVtbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBfcmVmTWFya2Vycy5wdXNoKHNlc3Npb24uYWRkTWFya2VyKHJhbmdlLCBcInR5cGVzY3JpcHQtcmVmXCIsIFwidGV4dFwiLCB0cnVlKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICB9XG4gICAgICAgICovXG4gICAgfVxuXG4gICAgdmFyIGRlZmVycmVkU2hvd09jY3VycmVuY2VzID0gZGVmZXJyZWRDYWxsKHNob3dPY2N1cnJlbmNlcyk7XG5cbiAgICAvKipcbiAgICAgKiBDaGFuZ2luZyB0aGUgc2VsZWN0aW9uIGRvZXMgbm90IHRyaWdnZXIgYW55IGVmZm9ydCBvbiBiZWhhbGYgb2YgdGhlIHdvcmtlci5cbiAgICAgKi9cbiAgICBlZGl0b3IuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVNlbGVjdGlvblwiLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAvLyBUaGVyZSdzIG5vdCBtdWNoIGluIHRoZSBldmVudCwganVzdCBhICd0eXBlJyBwcm9wZXJ0eSB0aGF0IGlzICdjaGFuZ2VTZWxlY3Rpb24nLlxuICAgICAgICBpZiAoIV9zeW5jU3RvcCkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZFNob3dPY2N1cnJlbmNlcy5zY2hlZHVsZSgyMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGV4KSB7XG4gICAgICAgICAgICAgICAgLy9UT0RPXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIFdoZW4gdGhlIHRleHQgaW4gdGhlIGVkaXRvciBjaGFuZ2VzLCB0aGUgZWRpdCBpcyBhcHBsaWVkIHRvIHRoZSB3b3Jrc3BhY2UuXG4gICAgICogVGhlIHdvcmtzcGFjZSBjb21tdW5pY2F0ZXMgd2l0aCB0aGUgV29ya3NwYWNlV29ya2VyIHRocm91Z2ggYSBXb3JrZXJDbGllbnQgcHJveHkuXG4gICAgICogVGhlIG9uVXBkYXRlIG1ldGhvZCBvZiB0aGUgd29ya2VyIGlzIHNvb24gdHJpZ2dlcmVkIGZvbGxvd2VkIGJ5IHRoZSBjb21waWxlIG1ldGhvZC5cbiAgICAgKi9cbiAgICBlZGl0b3IuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBmdW5jdGlvbihldmVudDogeyBkYXRhOiB7IGFjdGlvbjogc3RyaW5nOyByYW5nZTogeyBzdGFydDogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfSB9OyB0ZXh0OiBzdHJpbmc7IGxpbmVzOiBzdHJpbmdbXSB9IH0pIHtcbiAgICAgICAgdmFyIGRhdGEgPSBldmVudC5kYXRhO1xuICAgICAgICB2YXIgYWN0aW9uOiBzdHJpbmcgPSBkYXRhLmFjdGlvbjtcbiAgICAgICAgdmFyIHJhbmdlID0gZGF0YS5yYW5nZTtcbiAgICAgICAgaWYgKF9maWxlTmFtZSkge1xuICAgICAgICAgICAgaWYgKCFfc3luY1N0b3ApIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVXb3Jrc3BhY2VGaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZU1hcmtlck1vZGVscygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogVXBkYXRlcyB0aGUgZmlsZSBpbiB0aGUgd29ya3NwYWNlIHVzaW5nIHRoZSAoY2FwdHVyZWQpIGZpbGVOYW1lIGFuZCBjaGFuZ2UgZXZlbnQuXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiB1cGRhdGVXb3Jrc3BhY2VGaWxlKCkge1xuICAgICAgICAgICAgZnVuY3Rpb24gZWRpdExhbmd1YWdlU2VydmljZVNjcmlwdChzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlciwgdGV4dDogc3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2UuZWRpdFNjcmlwdChfZmlsZU5hbWUsIHN0YXJ0LCBlbmQsIHRleHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBlbmQ6IG51bWJlcjtcbiAgICAgICAgICAgIHZhciBzdGFydDogbnVtYmVyID0gX2VkaXRvclBvc2l0aW9uU2VydmljZS5nZXRQb3NpdGlvbkNoYXJzKHJhbmdlLnN0YXJ0KTtcbiAgICAgICAgICAgIGlmIChhY3Rpb24gPT09IFwiaW5zZXJ0VGV4dFwiKSB7XG4gICAgICAgICAgICAgICAgZWRpdExhbmd1YWdlU2VydmljZVNjcmlwdChzdGFydCwgc3RhcnQsIGRhdGEudGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwicmVtb3ZlVGV4dFwiKSB7XG4gICAgICAgICAgICAgICAgZW5kID0gc3RhcnQgKyBkYXRhLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGVkaXRMYW5ndWFnZVNlcnZpY2VTY3JpcHQoc3RhcnQsIGVuZCwgXCJcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwiaW5zZXJ0TGluZXNcIikge1xuICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gZGF0YS5saW5lcy5tYXAoZnVuY3Rpb24obGluZSkgeyByZXR1cm4gbGluZSArICdcXG4nOyB9KS5qb2luKCcnKTtcbiAgICAgICAgICAgICAgICBlZGl0TGFuZ3VhZ2VTZXJ2aWNlU2NyaXB0KHN0YXJ0LCBzdGFydCwgdGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwicmVtb3ZlTGluZXNcIikge1xuICAgICAgICAgICAgICAgIHZhciBsZW4gPSBfZWRpdG9yUG9zaXRpb25TZXJ2aWNlLmdldExpbmVzQ2hhcnMoZGF0YS5saW5lcyk7XG4gICAgICAgICAgICAgICAgZW5kID0gc3RhcnQgKyBsZW47XG4gICAgICAgICAgICAgICAgZWRpdExhbmd1YWdlU2VydmljZVNjcmlwdChzdGFydCwgZW5kLCBcIlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVwZGF0ZXMgdGhlIG1hcmtlciBtb2RlbHMuXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiB1cGRhdGVNYXJrZXJNb2RlbHMoKSB7XG4gICAgICAgICAgICB2YXIgbWFya2VycyA9IGVkaXRvci5nZXRTZXNzaW9uKCkuZ2V0TWFya2Vycyh0cnVlKTtcbiAgICAgICAgICAgIHZhciBsaW5lX2NvdW50ID0gMDtcbiAgICAgICAgICAgIHZhciBpc05ld0xpbmUgPSBlZGl0b3IuZ2V0U2Vzc2lvbigpLmdldERvY3VtZW50KCkuaXNOZXdMaW5lO1xuICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gXCJpbnNlcnRUZXh0XCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNOZXdMaW5lKGRhdGEudGV4dCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbGluZV9jb3VudCA9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSBcImluc2VydExpbmVzXCIpIHtcbiAgICAgICAgICAgICAgICBsaW5lX2NvdW50ID0gZGF0YS5saW5lcy5sZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwicmVtb3ZlVGV4dFwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzTmV3TGluZShkYXRhLnRleHQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpbmVfY291bnQgPSAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwicmVtb3ZlTGluZXNcIikge1xuICAgICAgICAgICAgICAgIGxpbmVfY291bnQgPSAtZGF0YS5saW5lcy5sZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobGluZV9jb3VudCAhPT0gMCkge1xuICAgICAgICAgICAgICAgIHZhciBtYXJrZXJVcGRhdGUgPSBmdW5jdGlvbihpZDogbnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXJrZXIgPSBtYXJrZXJzW2lkXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvdyA9IHJhbmdlLnN0YXJ0LnJvdztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmVfY291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByb3cgPSArMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobWFya2VyICYmIG1hcmtlci5yYW5nZS5zdGFydC5yb3cgPiByb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcmtlci5yYW5nZS5zdGFydC5yb3cgKz0gbGluZV9jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcmtlci5yYW5nZS5lbmQucm93ICs9IGxpbmVfY291bnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIF9lcnJvck1hcmtlcnMuZm9yRWFjaChtYXJrZXJVcGRhdGUpO1xuICAgICAgICAgICAgICAgIF9yZWZNYXJrZXJzLmZvckVhY2gobWFya2VyVXBkYXRlKTtcbiAgICAgICAgICAgICAgICAvLyBGSVhNRTogVGhpcyBpcyB0aGUgb2RkIG1hbiBvdXQuXG4gICAgICAgICAgICAgICAgLy8gV2Ugc2hvdWxkIG5vdCBiZSB0cmlnZ2VyaW5nIGEgdmlldyByZWZyZXNoIGhlcmU/XG4gICAgICAgICAgICAgICAgZWRpdG9yLm9uQ2hhbmdlRnJvbnRNYXJrZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLypcbiAgICBmdW5jdGlvbiBsYW5ndWFnZVNlcnZpY2VJbmRlbnQoKSB7XG4gICAgICAgIHZhciBjdXJzb3IgPSBfZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCk7XG4gICAgICAgIHZhciBsaW5lTnVtYmVyID0gY3Vyc29yLnJvdztcblxuICAgICAgICB2YXIgdGV4dCA9IF9lZGl0b3Iuc2Vzc2lvbi5nZXRMaW5lKGxpbmVOdW1iZXIpO1xuICAgICAgICB2YXIgbWF0Y2hlcyA9IHRleHQubWF0Y2goLyBeW1xcdCBdKiAvKTtcbiAgICAgICAgdmFyIHByZUluZGVudCA9IDA7XG4gICAgICAgIHZhciB3b3JkTGVuID0gMDtcblxuICAgICAgICBpZiAobWF0Y2hlcykge1xuICAgICAgICAgICAgd29yZExlbiA9IG1hdGNoZXNbMF0ubGVuZ3RoO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXRjaGVzWzBdLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsbSA9IG1hdGNoZXNbMF0uY2hhckF0KGkpO1xuICAgICAgICAgICAgICAgIHZhciBzcGFjZUxlbiA9IChlbG0gPT0gXCIgXCIpID8gMSA6IF9lZGl0b3Iuc2Vzc2lvbi5nZXRUYWJTaXplKCk7XG4gICAgICAgICAgICAgICAgcHJlSW5kZW50ICs9IHNwYWNlTGVuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG9wdGlvbiA9IG5ldyBTZXJ2aWNlcy5FZGl0b3JPcHRpb25zKCk7XG4gICAgICAgIG9wdGlvbi5OZXdMaW5lQ2hhcmFjdGVyID0gXCJcXG5cIjtcblxuICAgICAgICB2YXIgc21hcnRJbmRlbnQgPSBfbGFuZ3VhZ2VTZXJ2aWNlLmdldFNtYXJ0SW5kZW50QXRMaW5lTnVtYmVyKF9jdXJyZW50RmlsZU5hbWUsIGxpbmVOdW1iZXIsIG9wdGlvbik7XG5cbiAgICAgICAgaWYgKHByZUluZGVudCA+IHNtYXJ0SW5kZW50KSB7XG4gICAgICAgICAgICBfZWRpdG9yLmluZGVudCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIGluZGVudCA9IHNtYXJ0SW5kZW50IC0gcHJlSW5kZW50O1xuXG4gICAgICAgICAgICBpZiAoaW5kZW50ID4gMCkge1xuICAgICAgICAgICAgICAgIF9lZGl0b3IuZ2V0U2VsZWN0aW9uKCkubW92ZUN1cnNvckxpbmVTdGFydCgpO1xuICAgICAgICAgICAgICAgIF9lZGl0b3IuY29tbWFuZHMuZXhlYyhcImluc2VydHRleHRcIiwgX2VkaXRvciwgeyB0ZXh0OiBcIiBcIiwgdGltZXM6IGluZGVudCB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGN1cnNvci5jb2x1bW4gPiB3b3JkTGVuKSB7XG4gICAgICAgICAgICAgICAgY3Vyc29yLmNvbHVtbiArPSBpbmRlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdXJzb3IuY29sdW1uID0gaW5kZW50ICsgd29yZExlbjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgX2VkaXRvci5nZXRTZWxlY3Rpb24oKS5tb3ZlQ3Vyc29yVG9Qb3NpdGlvbihjdXJzb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2VkaXRvci5jb21tYW5kcy5hZGRDb21tYW5kcyhbe1xuICAgICAgICBuYW1lOiBcImluZGVudFwiLFxuICAgICAgICBiaW5kS2V5OiBcIlRhYlwiLFxuICAgICAgICBleGVjOiBmdW5jdGlvbihlZGl0b3IpIHtcbiAgICAgICAgICAgIGxhbmd1YWdlU2VydmljZUluZGVudCgpO1xuICAgICAgICB9LFxuICAgICAgICBtdWx0aVNlbGVjdEFjdGlvbjogXCJmb3JFYWNoXCJcbiAgICB9XSk7XG4gICAgKi9cblxuICAgIC8qXG4gICAgZnVuY3Rpb24gcmVmYWN0b3IoKSB7XG4gICAgICAgIHZhciByZWZlcmVuY2VzID0gX2xhbmd1YWdlU2VydmljZS5nZXRPY2N1cnJlbmNlc0F0UG9zaXRpb24oX2N1cnJlbnRGaWxlTmFtZSwgX2VkaXRvclBvc2l0aW9uU2VydmljZS5nZXRDdXJyZW50Q2hhclBvc2l0aW9uKCkpO1xuXG4gICAgICAgIHJlZmVyZW5jZXMuZm9yRWFjaChmdW5jdGlvbihyZWZlcmVuY2UpIHtcbiAgICAgICAgICAgIHZhciBzdGFydCA9IF9lZGl0b3JQb3NpdGlvblNlcnZpY2UuZ2V0UG9zaXRpb25Gcm9tQ2hhcnMocmVmZXJlbmNlLm1pbkNoYXIpO1xuICAgICAgICAgICAgdmFyIGVuZCA9IF9lZGl0b3JQb3NpdGlvblNlcnZpY2UuZ2V0UG9zaXRpb25Gcm9tQ2hhcnMocmVmZXJlbmNlLmxpbUNoYXIpO1xuICAgICAgICAgICAgdmFyIHJhbmdlID0gbmV3IEFjZVJhbmdlKHN0YXJ0LnJvdywgc3RhcnQuY29sdW1uLCBlbmQucm93LCBlbmQuY29sdW1uKTtcbiAgICAgICAgICAgIF9lZGl0b3Iuc2Vzc2lvbi5tdWx0aVNlbGVjdC5hZGRSYW5nZShyYW5nZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIF9lZGl0b3IuY29tbWFuZHMuYWRkQ29tbWFuZHMoW3tcbiAgICAgICAgbmFtZTogXCJyZWZhY3RvclwiLFxuICAgICAgICBiaW5kS2V5OiBcIkYyXCIsXG4gICAgICAgIGV4ZWM6IGZ1bmN0aW9uKGVkaXRvcikge1xuICAgICAgICAgICAgcmVmYWN0b3IoKTtcbiAgICAgICAgfVxuICAgIH1dKTtcbiAgICAqL1xuXG4gICAgLy8gSGFuZGxlIHRoZSBjb21waWxlZCBub3RpZmljYXRpb25cbiAgICBlZGl0b3IuZ2V0U2Vzc2lvbigpLm9uKFwiY29tcGlsZWRcIiwgZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICB2YXIgc2Vzc2lvbjogZXNtLkVkaXRTZXNzaW9uID0gZWRpdG9yLmdldFNlc3Npb24oKTtcbiAgICAgICAgLy8gRklYTUU6IERvY3VtZW50IGhlcmUgY29uZmxpY3RzIHdpdGggdGhlIGJyb3dzZXIgZG9jdW1lbnQgdHlwZS5cbiAgICAgICAgdmFyIGRvYzogYW55ID0gc2Vzc2lvbi5nZXREb2N1bWVudCgpO1xuICAgICAgICBmdW5jdGlvbiBjb252ZXJ0RXJyb3IoZXJyb3I6IHsgbWVzc2FnZTogc3RyaW5nOyBzdGFydDogbnVtYmVyOyBsZW5ndGg6IG51bWJlciB9KTogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXI7IHRleHQ6IHN0cmluZzsgdHlwZTogc3RyaW5nIH0ge1xuICAgICAgICAgICAgdmFyIG1pbkNoYXIgPSBlcnJvci5zdGFydDtcbiAgICAgICAgICAgIHZhciBsaW1DaGFyID0gbWluQ2hhciArIGVycm9yLmxlbmd0aDtcbiAgICAgICAgICAgIHZhciBwb3MgPSBEb2N1bWVudFBvc2l0aW9uVXRpbC5nZXRQb3NpdGlvbihkb2MsIG1pbkNoYXIpO1xuICAgICAgICAgICAgcmV0dXJuIHsgcm93OiBwb3Mucm93LCBjb2x1bW46IHBvcy5jb2x1bW4sIHRleHQ6IGVycm9yLm1lc3NhZ2UsIHR5cGU6ICdlcnJvcicgfTtcbiAgICAgICAgfVxuICAgICAgICAvLyBGSVhNRTogVGhlIHR5cGUgb2YgdGhlIGNhbGxiYWNrIHNob3VsZCBiZSBrbm93bi5cbiAgICAgICAgZnVuY3Rpb24gZ2V0U3ludGF4RXJyb3JzKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBpZiAod29ya3NwYWNlICYmIHR5cGVvZiBfZmlsZU5hbWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgd29ya3NwYWNlLmdldFN5bnRheEVycm9ycyhfZmlsZU5hbWUsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIFtdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBGSVhNRTogVGhlIHR5cGUgb2YgdGhlIGNhbGxiYWNrIHNob3VsZCBiZSBrbm93bi5cbiAgICAgICAgZnVuY3Rpb24gZ2V0U2VtYW50aWNFcnJvcnMoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGlmICh3b3Jrc3BhY2UgJiYgdHlwZW9mIF9maWxlTmFtZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICB3b3Jrc3BhY2UuZ2V0U2VtYW50aWNFcnJvcnMoX2ZpbGVOYW1lLCBjYWxsYmFjayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBbXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmVxdWVzdCBzeW50YXggYW5kIHNlbWFudGljIGVycm9ycyBmcm9tIHRoZSB3b3Jrc3BhY2UsIHNldCBtYXJrZXJzIGFuZCBhbm5vdGF0aW9ucy5cbiAgICAgICAgYXN5bmMucGFyYWxsZWwoW2dldFN5bnRheEVycm9ycywgZ2V0U2VtYW50aWNFcnJvcnNdLCBmdW5jdGlvbihlcnIsIHJlc3VsdHM6IGFueVtdW10pIHtcbiAgICAgICAgICAgIGlmICghZXJyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9ycyA9IHJlc3VsdHNbMF0uY29uY2F0KHJlc3VsdHNbMV0pO1xuICAgICAgICAgICAgICAgIHZhciBhbm5vdGF0aW9ucyA9IFtdO1xuICAgICAgICAgICAgICAgIGlmIChlcnJvcnMgJiYgZXJyb3JzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBlcnJvcnMuZm9yRWFjaChmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5ub3RhdGlvbnMucHVzaChjb252ZXJ0RXJyb3IoZXJyb3IpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEZJWE1FOiBFZGl0U2Vzc2lvbiBzaG91bGQgZGVjbGFyZSBhbm5vdGF0aW9uIHR5cGUuXG4gICAgICAgICAgICAgICAgLy8gU2VlIEFubm90YXRpb24gaW50ZXJmYWNlLlxuICAgICAgICAgICAgICAgIHNlc3Npb24uc2V0QW5ub3RhdGlvbnMoYW5ub3RhdGlvbnMpO1xuICAgICAgICAgICAgICAgIF9lcnJvck1hcmtlcnMuZm9yRWFjaChmdW5jdGlvbihpZCkgeyBzZXNzaW9uLnJlbW92ZU1hcmtlcihpZCk7IH0pO1xuICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgbmV3IGNvbXBpbGUgZXJyb3JzIHRvIHRoZSBlZGl0b3Igc2Vzc2lvbiBhbmQgdGhlIGlkKHMpIHRvIHRoZSBtb2RlbC5cbiAgICAgICAgICAgICAgICBlcnJvcnMuZm9yRWFjaChmdW5jdGlvbihlcnJvcjogeyBtZXNzYWdlOiBzdHJpbmc7IHN0YXJ0OiBudW1iZXI7IGxlbmd0aDogbnVtYmVyIH0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1pbkNoYXIgPSBlcnJvci5zdGFydDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbUNoYXIgPSBtaW5DaGFyICsgZXJyb3IubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnQgPSBfZWRpdG9yUG9zaXRpb25TZXJ2aWNlLmdldFBvc2l0aW9uRnJvbUNoYXJzKG1pbkNoYXIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW5kID0gX2VkaXRvclBvc2l0aW9uU2VydmljZS5nZXRQb3NpdGlvbkZyb21DaGFycyhsaW1DaGFyKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gbmV3IHJhbS5SYW5nZShzdGFydC5yb3csIHN0YXJ0LmNvbHVtbiwgZW5kLnJvdywgZW5kLmNvbHVtbik7XG4gICAgICAgICAgICAgICAgICAgIC8vIEFkZCBhIG5ldyBtYXJrZXIgdG8gdGhlIGdpdmVuIFJhbmdlLiBUaGUgbGFzdCBhcmd1bWVudCAoaW5Gcm9udCkgY2F1c2VzIGFcbiAgICAgICAgICAgICAgICAgICAgLy8gZnJvbnQgbWFya2VyIHRvIGJlIGRlZmluZWQgYW5kIHRoZSAnY2hhbmdlRnJvbnRNYXJrZXInIGV2ZW50IGZpcmVzLlxuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgY2xhc3MgcGFyYW1ldGVyIGlzIGEgY3NzIHN0eWxlc2hlZXQgY2xhc3Mgc28geW91IG11c3QgaGF2ZSBpdCBpbiB5b3VyIENTUy5cbiAgICAgICAgICAgICAgICAgICAgX2Vycm9yTWFya2Vycy5wdXNoKHNlc3Npb24uYWRkTWFya2VyKHJhbmdlLCBcInR5cGVzY3JpcHQtZXJyb3JcIiwgXCJ0ZXh0XCIsIHRydWUpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHdvcmtzcGFjZSAmJiB0eXBlb2YgX2ZpbGVOYW1lID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgd29ya3NwYWNlLmdldE91dHB1dEZpbGVzKF9maWxlTmFtZSwgZnVuY3Rpb24oZXJyLCBvdXRwdXRGaWxlcykge1xuICAgICAgICAgICAgICAgIHNlc3Npb24uX2VtaXQoXCJvdXRwdXRGaWxlc1wiLCB7IGRhdGE6IG91dHB1dEZpbGVzIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBlZGl0b3JXcmFwcGVyID0ge1xuICAgICAgICBjbGVhclNlbGVjdGlvbjogKCkgPT4geyBlZGl0b3IuY2xlYXJTZWxlY3Rpb24oKTsgfSxcbiAgICAgICAgZ2V0IGZpbGVOYW1lKCk6IHN0cmluZyB7IHJldHVybiBfZmlsZU5hbWU7IH0sXG4gICAgICAgIHNldCBmaWxlTmFtZSh2YWx1ZSkgeyBfZmlsZU5hbWUgPSB2YWx1ZTsgfSxcbiAgICAgICAgZ2V0IGNvbW1hbmRzKCkgeyByZXR1cm4gZWRpdG9yLmNvbW1hbmRzOyB9LFxuICAgICAgICBnZXQgY29udGFpbmVyKCkgeyByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IHNlc3Npb24oKSB7IHJldHVybiBlZGl0b3Iuc2Vzc2lvbjsgfSxcbiAgICAgICAgZ2V0Q3Vyc29yUG9zaXRpb246ICgpID0+IHsgcmV0dXJuIGVkaXRvci5nZXRDdXJzb3JQb3NpdGlvbigpOyB9LFxuICAgICAgICBnZXRTZWxlY3Rpb246ICgpID0+IHsgcmV0dXJuIGVkaXRvci5nZXRTZWxlY3Rpb24oKTsgfSxcbiAgICAgICAgZ2V0VmFsdWU6ICgpID0+IHsgcmV0dXJuIGVkaXRvci5nZXRWYWx1ZSgpOyB9LFxuICAgICAgICBnb3RvTGluZTogKGxpbmVOdW1iZXI6IG51bWJlciwgY29sdW1uOiBudW1iZXIsIGFuaW1hdGU/OiBib29sZWFuKSA9PiB7IHJldHVybiBlZGl0b3IuZ290b0xpbmUobGluZU51bWJlciwgY29sdW1uLCBhbmltYXRlKTsgfSxcbiAgICAgICAgZm9jdXM6ICgpID0+IHsgZWRpdG9yLmZvY3VzKCk7IH0sXG4gICAgICAgIGluZGVudDogKCkgPT4geyBlZGl0b3IuaW5kZW50KCk7IH0sXG4gICAgICAgIG1vdmVDdXJzb3JUbzogKHJvdzogbnVtYmVyLCBjb2x1bW46IG51bWJlciwgYW5pbWF0ZT86IGJvb2xlYW4pID0+IHsgcmV0dXJuIGVkaXRvci5tb3ZlQ3Vyc29yVG8ocm93LCBjb2x1bW4sIGFuaW1hdGUpOyB9LFxuICAgICAgICByZXNpemU6IChmb3JjZTogYm9vbGVhbikgPT4geyByZXR1cm4gZWRpdG9yLnJlc2l6ZShmb3JjZSk7IH0sXG4gICAgICAgIHNlbGVjdEFsbDogKCkgPT4geyBlZGl0b3Iuc2VsZWN0QWxsKCk7IH0sXG4gICAgICAgIHNldEF1dG9TY3JvbGxFZGl0b3JJbnRvVmlldzogKGVuYWJsZTogYm9vbGVhbikgPT4geyByZXR1cm4gZWRpdG9yLnNldEF1dG9TY3JvbGxFZGl0b3JJbnRvVmlldyhlbmFibGUpOyB9LFxuICAgICAgICBzZXRGb250U2l6ZTogKGZvbnRTaXplOiBzdHJpbmcpID0+IHsgcmV0dXJuIGVkaXRvci5zZXRGb250U2l6ZShmb250U2l6ZSk7IH0sXG4gICAgICAgIHNldE9wdGlvbjogKG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSkgPT4geyByZXR1cm4gZWRpdG9yLnNldE9wdGlvbihuYW1lLCB2YWx1ZSk7IH0sXG4gICAgICAgIHNldE9wdGlvbnM6IChvcHRpb25zOiBhbnkpID0+IHsgcmV0dXJuIGVkaXRvci5zZXRPcHRpb25zKG9wdGlvbnMpOyB9LFxuICAgICAgICBzZXRTaG93SW52aXNpYmxlczogKHNob3dJbnZpc2libGVzOiBib29sZWFuKSA9PiB7IHJldHVybiBlZGl0b3Iuc2V0U2hvd0ludmlzaWJsZXMoc2hvd0ludmlzaWJsZXMpOyB9LFxuICAgICAgICBzZXRUaGVtZTogKHRoZW1lOiBzdHJpbmcsIGNhbGxiYWNrPzogKCkgPT4gdm9pZCkgPT4geyByZXR1cm4gZWRpdG9yLnNldFRoZW1lKHRoZW1lLCBjYWxsYmFjayk7IH0sXG4gICAgICAgIHNldFZhbHVlOiAodmFsOiBzdHJpbmcsIGN1cnNvclBvcz86IG51bWJlcikgPT4geyByZXR1cm4gZWRpdG9yLnNldFZhbHVlKHZhbCwgY3Vyc29yUG9zKTsgfSxcbiAgICAgICAgZ2V0U2Vzc2lvbjogKCkgPT4geyByZXR1cm4gZWRpdG9yLmdldFNlc3Npb24oKTsgfSxcbiAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogKGV2ZW50TmFtZTogc3RyaW5nLCBjYWxsYmFjazogKCkgPT4gdm9pZCwgY2FwdHVyaW5nPzogYm9vbGVhbikgPT4geyByZXR1cm4gZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBjYWxsYmFjaywgY2FwdHVyaW5nKTsgfSxcbiAgICAgICAgZ2V0IG9uVGV4dElucHV0KCk6IGFueSB7IHJldHVybiBlZGl0b3Iub25UZXh0SW5wdXQ7IH0sXG4gICAgICAgIHNldCBvblRleHRJbnB1dCh2YWx1ZSkgeyBlZGl0b3Iub25UZXh0SW5wdXQgPSB2YWx1ZTsgfSxcblxuICAgICAgICBnZXREaXNwbGF5SW5kZW50R3VpZGVzOiAoKSA9PiB7IHJldHVybiBlZGl0b3IuZ2V0RGlzcGxheUluZGVudEd1aWRlcygpOyB9LFxuICAgICAgICBzZXREaXNwbGF5SW5kZW50R3VpZGVzOiAoZGlzcGxheUluZGVudEd1aWRlczogYm9vbGVhbikgPT4geyByZXR1cm4gZWRpdG9yLnNldERpc3BsYXlJbmRlbnRHdWlkZXMoZGlzcGxheUluZGVudEd1aWRlcyk7IH0sXG5cbiAgICAgICAgZ2V0U2hvd1ByaW50TWFyZ2luOiAoKSA9PiB7IHJldHVybiBlZGl0b3IuZ2V0U2hvd1ByaW50TWFyZ2luKCk7IH0sXG4gICAgICAgIHNldFNob3dQcmludE1hcmdpbjogKHNob3dQcmludE1hcmdpbjogYm9vbGVhbikgPT4geyByZXR1cm4gZWRpdG9yLnNldFNob3dQcmludE1hcmdpbihzaG93UHJpbnRNYXJnaW4pOyB9LFxuXG4gICAgICAgIGNoYW5nZUZpbGU6IGNoYW5nZUZpbGVcbiAgICB9O1xuXG4gICAgcmV0dXJuIGVkaXRvcldyYXBwZXI7XG59XG5cbi8vIFdlIGNhbid0IGV4cG9ydCB0aGlzIHlldCB1bnRpbCB3ZSBjYW4gY3JlYXRlIHRoZSBpbm5lciBlZGl0b3IgaW4gVHlwZVNjcmlwdC5cbmZ1bmN0aW9uIGVkaXQoc291cmNlOiBhbnksIHdvcmtzcGFjZTogd3NtLldvcmtzcGFjZSwgZG9jOiBEb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudCkge1xuXG4gICAgdmFyIHJvb3RFbGVtZW50ID0gKGZ1bmN0aW9uKCk6IEhUTUxFbGVtZW50IHtcbiAgICAgICAgaWYgKHR5cGVvZiBzb3VyY2UgPT09IFwic3RyaW5nXCIpIHtcblxuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2MuZ2V0RWxlbWVudEJ5SWQoc291cmNlKTtcbiAgICAgICAgICAgIGlmIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Ioc291cmNlICsgXCIgbXVzdCBiZSBhbiBlbGVtZW50IGlkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICAgICAgfVxuICAgIH0pKCk7XG5cbiAgICB2YXIgX2VkaXRvciA9IChmdW5jdGlvbihlbGVtZW50OiBIVE1MRWxlbWVudCk6IEVkaXRvciB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImVkaXQgaXMgY3VycmVudGx5IHVuc3VwcG9ydGVkXCIpO1xuICAgICAgICAvLyAgICByZXR1cm4gYmFzaWMuZWRpdChlbGVtZW50KTtcbiAgICB9KShyb290RWxlbWVudCk7XG5cbiAgICByZXR1cm4gd3JhcChfZWRpdG9yLCByb290RWxlbWVudCwgd29ya3NwYWNlLCBkb2MpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gd29ya3NwYWNlKCkge1xuICAgIHJldHVybiB3c20ud29ya3NwYWNlKCk7XG59XG4iXX0=