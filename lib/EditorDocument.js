import { EventEmitterClass } from './lib/event_emitter';
import Range from './Range';
import Anchor from './Anchor';
var $split = (function () {
    function foo(text) {
        return text.replace(/\r\n|\r/g, "\n").split("\n");
    }
    function bar(text) {
        return text.split(/\r\n|\r|\n/);
    }
    if ("aaa".split(/a/).length === 0) {
        return foo;
    }
    else {
        return bar;
    }
})();
function $clipPosition(doc, position) {
    var length = doc.getLength();
    if (position.row >= length) {
        position.row = Math.max(0, length - 1);
        position.column = doc.getLine(length - 1).length;
    }
    else if (position.row < 0) {
        position.row = 0;
    }
    return position;
}
export default class EditorDocument extends EventEmitterClass {
    constructor(text) {
        super();
        this.$lines = [];
        this.$autoNewLine = "";
        this.$newLineMode = "auto";
        if (text.length === 0) {
            this.$lines = [""];
        }
        else if (Array.isArray(text)) {
            this._insertLines(0, text);
        }
        else {
            this.insert({ row: 0, column: 0 }, text);
        }
    }
    setValue(text) {
        var len = this.getLength();
        this.remove(new Range(0, 0, len, this.getLine(len - 1).length));
        this.insert({ row: 0, column: 0 }, text);
    }
    getValue() {
        return this.getAllLines().join(this.getNewLineCharacter());
    }
    createAnchor(row, column) {
        return new Anchor(this, row, column);
    }
    $detectNewLine(text) {
        var match = text.match(/^.*?(\r\n|\r|\n)/m);
        this.$autoNewLine = match ? match[1] : "\n";
        this._signal("changeNewLineMode");
    }
    getNewLineCharacter() {
        switch (this.$newLineMode) {
            case "windows":
                return "\r\n";
            case "unix":
                return "\n";
            default:
                return this.$autoNewLine || "\n";
        }
    }
    setNewLineMode(newLineMode) {
        if (this.$newLineMode === newLineMode)
            return;
        this.$newLineMode = newLineMode;
        this._signal("changeNewLineMode");
    }
    getNewLineMode() {
        return this.$newLineMode;
    }
    isNewLine(text) {
        return (text == "\r\n" || text == "\r" || text == "\n");
    }
    getLine(row) {
        return this.$lines[row] || "";
    }
    getLines(firstRow, lastRow) {
        return this.$lines.slice(firstRow, lastRow + 1);
    }
    getAllLines() {
        return this.getLines(0, this.getLength());
    }
    getLength() {
        return this.$lines.length;
    }
    getTextRange(range) {
        if (range.start.row == range.end.row) {
            return this.getLine(range.start.row).substring(range.start.column, range.end.column);
        }
        var lines = this.getLines(range.start.row, range.end.row);
        lines[0] = (lines[0] || "").substring(range.start.column);
        var l = lines.length - 1;
        if (range.end.row - range.start.row == l) {
            lines[l] = lines[l].substring(0, range.end.column);
        }
        return lines.join(this.getNewLineCharacter());
    }
    insert(position, text) {
        if (!text || text.length === 0)
            return position;
        position = $clipPosition(this, position);
        if (this.getLength() <= 1) {
            this.$detectNewLine(text);
        }
        var lines = $split(text);
        var firstLine = lines.splice(0, 1)[0];
        var lastLine = lines.length == 0 ? null : lines.splice(lines.length - 1, 1)[0];
        position = this.insertInLine(position, firstLine);
        if (lastLine !== null) {
            position = this.insertNewLine(position);
            position = this._insertLines(position.row, lines);
            position = this.insertInLine(position, lastLine || "");
        }
        return position;
    }
    insertLines(row, lines) {
        if (row >= this.getLength())
            return this.insert({ row: row, column: 0 }, "\n" + lines.join("\n"));
        return this._insertLines(Math.max(row, 0), lines);
    }
    _insertLines(row, lines) {
        if (lines.length == 0)
            return { row: row, column: 0 };
        while (lines.length > 0xF000) {
            var end = this._insertLines(row, lines.slice(0, 0xF000));
            lines = lines.slice(0xF000);
            row = end.row;
        }
        var args = [row, 0];
        args.push.apply(args, lines);
        this.$lines.splice.apply(this.$lines, args);
        var range = new Range(row, 0, row + lines.length, 0);
        var delta = {
            action: "insertLines",
            range: range,
            lines: lines
        };
        this._signal("change", { data: delta });
        return range.end;
    }
    insertNewLine(position) {
        position = $clipPosition(this, position);
        var line = this.$lines[position.row] || "";
        this.$lines[position.row] = line.substring(0, position.column);
        this.$lines.splice(position.row + 1, 0, line.substring(position.column, line.length));
        var end = {
            row: position.row + 1,
            column: 0
        };
        var delta = {
            action: "insertText",
            range: Range.fromPoints(position, end),
            text: this.getNewLineCharacter()
        };
        this._signal("change", { data: delta });
        return end;
    }
    insertInLine(position, text) {
        if (text.length == 0)
            return position;
        var line = this.$lines[position.row] || "";
        this.$lines[position.row] = line.substring(0, position.column) + text + line.substring(position.column);
        var end = {
            row: position.row,
            column: position.column + text.length
        };
        var delta = { action: "insertText", range: Range.fromPoints(position, end), text: text };
        this._signal("change", { data: delta });
        return end;
    }
    remove(range) {
        if (!(range instanceof Range))
            range = Range.fromPoints(range.start, range.end);
        range.start = $clipPosition(this, range.start);
        range.end = $clipPosition(this, range.end);
        if (range.isEmpty())
            return range.start;
        var firstRow = range.start.row;
        var lastRow = range.end.row;
        if (range.isMultiLine()) {
            var firstFullRow = range.start.column == 0 ? firstRow : firstRow + 1;
            var lastFullRow = lastRow - 1;
            if (range.end.column > 0)
                this.removeInLine(lastRow, 0, range.end.column);
            if (lastFullRow >= firstFullRow)
                this._removeLines(firstFullRow, lastFullRow);
            if (firstFullRow != firstRow) {
                this.removeInLine(firstRow, range.start.column, this.getLine(firstRow).length);
                this.removeNewLine(range.start.row);
            }
        }
        else {
            this.removeInLine(firstRow, range.start.column, range.end.column);
        }
        return range.start;
    }
    removeInLine(row, startColumn, endColumn) {
        if (startColumn === endColumn)
            return;
        var range = new Range(row, startColumn, row, endColumn);
        var line = this.getLine(row);
        var removed = line.substring(startColumn, endColumn);
        var newLine = line.substring(0, startColumn) + line.substring(endColumn, line.length);
        this.$lines.splice(row, 1, newLine);
        var delta = {
            action: "removeText",
            range: range,
            text: removed
        };
        this._signal("change", { data: delta });
        return range.start;
    }
    removeLines(firstRow, lastRow) {
        if (firstRow < 0 || lastRow >= this.getLength())
            return this.remove(new Range(firstRow, 0, lastRow + 1, 0));
        return this._removeLines(firstRow, lastRow);
    }
    _removeLines(firstRow, lastRow) {
        var range = new Range(firstRow, 0, lastRow + 1, 0);
        var removed = this.$lines.splice(firstRow, lastRow - firstRow + 1);
        var delta = {
            action: "removeLines",
            range: range,
            nl: this.getNewLineCharacter(),
            lines: removed
        };
        this._signal("change", { data: delta });
        return removed;
    }
    removeNewLine(row) {
        var firstLine = this.getLine(row);
        var secondLine = this.getLine(row + 1);
        var range = new Range(row, firstLine.length, row + 1, 0);
        var line = firstLine + secondLine;
        this.$lines.splice(row, 2, line);
        var delta = {
            action: "removeText",
            range: range,
            text: this.getNewLineCharacter()
        };
        this._signal("change", { data: delta });
    }
    replace(range, text) {
        if (text.length == 0 && range.isEmpty())
            return range.start;
        if (text == this.getTextRange(range))
            return range.end;
        this.remove(range);
        if (text) {
            var end = this.insert(range.start, text);
        }
        else {
            end = range.start;
        }
        return end;
    }
    applyDeltas(deltas) {
        for (var i = 0; i < deltas.length; i++) {
            var delta = deltas[i];
            var range = Range.fromPoints(delta.range.start, delta.range.end);
            if (delta.action == "insertLines")
                this.insertLines(range.start.row, delta.lines);
            else if (delta.action == "insertText")
                this.insert(range.start, delta.text);
            else if (delta.action == "removeLines")
                this._removeLines(range.start.row, range.end.row - 1);
            else if (delta.action == "removeText")
                this.remove(range);
        }
    }
    revertDeltas(deltas) {
        for (var i = deltas.length - 1; i >= 0; i--) {
            var delta = deltas[i];
            var range = Range.fromPoints(delta.range.start, delta.range.end);
            if (delta.action == "insertLines")
                this._removeLines(range.start.row, range.end.row - 1);
            else if (delta.action == "insertText")
                this.remove(range);
            else if (delta.action == "removeLines")
                this._insertLines(range.start.row, delta.lines);
            else if (delta.action == "removeText")
                this.insert(range.start, delta.text);
        }
    }
    indexToPosition(index, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        for (var i = startRow || 0, l = lines.length; i < l; i++) {
            index -= lines[i].length + newlineLength;
            if (index < 0)
                return { row: i, column: index + lines[i].length + newlineLength };
        }
        return { row: l - 1, column: lines[l - 1].length };
    }
    positionToIndex(pos, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        var index = 0;
        var row = Math.min(pos.row, lines.length);
        for (var i = startRow || 0; i < row; ++i)
            index += lines[i].length + newlineLength;
        return index + pos.column;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWRpdG9yRG9jdW1lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvRWRpdG9yRG9jdW1lbnQudHMiXSwibmFtZXMiOlsiZm9vIiwiYmFyIiwiJGNsaXBQb3NpdGlvbiIsIkVkaXRvckRvY3VtZW50IiwiRWRpdG9yRG9jdW1lbnQuY29uc3RydWN0b3IiLCJFZGl0b3JEb2N1bWVudC5zZXRWYWx1ZSIsIkVkaXRvckRvY3VtZW50LmdldFZhbHVlIiwiRWRpdG9yRG9jdW1lbnQuY3JlYXRlQW5jaG9yIiwiRWRpdG9yRG9jdW1lbnQuJGRldGVjdE5ld0xpbmUiLCJFZGl0b3JEb2N1bWVudC5nZXROZXdMaW5lQ2hhcmFjdGVyIiwiRWRpdG9yRG9jdW1lbnQuc2V0TmV3TGluZU1vZGUiLCJFZGl0b3JEb2N1bWVudC5nZXROZXdMaW5lTW9kZSIsIkVkaXRvckRvY3VtZW50LmlzTmV3TGluZSIsIkVkaXRvckRvY3VtZW50LmdldExpbmUiLCJFZGl0b3JEb2N1bWVudC5nZXRMaW5lcyIsIkVkaXRvckRvY3VtZW50LmdldEFsbExpbmVzIiwiRWRpdG9yRG9jdW1lbnQuZ2V0TGVuZ3RoIiwiRWRpdG9yRG9jdW1lbnQuZ2V0VGV4dFJhbmdlIiwiRWRpdG9yRG9jdW1lbnQuaW5zZXJ0IiwiRWRpdG9yRG9jdW1lbnQuaW5zZXJ0TGluZXMiLCJFZGl0b3JEb2N1bWVudC5faW5zZXJ0TGluZXMiLCJFZGl0b3JEb2N1bWVudC5pbnNlcnROZXdMaW5lIiwiRWRpdG9yRG9jdW1lbnQuaW5zZXJ0SW5MaW5lIiwiRWRpdG9yRG9jdW1lbnQucmVtb3ZlIiwiRWRpdG9yRG9jdW1lbnQucmVtb3ZlSW5MaW5lIiwiRWRpdG9yRG9jdW1lbnQucmVtb3ZlTGluZXMiLCJFZGl0b3JEb2N1bWVudC5fcmVtb3ZlTGluZXMiLCJFZGl0b3JEb2N1bWVudC5yZW1vdmVOZXdMaW5lIiwiRWRpdG9yRG9jdW1lbnQucmVwbGFjZSIsIkVkaXRvckRvY3VtZW50LmFwcGx5RGVsdGFzIiwiRWRpdG9yRG9jdW1lbnQucmV2ZXJ0RGVsdGFzIiwiRWRpdG9yRG9jdW1lbnQuaW5kZXhUb1Bvc2l0aW9uIiwiRWRpdG9yRG9jdW1lbnQucG9zaXRpb25Ub0luZGV4Il0sIm1hcHBpbmdzIjoiT0E4Qk8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQjtPQUNoRCxLQUFLLE1BQU0sU0FBUztPQUNwQixNQUFNLE1BQU0sVUFBVTtBQUU3QixJQUFJLE1BQU0sR0FBK0IsQ0FBQztJQUN0QyxhQUFhLElBQVk7UUFDckJBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO0lBQ3REQSxDQUFDQTtJQUNELGFBQWEsSUFBWTtRQUNyQkMsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0E7SUFDcENBLENBQUNBO0lBQ0QsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoQyxNQUFNLENBQUMsR0FBRyxDQUFDO0lBQ2YsQ0FBQztJQUNELElBQUksQ0FBQyxDQUFDO1FBQ0YsTUFBTSxDQUFDLEdBQUcsQ0FBQztJQUNmLENBQUM7QUFDTCxDQUFDLENBQUMsRUFBRSxDQUFDO0FBRUwsdUJBQXVCLEdBQW1CLEVBQUUsUUFBeUM7SUFDakZDLElBQUlBLE1BQU1BLEdBQUdBLEdBQUdBLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBO0lBQzdCQSxFQUFFQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxJQUFJQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6QkEsUUFBUUEsQ0FBQ0EsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdkNBLFFBQVFB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QSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN2Q0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDdkRBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLG1CQUFtQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7SUFDbERBLENBQUNBO0lBU0RkLE1BQU1BLENBQUNBLFFBQXlDQSxFQUFFQSxJQUFZQTtRQUMxRGUsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFDM0JBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBO1FBRXBCQSxRQUFRQSxHQUFHQSxhQUFhQSxDQUFDQSxJQUFJQSxFQUFFQSxRQUFRQSxDQUFDQSxDQUFDQTtRQUd6Q0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDeEJBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQzlCQSxDQUFDQTtRQUVEQSxJQUFJQSxLQUFLQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUN6QkEsSUFBSUEsU0FBU0EsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdENBLElBQUlBLFFBQVFBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLElBQUlBLENBQUNBLEdBQUdBLElBQUlBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRS9FQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxRQUFRQSxFQUFFQSxTQUFTQSxDQUFDQSxDQUFDQTtRQUNsREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsUUFBUUEsS0FBS0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDcEJBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO1lBQ3hDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtZQUNsREEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsUUFBUUEsRUFBRUEsUUFBUUEsSUFBSUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDM0RBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBO0lBQ3BCQSxDQUFDQTtJQXVDRGYsV0FBV0EsQ0FBQ0EsR0FBV0EsRUFBRUEsS0FBZUE7UUFDcENnQixFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxJQUFJQSxDQUFDQSxTQUFTQSxFQUFFQSxDQUFDQTtZQUN4QkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0EsRUFBRUEsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsSUFBSUEsR0FBR0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDekVBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO0lBQ3REQSxDQUFDQTtJQUVPaEIsWUFBWUEsQ0FBQ0EsR0FBV0EsRUFBRUEsS0FBZUE7UUFDN0NpQixFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNsQkEsTUFBTUEsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0EsRUFBRUEsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7UUFJbkNBLE9BQU9BLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLE1BQU1BLEVBQUVBLENBQUNBO1lBQzNCQSxJQUFJQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxHQUFHQSxFQUFFQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxFQUFFQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN6REEsS0FBS0EsR0FBR0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDNUJBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBO1FBQ2xCQSxDQUFDQTtRQUVEQSxJQUFJQSxJQUFJQSxHQUFHQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNwQkEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFDN0JBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1FBRTVDQSxJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNyREEsSUFBSUEsS0FBS0EsR0FBR0E7WUFDUkEsTUFBTUEsRUFBRUEsYUFBYUE7WUFDckJBLEtBQUtBLEVBQUVBLEtBQUtBO1lBQ1pBLEtBQUtBLEVBQUVBLEtBQUtBO1NBQ2ZBLENBQUNBO1FBQ0ZBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFFBQVFBLEVBQUVBLEVBQUVBLElBQUlBLEVBQUVBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBO1FBQ3hDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQTtJQUNyQkEsQ0FBQ0E7SUFXRGpCLGFBQWFBLENBQUNBLFFBQXlDQTtRQUNuRGtCLFFBQVFBLEdBQUdBLGFBQWFBLENBQUNBLElBQUlBLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO1FBQ3pDQSxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQTtRQUUzQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsUUFBUUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDL0RBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1FBRXRGQSxJQUFJQSxHQUFHQSxHQUFHQTtZQUNOQSxHQUFHQSxFQUFFQSxRQUFRQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtZQUNyQkEsTUFBTUEsRUFBRUEsQ0FBQ0E7U0FDWkEsQ0FBQ0E7UUFFRkEsSUFBSUEsS0FBS0EsR0FBR0E7WUFDUkEsTUFBTUEsRUFBRUEsWUFBWUE7WUFDcEJBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLFVBQVVBLENBQUNBLFFBQVFBLEVBQUVBLEdBQUdBLENBQUNBO1lBQ3RDQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEVB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Q0E7Z0JBQ25DQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMxREEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsWUFBWUEsQ0FBQ0E7Z0JBQ2xDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFLRDFCLFlBQVlBLENBQUNBLE1BQU1BO1FBQ2YyQixHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUMxQ0EsSUFBSUEsS0FBS0EsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFFdEJBLElBQUlBLEtBQUtBLEdBQUdBLEtBQUtBLENBQUNBLFVBQVVBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBRWpFQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxhQUFhQSxDQUFDQTtnQkFDOUJBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1lBQzFEQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxZQUFZQSxDQUFDQTtnQkFDbENBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1lBQ3ZCQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxhQUFhQSxDQUFDQTtnQkFDbkNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1lBQ3BEQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxZQUFZQSxDQUFDQTtnQkFDbENBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQzdDQSxDQUFDQTtJQUNMQSxDQUFDQTtJQWtCRDNCLGVBQWVBLENBQUNBLEtBQWFBLEVBQUVBLFFBQWdCQTtRQUMzQzRCLElBQUlBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLElBQUlBLElBQUlBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBO1FBQzlDQSxJQUFJQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEVBQUVBLENBQUNBLE1BQU1BLENBQUNBO1FBQ3REQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxRQUFRQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUN2REEsS0FBS0EsSUFBSUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsYUFBYUEsQ0FBQ0E7WUFDekNBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBO2dCQUNWQSxNQUFNQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxDQUFDQSxFQUFFQSxNQUFNQSxFQUFFQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxHQUFHQSxhQUFhQSxFQUFFQSxDQUFDQTtRQUMzRUEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsTUFBTUEsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7SUFDdkRBLENBQUNBO0lBa0JENUIsZUFBZUEsQ0FBQ0EsR0FBR0EsRUFBRUEsUUFBUUE7UUFDekI2QixJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxJQUFJQSxJQUFJQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQTtRQUM5Q0EsSUFBSUEsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUN0REEsSUFBSUEsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDZEEsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsRUFBRUEsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDMUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLFFBQVFBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ3BDQSxLQUFLQSxJQUFJQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxHQUFHQSxhQUFhQSxDQUFDQTtRQUU3Q0EsTUFBTUEsQ0FBQ0EsS0FBS0EsR0FBR0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7SUFDOUJBLENBQUNBO0FBQ0w3QixDQUFDQTtBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMCwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIFxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0XG4gKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDpcbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuXG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZVxuICogICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cbiAqICAgICAqIE5laXRoZXIgdGhlIG5hbWUgb2YgQWpheC5vcmcgQi5WLiBub3IgdGhlXG4gKiAgICAgICBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0c1xuICogICAgICAgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXG4gKiBcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiIEFORFxuICogQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRURcbiAqIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkVcbiAqIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIEFKQVguT1JHIEIuVi4gQkUgTElBQkxFIEZPUiBBTllcbiAqIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTXG4gKiAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7XG4gKiBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkRcbiAqIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUXG4gKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJU1xuICogU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG4gKlxuICogKioqKiogRU5EIExJQ0VOU0UgQkxPQ0sgKioqKiogKi9cblxuaW1wb3J0IHsgRXZlbnRFbWl0dGVyQ2xhc3MgfSBmcm9tICcuL2xpYi9ldmVudF9lbWl0dGVyJztcbmltcG9ydCBSYW5nZSBmcm9tICcuL1JhbmdlJztcbmltcG9ydCBBbmNob3IgZnJvbSAnLi9BbmNob3InO1xuXG52YXIgJHNwbGl0OiAodGV4dDogc3RyaW5nKSA9PiBzdHJpbmdbXSA9IChmdW5jdGlvbigpIHtcbiAgICBmdW5jdGlvbiBmb28odGV4dDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9cXHJcXG58XFxyL2csIFwiXFxuXCIpLnNwbGl0KFwiXFxuXCIpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBiYXIodGV4dDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGV4dC5zcGxpdCgvXFxyXFxufFxccnxcXG4vKTtcbiAgICB9XG4gICAgaWYgKFwiYWFhXCIuc3BsaXQoL2EvKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGZvbztcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBiYXI7XG4gICAgfVxufSkoKTtcblxuZnVuY3Rpb24gJGNsaXBQb3NpdGlvbihkb2M6IEVkaXRvckRvY3VtZW50LCBwb3NpdGlvbjogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfSkge1xuICAgIHZhciBsZW5ndGggPSBkb2MuZ2V0TGVuZ3RoKCk7XG4gICAgaWYgKHBvc2l0aW9uLnJvdyA+PSBsZW5ndGgpIHtcbiAgICAgICAgcG9zaXRpb24ucm93ID0gTWF0aC5tYXgoMCwgbGVuZ3RoIC0gMSk7XG4gICAgICAgIHBvc2l0aW9uLmNvbHVtbiA9IGRvYy5nZXRMaW5lKGxlbmd0aCAtIDEpLmxlbmd0aDtcbiAgICB9IGVsc2UgaWYgKHBvc2l0aW9uLnJvdyA8IDApIHtcbiAgICAgICAgcG9zaXRpb24ucm93ID0gMDtcbiAgICB9XG4gICAgcmV0dXJuIHBvc2l0aW9uO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFZGl0b3JEb2N1bWVudCBleHRlbmRzIEV2ZW50RW1pdHRlckNsYXNzIHtcbiAgICBwcml2YXRlICRsaW5lczogc3RyaW5nW10gPSBbXTtcbiAgICBwcml2YXRlICRhdXRvTmV3TGluZTogc3RyaW5nID0gXCJcIjtcbiAgICBwcml2YXRlICRuZXdMaW5lTW9kZTogc3RyaW5nID0gXCJhdXRvXCI7XG4gICAgY29uc3RydWN0b3IodGV4dDogc3RyaW5nIHwgQXJyYXk8c3RyaW5nPikge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIC8vIFRoZXJlIGhhcyB0byBiZSBvbmUgbGluZSBhdCBsZWFzdCBpbiB0aGUgZG9jdW1lbnQuIElmIHlvdSBwYXNzIGFuIGVtcHR5XG4gICAgICAgIC8vIHN0cmluZyB0byB0aGUgaW5zZXJ0IGZ1bmN0aW9uLCBub3RoaW5nIHdpbGwgaGFwcGVuLiBXb3JrYXJvdW5kLlxuICAgICAgICBpZiAodGV4dC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuJGxpbmVzID0gW1wiXCJdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodGV4dCkpIHtcbiAgICAgICAgICAgIHRoaXMuX2luc2VydExpbmVzKDAsIHRleHQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbnNlcnQoeyByb3c6IDAsIGNvbHVtbjogMCB9LCB0ZXh0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlcGxhY2VzIGFsbCB0aGUgbGluZXMgaW4gdGhlIGN1cnJlbnQgYEVkaXRvckRvY3VtZW50YCB3aXRoIHRoZSB2YWx1ZSBvZiBgdGV4dGAuXG4gICAgICogQG1ldGhvZCBzZXRWYWx1ZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IFRoZSB0ZXh0IHRvIHVzZVxuICAgICAqIEByZXR1cm4ge3ZvaWR9XG4gICAgICovXG4gICAgc2V0VmFsdWUodGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHZhciBsZW4gPSB0aGlzLmdldExlbmd0aCgpO1xuICAgICAgICB0aGlzLnJlbW92ZShuZXcgUmFuZ2UoMCwgMCwgbGVuLCB0aGlzLmdldExpbmUobGVuIC0gMSkubGVuZ3RoKSk7XG4gICAgICAgIHRoaXMuaW5zZXJ0KHsgcm93OiAwLCBjb2x1bW46IDAgfSwgdGV4dCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbGwgdGhlIGxpbmVzIGluIHRoZSBkb2N1bWVudCBhcyBhIHNpbmdsZSBzdHJpbmcsIGpvaW5lZCBieSB0aGUgbmV3IGxpbmUgY2hhcmFjdGVyLlxuICAgICAqIEBtZXRob2QgZ2V0VmFsdWVcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICovXG4gICAgZ2V0VmFsdWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsTGluZXMoKS5qb2luKHRoaXMuZ2V0TmV3TGluZUNoYXJhY3RlcigpKTtcbiAgICB9XG5cbiAgICAvKiogXG4gICAgICogQ3JlYXRlcyBhIG5ldyBgQW5jaG9yYCB0byBkZWZpbmUgYSBmbG9hdGluZyBwb2ludCBpbiB0aGUgZG9jdW1lbnQuXG4gICAgICogQG1ldGhvZCBjcmVhdGVBbmNob3JcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gcm93IFRoZSByb3cgbnVtYmVyIHRvIHVzZVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBjb2x1bW4gVGhlIGNvbHVtbiBudW1iZXIgdG8gdXNlXG4gICAgICogQHJldHVybiB7QW5jaG9yfVxuICAgICAqXG4gICAgICovXG4gICAgY3JlYXRlQW5jaG9yKHJvdzogbnVtYmVyLCBjb2x1bW46IG51bWJlcik6IEFuY2hvciB7XG4gICAgICAgIHJldHVybiBuZXcgQW5jaG9yKHRoaXMsIHJvdywgY29sdW1uKTtcbiAgICB9XG5cbiAgICAvKiogXG4gICAgICogU3BsaXRzIGEgc3RyaW5nIG9mIHRleHQgb24gYW55IG5ld2xpbmUgKGBcXG5gKSBvciBjYXJyaWFnZS1yZXR1cm4gKCdcXHInKSBjaGFyYWN0ZXJzLlxuICAgICAqXG4gICAgICogQG1ldGhvZCAkc3BsaXRcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdGV4dCBUaGUgdGV4dCB0byB3b3JrIHdpdGhcbiAgICAgKi9cbiAgICAkZGV0ZWN0TmV3TGluZSh0ZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdmFyIG1hdGNoID0gdGV4dC5tYXRjaCgvXi4qPyhcXHJcXG58XFxyfFxcbikvbSk7XG4gICAgICAgIHRoaXMuJGF1dG9OZXdMaW5lID0gbWF0Y2ggPyBtYXRjaFsxXSA6IFwiXFxuXCI7XG4gICAgICAgIHRoaXMuX3NpZ25hbChcImNoYW5nZU5ld0xpbmVNb2RlXCIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogUmV0dXJucyB0aGUgbmV3bGluZSBjaGFyYWN0ZXIgdGhhdCdzIGJlaW5nIHVzZWQsIGRlcGVuZGluZyBvbiB0aGUgdmFsdWUgb2YgYG5ld0xpbmVNb2RlYC4gXG4gICAgKiBAbWV0aG9kIGdldE5ld0xpbmVDaGFyYWN0ZXJcbiAgICAqIEByZXR1cm5zIHtTdHJpbmd9XG4gICAgKiAgSWYgYG5ld0xpbmVNb2RlID09IHdpbmRvd3NgLCBgXFxyXFxuYCBpcyByZXR1cm5lZC4gIFxuICAgICogIElmIGBuZXdMaW5lTW9kZSA9PSB1bml4YCwgYFxcbmAgaXMgcmV0dXJuZWQuICBcbiAgICAqICBJZiBgbmV3TGluZU1vZGUgPT0gYXV0b2AsIHRoZSB2YWx1ZSBvZiBgYXV0b05ld0xpbmVgIGlzIHJldHVybmVkLlxuICAgICpcbiAgICAqKi9cbiAgICBnZXROZXdMaW5lQ2hhcmFjdGVyKCk6IHN0cmluZyB7XG4gICAgICAgIHN3aXRjaCAodGhpcy4kbmV3TGluZU1vZGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJ3aW5kb3dzXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiXFxyXFxuXCI7XG4gICAgICAgICAgICBjYXNlIFwidW5peFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIlxcblwiO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kYXV0b05ld0xpbmUgfHwgXCJcXG5cIjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIG5ldyBsaW5lIG1vZGUuXG4gICAgICogQG1ldGhvZCBzZXROZXdMaW5lTW9kZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuZXdMaW5lTW9kZSBbVGhlIG5ld2xpbmUgbW9kZSB0byB1c2U7IGNhbiBiZSBlaXRoZXIgYHdpbmRvd3NgLCBgdW5peGAsIG9yIGBhdXRvYF17OiAjRWRpdG9yRG9jdW1lbnQuc2V0TmV3TGluZU1vZGUucGFyYW19XG4gICAgICogQHJldHVybiB7dm9pZH1cbiAgICAgKi9cbiAgICBzZXROZXdMaW5lTW9kZShuZXdMaW5lTW9kZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLiRuZXdMaW5lTW9kZSA9PT0gbmV3TGluZU1vZGUpXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgdGhpcy4kbmV3TGluZU1vZGUgPSBuZXdMaW5lTW9kZTtcbiAgICAgICAgdGhpcy5fc2lnbmFsKFwiY2hhbmdlTmV3TGluZU1vZGVcIik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdHlwZSBvZiBuZXdsaW5lcyBiZWluZyB1c2VkOyBlaXRoZXIgYHdpbmRvd3NgLCBgdW5peGAsIG9yIGBhdXRvYFxuICAgICAqIEBtZXRob2QgZ2V0TmV3TGluZU1vZGVcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICovXG4gICAgZ2V0TmV3TGluZU1vZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRuZXdMaW5lTW9kZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGB0cnVlYCBpZiBgdGV4dGAgaXMgYSBuZXdsaW5lIGNoYXJhY3RlciAoZWl0aGVyIGBcXHJcXG5gLCBgXFxyYCwgb3IgYFxcbmApLlxuICAgICAqIEBtZXRob2QgaXNOZXdMaW5lXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQgVGhlIHRleHQgdG8gY2hlY2tcbiAgICAgKiBAcmV0dXJuIHtib29sZWFufVxuICAgICAqL1xuICAgIGlzTmV3TGluZSh0ZXh0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICh0ZXh0ID09IFwiXFxyXFxuXCIgfHwgdGV4dCA9PSBcIlxcclwiIHx8IHRleHQgPT0gXCJcXG5cIik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHZlcmJhdGltIGNvcHkgb2YgdGhlIGdpdmVuIGxpbmUgYXMgaXQgaXMgaW4gdGhlIGRvY3VtZW50XG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHJvdyBUaGUgcm93IGluZGV4IHRvIHJldHJpZXZlXG4gICAgICogQHJldHVybiB7c3RyaW5nfVxuICAgICAqL1xuICAgIGdldExpbmUocm93OiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy4kbGluZXNbcm93XSB8fCBcIlwiO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogUmV0dXJucyBhbiBhcnJheSBvZiBzdHJpbmdzIG9mIHRoZSByb3dzIGJldHdlZW4gYGZpcnN0Um93YCBhbmQgYGxhc3RSb3dgLiBUaGlzIGZ1bmN0aW9uIGlzIGluY2x1c2l2ZSBvZiBgbGFzdFJvd2AuXG4gICAgKiBAcGFyYW0ge051bWJlcn0gZmlyc3RSb3cgVGhlIGZpcnN0IHJvdyBpbmRleCB0byByZXRyaWV2ZVxuICAgICogQHBhcmFtIHtOdW1iZXJ9IGxhc3RSb3cgVGhlIGZpbmFsIHJvdyBpbmRleCB0byByZXRyaWV2ZVxuICAgICpcbiAgICAqKi9cbiAgICBnZXRMaW5lcyhmaXJzdFJvdz86IG51bWJlciwgbGFzdFJvdz86IG51bWJlcik6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGxpbmVzLnNsaWNlKGZpcnN0Um93LCBsYXN0Um93ICsgMSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBSZXR1cm5zIGFsbCBsaW5lcyBpbiB0aGUgZG9jdW1lbnQgYXMgc3RyaW5nIGFycmF5LlxuICAgICoqL1xuICAgIGdldEFsbExpbmVzKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TGluZXMoMCwgdGhpcy5nZXRMZW5ndGgoKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygcm93cyBpbiB0aGUgZG9jdW1lbnQuXG4gICAgKiovXG4gICAgZ2V0TGVuZ3RoKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLiRsaW5lcy5sZW5ndGg7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2l2ZW4gYSByYW5nZSB3aXRoaW4gdGhlIGRvY3VtZW50LCByZXR1cm5zIGFsbCB0aGUgdGV4dCB3aXRoaW4gdGhhdCByYW5nZSBhcyBhIHNpbmdsZSBzdHJpbmcuXG4gICAgICogQHBhcmFtIHtSYW5nZX0gcmFuZ2UgVGhlIHJhbmdlIHRvIHdvcmsgd2l0aFxuICAgICAqXG4gICAgICovXG4gICAgZ2V0VGV4dFJhbmdlKHJhbmdlOiBSYW5nZSk6IHN0cmluZyB7XG4gICAgICAgIGlmIChyYW5nZS5zdGFydC5yb3cgPT0gcmFuZ2UuZW5kLnJvdykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TGluZShyYW5nZS5zdGFydC5yb3cpLnN1YnN0cmluZyhyYW5nZS5zdGFydC5jb2x1bW4sIHJhbmdlLmVuZC5jb2x1bW4pO1xuICAgICAgICB9XG4gICAgICAgIHZhciBsaW5lcyA9IHRoaXMuZ2V0TGluZXMocmFuZ2Uuc3RhcnQucm93LCByYW5nZS5lbmQucm93KTtcbiAgICAgICAgbGluZXNbMF0gPSAobGluZXNbMF0gfHwgXCJcIikuc3Vic3RyaW5nKHJhbmdlLnN0YXJ0LmNvbHVtbik7XG4gICAgICAgIHZhciBsID0gbGluZXMubGVuZ3RoIC0gMTtcbiAgICAgICAgaWYgKHJhbmdlLmVuZC5yb3cgLSByYW5nZS5zdGFydC5yb3cgPT0gbCkge1xuICAgICAgICAgICAgbGluZXNbbF0gPSBsaW5lc1tsXS5zdWJzdHJpbmcoMCwgcmFuZ2UuZW5kLmNvbHVtbik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxpbmVzLmpvaW4odGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogSW5zZXJ0cyBhIGJsb2NrIG9mIGB0ZXh0YCBhdCB0aGUgaW5kaWNhdGVkIGBwb3NpdGlvbmAuXG4gICAgKiBAcGFyYW0ge09iamVjdH0gcG9zaXRpb24gVGhlIHBvc2l0aW9uIHRvIHN0YXJ0IGluc2VydGluZyBhdDsgaXQncyBhbiBvYmplY3QgdGhhdCBsb29rcyBsaWtlIGB7IHJvdzogcm93LCBjb2x1bW46IGNvbHVtbn1gXG4gICAgKiBAcGFyYW0ge3N0cmluZ30gdGV4dCBBIGNodW5rIG9mIHRleHQgdG8gaW5zZXJ0XG4gICAgKiBAcmV0dXJucyB7T2JqZWN0fSBUaGUgcG9zaXRpb24gKHtyb3csIGNvbHVtbn0pIG9mIHRoZSBsYXN0IGxpbmUgb2YgYHRleHRgLiBJZiB0aGUgbGVuZ3RoIG9mIGB0ZXh0YCBpcyAwLCB0aGlzIGZ1bmN0aW9uIHNpbXBseSByZXR1cm5zIGBwb3NpdGlvbmAuIFxuICAgICpcbiAgICAqKi9cbiAgICBpbnNlcnQocG9zaXRpb246IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0sIHRleHQ6IHN0cmluZykge1xuICAgICAgICBpZiAoIXRleHQgfHwgdGV4dC5sZW5ndGggPT09IDApXG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb247XG5cbiAgICAgICAgcG9zaXRpb24gPSAkY2xpcFBvc2l0aW9uKHRoaXMsIHBvc2l0aW9uKTtcblxuICAgICAgICAvLyBvbmx5IGRldGVjdCBuZXcgbGluZXMgaWYgdGhlIGRvY3VtZW50IGhhcyBubyBsaW5lIGJyZWFrIHlldFxuICAgICAgICBpZiAodGhpcy5nZXRMZW5ndGgoKSA8PSAxKSB7XG4gICAgICAgICAgICB0aGlzLiRkZXRlY3ROZXdMaW5lKHRleHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGxpbmVzID0gJHNwbGl0KHRleHQpO1xuICAgICAgICB2YXIgZmlyc3RMaW5lID0gbGluZXMuc3BsaWNlKDAsIDEpWzBdO1xuICAgICAgICB2YXIgbGFzdExpbmUgPSBsaW5lcy5sZW5ndGggPT0gMCA/IG51bGwgOiBsaW5lcy5zcGxpY2UobGluZXMubGVuZ3RoIC0gMSwgMSlbMF07XG5cbiAgICAgICAgcG9zaXRpb24gPSB0aGlzLmluc2VydEluTGluZShwb3NpdGlvbiwgZmlyc3RMaW5lKTtcbiAgICAgICAgaWYgKGxhc3RMaW5lICE9PSBudWxsKSB7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IHRoaXMuaW5zZXJ0TmV3TGluZShwb3NpdGlvbik7IC8vIHRlcm1pbmF0ZSBmaXJzdCBsaW5lXG4gICAgICAgICAgICBwb3NpdGlvbiA9IHRoaXMuX2luc2VydExpbmVzKHBvc2l0aW9uLnJvdywgbGluZXMpO1xuICAgICAgICAgICAgcG9zaXRpb24gPSB0aGlzLmluc2VydEluTGluZShwb3NpdGlvbiwgbGFzdExpbmUgfHwgXCJcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpcmVzIHdoZW5ldmVyIHRoZSBkb2N1bWVudCBjaGFuZ2VzLlxuICAgICAqXG4gICAgICogU2V2ZXJhbCBtZXRob2RzIHRyaWdnZXIgZGlmZmVyZW50IGBcImNoYW5nZVwiYCBldmVudHMuIEJlbG93IGlzIGEgbGlzdCBvZiBlYWNoIGFjdGlvbiB0eXBlLCBmb2xsb3dlZCBieSBlYWNoIHByb3BlcnR5IHRoYXQncyBhbHNvIGF2YWlsYWJsZTpcbiAgICAgKlxuICAgICAqICAqIGBcImluc2VydExpbmVzXCJgIChlbWl0dGVkIGJ5IFtbRWRpdG9yRG9jdW1lbnQuaW5zZXJ0TGluZXNdXSlcbiAgICAgKiAgICAqIGByYW5nZWA6IHRoZSBbW1JhbmdlXV0gb2YgdGhlIGNoYW5nZSB3aXRoaW4gdGhlIGRvY3VtZW50XG4gICAgICogICAgKiBgbGluZXNgOiB0aGUgbGluZXMgaW4gdGhlIGRvY3VtZW50IHRoYXQgYXJlIGNoYW5naW5nXG4gICAgICogICogYFwiaW5zZXJ0VGV4dFwiYCAoZW1pdHRlZCBieSBbW0VkaXRvckRvY3VtZW50Lmluc2VydE5ld0xpbmVdXSlcbiAgICAgKiAgICAqIGByYW5nZWA6IHRoZSBbW1JhbmdlXV0gb2YgdGhlIGNoYW5nZSB3aXRoaW4gdGhlIGRvY3VtZW50XG4gICAgICogICAgKiBgdGV4dGA6IHRoZSB0ZXh0IHRoYXQncyBiZWluZyBhZGRlZFxuICAgICAqICAqIGBcInJlbW92ZUxpbmVzXCJgIChlbWl0dGVkIGJ5IFtbRWRpdG9yRG9jdW1lbnQuaW5zZXJ0TGluZXNdXSlcbiAgICAgKiAgICAqIGByYW5nZWA6IHRoZSBbW1JhbmdlXV0gb2YgdGhlIGNoYW5nZSB3aXRoaW4gdGhlIGRvY3VtZW50XG4gICAgICogICAgKiBgbGluZXNgOiB0aGUgbGluZXMgaW4gdGhlIGRvY3VtZW50IHRoYXQgd2VyZSByZW1vdmVkXG4gICAgICogICAgKiBgbmxgOiB0aGUgbmV3IGxpbmUgY2hhcmFjdGVyIChhcyBkZWZpbmVkIGJ5IFtbRWRpdG9yRG9jdW1lbnQuZ2V0TmV3TGluZUNoYXJhY3Rlcl1dKVxuICAgICAqICAqIGBcInJlbW92ZVRleHRcImAgKGVtaXR0ZWQgYnkgW1tFZGl0b3JEb2N1bWVudC5yZW1vdmVJbkxpbmVdXSBhbmQgW1tFZGl0b3JEb2N1bWVudC5yZW1vdmVOZXdMaW5lXV0pXG4gICAgICogICAgKiBgcmFuZ2VgOiB0aGUgW1tSYW5nZV1dIG9mIHRoZSBjaGFuZ2Ugd2l0aGluIHRoZSBkb2N1bWVudFxuICAgICAqICAgICogYHRleHRgOiB0aGUgdGV4dCB0aGF0J3MgYmVpbmcgcmVtb3ZlZFxuICAgICAqXG4gICAgICogQGV2ZW50IGNoYW5nZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlIENvbnRhaW5zIGF0IGxlYXN0IG9uZSBwcm9wZXJ0eSBjYWxsZWQgYFwiYWN0aW9uXCJgLiBgXCJhY3Rpb25cImAgaW5kaWNhdGVzIHRoZSBhY3Rpb24gdGhhdCB0cmlnZ2VyZWQgdGhlIGNoYW5nZS4gRWFjaCBhY3Rpb24gYWxzbyBoYXMgYSBzZXQgb2YgYWRkaXRpb25hbCBwcm9wZXJ0aWVzLlxuICAgICAqXG4gICAgICoqL1xuICAgIC8qKlxuICAgICogSW5zZXJ0cyB0aGUgZWxlbWVudHMgaW4gYGxpbmVzYCBpbnRvIHRoZSBkb2N1bWVudCwgc3RhcnRpbmcgYXQgdGhlIHJvdyBpbmRleCBnaXZlbiBieSBgcm93YC4gVGhpcyBtZXRob2QgYWxzbyB0cmlnZ2VycyB0aGUgYCdjaGFuZ2UnYCBldmVudC5cbiAgICAqIEBwYXJhbSB7TnVtYmVyfSByb3cgVGhlIGluZGV4IG9mIHRoZSByb3cgdG8gaW5zZXJ0IGF0XG4gICAgKiBAcGFyYW0ge0FycmF5fSBsaW5lcyBBbiBhcnJheSBvZiBzdHJpbmdzXG4gICAgKiBAcmV0dXJucyB7T2JqZWN0fSBDb250YWlucyB0aGUgZmluYWwgcm93IGFuZCBjb2x1bW4sIGxpa2UgdGhpczogIFxuICAgICogICBgYGBcbiAgICAqICAge3JvdzogZW5kUm93LCBjb2x1bW46IDB9XG4gICAgKiAgIGBgYCAgXG4gICAgKiAgIElmIGBsaW5lc2AgaXMgZW1wdHksIHRoaXMgZnVuY3Rpb24gcmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgY3VycmVudCByb3csIGFuZCBjb2x1bW4sIGxpa2UgdGhpczogIFxuICAgICogICBgYGAgXG4gICAgKiAgIHtyb3c6IHJvdywgY29sdW1uOiAwfVxuICAgICogICBgYGBcbiAgICAqXG4gICAgKiovXG4gICAgaW5zZXJ0TGluZXMocm93OiBudW1iZXIsIGxpbmVzOiBzdHJpbmdbXSkge1xuICAgICAgICBpZiAocm93ID49IHRoaXMuZ2V0TGVuZ3RoKCkpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbnNlcnQoeyByb3c6IHJvdywgY29sdW1uOiAwIH0sIFwiXFxuXCIgKyBsaW5lcy5qb2luKFwiXFxuXCIpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luc2VydExpbmVzKE1hdGgubWF4KHJvdywgMCksIGxpbmVzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9pbnNlcnRMaW5lcyhyb3c6IG51bWJlciwgbGluZXM6IHN0cmluZ1tdKSB7XG4gICAgICAgIGlmIChsaW5lcy5sZW5ndGggPT0gMClcbiAgICAgICAgICAgIHJldHVybiB7IHJvdzogcm93LCBjb2x1bW46IDAgfTtcblxuICAgICAgICAvLyBhcHBseSBkb2Vzbid0IHdvcmsgZm9yIGJpZyBhcnJheXMgKHNtYWxsZXN0IHRocmVzaG9sZCBpcyBvbiBzYWZhcmkgMHhGRkZGKVxuICAgICAgICAvLyB0byBjaXJjdW12ZW50IHRoYXQgd2UgaGF2ZSB0byBicmVhayBodWdlIGluc2VydHMgaW50byBzbWFsbGVyIGNodW5rcyBoZXJlXG4gICAgICAgIHdoaWxlIChsaW5lcy5sZW5ndGggPiAweEYwMDApIHtcbiAgICAgICAgICAgIHZhciBlbmQgPSB0aGlzLl9pbnNlcnRMaW5lcyhyb3csIGxpbmVzLnNsaWNlKDAsIDB4RjAwMCkpO1xuICAgICAgICAgICAgbGluZXMgPSBsaW5lcy5zbGljZSgweEYwMDApO1xuICAgICAgICAgICAgcm93ID0gZW5kLnJvdztcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBhcmdzID0gW3JvdywgMF07XG4gICAgICAgIGFyZ3MucHVzaC5hcHBseShhcmdzLCBsaW5lcyk7XG4gICAgICAgIHRoaXMuJGxpbmVzLnNwbGljZS5hcHBseSh0aGlzLiRsaW5lcywgYXJncyk7XG5cbiAgICAgICAgdmFyIHJhbmdlID0gbmV3IFJhbmdlKHJvdywgMCwgcm93ICsgbGluZXMubGVuZ3RoLCAwKTtcbiAgICAgICAgdmFyIGRlbHRhID0ge1xuICAgICAgICAgICAgYWN0aW9uOiBcImluc2VydExpbmVzXCIsXG4gICAgICAgICAgICByYW5nZTogcmFuZ2UsXG4gICAgICAgICAgICBsaW5lczogbGluZXNcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5fc2lnbmFsKFwiY2hhbmdlXCIsIHsgZGF0YTogZGVsdGEgfSk7XG4gICAgICAgIHJldHVybiByYW5nZS5lbmQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBJbnNlcnRzIGEgbmV3IGxpbmUgaW50byB0aGUgZG9jdW1lbnQgYXQgdGhlIGN1cnJlbnQgcm93J3MgYHBvc2l0aW9uYC4gVGhpcyBtZXRob2QgYWxzbyB0cmlnZ2VycyB0aGUgYCdjaGFuZ2UnYCBldmVudC4gXG4gICAgKiBAcGFyYW0ge09iamVjdH0gcG9zaXRpb24gVGhlIHBvc2l0aW9uIHRvIGluc2VydCBhdFxuICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgZmluYWwgcm93IGFuZCBjb2x1bW4sIGxpa2UgdGhpczo8YnIvPlxuICAgICogICAgYGBgXG4gICAgKiAgICB7cm93OiBlbmRSb3csIGNvbHVtbjogMH1cbiAgICAqICAgIGBgYFxuICAgICpcbiAgICAqKi9cbiAgICBpbnNlcnROZXdMaW5lKHBvc2l0aW9uOiB7IHJvdzogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9KSB7XG4gICAgICAgIHBvc2l0aW9uID0gJGNsaXBQb3NpdGlvbih0aGlzLCBwb3NpdGlvbik7XG4gICAgICAgIHZhciBsaW5lID0gdGhpcy4kbGluZXNbcG9zaXRpb24ucm93XSB8fCBcIlwiO1xuXG4gICAgICAgIHRoaXMuJGxpbmVzW3Bvc2l0aW9uLnJvd10gPSBsaW5lLnN1YnN0cmluZygwLCBwb3NpdGlvbi5jb2x1bW4pO1xuICAgICAgICB0aGlzLiRsaW5lcy5zcGxpY2UocG9zaXRpb24ucm93ICsgMSwgMCwgbGluZS5zdWJzdHJpbmcocG9zaXRpb24uY29sdW1uLCBsaW5lLmxlbmd0aCkpO1xuXG4gICAgICAgIHZhciBlbmQgPSB7XG4gICAgICAgICAgICByb3c6IHBvc2l0aW9uLnJvdyArIDEsXG4gICAgICAgICAgICBjb2x1bW46IDBcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZGVsdGEgPSB7XG4gICAgICAgICAgICBhY3Rpb246IFwiaW5zZXJ0VGV4dFwiLFxuICAgICAgICAgICAgcmFuZ2U6IFJhbmdlLmZyb21Qb2ludHMocG9zaXRpb24sIGVuZCksXG4gICAgICAgICAgICB0ZXh0OiB0aGlzLmdldE5ld0xpbmVDaGFyYWN0ZXIoKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9zaWduYWwoXCJjaGFuZ2VcIiwgeyBkYXRhOiBkZWx0YSB9KTtcblxuICAgICAgICByZXR1cm4gZW5kO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogSW5zZXJ0cyBgdGV4dGAgaW50byB0aGUgYHBvc2l0aW9uYCBhdCB0aGUgY3VycmVudCByb3cuIFRoaXMgbWV0aG9kIGFsc28gdHJpZ2dlcnMgdGhlIGAnY2hhbmdlJ2AgZXZlbnQuXG4gICAgKiBAcGFyYW0ge09iamVjdH0gcG9zaXRpb24gVGhlIHBvc2l0aW9uIHRvIGluc2VydCBhdC5cbiAgICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IEEgY2h1bmsgb2YgdGV4dFxuICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgZmluYWwgcm93IGFuZCBjb2x1bW4uXG4gICAgKiovXG4gICAgaW5zZXJ0SW5MaW5lKHBvc2l0aW9uOiB7IHJvdzogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9LCB0ZXh0OiBzdHJpbmcpOiB7IHJvdzogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9IHtcbiAgICAgICAgaWYgKHRleHQubGVuZ3RoID09IDApXG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb247XG5cbiAgICAgICAgdmFyIGxpbmUgPSB0aGlzLiRsaW5lc1twb3NpdGlvbi5yb3ddIHx8IFwiXCI7XG5cbiAgICAgICAgdGhpcy4kbGluZXNbcG9zaXRpb24ucm93XSA9IGxpbmUuc3Vic3RyaW5nKDAsIHBvc2l0aW9uLmNvbHVtbikgKyB0ZXh0ICsgbGluZS5zdWJzdHJpbmcocG9zaXRpb24uY29sdW1uKTtcblxuICAgICAgICB2YXIgZW5kID0ge1xuICAgICAgICAgICAgcm93OiBwb3NpdGlvbi5yb3csXG4gICAgICAgICAgICBjb2x1bW46IHBvc2l0aW9uLmNvbHVtbiArIHRleHQubGVuZ3RoXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGRlbHRhID0geyBhY3Rpb246IFwiaW5zZXJ0VGV4dFwiLCByYW5nZTogUmFuZ2UuZnJvbVBvaW50cyhwb3NpdGlvbiwgZW5kKSwgdGV4dDogdGV4dCB9O1xuICAgICAgICB0aGlzLl9zaWduYWwoXCJjaGFuZ2VcIiwgeyBkYXRhOiBkZWx0YSB9KTtcblxuICAgICAgICByZXR1cm4gZW5kO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogUmVtb3ZlcyB0aGUgYHJhbmdlYCBmcm9tIHRoZSBkb2N1bWVudC5cbiAgICAqIEBwYXJhbSB7UmFuZ2V9IHJhbmdlIEEgc3BlY2lmaWVkIFJhbmdlIHRvIHJlbW92ZVxuICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbmV3IGBzdGFydGAgcHJvcGVydHkgb2YgdGhlIHJhbmdlLCB3aGljaCBjb250YWlucyBgc3RhcnRSb3dgIGFuZCBgc3RhcnRDb2x1bW5gLiBJZiBgcmFuZ2VgIGlzIGVtcHR5LCB0aGlzIGZ1bmN0aW9uIHJldHVybnMgdGhlIHVubW9kaWZpZWQgdmFsdWUgb2YgYHJhbmdlLnN0YXJ0YC5cbiAgICAqXG4gICAgKiovXG4gICAgcmVtb3ZlKHJhbmdlOiB7IHN0YXJ0OyBlbmQ7IGlzRW1wdHk7IGlzTXVsdGlMaW5lIH0pIHtcbiAgICAgICAgaWYgKCEocmFuZ2UgaW5zdGFuY2VvZiBSYW5nZSkpXG4gICAgICAgICAgICByYW5nZSA9IFJhbmdlLmZyb21Qb2ludHMocmFuZ2Uuc3RhcnQsIHJhbmdlLmVuZCk7XG4gICAgICAgIC8vIGNsaXAgdG8gZG9jdW1lbnRcbiAgICAgICAgcmFuZ2Uuc3RhcnQgPSAkY2xpcFBvc2l0aW9uKHRoaXMsIHJhbmdlLnN0YXJ0KTtcbiAgICAgICAgcmFuZ2UuZW5kID0gJGNsaXBQb3NpdGlvbih0aGlzLCByYW5nZS5lbmQpO1xuXG4gICAgICAgIGlmIChyYW5nZS5pc0VtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gcmFuZ2Uuc3RhcnQ7XG5cbiAgICAgICAgdmFyIGZpcnN0Um93ID0gcmFuZ2Uuc3RhcnQucm93O1xuICAgICAgICB2YXIgbGFzdFJvdyA9IHJhbmdlLmVuZC5yb3c7XG5cbiAgICAgICAgaWYgKHJhbmdlLmlzTXVsdGlMaW5lKCkpIHtcbiAgICAgICAgICAgIHZhciBmaXJzdEZ1bGxSb3cgPSByYW5nZS5zdGFydC5jb2x1bW4gPT0gMCA/IGZpcnN0Um93IDogZmlyc3RSb3cgKyAxO1xuICAgICAgICAgICAgdmFyIGxhc3RGdWxsUm93ID0gbGFzdFJvdyAtIDE7XG5cbiAgICAgICAgICAgIGlmIChyYW5nZS5lbmQuY29sdW1uID4gMClcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUluTGluZShsYXN0Um93LCAwLCByYW5nZS5lbmQuY29sdW1uKTtcblxuICAgICAgICAgICAgaWYgKGxhc3RGdWxsUm93ID49IGZpcnN0RnVsbFJvdylcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVMaW5lcyhmaXJzdEZ1bGxSb3csIGxhc3RGdWxsUm93KTtcblxuICAgICAgICAgICAgaWYgKGZpcnN0RnVsbFJvdyAhPSBmaXJzdFJvdykge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlSW5MaW5lKGZpcnN0Um93LCByYW5nZS5zdGFydC5jb2x1bW4sIHRoaXMuZ2V0TGluZShmaXJzdFJvdykubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZU5ld0xpbmUocmFuZ2Uuc3RhcnQucm93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlSW5MaW5lKGZpcnN0Um93LCByYW5nZS5zdGFydC5jb2x1bW4sIHJhbmdlLmVuZC5jb2x1bW4pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByYW5nZS5zdGFydDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIFJlbW92ZXMgdGhlIHNwZWNpZmllZCBjb2x1bW5zIGZyb20gdGhlIGByb3dgLiBUaGlzIG1ldGhvZCBhbHNvIHRyaWdnZXJzIHRoZSBgJ2NoYW5nZSdgIGV2ZW50LlxuICAgICogQHBhcmFtIHtOdW1iZXJ9IHJvdyBUaGUgcm93IHRvIHJlbW92ZSBmcm9tXG4gICAgKiBAcGFyYW0ge051bWJlcn0gc3RhcnRDb2x1bW4gVGhlIGNvbHVtbiB0byBzdGFydCByZW1vdmluZyBhdCBcbiAgICAqIEBwYXJhbSB7TnVtYmVyfSBlbmRDb2x1bW4gVGhlIGNvbHVtbiB0byBzdG9wIHJlbW92aW5nIGF0XG4gICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIGBzdGFydFJvd2AgYW5kIGBzdGFydENvbHVtbmAsIGluZGljYXRpbmcgdGhlIG5ldyByb3cgYW5kIGNvbHVtbiB2YWx1ZXMuPGJyLz5JZiBgc3RhcnRDb2x1bW5gIGlzIGVxdWFsIHRvIGBlbmRDb2x1bW5gLCB0aGlzIGZ1bmN0aW9uIHJldHVybnMgbm90aGluZy5cbiAgICAqXG4gICAgKiovXG4gICAgcmVtb3ZlSW5MaW5lKHJvdzogbnVtYmVyLCBzdGFydENvbHVtbjogbnVtYmVyLCBlbmRDb2x1bW46IG51bWJlcikge1xuICAgICAgICBpZiAoc3RhcnRDb2x1bW4gPT09IGVuZENvbHVtbilcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICB2YXIgcmFuZ2UgPSBuZXcgUmFuZ2Uocm93LCBzdGFydENvbHVtbiwgcm93LCBlbmRDb2x1bW4pO1xuICAgICAgICB2YXIgbGluZSA9IHRoaXMuZ2V0TGluZShyb3cpO1xuICAgICAgICB2YXIgcmVtb3ZlZCA9IGxpbmUuc3Vic3RyaW5nKHN0YXJ0Q29sdW1uLCBlbmRDb2x1bW4pO1xuICAgICAgICB2YXIgbmV3TGluZSA9IGxpbmUuc3Vic3RyaW5nKDAsIHN0YXJ0Q29sdW1uKSArIGxpbmUuc3Vic3RyaW5nKGVuZENvbHVtbiwgbGluZS5sZW5ndGgpO1xuICAgICAgICB0aGlzLiRsaW5lcy5zcGxpY2Uocm93LCAxLCBuZXdMaW5lKTtcblxuICAgICAgICB2YXIgZGVsdGEgPSB7XG4gICAgICAgICAgICBhY3Rpb246IFwicmVtb3ZlVGV4dFwiLFxuICAgICAgICAgICAgcmFuZ2U6IHJhbmdlLFxuICAgICAgICAgICAgdGV4dDogcmVtb3ZlZFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9zaWduYWwoXCJjaGFuZ2VcIiwgeyBkYXRhOiBkZWx0YSB9KTtcbiAgICAgICAgcmV0dXJuIHJhbmdlLnN0YXJ0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICogUmVtb3ZlcyBhIHJhbmdlIG9mIGZ1bGwgbGluZXMuIFRoaXMgbWV0aG9kIGFsc28gdHJpZ2dlcnMgdGhlIGAnY2hhbmdlJ2AgZXZlbnQuXG4gICAgKiBAcGFyYW0ge051bWJlcn0gZmlyc3RSb3cgVGhlIGZpcnN0IHJvdyB0byBiZSByZW1vdmVkXG4gICAgKiBAcGFyYW0ge051bWJlcn0gbGFzdFJvdyBUaGUgbGFzdCByb3cgdG8gYmUgcmVtb3ZlZFxuICAgICogQHJldHVybnMge1tTdHJpbmddfSBSZXR1cm5zIGFsbCB0aGUgcmVtb3ZlZCBsaW5lcy5cbiAgICAqXG4gICAgKiovXG4gICAgcmVtb3ZlTGluZXMoZmlyc3RSb3c6IG51bWJlciwgbGFzdFJvdzogbnVtYmVyKTogc3RyaW5nW10ge1xuICAgICAgICBpZiAoZmlyc3RSb3cgPCAwIHx8IGxhc3RSb3cgPj0gdGhpcy5nZXRMZW5ndGgoKSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbW92ZShuZXcgUmFuZ2UoZmlyc3RSb3csIDAsIGxhc3RSb3cgKyAxLCAwKSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZW1vdmVMaW5lcyhmaXJzdFJvdywgbGFzdFJvdyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfcmVtb3ZlTGluZXMoZmlyc3RSb3c6IG51bWJlciwgbGFzdFJvdzogbnVtYmVyKTogc3RyaW5nW10ge1xuICAgICAgICB2YXIgcmFuZ2UgPSBuZXcgUmFuZ2UoZmlyc3RSb3csIDAsIGxhc3RSb3cgKyAxLCAwKTtcbiAgICAgICAgdmFyIHJlbW92ZWQgPSB0aGlzLiRsaW5lcy5zcGxpY2UoZmlyc3RSb3csIGxhc3RSb3cgLSBmaXJzdFJvdyArIDEpO1xuXG4gICAgICAgIHZhciBkZWx0YSA9IHtcbiAgICAgICAgICAgIGFjdGlvbjogXCJyZW1vdmVMaW5lc1wiLFxuICAgICAgICAgICAgcmFuZ2U6IHJhbmdlLFxuICAgICAgICAgICAgbmw6IHRoaXMuZ2V0TmV3TGluZUNoYXJhY3RlcigpLFxuICAgICAgICAgICAgbGluZXM6IHJlbW92ZWRcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5fc2lnbmFsKFwiY2hhbmdlXCIsIHsgZGF0YTogZGVsdGEgfSk7XG4gICAgICAgIHJldHVybiByZW1vdmVkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogUmVtb3ZlcyB0aGUgbmV3IGxpbmUgYmV0d2VlbiBgcm93YCBhbmQgdGhlIHJvdyBpbW1lZGlhdGVseSBmb2xsb3dpbmcgaXQuIFRoaXMgbWV0aG9kIGFsc28gdHJpZ2dlcnMgdGhlIGAnY2hhbmdlJ2AgZXZlbnQuXG4gICAgKiBAcGFyYW0ge051bWJlcn0gcm93IFRoZSByb3cgdG8gY2hlY2tcbiAgICAqXG4gICAgKiovXG4gICAgcmVtb3ZlTmV3TGluZShyb3c6IG51bWJlcik6IHZvaWQge1xuICAgICAgICB2YXIgZmlyc3RMaW5lID0gdGhpcy5nZXRMaW5lKHJvdyk7XG4gICAgICAgIHZhciBzZWNvbmRMaW5lID0gdGhpcy5nZXRMaW5lKHJvdyArIDEpO1xuXG4gICAgICAgIHZhciByYW5nZSA9IG5ldyBSYW5nZShyb3csIGZpcnN0TGluZS5sZW5ndGgsIHJvdyArIDEsIDApO1xuICAgICAgICB2YXIgbGluZSA9IGZpcnN0TGluZSArIHNlY29uZExpbmU7XG5cbiAgICAgICAgdGhpcy4kbGluZXMuc3BsaWNlKHJvdywgMiwgbGluZSk7XG5cbiAgICAgICAgdmFyIGRlbHRhID0ge1xuICAgICAgICAgICAgYWN0aW9uOiBcInJlbW92ZVRleHRcIixcbiAgICAgICAgICAgIHJhbmdlOiByYW5nZSxcbiAgICAgICAgICAgIHRleHQ6IHRoaXMuZ2V0TmV3TGluZUNoYXJhY3RlcigpXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3NpZ25hbChcImNoYW5nZVwiLCB7IGRhdGE6IGRlbHRhIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogUmVwbGFjZXMgYSByYW5nZSBpbiB0aGUgZG9jdW1lbnQgd2l0aCB0aGUgbmV3IGB0ZXh0YC5cbiAgICAqIEBwYXJhbSB7UmFuZ2V9IHJhbmdlIEEgc3BlY2lmaWVkIFJhbmdlIHRvIHJlcGxhY2VcbiAgICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFRoZSBuZXcgdGV4dCB0byB1c2UgYXMgYSByZXBsYWNlbWVudFxuICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgZmluYWwgcm93IGFuZCBjb2x1bW4sIGxpa2UgdGhpczpcbiAgICAqICAgICB7cm93OiBlbmRSb3csIGNvbHVtbjogMH1cbiAgICAqIElmIHRoZSB0ZXh0IGFuZCByYW5nZSBhcmUgZW1wdHksIHRoaXMgZnVuY3Rpb24gcmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgY3VycmVudCBgcmFuZ2Uuc3RhcnRgIHZhbHVlLlxuICAgICogSWYgdGhlIHRleHQgaXMgdGhlIGV4YWN0IHNhbWUgYXMgd2hhdCBjdXJyZW50bHkgZXhpc3RzLCB0aGlzIGZ1bmN0aW9uIHJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGN1cnJlbnQgYHJhbmdlLmVuZGAgdmFsdWUuXG4gICAgKlxuICAgICoqL1xuICAgIHJlcGxhY2UocmFuZ2U6IFJhbmdlLCB0ZXh0OiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKHRleHQubGVuZ3RoID09IDAgJiYgcmFuZ2UuaXNFbXB0eSgpKVxuICAgICAgICAgICAgcmV0dXJuIHJhbmdlLnN0YXJ0O1xuXG4gICAgICAgIC8vIFNob3J0Y3V0OiBJZiB0aGUgdGV4dCB3ZSB3YW50IHRvIGluc2VydCBpcyB0aGUgc2FtZSBhcyBpdCBpcyBhbHJlYWR5XG4gICAgICAgIC8vIGluIHRoZSBkb2N1bWVudCwgd2UgZG9uJ3QgaGF2ZSB0byByZXBsYWNlIGFueXRoaW5nLlxuICAgICAgICBpZiAodGV4dCA9PSB0aGlzLmdldFRleHRSYW5nZShyYW5nZSkpXG4gICAgICAgICAgICByZXR1cm4gcmFuZ2UuZW5kO1xuXG4gICAgICAgIHRoaXMucmVtb3ZlKHJhbmdlKTtcbiAgICAgICAgaWYgKHRleHQpIHtcbiAgICAgICAgICAgIHZhciBlbmQgPSB0aGlzLmluc2VydChyYW5nZS5zdGFydCwgdGV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBlbmQgPSByYW5nZS5zdGFydDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBlbmQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBBcHBsaWVzIGFsbCB0aGUgY2hhbmdlcyBwcmV2aW91c2x5IGFjY3VtdWxhdGVkLiBUaGVzZSBjYW4gYmUgZWl0aGVyIGAnaW5jbHVkZVRleHQnYCwgYCdpbnNlcnRMaW5lcydgLCBgJ3JlbW92ZVRleHQnYCwgYW5kIGAncmVtb3ZlTGluZXMnYC5cbiAgICAqKi9cbiAgICBhcHBseURlbHRhcyhkZWx0YXM6IHsgYWN0aW9uOiBzdHJpbmc7IGxpbmVzOiBzdHJpbmdbXTsgcmFuZ2U6IHsgc3RhcnQ6IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH07IGVuZDogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfSB9OyB0ZXh0OiBzdHJpbmcgfVtdKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGVsdGFzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgZGVsdGEgPSBkZWx0YXNbaV07XG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSBSYW5nZS5mcm9tUG9pbnRzKGRlbHRhLnJhbmdlLnN0YXJ0LCBkZWx0YS5yYW5nZS5lbmQpO1xuXG4gICAgICAgICAgICBpZiAoZGVsdGEuYWN0aW9uID09IFwiaW5zZXJ0TGluZXNcIilcbiAgICAgICAgICAgICAgICB0aGlzLmluc2VydExpbmVzKHJhbmdlLnN0YXJ0LnJvdywgZGVsdGEubGluZXMpO1xuICAgICAgICAgICAgZWxzZSBpZiAoZGVsdGEuYWN0aW9uID09IFwiaW5zZXJ0VGV4dFwiKVxuICAgICAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHJhbmdlLnN0YXJ0LCBkZWx0YS50ZXh0KTtcbiAgICAgICAgICAgIGVsc2UgaWYgKGRlbHRhLmFjdGlvbiA9PSBcInJlbW92ZUxpbmVzXCIpXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlTGluZXMocmFuZ2Uuc3RhcnQucm93LCByYW5nZS5lbmQucm93IC0gMSk7XG4gICAgICAgICAgICBlbHNlIGlmIChkZWx0YS5hY3Rpb24gPT0gXCJyZW1vdmVUZXh0XCIpXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUocmFuZ2UpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBSZXZlcnRzIGFueSBjaGFuZ2VzIHByZXZpb3VzbHkgYXBwbGllZC4gVGhlc2UgY2FuIGJlIGVpdGhlciBgJ2luY2x1ZGVUZXh0J2AsIGAnaW5zZXJ0TGluZXMnYCwgYCdyZW1vdmVUZXh0J2AsIGFuZCBgJ3JlbW92ZUxpbmVzJ2AuXG4gICAgKiovXG4gICAgcmV2ZXJ0RGVsdGFzKGRlbHRhcykge1xuICAgICAgICBmb3IgKHZhciBpID0gZGVsdGFzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICB2YXIgZGVsdGEgPSBkZWx0YXNbaV07XG5cbiAgICAgICAgICAgIHZhciByYW5nZSA9IFJhbmdlLmZyb21Qb2ludHMoZGVsdGEucmFuZ2Uuc3RhcnQsIGRlbHRhLnJhbmdlLmVuZCk7XG5cbiAgICAgICAgICAgIGlmIChkZWx0YS5hY3Rpb24gPT0gXCJpbnNlcnRMaW5lc1wiKVxuICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUxpbmVzKHJhbmdlLnN0YXJ0LnJvdywgcmFuZ2UuZW5kLnJvdyAtIDEpO1xuICAgICAgICAgICAgZWxzZSBpZiAoZGVsdGEuYWN0aW9uID09IFwiaW5zZXJ0VGV4dFwiKVxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKHJhbmdlKTtcbiAgICAgICAgICAgIGVsc2UgaWYgKGRlbHRhLmFjdGlvbiA9PSBcInJlbW92ZUxpbmVzXCIpXG4gICAgICAgICAgICAgICAgdGhpcy5faW5zZXJ0TGluZXMocmFuZ2Uuc3RhcnQucm93LCBkZWx0YS5saW5lcyk7XG4gICAgICAgICAgICBlbHNlIGlmIChkZWx0YS5hY3Rpb24gPT0gXCJyZW1vdmVUZXh0XCIpXG4gICAgICAgICAgICAgICAgdGhpcy5pbnNlcnQocmFuZ2Uuc3RhcnQsIGRlbHRhLnRleHQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYW4gaW5kZXggcG9zaXRpb24gaW4gYSBkb2N1bWVudCB0byBhIGB7cm93LCBjb2x1bW59YCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBJbmRleCByZWZlcnMgdG8gdGhlIFwiYWJzb2x1dGUgcG9zaXRpb25cIiBvZiBhIGNoYXJhY3RlciBpbiB0aGUgZG9jdW1lbnQuIEZvciBleGFtcGxlOlxuICAgICAqXG4gICAgICogYGBgamF2YXNjcmlwdFxuICAgICAqIHZhciB4ID0gMDsgLy8gMTAgY2hhcmFjdGVycywgcGx1cyBvbmUgZm9yIG5ld2xpbmVcbiAgICAgKiB2YXIgeSA9IC0xO1xuICAgICAqIGBgYFxuICAgICAqIFxuICAgICAqIEhlcmUsIGB5YCBpcyBhbiBpbmRleCAxNTogMTEgY2hhcmFjdGVycyBmb3IgdGhlIGZpcnN0IHJvdywgYW5kIDUgY2hhcmFjdGVycyB1bnRpbCBgeWAgaW4gdGhlIHNlY29uZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleCBBbiBpbmRleCB0byBjb252ZXJ0XG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHN0YXJ0Um93PTAgVGhlIHJvdyBmcm9tIHdoaWNoIHRvIHN0YXJ0IHRoZSBjb252ZXJzaW9uXG4gICAgICogQHJldHVybnMge09iamVjdH0gQSBge3JvdywgY29sdW1ufWAgb2JqZWN0IG9mIHRoZSBgaW5kZXhgIHBvc2l0aW9uXG4gICAgICovXG4gICAgaW5kZXhUb1Bvc2l0aW9uKGluZGV4OiBudW1iZXIsIHN0YXJ0Um93OiBudW1iZXIpIHtcbiAgICAgICAgdmFyIGxpbmVzID0gdGhpcy4kbGluZXMgfHwgdGhpcy5nZXRBbGxMaW5lcygpO1xuICAgICAgICB2YXIgbmV3bGluZUxlbmd0aCA9IHRoaXMuZ2V0TmV3TGluZUNoYXJhY3RlcigpLmxlbmd0aDtcbiAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0Um93IHx8IDAsIGwgPSBsaW5lcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgIGluZGV4IC09IGxpbmVzW2ldLmxlbmd0aCArIG5ld2xpbmVMZW5ndGg7XG4gICAgICAgICAgICBpZiAoaW5kZXggPCAwKVxuICAgICAgICAgICAgICAgIHJldHVybiB7IHJvdzogaSwgY29sdW1uOiBpbmRleCArIGxpbmVzW2ldLmxlbmd0aCArIG5ld2xpbmVMZW5ndGggfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyByb3c6IGwgLSAxLCBjb2x1bW46IGxpbmVzW2wgLSAxXS5sZW5ndGggfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyB0aGUgYHtyb3csIGNvbHVtbn1gIHBvc2l0aW9uIGluIGEgZG9jdW1lbnQgdG8gdGhlIGNoYXJhY3RlcidzIGluZGV4LlxuICAgICAqXG4gICAgICogSW5kZXggcmVmZXJzIHRvIHRoZSBcImFic29sdXRlIHBvc2l0aW9uXCIgb2YgYSBjaGFyYWN0ZXIgaW4gdGhlIGRvY3VtZW50LiBGb3IgZXhhbXBsZTpcbiAgICAgKlxuICAgICAqIGBgYGphdmFzY3JpcHRcbiAgICAgKiB2YXIgeCA9IDA7IC8vIDEwIGNoYXJhY3RlcnMsIHBsdXMgb25lIGZvciBuZXdsaW5lXG4gICAgICogdmFyIHkgPSAtMTtcbiAgICAgKiBgYGBcbiAgICAgKiBcbiAgICAgKiBIZXJlLCBgeWAgaXMgYW4gaW5kZXggMTU6IDExIGNoYXJhY3RlcnMgZm9yIHRoZSBmaXJzdCByb3csIGFuZCA1IGNoYXJhY3RlcnMgdW50aWwgYHlgIGluIHRoZSBzZWNvbmQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9zIFRoZSBge3JvdywgY29sdW1ufWAgdG8gY29udmVydFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBzdGFydFJvdz0wIFRoZSByb3cgZnJvbSB3aGljaCB0byBzdGFydCB0aGUgY29udmVyc2lvblxuICAgICAqIEByZXR1cm5zIHtOdW1iZXJ9IFRoZSBpbmRleCBwb3NpdGlvbiBpbiB0aGUgZG9jdW1lbnRcbiAgICAgKi9cbiAgICBwb3NpdGlvblRvSW5kZXgocG9zLCBzdGFydFJvdykge1xuICAgICAgICB2YXIgbGluZXMgPSB0aGlzLiRsaW5lcyB8fCB0aGlzLmdldEFsbExpbmVzKCk7XG4gICAgICAgIHZhciBuZXdsaW5lTGVuZ3RoID0gdGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCkubGVuZ3RoO1xuICAgICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgICB2YXIgcm93ID0gTWF0aC5taW4ocG9zLnJvdywgbGluZXMubGVuZ3RoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0Um93IHx8IDA7IGkgPCByb3c7ICsraSlcbiAgICAgICAgICAgIGluZGV4ICs9IGxpbmVzW2ldLmxlbmd0aCArIG5ld2xpbmVMZW5ndGg7XG5cbiAgICAgICAgcmV0dXJuIGluZGV4ICsgcG9zLmNvbHVtbjtcbiAgICB9XG59XG4iXX0=