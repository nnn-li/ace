import EventEmitterClass from './lib/event_emitter';
import Range from './Range';
import Anchor from './Anchor';
var $split = (function () {
    function foo(text) {
        return text.replace(/\r\n|\r/g, "\n").split("\n");
    }
    function bar(text) {
        return text.split(/\r\n|\r|\n/);
    }
    if ("aaa".split(/a/).length === 0) {
        return foo;
    }
    else {
        return bar;
    }
})();
function $clipPosition(doc, position) {
    var length = doc.getLength();
    if (position.row >= length) {
        position.row = Math.max(0, length - 1);
        position.column = doc.getLine(length - 1).length;
    }
    else if (position.row < 0) {
        position.row = 0;
    }
    return position;
}
export default class EditorDocument extends EventEmitterClass {
    constructor(text) {
        super();
        this.$lines = [];
        this.$autoNewLine = "";
        this.$newLineMode = "auto";
        if (text.length === 0) {
            this.$lines = [""];
        }
        else if (Array.isArray(text)) {
            this._insertLines(0, text);
        }
        else {
            this.insert({ row: 0, column: 0 }, text);
        }
    }
    setValue(text) {
        var len = this.getLength();
        this.remove(new Range(0, 0, len, this.getLine(len - 1).length));
        this.insert({ row: 0, column: 0 }, text);
    }
    getValue() {
        return this.getAllLines().join(this.getNewLineCharacter());
    }
    createAnchor(row, column) {
        return new Anchor(this, row, column);
    }
    $detectNewLine(text) {
        var match = text.match(/^.*?(\r\n|\r|\n)/m);
        this.$autoNewLine = match ? match[1] : "\n";
        this._signal("changeNewLineMode");
    }
    getNewLineCharacter() {
        switch (this.$newLineMode) {
            case "windows":
                return "\r\n";
            case "unix":
                return "\n";
            default:
                return this.$autoNewLine || "\n";
        }
    }
    setNewLineMode(newLineMode) {
        if (this.$newLineMode === newLineMode)
            return;
        this.$newLineMode = newLineMode;
        this._signal("changeNewLineMode");
    }
    getNewLineMode() {
        return this.$newLineMode;
    }
    isNewLine(text) {
        return (text == "\r\n" || text == "\r" || text == "\n");
    }
    getLine(row) {
        return this.$lines[row] || "";
    }
    getLines(firstRow, lastRow) {
        return this.$lines.slice(firstRow, lastRow + 1);
    }
    getAllLines() {
        return this.getLines(0, this.getLength());
    }
    getLength() {
        return this.$lines.length;
    }
    getTextRange(range) {
        if (range.start.row == range.end.row) {
            return this.getLine(range.start.row).substring(range.start.column, range.end.column);
        }
        var lines = this.getLines(range.start.row, range.end.row);
        lines[0] = (lines[0] || "").substring(range.start.column);
        var l = lines.length - 1;
        if (range.end.row - range.start.row == l) {
            lines[l] = lines[l].substring(0, range.end.column);
        }
        return lines.join(this.getNewLineCharacter());
    }
    insert(position, text) {
        if (!text || text.length === 0)
            return position;
        position = $clipPosition(this, position);
        if (this.getLength() <= 1) {
            this.$detectNewLine(text);
        }
        var lines = $split(text);
        var firstLine = lines.splice(0, 1)[0];
        var lastLine = lines.length == 0 ? null : lines.splice(lines.length - 1, 1)[0];
        position = this.insertInLine(position, firstLine);
        if (lastLine !== null) {
            position = this.insertNewLine(position);
            position = this._insertLines(position.row, lines);
            position = this.insertInLine(position, lastLine || "");
        }
        return position;
    }
    insertLines(row, lines) {
        if (row >= this.getLength())
            return this.insert({ row: row, column: 0 }, "\n" + lines.join("\n"));
        return this._insertLines(Math.max(row, 0), lines);
    }
    _insertLines(row, lines) {
        if (lines.length == 0)
            return { row: row, column: 0 };
        while (lines.length > 0xF000) {
            var end = this._insertLines(row, lines.slice(0, 0xF000));
            lines = lines.slice(0xF000);
            row = end.row;
        }
        var args = [row, 0];
        args.push.apply(args, lines);
        this.$lines.splice.apply(this.$lines, args);
        var range = new Range(row, 0, row + lines.length, 0);
        var delta = {
            action: "insertLines",
            range: range,
            lines: lines
        };
        this._signal("change", { data: delta });
        return range.end;
    }
    insertNewLine(position) {
        position = $clipPosition(this, position);
        var line = this.$lines[position.row] || "";
        this.$lines[position.row] = line.substring(0, position.column);
        this.$lines.splice(position.row + 1, 0, line.substring(position.column, line.length));
        var end = {
            row: position.row + 1,
            column: 0
        };
        var delta = {
            action: "insertText",
            range: Range.fromPoints(position, end),
            text: this.getNewLineCharacter()
        };
        this._signal("change", { data: delta });
        return end;
    }
    insertInLine(position, text) {
        if (text.length == 0)
            return position;
        var line = this.$lines[position.row] || "";
        this.$lines[position.row] = line.substring(0, position.column) + text + line.substring(position.column);
        var end = {
            row: position.row,
            column: position.column + text.length
        };
        var delta = { action: "insertText", range: Range.fromPoints(position, end), text: text };
        this._signal("change", { data: delta });
        return end;
    }
    remove(range) {
        if (!(range instanceof Range))
            range = Range.fromPoints(range.start, range.end);
        range.start = $clipPosition(this, range.start);
        range.end = $clipPosition(this, range.end);
        if (range.isEmpty())
            return range.start;
        var firstRow = range.start.row;
        var lastRow = range.end.row;
        if (range.isMultiLine()) {
            var firstFullRow = range.start.column == 0 ? firstRow : firstRow + 1;
            var lastFullRow = lastRow - 1;
            if (range.end.column > 0)
                this.removeInLine(lastRow, 0, range.end.column);
            if (lastFullRow >= firstFullRow)
                this._removeLines(firstFullRow, lastFullRow);
            if (firstFullRow != firstRow) {
                this.removeInLine(firstRow, range.start.column, this.getLine(firstRow).length);
                this.removeNewLine(range.start.row);
            }
        }
        else {
            this.removeInLine(firstRow, range.start.column, range.end.column);
        }
        return range.start;
    }
    removeInLine(row, startColumn, endColumn) {
        if (startColumn === endColumn)
            return;
        var range = new Range(row, startColumn, row, endColumn);
        var line = this.getLine(row);
        var removed = line.substring(startColumn, endColumn);
        var newLine = line.substring(0, startColumn) + line.substring(endColumn, line.length);
        this.$lines.splice(row, 1, newLine);
        var delta = {
            action: "removeText",
            range: range,
            text: removed
        };
        this._signal("change", { data: delta });
        return range.start;
    }
    removeLines(firstRow, lastRow) {
        if (firstRow < 0 || lastRow >= this.getLength())
            return this.remove(new Range(firstRow, 0, lastRow + 1, 0));
        return this._removeLines(firstRow, lastRow);
    }
    _removeLines(firstRow, lastRow) {
        var range = new Range(firstRow, 0, lastRow + 1, 0);
        var removed = this.$lines.splice(firstRow, lastRow - firstRow + 1);
        var delta = {
            action: "removeLines",
            range: range,
            nl: this.getNewLineCharacter(),
            lines: removed
        };
        this._signal("change", { data: delta });
        return removed;
    }
    removeNewLine(row) {
        var firstLine = this.getLine(row);
        var secondLine = this.getLine(row + 1);
        var range = new Range(row, firstLine.length, row + 1, 0);
        var line = firstLine + secondLine;
        this.$lines.splice(row, 2, line);
        var delta = {
            action: "removeText",
            range: range,
            text: this.getNewLineCharacter()
        };
        this._signal("change", { data: delta });
    }
    replace(range, text) {
        if (text.length == 0 && range.isEmpty())
            return range.start;
        if (text == this.getTextRange(range))
            return range.end;
        this.remove(range);
        if (text) {
            var end = this.insert(range.start, text);
        }
        else {
            end = range.start;
        }
        return end;
    }
    applyDeltas(deltas) {
        for (var i = 0; i < deltas.length; i++) {
            var delta = deltas[i];
            var range = Range.fromPoints(delta.range.start, delta.range.end);
            if (delta.action == "insertLines")
                this.insertLines(range.start.row, delta.lines);
            else if (delta.action == "insertText")
                this.insert(range.start, delta.text);
            else if (delta.action == "removeLines")
                this._removeLines(range.start.row, range.end.row - 1);
            else if (delta.action == "removeText")
                this.remove(range);
        }
    }
    revertDeltas(deltas) {
        for (var i = deltas.length - 1; i >= 0; i--) {
            var delta = deltas[i];
            var range = Range.fromPoints(delta.range.start, delta.range.end);
            if (delta.action == "insertLines")
                this._removeLines(range.start.row, range.end.row - 1);
            else if (delta.action == "insertText")
                this.remove(range);
            else if (delta.action == "removeLines")
                this._insertLines(range.start.row, delta.lines);
            else if (delta.action == "removeText")
                this.insert(range.start, delta.text);
        }
    }
    indexToPosition(index, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        for (var i = startRow || 0, l = lines.length; i < l; i++) {
            index -= lines[i].length + newlineLength;
            if (index < 0)
                return { row: i, column: index + lines[i].length + newlineLength };
        }
        return { row: l - 1, column: lines[l - 1].length };
    }
    positionToIndex(pos, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        var index = 0;
        var row = Math.min(pos.row, lines.length);
        for (var i = startRow || 0; i < row; ++i)
            index += lines[i].length + newlineLength;
        return index + pos.column;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWRpdG9yRG9jdW1lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvRWRpdG9yRG9jdW1lbnQudHMiXSwibmFtZXMiOlsiZm9vIiwiYmFyIiwiJGNsaXBQb3NpdGlvbiIsIkVkaXRvckRvY3VtZW50IiwiRWRpdG9yRG9jdW1lbnQuY29uc3RydWN0b3IiLCJFZGl0b3JEb2N1bWVudC5zZXRWYWx1ZSIsIkVkaXRvckRvY3VtZW50LmdldFZhbHVlIiwiRWRpdG9yRG9jdW1lbnQuY3JlYXRlQW5jaG9yIiwiRWRpdG9yRG9jdW1lbnQuJGRldGVjdE5ld0xpbmUiLCJFZGl0b3JEb2N1bWVudC5nZXROZXdMaW5lQ2hhcmFjdGVyIiwiRWRpdG9yRG9jdW1lbnQuc2V0TmV3TGluZU1vZGUiLCJFZGl0b3JEb2N1bWVudC5nZXROZXdMaW5lTW9kZSIsIkVkaXRvckRvY3VtZW50LmlzTmV3TGluZSIsIkVkaXRvckRvY3VtZW50LmdldExpbmUiLCJFZGl0b3JEb2N1bWVudC5nZXRMaW5lcyIsIkVkaXRvckRvY3VtZW50LmdldEFsbExpbmVzIiwiRWRpdG9yRG9jdW1lbnQuZ2V0TGVuZ3RoIiwiRWRpdG9yRG9jdW1lbnQuZ2V0VGV4dFJhbmdlIiwiRWRpdG9yRG9jdW1lbnQuaW5zZXJ0IiwiRWRpdG9yRG9jdW1lbnQuaW5zZXJ0TGluZXMiLCJFZGl0b3JEb2N1bWVudC5faW5zZXJ0TGluZXMiLCJFZGl0b3JEb2N1bWVudC5pbnNlcnROZXdMaW5lIiwiRWRpdG9yRG9jdW1lbnQuaW5zZXJ0SW5MaW5lIiwiRWRpdG9yRG9jdW1lbnQucmVtb3ZlIiwiRWRpdG9yRG9jdW1lbnQucmVtb3ZlSW5MaW5lIiwiRWRpdG9yRG9jdW1lbnQucmVtb3ZlTGluZXMiLCJFZGl0b3JEb2N1bWVudC5fcmVtb3ZlTGluZXMiLCJFZGl0b3JEb2N1bWVudC5yZW1vdmVOZXdMaW5lIiwiRWRpdG9yRG9jdW1lbnQucmVwbGFjZSIsIkVkaXRvckRvY3VtZW50LmFwcGx5RGVsdGFzIiwiRWRpdG9yRG9jdW1lbnQucmV2ZXJ0RGVsdGFzIiwiRWRpdG9yRG9jdW1lbnQuaW5kZXhUb1Bvc2l0aW9uIiwiRWRpdG9yRG9jdW1lbnQucG9zaXRpb25Ub0luZGV4Il0sIm1hcHBpbmdzIjoiT0E4Qk8saUJBQWlCLE1BQU0scUJBQXFCO09BQzVDLEtBQUssTUFBTSxTQUFTO09BQ3BCLE1BQU0sTUFBTSxVQUFVO0FBRTdCLElBQUksTUFBTSxHQUErQixDQUFDO0lBQ3RDLGFBQWEsSUFBWTtRQUNyQkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsVUFBVUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7SUFDdERBLENBQUNBO0lBQ0QsYUFBYSxJQUFZO1FBQ3JCQyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQTtJQUNwQ0EsQ0FBQ0E7SUFDRCxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLE1BQU0sQ0FBQyxHQUFHLENBQUM7SUFDZixDQUFDO0lBQ0QsSUFBSSxDQUFDLENBQUM7UUFDRixNQUFNLENBQUMsR0FBRyxDQUFDO0lBQ2YsQ0FBQztBQUNMLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFFTCx1QkFBdUIsR0FBbUIsRUFBRSxRQUF5QztJQUNqRkMsSUFBSUEsTUFBTUEsR0FBR0EsR0FBR0EsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0E7SUFDN0JBLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLElBQUlBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1FBQ3pCQSxRQUFRQSxDQUFDQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxFQUFFQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN2Q0EsUUFBUUEsQ0FBQ0EsTUFBTUEsR0FBR0EsR0FBR0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7SUFDckRBLENBQUNBO0lBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQzFCQSxRQUFRQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUNyQkEsQ0FBQ0E7SUFDREEsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0E7QUFDcEJBLENBQUNBO0FBRUQsNENBQTRDLGlCQUFpQjtJQUl6REMsWUFBWUEsSUFBNEJBO1FBQ3BDQyxPQUFPQSxDQUFDQTtRQUpKQSxXQUFNQSxHQUFhQSxFQUFFQSxDQUFDQTtRQUN0QkEsaUJBQVlBLEdBQVdBLEVBQUVBLENBQUNBO1FBQzFCQSxpQkFBWUEsR0FBV0EsTUFBTUEsQ0FBQ0E7UUFNbENBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3BCQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUN2QkEsQ0FBQ0E7UUFDREEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDM0JBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1FBQy9CQSxDQUFDQTtRQUNEQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNGQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxDQUFDQSxFQUFFQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUM3Q0EsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFRREQsUUFBUUEsQ0FBQ0EsSUFBWUE7UUFDakJFLElBQUlBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBO1FBQzNCQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxLQUFLQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNoRUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsRUFBRUEsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7SUFDN0NBLENBQUNBO0lBT0RGLFFBQVFBO1FBQ0pHLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLG1CQUFtQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7SUFDL0RBLENBQUNBO0lBVURILFlBQVlBLENBQUNBLEdBQVdBLEVBQUVBLE1BQWNBO1FBQ3BDSSxNQUFNQSxDQUFDQSxJQUFJQSxNQUFNQSxDQUFDQSxJQUFJQSxFQUFFQSxHQUFHQSxFQUFFQSxNQUFNQSxDQUFDQSxDQUFDQTtJQUN6Q0EsQ0FBQ0E7SUFRT0osY0FBY0EsQ0FBQ0EsSUFBWUE7UUFDL0JLLElBQUlBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsQ0FBQ0E7UUFDNUNBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLEtBQUtBLEdBQUdBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO1FBQzVDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxtQkFBbUJBLENBQUNBLENBQUNBO0lBQ3RDQSxDQUFDQTtJQVdETCxtQkFBbUJBO1FBQ2ZNLE1BQU1BLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBO1lBQ3hCQSxLQUFLQSxTQUFTQTtnQkFDVkEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDbEJBLEtBQUtBLE1BQU1BO2dCQUNQQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTtZQUNoQkE7Z0JBQ0lBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLElBQUlBLElBQUlBLENBQUNBO1FBQ3pDQSxDQUFDQTtJQUNMQSxDQUFDQTtJQVFETixjQUFjQSxDQUFDQSxXQUFtQkE7UUFDOUJPLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLEtBQUtBLFdBQVdBLENBQUNBO1lBQ2xDQSxNQUFNQSxDQUFDQTtRQUVYQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxXQUFXQSxDQUFDQTtRQUNoQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsbUJBQW1CQSxDQUFDQSxDQUFDQTtJQUN0Q0EsQ0FBQ0E7SUFPRFAsY0FBY0E7UUFDVlEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7SUFDN0JBLENBQUNBO0lBUURSLFNBQVNBLENBQUNBLElBQVlBO1FBQ2xCUyxNQUFNQSxDQUFDQSxDQUFDQSxJQUFJQSxJQUFJQSxNQUFNQSxJQUFJQSxJQUFJQSxJQUFJQSxJQUFJQSxJQUFJQSxJQUFJQSxJQUFJQSxJQUFJQSxDQUFDQSxDQUFDQTtJQUM1REEsQ0FBQ0E7SUFPRFQsT0FBT0EsQ0FBQ0EsR0FBV0E7UUFDZlUsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0E7SUFDbENBLENBQUNBO0lBUURWLFFBQVFBLENBQUNBLFFBQWlCQSxFQUFFQSxPQUFnQkE7UUFDeENXLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLFFBQVFBLEVBQUVBLE9BQU9BLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO0lBQ3BEQSxDQUFDQTtJQUtEWCxXQUFXQTtRQUNQWSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxTQUFTQSxFQUFFQSxDQUFDQSxDQUFDQTtJQUM5Q0EsQ0FBQ0E7SUFLRFosU0FBU0E7UUFDTGEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7SUFDOUJBLENBQUNBO0lBT0RiLFlBQVlBLENBQUNBLEtBQVlBO1FBQ3JCYyxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxJQUFJQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNuQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDekZBLENBQUNBO1FBQ0RBLElBQUlBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQzFEQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxDQUFDQSxTQUFTQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUMxREEsSUFBSUEsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDekJBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3ZDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUN2REEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxDQUFDQSxDQUFDQTtJQUNsREEsQ0FBQ0E7SUFTRGQsTUFBTUEsQ0FBQ0EsUUFBeUNBLEVBQUVBLElBQVlBO1FBQzFEZSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxJQUFJQSxJQUFJQSxDQUFDQSxNQUFNQSxLQUFLQSxDQUFDQSxDQUFDQTtZQUMzQkEsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0E7UUFFcEJBLFFBQVFBLEdBQUdBLGFBQWFBLENBQUNBLElBQUlBLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO1FBR3pDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN4QkEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDOUJBLENBQUNBO1FBRURBLElBQUlBLEtBQUtBLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ3pCQSxJQUFJQSxTQUFTQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN0Q0EsSUFBSUEsUUFBUUEsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsQ0FBQ0EsR0FBR0EsSUFBSUEsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFL0VBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFFBQVFBLEVBQUVBLFNBQVNBLENBQUNBLENBQUNBO1FBQ2xEQSxFQUFFQSxDQUFDQSxDQUFDQSxRQUFRQSxLQUFLQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNwQkEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7WUFDeENBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1lBQ2xEQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxRQUFRQSxFQUFFQSxRQUFRQSxJQUFJQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUMzREEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0E7SUFDcEJBLENBQUNBO0lBdUNEZixXQUFXQSxDQUFDQSxHQUFXQSxFQUFFQSxLQUFlQTtRQUNwQ2dCLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLElBQUlBLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBO1lBQ3hCQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxFQUFFQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6RUEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7SUFDdERBLENBQUNBO0lBRU9oQixZQUFZQSxDQUFDQSxHQUFXQSxFQUFFQSxLQUFlQTtRQUM3Q2lCLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLElBQUlBLENBQUNBLENBQUNBO1lBQ2xCQSxNQUFNQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxFQUFFQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUluQ0EsT0FBT0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsTUFBTUEsRUFBRUEsQ0FBQ0E7WUFDM0JBLElBQUlBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLEVBQUVBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1lBQ3pEQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtZQUM1QkEsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7UUFDbEJBLENBQUNBO1FBRURBLElBQUlBLElBQUlBLEdBQUdBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ3BCQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUM3QkEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFFNUNBLElBQUlBLEtBQUtBLEdBQUdBLElBQUlBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ3JEQSxJQUFJQSxLQUFLQSxHQUFHQTtZQUNSQSxNQUFNQSxFQUFFQSxhQUFhQTtZQUNyQkEsS0FBS0EsRUFBRUEsS0FBS0E7WUFDWkEsS0FBS0EsRUFBRUEsS0FBS0E7U0FDZkEsQ0FBQ0E7UUFDRkEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsRUFBRUEsSUFBSUEsRUFBRUEsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDeENBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBO0lBQ3JCQSxDQUFDQTtJQVdEakIsYUFBYUEsQ0FBQ0EsUUFBeUNBO1FBQ25Ea0IsUUFBUUEsR0FBR0EsYUFBYUEsQ0FBQ0EsSUFBSUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFDekNBLElBQUlBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBO1FBRTNDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxRQUFRQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUMvREEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFdEZBLElBQUlBLEdBQUdBLEdBQUdBO1lBQ05BLEdBQUdBLEVBQUVBLFFBQVFBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBO1lBQ3JCQSxNQUFNQSxFQUFFQSxDQUFDQTtTQUNaQSxDQUFDQTtRQUVGQSxJQUFJQSxLQUFLQSxHQUFHQTtZQUNSQSxNQUFNQSxFQUFFQSxZQUFZQTtZQUNwQkEsS0FBS0EsRUFBRUEsS0FBS0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsUUFBUUEsRUFBRUEsR0FBR0EsQ0FBQ0E7WUFDdENBLElBQUlBLEVBQUVBLElBQUlBLENBQUNBLG1CQUFtQkEsRUFBRUE7U0FDbkNBLENBQUNBO1FBQ0ZBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFFBQVFBLEVBQUVBLEVBQUVBLElBQUlBLEVBQUVBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBO1FBRXhDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQTtJQUNmQSxDQUFDQTtJQVFEbEIsWUFBWUEsQ0FBQ0EsUUFBeUNBLEVBQUVBLElBQVlBO1FBQ2hFbUIsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDakJBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBO1FBRXBCQSxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQTtRQUUzQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsUUFBUUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFFeEdBLElBQUlBLEdBQUdBLEdBQUdBO1lBQ05BLEdBQUdBLEVBQUVBLFFBQVFBLENBQUNBLEdBQUdBO1lBQ2pCQSxNQUFNQSxFQUFFQSxRQUFRQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQTtTQUN4Q0EsQ0FBQ0E7UUFFRkEsSUFBSUEsS0FBS0EsR0FBR0EsRUFBRUEsTUFBTUEsRUFBRUEsWUFBWUEsRUFBRUEsS0FBS0EsRUFBRUEsS0FBS0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsUUFBUUEsRUFBRUEsR0FBR0EsQ0FBQ0EsRUFBRUEsSUFBSUEsRUFBRUEsSUFBSUEsRUFBRUEsQ0FBQ0E7UUFDekZBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFFBQVFBLEVBQUVBLEVBQUVBLElBQUlBLEVBQUVBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBO1FBRXhDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQTtJQUNmQSxDQUFDQTtJQVFEbkIsTUFBTUEsQ0FBQ0EsS0FBMkNBO1FBQzlDb0IsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsWUFBWUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFDMUJBLEtBQUtBLEdBQUdBLEtBQUtBLENBQUNBLFVBQVVBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBRXJEQSxLQUFLQSxDQUFDQSxLQUFLQSxHQUFHQSxhQUFhQSxDQUFDQSxJQUFJQSxFQUFFQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUMvQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsR0FBR0EsYUFBYUEsQ0FBQ0EsSUFBSUEsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFM0NBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBO1lBQ2hCQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUV2QkEsSUFBSUEsUUFBUUEsR0FBR0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7UUFDL0JBLElBQUlBLE9BQU9BLEdBQUdBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBO1FBRTVCQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN0QkEsSUFBSUEsWUFBWUEsR0FBR0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsQ0FBQ0EsR0FBR0EsUUFBUUEsR0FBR0EsUUFBUUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDckVBLElBQUlBLFdBQVdBLEdBQUdBLE9BQU9BLEdBQUdBLENBQUNBLENBQUNBO1lBRTlCQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDckJBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBLEVBQUVBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1lBRXBEQSxFQUFFQSxDQUFDQSxDQUFDQSxXQUFXQSxJQUFJQSxZQUFZQSxDQUFDQTtnQkFDNUJBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFlBQVlBLEVBQUVBLFdBQVdBLENBQUNBLENBQUNBO1lBRWpEQSxFQUFFQSxDQUFDQSxDQUFDQSxZQUFZQSxJQUFJQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDM0JBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFFBQVFBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO2dCQUMvRUEsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDeENBLENBQUNBO1FBQ0xBLENBQUNBO1FBQ0RBLElBQUlBLENBQUNBLENBQUNBO1lBQ0ZBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFFBQVFBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ3RFQSxDQUFDQTtRQUNEQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQTtJQUN2QkEsQ0FBQ0E7SUFVRHBCLFlBQVlBLENBQUNBLEdBQVdBLEVBQUVBLFdBQW1CQSxFQUFFQSxTQUFpQkE7UUFDNURxQixFQUFFQSxDQUFDQSxDQUFDQSxXQUFXQSxLQUFLQSxTQUFTQSxDQUFDQTtZQUMxQkEsTUFBTUEsQ0FBQ0E7UUFFWEEsSUFBSUEsS0FBS0EsR0FBR0EsSUFBSUEsS0FBS0EsQ0FBQ0EsR0FBR0EsRUFBRUEsV0FBV0EsRUFBRUEsR0FBR0EsRUFBRUEsU0FBU0EsQ0FBQ0EsQ0FBQ0E7UUFDeERBLElBQUlBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQzdCQSxJQUFJQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxXQUFXQSxFQUFFQSxTQUFTQSxDQUFDQSxDQUFDQTtRQUNyREEsSUFBSUEsT0FBT0EsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsV0FBV0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsU0FBU0EsRUFBRUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDdEZBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBO1FBRXBDQSxJQUFJQSxLQUFLQSxHQUFHQTtZQUNSQSxNQUFNQSxFQUFFQSxZQUFZQTtZQUNwQkEsS0FBS0EsRUFBRUEsS0FBS0E7WUFDWkEsSUFBSUEsRUFBRUEsT0FBT0E7U0FDaEJBLENBQUNBO1FBQ0ZBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFFBQVFBLEVBQUVBLEVBQUVBLElBQUlBLEVBQUVBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBO1FBQ3hDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQTtJQUN2QkEsQ0FBQ0E7SUFTRHJCLFdBQVdBLENBQUNBLFFBQWdCQSxFQUFFQSxPQUFlQTtRQUN6Q3NCLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLEdBQUdBLENBQUNBLElBQUlBLE9BQU9BLElBQUlBLElBQUlBLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBO1lBQzVDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxLQUFLQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQSxFQUFFQSxPQUFPQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMvREEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsUUFBUUEsRUFBRUEsT0FBT0EsQ0FBQ0EsQ0FBQ0E7SUFDaERBLENBQUNBO0lBRU90QixZQUFZQSxDQUFDQSxRQUFnQkEsRUFBRUEsT0FBZUE7UUFDbER1QixJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxLQUFLQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQSxFQUFFQSxPQUFPQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNuREEsSUFBSUEsT0FBT0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsRUFBRUEsT0FBT0EsR0FBR0EsUUFBUUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFbkVBLElBQUlBLEtBQUtBLEdBQUdBO1lBQ1JBLE1BQU1BLEVBQUVBLGFBQWFBO1lBQ3JCQSxLQUFLQSxFQUFFQSxLQUFLQTtZQUNaQSxFQUFFQSxFQUFFQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEVBQUVBO1lBQzlCQSxLQUFLQSxFQUFFQSxPQUFPQTtTQUNqQkEsQ0FBQ0E7UUFDRkEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsRUFBRUEsSUFBSUEsRUFBRUEsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDeENBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBO0lBQ25CQSxDQUFDQTtJQU9EdkIsYUFBYUEsQ0FBQ0EsR0FBV0E7UUFDckJ3QixJQUFJQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNsQ0EsSUFBSUEsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFdkNBLElBQUlBLEtBQUtBLEdBQUdBLElBQUlBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLFNBQVNBLENBQUNBLE1BQU1BLEVBQUVBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ3pEQSxJQUFJQSxJQUFJQSxHQUFHQSxTQUFTQSxHQUFHQSxVQUFVQSxDQUFDQTtRQUVsQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFFakNBLElBQUlBLEtBQUtBLEdBQUdBO1lBQ1JBLE1BQU1BLEVBQUVBLFlBQVlBO1lBQ3BCQSxLQUFLQSxFQUFFQSxLQUFLQTtZQUNaQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEVBQUVBO1NBQ25DQSxDQUFDQTtRQUNGQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxRQUFRQSxFQUFFQSxFQUFFQSxJQUFJQSxFQUFFQSxLQUFLQSxFQUFFQSxDQUFDQSxDQUFDQTtJQUM1Q0EsQ0FBQ0E7SUFZRHhCLE9BQU9BLENBQUNBLEtBQVlBLEVBQUVBLElBQVlBO1FBQzlCeUIsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsSUFBSUEsQ0FBQ0EsSUFBSUEsS0FBS0EsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7WUFDcENBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBO1FBSXZCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxJQUFJQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtZQUNqQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7UUFFckJBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBQ25CQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNQQSxJQUFJQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUM3Q0EsQ0FBQ0E7UUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDRkEsR0FBR0EsR0FBR0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDdEJBLENBQUNBO1FBRURBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBO0lBQ2ZBLENBQUNBO0lBS0R6QixXQUFXQSxDQUFDQSxNQUFvSkE7UUFDNUowQixHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUNyQ0EsSUFBSUEsS0FBS0EsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdEJBLElBQUlBLEtBQUtBLEdBQUdBLEtBQUtBLENBQUNBLFVBQVVBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBRWpFQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxhQUFhQSxDQUFDQTtnQkFDOUJBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1lBQ25EQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxZQUFZQSxDQUFDQTtnQkFDbENBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ3pDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxhQUFhQSxDQUFDQTtnQkFDbkNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1lBQzFEQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxZQUFZQSxDQUFDQTtnQkFDbENBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBQzNCQSxDQUFDQTtJQUNMQSxDQUFDQTtJQUtEMUIsWUFBWUEsQ0FBQ0EsTUFBeUVBO1FBQ2xGMkIsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDMUNBLElBQUlBLEtBQUtBLEdBQUdBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBRXRCQSxJQUFJQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxVQUFVQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxFQUFFQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUVqRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsYUFBYUEsQ0FBQ0E7Z0JBQzlCQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMxREEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsWUFBWUEsQ0FBQ0E7Z0JBQ2xDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtZQUN2QkEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsYUFBYUEsQ0FBQ0E7Z0JBQ25DQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtZQUNwREEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsWUFBWUEsQ0FBQ0E7Z0JBQ2xDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxFQUFFQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUM3Q0EsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFrQkQzQixlQUFlQSxDQUFDQSxLQUFhQSxFQUFFQSxRQUFnQkE7UUFDM0M0QixJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxJQUFJQSxJQUFJQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQTtRQUM5Q0EsSUFBSUEsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUN0REEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsUUFBUUEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDdkRBLEtBQUtBLElBQUlBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLEdBQUdBLGFBQWFBLENBQUNBO1lBQ3pDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDVkEsTUFBTUEsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsRUFBRUEsTUFBTUEsRUFBRUEsS0FBS0EsR0FBR0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsYUFBYUEsRUFBRUEsQ0FBQ0E7UUFDM0VBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLE1BQU1BLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO0lBQ3ZEQSxDQUFDQTtJQWtCRDVCLGVBQWVBLENBQUNBLEdBQW9DQSxFQUFFQSxRQUFnQkE7UUFDbEU2QixJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxJQUFJQSxJQUFJQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQTtRQUM5Q0EsSUFBSUEsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUN0REEsSUFBSUEsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDZEEsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsRUFBRUEsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDMUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLFFBQVFBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ3BDQSxLQUFLQSxJQUFJQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxHQUFHQSxhQUFhQSxDQUFDQTtRQUU3Q0EsTUFBTUEsQ0FBQ0EsS0FBS0EsR0FBR0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7SUFDOUJBLENBQUNBO0FBQ0w3QixDQUFDQTtBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMCwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIFxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0XG4gKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDpcbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuXG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZVxuICogICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cbiAqICAgICAqIE5laXRoZXIgdGhlIG5hbWUgb2YgQWpheC5vcmcgQi5WLiBub3IgdGhlXG4gKiAgICAgICBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0c1xuICogICAgICAgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXG4gKiBcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiIEFORFxuICogQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRURcbiAqIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkVcbiAqIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIEFKQVguT1JHIEIuVi4gQkUgTElBQkxFIEZPUiBBTllcbiAqIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTXG4gKiAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7XG4gKiBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkRcbiAqIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUXG4gKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJU1xuICogU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG4gKlxuICogKioqKiogRU5EIExJQ0VOU0UgQkxPQ0sgKioqKiogKi9cblxuaW1wb3J0IEV2ZW50RW1pdHRlckNsYXNzIGZyb20gJy4vbGliL2V2ZW50X2VtaXR0ZXInO1xuaW1wb3J0IFJhbmdlIGZyb20gJy4vUmFuZ2UnO1xuaW1wb3J0IEFuY2hvciBmcm9tICcuL0FuY2hvcic7XG5cbnZhciAkc3BsaXQ6ICh0ZXh0OiBzdHJpbmcpID0+IHN0cmluZ1tdID0gKGZ1bmN0aW9uKCkge1xuICAgIGZ1bmN0aW9uIGZvbyh0ZXh0OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoL1xcclxcbnxcXHIvZywgXCJcXG5cIikuc3BsaXQoXCJcXG5cIik7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGJhcih0ZXh0OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0ZXh0LnNwbGl0KC9cXHJcXG58XFxyfFxcbi8pO1xuICAgIH1cbiAgICBpZiAoXCJhYWFcIi5zcGxpdCgvYS8pLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gZm9vO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGJhcjtcbiAgICB9XG59KSgpO1xuXG5mdW5jdGlvbiAkY2xpcFBvc2l0aW9uKGRvYzogRWRpdG9yRG9jdW1lbnQsIHBvc2l0aW9uOiB7IHJvdzogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9KSB7XG4gICAgdmFyIGxlbmd0aCA9IGRvYy5nZXRMZW5ndGgoKTtcbiAgICBpZiAocG9zaXRpb24ucm93ID49IGxlbmd0aCkge1xuICAgICAgICBwb3NpdGlvbi5yb3cgPSBNYXRoLm1heCgwLCBsZW5ndGggLSAxKTtcbiAgICAgICAgcG9zaXRpb24uY29sdW1uID0gZG9jLmdldExpbmUobGVuZ3RoIC0gMSkubGVuZ3RoO1xuICAgIH0gZWxzZSBpZiAocG9zaXRpb24ucm93IDwgMCkge1xuICAgICAgICBwb3NpdGlvbi5yb3cgPSAwO1xuICAgIH1cbiAgICByZXR1cm4gcG9zaXRpb247XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEVkaXRvckRvY3VtZW50IGV4dGVuZHMgRXZlbnRFbWl0dGVyQ2xhc3Mge1xuICAgIHByaXZhdGUgJGxpbmVzOiBzdHJpbmdbXSA9IFtdO1xuICAgIHByaXZhdGUgJGF1dG9OZXdMaW5lOiBzdHJpbmcgPSBcIlwiO1xuICAgIHByaXZhdGUgJG5ld0xpbmVNb2RlOiBzdHJpbmcgPSBcImF1dG9cIjtcbiAgICBjb25zdHJ1Y3Rvcih0ZXh0OiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+KSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgLy8gVGhlcmUgaGFzIHRvIGJlIG9uZSBsaW5lIGF0IGxlYXN0IGluIHRoZSBkb2N1bWVudC4gSWYgeW91IHBhc3MgYW4gZW1wdHlcbiAgICAgICAgLy8gc3RyaW5nIHRvIHRoZSBpbnNlcnQgZnVuY3Rpb24sIG5vdGhpbmcgd2lsbCBoYXBwZW4uIFdvcmthcm91bmQuXG4gICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy4kbGluZXMgPSBbXCJcIl07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh0ZXh0KSkge1xuICAgICAgICAgICAgdGhpcy5faW5zZXJ0TGluZXMoMCwgdGV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmluc2VydCh7IHJvdzogMCwgY29sdW1uOiAwIH0sIHRleHQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVwbGFjZXMgYWxsIHRoZSBsaW5lcyBpbiB0aGUgY3VycmVudCBgRWRpdG9yRG9jdW1lbnRgIHdpdGggdGhlIHZhbHVlIG9mIGB0ZXh0YC5cbiAgICAgKiBAbWV0aG9kIHNldFZhbHVlXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQgVGhlIHRleHQgdG8gdXNlXG4gICAgICogQHJldHVybiB7dm9pZH1cbiAgICAgKi9cbiAgICBzZXRWYWx1ZSh0ZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdmFyIGxlbiA9IHRoaXMuZ2V0TGVuZ3RoKCk7XG4gICAgICAgIHRoaXMucmVtb3ZlKG5ldyBSYW5nZSgwLCAwLCBsZW4sIHRoaXMuZ2V0TGluZShsZW4gLSAxKS5sZW5ndGgpKTtcbiAgICAgICAgdGhpcy5pbnNlcnQoeyByb3c6IDAsIGNvbHVtbjogMCB9LCB0ZXh0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgbGluZXMgaW4gdGhlIGRvY3VtZW50IGFzIGEgc2luZ2xlIHN0cmluZywgam9pbmVkIGJ5IHRoZSBuZXcgbGluZSBjaGFyYWN0ZXIuXG4gICAgICogQG1ldGhvZCBnZXRWYWx1ZVxuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKi9cbiAgICBnZXRWYWx1ZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBbGxMaW5lcygpLmpvaW4odGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCkpO1xuICAgIH1cblxuICAgIC8qKiBcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGBBbmNob3JgIHRvIGRlZmluZSBhIGZsb2F0aW5nIHBvaW50IGluIHRoZSBkb2N1bWVudC5cbiAgICAgKiBAbWV0aG9kIGNyZWF0ZUFuY2hvclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSByb3cgVGhlIHJvdyBudW1iZXIgdG8gdXNlXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGNvbHVtbiBUaGUgY29sdW1uIG51bWJlciB0byB1c2VcbiAgICAgKiBAcmV0dXJuIHtBbmNob3J9XG4gICAgICpcbiAgICAgKi9cbiAgICBjcmVhdGVBbmNob3Iocm93OiBudW1iZXIsIGNvbHVtbjogbnVtYmVyKTogQW5jaG9yIHtcbiAgICAgICAgcmV0dXJuIG5ldyBBbmNob3IodGhpcywgcm93LCBjb2x1bW4pO1xuICAgIH1cblxuICAgIC8qKiBcbiAgICAgKiBTcGxpdHMgYSBzdHJpbmcgb2YgdGV4dCBvbiBhbnkgbmV3bGluZSAoYFxcbmApIG9yIGNhcnJpYWdlLXJldHVybiAoJ1xccicpIGNoYXJhY3RlcnMuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kICRzcGxpdFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IFRoZSB0ZXh0IHRvIHdvcmsgd2l0aFxuICAgICAqL1xuICAgIHByaXZhdGUgJGRldGVjdE5ld0xpbmUodGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHZhciBtYXRjaCA9IHRleHQubWF0Y2goL14uKj8oXFxyXFxufFxccnxcXG4pL20pO1xuICAgICAgICB0aGlzLiRhdXRvTmV3TGluZSA9IG1hdGNoID8gbWF0Y2hbMV0gOiBcIlxcblwiO1xuICAgICAgICB0aGlzLl9zaWduYWwoXCJjaGFuZ2VOZXdMaW5lTW9kZVwiKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIFJldHVybnMgdGhlIG5ld2xpbmUgY2hhcmFjdGVyIHRoYXQncyBiZWluZyB1c2VkLCBkZXBlbmRpbmcgb24gdGhlIHZhbHVlIG9mIGBuZXdMaW5lTW9kZWAuIFxuICAgICogQG1ldGhvZCBnZXROZXdMaW5lQ2hhcmFjdGVyXG4gICAgKiBAcmV0dXJucyB7U3RyaW5nfVxuICAgICogIElmIGBuZXdMaW5lTW9kZSA9PSB3aW5kb3dzYCwgYFxcclxcbmAgaXMgcmV0dXJuZWQuICBcbiAgICAqICBJZiBgbmV3TGluZU1vZGUgPT0gdW5peGAsIGBcXG5gIGlzIHJldHVybmVkLiAgXG4gICAgKiAgSWYgYG5ld0xpbmVNb2RlID09IGF1dG9gLCB0aGUgdmFsdWUgb2YgYGF1dG9OZXdMaW5lYCBpcyByZXR1cm5lZC5cbiAgICAqXG4gICAgKiovXG4gICAgZ2V0TmV3TGluZUNoYXJhY3RlcigpOiBzdHJpbmcge1xuICAgICAgICBzd2l0Y2ggKHRoaXMuJG5ld0xpbmVNb2RlKSB7XG4gICAgICAgICAgICBjYXNlIFwid2luZG93c1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIlxcclxcblwiO1xuICAgICAgICAgICAgY2FzZSBcInVuaXhcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJcXG5cIjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGF1dG9OZXdMaW5lIHx8IFwiXFxuXCI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBuZXcgbGluZSBtb2RlLlxuICAgICAqIEBtZXRob2Qgc2V0TmV3TGluZU1vZGVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmV3TGluZU1vZGUgW1RoZSBuZXdsaW5lIG1vZGUgdG8gdXNlOyBjYW4gYmUgZWl0aGVyIGB3aW5kb3dzYCwgYHVuaXhgLCBvciBgYXV0b2BdezogI0VkaXRvckRvY3VtZW50LnNldE5ld0xpbmVNb2RlLnBhcmFtfVxuICAgICAqIEByZXR1cm4ge3ZvaWR9XG4gICAgICovXG4gICAgc2V0TmV3TGluZU1vZGUobmV3TGluZU1vZGU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy4kbmV3TGluZU1vZGUgPT09IG5ld0xpbmVNb2RlKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuJG5ld0xpbmVNb2RlID0gbmV3TGluZU1vZGU7XG4gICAgICAgIHRoaXMuX3NpZ25hbChcImNoYW5nZU5ld0xpbmVNb2RlXCIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHR5cGUgb2YgbmV3bGluZXMgYmVpbmcgdXNlZDsgZWl0aGVyIGB3aW5kb3dzYCwgYHVuaXhgLCBvciBgYXV0b2BcbiAgICAgKiBAbWV0aG9kIGdldE5ld0xpbmVNb2RlXG4gICAgICogQHJldHVybiB7c3RyaW5nfVxuICAgICAqL1xuICAgIGdldE5ld0xpbmVNb2RlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kbmV3TGluZU1vZGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBgdHJ1ZWAgaWYgYHRleHRgIGlzIGEgbmV3bGluZSBjaGFyYWN0ZXIgKGVpdGhlciBgXFxyXFxuYCwgYFxccmAsIG9yIGBcXG5gKS5cbiAgICAgKiBAbWV0aG9kIGlzTmV3TGluZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IFRoZSB0ZXh0IHRvIGNoZWNrXG4gICAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBpc05ld0xpbmUodGV4dDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAodGV4dCA9PSBcIlxcclxcblwiIHx8IHRleHQgPT0gXCJcXHJcIiB8fCB0ZXh0ID09IFwiXFxuXCIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSB2ZXJiYXRpbSBjb3B5IG9mIHRoZSBnaXZlbiBsaW5lIGFzIGl0IGlzIGluIHRoZSBkb2N1bWVudFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSByb3cgVGhlIHJvdyBpbmRleCB0byByZXRyaWV2ZVxuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKi9cbiAgICBnZXRMaW5lKHJvdzogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGxpbmVzW3Jvd10gfHwgXCJcIjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIFJldHVybnMgYW4gYXJyYXkgb2Ygc3RyaW5ncyBvZiB0aGUgcm93cyBiZXR3ZWVuIGBmaXJzdFJvd2AgYW5kIGBsYXN0Um93YC4gVGhpcyBmdW5jdGlvbiBpcyBpbmNsdXNpdmUgb2YgYGxhc3RSb3dgLlxuICAgICogQHBhcmFtIHtOdW1iZXJ9IGZpcnN0Um93IFRoZSBmaXJzdCByb3cgaW5kZXggdG8gcmV0cmlldmVcbiAgICAqIEBwYXJhbSB7TnVtYmVyfSBsYXN0Um93IFRoZSBmaW5hbCByb3cgaW5kZXggdG8gcmV0cmlldmVcbiAgICAqXG4gICAgKiovXG4gICAgZ2V0TGluZXMoZmlyc3RSb3c/OiBudW1iZXIsIGxhc3RSb3c/OiBudW1iZXIpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRsaW5lcy5zbGljZShmaXJzdFJvdywgbGFzdFJvdyArIDEpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogUmV0dXJucyBhbGwgbGluZXMgaW4gdGhlIGRvY3VtZW50IGFzIHN0cmluZyBhcnJheS5cbiAgICAqKi9cbiAgICBnZXRBbGxMaW5lcygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldExpbmVzKDAsIHRoaXMuZ2V0TGVuZ3RoKCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIGRvY3VtZW50LlxuICAgICoqL1xuICAgIGdldExlbmd0aCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy4kbGluZXMubGVuZ3RoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdpdmVuIGEgcmFuZ2Ugd2l0aGluIHRoZSBkb2N1bWVudCwgcmV0dXJucyBhbGwgdGhlIHRleHQgd2l0aGluIHRoYXQgcmFuZ2UgYXMgYSBzaW5nbGUgc3RyaW5nLlxuICAgICAqIEBwYXJhbSB7UmFuZ2V9IHJhbmdlIFRoZSByYW5nZSB0byB3b3JrIHdpdGhcbiAgICAgKlxuICAgICAqL1xuICAgIGdldFRleHRSYW5nZShyYW5nZTogUmFuZ2UpOiBzdHJpbmcge1xuICAgICAgICBpZiAocmFuZ2Uuc3RhcnQucm93ID09IHJhbmdlLmVuZC5yb3cpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldExpbmUocmFuZ2Uuc3RhcnQucm93KS5zdWJzdHJpbmcocmFuZ2Uuc3RhcnQuY29sdW1uLCByYW5nZS5lbmQuY29sdW1uKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbGluZXMgPSB0aGlzLmdldExpbmVzKHJhbmdlLnN0YXJ0LnJvdywgcmFuZ2UuZW5kLnJvdyk7XG4gICAgICAgIGxpbmVzWzBdID0gKGxpbmVzWzBdIHx8IFwiXCIpLnN1YnN0cmluZyhyYW5nZS5zdGFydC5jb2x1bW4pO1xuICAgICAgICB2YXIgbCA9IGxpbmVzLmxlbmd0aCAtIDE7XG4gICAgICAgIGlmIChyYW5nZS5lbmQucm93IC0gcmFuZ2Uuc3RhcnQucm93ID09IGwpIHtcbiAgICAgICAgICAgIGxpbmVzW2xdID0gbGluZXNbbF0uc3Vic3RyaW5nKDAsIHJhbmdlLmVuZC5jb2x1bW4pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsaW5lcy5qb2luKHRoaXMuZ2V0TmV3TGluZUNoYXJhY3RlcigpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIEluc2VydHMgYSBibG9jayBvZiBgdGV4dGAgYXQgdGhlIGluZGljYXRlZCBgcG9zaXRpb25gLlxuICAgICogQHBhcmFtIHtPYmplY3R9IHBvc2l0aW9uIFRoZSBwb3NpdGlvbiB0byBzdGFydCBpbnNlcnRpbmcgYXQ7IGl0J3MgYW4gb2JqZWN0IHRoYXQgbG9va3MgbGlrZSBgeyByb3c6IHJvdywgY29sdW1uOiBjb2x1bW59YFxuICAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQgQSBjaHVuayBvZiB0ZXh0IHRvIGluc2VydFxuICAgICogQHJldHVybnMge09iamVjdH0gVGhlIHBvc2l0aW9uICh7cm93LCBjb2x1bW59KSBvZiB0aGUgbGFzdCBsaW5lIG9mIGB0ZXh0YC4gSWYgdGhlIGxlbmd0aCBvZiBgdGV4dGAgaXMgMCwgdGhpcyBmdW5jdGlvbiBzaW1wbHkgcmV0dXJucyBgcG9zaXRpb25gLiBcbiAgICAqXG4gICAgKiovXG4gICAgaW5zZXJ0KHBvc2l0aW9uOiB7IHJvdzogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9LCB0ZXh0OiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKCF0ZXh0IHx8IHRleHQubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xuXG4gICAgICAgIHBvc2l0aW9uID0gJGNsaXBQb3NpdGlvbih0aGlzLCBwb3NpdGlvbik7XG5cbiAgICAgICAgLy8gb25seSBkZXRlY3QgbmV3IGxpbmVzIGlmIHRoZSBkb2N1bWVudCBoYXMgbm8gbGluZSBicmVhayB5ZXRcbiAgICAgICAgaWYgKHRoaXMuZ2V0TGVuZ3RoKCkgPD0gMSkge1xuICAgICAgICAgICAgdGhpcy4kZGV0ZWN0TmV3TGluZSh0ZXh0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsaW5lcyA9ICRzcGxpdCh0ZXh0KTtcbiAgICAgICAgdmFyIGZpcnN0TGluZSA9IGxpbmVzLnNwbGljZSgwLCAxKVswXTtcbiAgICAgICAgdmFyIGxhc3RMaW5lID0gbGluZXMubGVuZ3RoID09IDAgPyBudWxsIDogbGluZXMuc3BsaWNlKGxpbmVzLmxlbmd0aCAtIDEsIDEpWzBdO1xuXG4gICAgICAgIHBvc2l0aW9uID0gdGhpcy5pbnNlcnRJbkxpbmUocG9zaXRpb24sIGZpcnN0TGluZSk7XG4gICAgICAgIGlmIChsYXN0TGluZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcG9zaXRpb24gPSB0aGlzLmluc2VydE5ld0xpbmUocG9zaXRpb24pOyAvLyB0ZXJtaW5hdGUgZmlyc3QgbGluZVxuICAgICAgICAgICAgcG9zaXRpb24gPSB0aGlzLl9pbnNlcnRMaW5lcyhwb3NpdGlvbi5yb3csIGxpbmVzKTtcbiAgICAgICAgICAgIHBvc2l0aW9uID0gdGhpcy5pbnNlcnRJbkxpbmUocG9zaXRpb24sIGxhc3RMaW5lIHx8IFwiXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwb3NpdGlvbjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaXJlcyB3aGVuZXZlciB0aGUgZG9jdW1lbnQgY2hhbmdlcy5cbiAgICAgKlxuICAgICAqIFNldmVyYWwgbWV0aG9kcyB0cmlnZ2VyIGRpZmZlcmVudCBgXCJjaGFuZ2VcImAgZXZlbnRzLiBCZWxvdyBpcyBhIGxpc3Qgb2YgZWFjaCBhY3Rpb24gdHlwZSwgZm9sbG93ZWQgYnkgZWFjaCBwcm9wZXJ0eSB0aGF0J3MgYWxzbyBhdmFpbGFibGU6XG4gICAgICpcbiAgICAgKiAgKiBgXCJpbnNlcnRMaW5lc1wiYCAoZW1pdHRlZCBieSBbW0VkaXRvckRvY3VtZW50Lmluc2VydExpbmVzXV0pXG4gICAgICogICAgKiBgcmFuZ2VgOiB0aGUgW1tSYW5nZV1dIG9mIHRoZSBjaGFuZ2Ugd2l0aGluIHRoZSBkb2N1bWVudFxuICAgICAqICAgICogYGxpbmVzYDogdGhlIGxpbmVzIGluIHRoZSBkb2N1bWVudCB0aGF0IGFyZSBjaGFuZ2luZ1xuICAgICAqICAqIGBcImluc2VydFRleHRcImAgKGVtaXR0ZWQgYnkgW1tFZGl0b3JEb2N1bWVudC5pbnNlcnROZXdMaW5lXV0pXG4gICAgICogICAgKiBgcmFuZ2VgOiB0aGUgW1tSYW5nZV1dIG9mIHRoZSBjaGFuZ2Ugd2l0aGluIHRoZSBkb2N1bWVudFxuICAgICAqICAgICogYHRleHRgOiB0aGUgdGV4dCB0aGF0J3MgYmVpbmcgYWRkZWRcbiAgICAgKiAgKiBgXCJyZW1vdmVMaW5lc1wiYCAoZW1pdHRlZCBieSBbW0VkaXRvckRvY3VtZW50Lmluc2VydExpbmVzXV0pXG4gICAgICogICAgKiBgcmFuZ2VgOiB0aGUgW1tSYW5nZV1dIG9mIHRoZSBjaGFuZ2Ugd2l0aGluIHRoZSBkb2N1bWVudFxuICAgICAqICAgICogYGxpbmVzYDogdGhlIGxpbmVzIGluIHRoZSBkb2N1bWVudCB0aGF0IHdlcmUgcmVtb3ZlZFxuICAgICAqICAgICogYG5sYDogdGhlIG5ldyBsaW5lIGNoYXJhY3RlciAoYXMgZGVmaW5lZCBieSBbW0VkaXRvckRvY3VtZW50LmdldE5ld0xpbmVDaGFyYWN0ZXJdXSlcbiAgICAgKiAgKiBgXCJyZW1vdmVUZXh0XCJgIChlbWl0dGVkIGJ5IFtbRWRpdG9yRG9jdW1lbnQucmVtb3ZlSW5MaW5lXV0gYW5kIFtbRWRpdG9yRG9jdW1lbnQucmVtb3ZlTmV3TGluZV1dKVxuICAgICAqICAgICogYHJhbmdlYDogdGhlIFtbUmFuZ2VdXSBvZiB0aGUgY2hhbmdlIHdpdGhpbiB0aGUgZG9jdW1lbnRcbiAgICAgKiAgICAqIGB0ZXh0YDogdGhlIHRleHQgdGhhdCdzIGJlaW5nIHJlbW92ZWRcbiAgICAgKlxuICAgICAqIEBldmVudCBjaGFuZ2VcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZSBDb250YWlucyBhdCBsZWFzdCBvbmUgcHJvcGVydHkgY2FsbGVkIGBcImFjdGlvblwiYC4gYFwiYWN0aW9uXCJgIGluZGljYXRlcyB0aGUgYWN0aW9uIHRoYXQgdHJpZ2dlcmVkIHRoZSBjaGFuZ2UuIEVhY2ggYWN0aW9uIGFsc28gaGFzIGEgc2V0IG9mIGFkZGl0aW9uYWwgcHJvcGVydGllcy5cbiAgICAgKlxuICAgICAqKi9cbiAgICAvKipcbiAgICAqIEluc2VydHMgdGhlIGVsZW1lbnRzIGluIGBsaW5lc2AgaW50byB0aGUgZG9jdW1lbnQsIHN0YXJ0aW5nIGF0IHRoZSByb3cgaW5kZXggZ2l2ZW4gYnkgYHJvd2AuIFRoaXMgbWV0aG9kIGFsc28gdHJpZ2dlcnMgdGhlIGAnY2hhbmdlJ2AgZXZlbnQuXG4gICAgKiBAcGFyYW0ge051bWJlcn0gcm93IFRoZSBpbmRleCBvZiB0aGUgcm93IHRvIGluc2VydCBhdFxuICAgICogQHBhcmFtIHtBcnJheX0gbGluZXMgQW4gYXJyYXkgb2Ygc3RyaW5nc1xuICAgICogQHJldHVybnMge09iamVjdH0gQ29udGFpbnMgdGhlIGZpbmFsIHJvdyBhbmQgY29sdW1uLCBsaWtlIHRoaXM6ICBcbiAgICAqICAgYGBgXG4gICAgKiAgIHtyb3c6IGVuZFJvdywgY29sdW1uOiAwfVxuICAgICogICBgYGAgIFxuICAgICogICBJZiBgbGluZXNgIGlzIGVtcHR5LCB0aGlzIGZ1bmN0aW9uIHJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGN1cnJlbnQgcm93LCBhbmQgY29sdW1uLCBsaWtlIHRoaXM6ICBcbiAgICAqICAgYGBgIFxuICAgICogICB7cm93OiByb3csIGNvbHVtbjogMH1cbiAgICAqICAgYGBgXG4gICAgKlxuICAgICoqL1xuICAgIGluc2VydExpbmVzKHJvdzogbnVtYmVyLCBsaW5lczogc3RyaW5nW10pIHtcbiAgICAgICAgaWYgKHJvdyA+PSB0aGlzLmdldExlbmd0aCgpKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0KHsgcm93OiByb3csIGNvbHVtbjogMCB9LCBcIlxcblwiICsgbGluZXMuam9pbihcIlxcblwiKSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbnNlcnRMaW5lcyhNYXRoLm1heChyb3csIDApLCBsaW5lcyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfaW5zZXJ0TGluZXMocm93OiBudW1iZXIsIGxpbmVzOiBzdHJpbmdbXSkge1xuICAgICAgICBpZiAobGluZXMubGVuZ3RoID09IDApXG4gICAgICAgICAgICByZXR1cm4geyByb3c6IHJvdywgY29sdW1uOiAwIH07XG5cbiAgICAgICAgLy8gYXBwbHkgZG9lc24ndCB3b3JrIGZvciBiaWcgYXJyYXlzIChzbWFsbGVzdCB0aHJlc2hvbGQgaXMgb24gc2FmYXJpIDB4RkZGRilcbiAgICAgICAgLy8gdG8gY2lyY3VtdmVudCB0aGF0IHdlIGhhdmUgdG8gYnJlYWsgaHVnZSBpbnNlcnRzIGludG8gc21hbGxlciBjaHVua3MgaGVyZVxuICAgICAgICB3aGlsZSAobGluZXMubGVuZ3RoID4gMHhGMDAwKSB7XG4gICAgICAgICAgICB2YXIgZW5kID0gdGhpcy5faW5zZXJ0TGluZXMocm93LCBsaW5lcy5zbGljZSgwLCAweEYwMDApKTtcbiAgICAgICAgICAgIGxpbmVzID0gbGluZXMuc2xpY2UoMHhGMDAwKTtcbiAgICAgICAgICAgIHJvdyA9IGVuZC5yb3c7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgYXJncyA9IFtyb3csIDBdO1xuICAgICAgICBhcmdzLnB1c2guYXBwbHkoYXJncywgbGluZXMpO1xuICAgICAgICB0aGlzLiRsaW5lcy5zcGxpY2UuYXBwbHkodGhpcy4kbGluZXMsIGFyZ3MpO1xuXG4gICAgICAgIHZhciByYW5nZSA9IG5ldyBSYW5nZShyb3csIDAsIHJvdyArIGxpbmVzLmxlbmd0aCwgMCk7XG4gICAgICAgIHZhciBkZWx0YSA9IHtcbiAgICAgICAgICAgIGFjdGlvbjogXCJpbnNlcnRMaW5lc1wiLFxuICAgICAgICAgICAgcmFuZ2U6IHJhbmdlLFxuICAgICAgICAgICAgbGluZXM6IGxpbmVzXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3NpZ25hbChcImNoYW5nZVwiLCB7IGRhdGE6IGRlbHRhIH0pO1xuICAgICAgICByZXR1cm4gcmFuZ2UuZW5kO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogSW5zZXJ0cyBhIG5ldyBsaW5lIGludG8gdGhlIGRvY3VtZW50IGF0IHRoZSBjdXJyZW50IHJvdydzIGBwb3NpdGlvbmAuIFRoaXMgbWV0aG9kIGFsc28gdHJpZ2dlcnMgdGhlIGAnY2hhbmdlJ2AgZXZlbnQuIFxuICAgICogQHBhcmFtIHtPYmplY3R9IHBvc2l0aW9uIFRoZSBwb3NpdGlvbiB0byBpbnNlcnQgYXRcbiAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGZpbmFsIHJvdyBhbmQgY29sdW1uLCBsaWtlIHRoaXM6PGJyLz5cbiAgICAqICAgIGBgYFxuICAgICogICAge3JvdzogZW5kUm93LCBjb2x1bW46IDB9XG4gICAgKiAgICBgYGBcbiAgICAqXG4gICAgKiovXG4gICAgaW5zZXJ0TmV3TGluZShwb3NpdGlvbjogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfSkge1xuICAgICAgICBwb3NpdGlvbiA9ICRjbGlwUG9zaXRpb24odGhpcywgcG9zaXRpb24pO1xuICAgICAgICB2YXIgbGluZSA9IHRoaXMuJGxpbmVzW3Bvc2l0aW9uLnJvd10gfHwgXCJcIjtcblxuICAgICAgICB0aGlzLiRsaW5lc1twb3NpdGlvbi5yb3ddID0gbGluZS5zdWJzdHJpbmcoMCwgcG9zaXRpb24uY29sdW1uKTtcbiAgICAgICAgdGhpcy4kbGluZXMuc3BsaWNlKHBvc2l0aW9uLnJvdyArIDEsIDAsIGxpbmUuc3Vic3RyaW5nKHBvc2l0aW9uLmNvbHVtbiwgbGluZS5sZW5ndGgpKTtcblxuICAgICAgICB2YXIgZW5kID0ge1xuICAgICAgICAgICAgcm93OiBwb3NpdGlvbi5yb3cgKyAxLFxuICAgICAgICAgICAgY29sdW1uOiAwXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGRlbHRhID0ge1xuICAgICAgICAgICAgYWN0aW9uOiBcImluc2VydFRleHRcIixcbiAgICAgICAgICAgIHJhbmdlOiBSYW5nZS5mcm9tUG9pbnRzKHBvc2l0aW9uLCBlbmQpLFxuICAgICAgICAgICAgdGV4dDogdGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKClcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5fc2lnbmFsKFwiY2hhbmdlXCIsIHsgZGF0YTogZGVsdGEgfSk7XG5cbiAgICAgICAgcmV0dXJuIGVuZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIEluc2VydHMgYHRleHRgIGludG8gdGhlIGBwb3NpdGlvbmAgYXQgdGhlIGN1cnJlbnQgcm93LiBUaGlzIG1ldGhvZCBhbHNvIHRyaWdnZXJzIHRoZSBgJ2NoYW5nZSdgIGV2ZW50LlxuICAgICogQHBhcmFtIHtPYmplY3R9IHBvc2l0aW9uIFRoZSBwb3NpdGlvbiB0byBpbnNlcnQgYXQuXG4gICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBBIGNodW5rIG9mIHRleHRcbiAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGZpbmFsIHJvdyBhbmQgY29sdW1uLlxuICAgICoqL1xuICAgIGluc2VydEluTGluZShwb3NpdGlvbjogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfSwgdGV4dDogc3RyaW5nKTogeyByb3c6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfSB7XG4gICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA9PSAwKVxuICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xuXG4gICAgICAgIHZhciBsaW5lID0gdGhpcy4kbGluZXNbcG9zaXRpb24ucm93XSB8fCBcIlwiO1xuXG4gICAgICAgIHRoaXMuJGxpbmVzW3Bvc2l0aW9uLnJvd10gPSBsaW5lLnN1YnN0cmluZygwLCBwb3NpdGlvbi5jb2x1bW4pICsgdGV4dCArIGxpbmUuc3Vic3RyaW5nKHBvc2l0aW9uLmNvbHVtbik7XG5cbiAgICAgICAgdmFyIGVuZCA9IHtcbiAgICAgICAgICAgIHJvdzogcG9zaXRpb24ucm93LFxuICAgICAgICAgICAgY29sdW1uOiBwb3NpdGlvbi5jb2x1bW4gKyB0ZXh0Lmxlbmd0aFxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBkZWx0YSA9IHsgYWN0aW9uOiBcImluc2VydFRleHRcIiwgcmFuZ2U6IFJhbmdlLmZyb21Qb2ludHMocG9zaXRpb24sIGVuZCksIHRleHQ6IHRleHQgfTtcbiAgICAgICAgdGhpcy5fc2lnbmFsKFwiY2hhbmdlXCIsIHsgZGF0YTogZGVsdGEgfSk7XG5cbiAgICAgICAgcmV0dXJuIGVuZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIFJlbW92ZXMgdGhlIGByYW5nZWAgZnJvbSB0aGUgZG9jdW1lbnQuXG4gICAgKiBAcGFyYW0ge1JhbmdlfSByYW5nZSBBIHNwZWNpZmllZCBSYW5nZSB0byByZW1vdmVcbiAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBgc3RhcnRgIHByb3BlcnR5IG9mIHRoZSByYW5nZSwgd2hpY2ggY29udGFpbnMgYHN0YXJ0Um93YCBhbmQgYHN0YXJ0Q29sdW1uYC4gSWYgYHJhbmdlYCBpcyBlbXB0eSwgdGhpcyBmdW5jdGlvbiByZXR1cm5zIHRoZSB1bm1vZGlmaWVkIHZhbHVlIG9mIGByYW5nZS5zdGFydGAuXG4gICAgKlxuICAgICoqL1xuICAgIHJlbW92ZShyYW5nZTogeyBzdGFydDsgZW5kOyBpc0VtcHR5OyBpc011bHRpTGluZSB9KSB7XG4gICAgICAgIGlmICghKHJhbmdlIGluc3RhbmNlb2YgUmFuZ2UpKVxuICAgICAgICAgICAgcmFuZ2UgPSBSYW5nZS5mcm9tUG9pbnRzKHJhbmdlLnN0YXJ0LCByYW5nZS5lbmQpO1xuICAgICAgICAvLyBjbGlwIHRvIGRvY3VtZW50XG4gICAgICAgIHJhbmdlLnN0YXJ0ID0gJGNsaXBQb3NpdGlvbih0aGlzLCByYW5nZS5zdGFydCk7XG4gICAgICAgIHJhbmdlLmVuZCA9ICRjbGlwUG9zaXRpb24odGhpcywgcmFuZ2UuZW5kKTtcblxuICAgICAgICBpZiAocmFuZ2UuaXNFbXB0eSgpKVxuICAgICAgICAgICAgcmV0dXJuIHJhbmdlLnN0YXJ0O1xuXG4gICAgICAgIHZhciBmaXJzdFJvdyA9IHJhbmdlLnN0YXJ0LnJvdztcbiAgICAgICAgdmFyIGxhc3RSb3cgPSByYW5nZS5lbmQucm93O1xuXG4gICAgICAgIGlmIChyYW5nZS5pc011bHRpTGluZSgpKSB7XG4gICAgICAgICAgICB2YXIgZmlyc3RGdWxsUm93ID0gcmFuZ2Uuc3RhcnQuY29sdW1uID09IDAgPyBmaXJzdFJvdyA6IGZpcnN0Um93ICsgMTtcbiAgICAgICAgICAgIHZhciBsYXN0RnVsbFJvdyA9IGxhc3RSb3cgLSAxO1xuXG4gICAgICAgICAgICBpZiAocmFuZ2UuZW5kLmNvbHVtbiA+IDApXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVJbkxpbmUobGFzdFJvdywgMCwgcmFuZ2UuZW5kLmNvbHVtbik7XG5cbiAgICAgICAgICAgIGlmIChsYXN0RnVsbFJvdyA+PSBmaXJzdEZ1bGxSb3cpXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlTGluZXMoZmlyc3RGdWxsUm93LCBsYXN0RnVsbFJvdyk7XG5cbiAgICAgICAgICAgIGlmIChmaXJzdEZ1bGxSb3cgIT0gZmlyc3RSb3cpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUluTGluZShmaXJzdFJvdywgcmFuZ2Uuc3RhcnQuY29sdW1uLCB0aGlzLmdldExpbmUoZmlyc3RSb3cpLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVOZXdMaW5lKHJhbmdlLnN0YXJ0LnJvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZUluTGluZShmaXJzdFJvdywgcmFuZ2Uuc3RhcnQuY29sdW1uLCByYW5nZS5lbmQuY29sdW1uKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmFuZ2Uuc3RhcnQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBSZW1vdmVzIHRoZSBzcGVjaWZpZWQgY29sdW1ucyBmcm9tIHRoZSBgcm93YC4gVGhpcyBtZXRob2QgYWxzbyB0cmlnZ2VycyB0aGUgYCdjaGFuZ2UnYCBldmVudC5cbiAgICAqIEBwYXJhbSB7TnVtYmVyfSByb3cgVGhlIHJvdyB0byByZW1vdmUgZnJvbVxuICAgICogQHBhcmFtIHtOdW1iZXJ9IHN0YXJ0Q29sdW1uIFRoZSBjb2x1bW4gdG8gc3RhcnQgcmVtb3ZpbmcgYXQgXG4gICAgKiBAcGFyYW0ge051bWJlcn0gZW5kQ29sdW1uIFRoZSBjb2x1bW4gdG8gc3RvcCByZW1vdmluZyBhdFxuICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyBgc3RhcnRSb3dgIGFuZCBgc3RhcnRDb2x1bW5gLCBpbmRpY2F0aW5nIHRoZSBuZXcgcm93IGFuZCBjb2x1bW4gdmFsdWVzLjxici8+SWYgYHN0YXJ0Q29sdW1uYCBpcyBlcXVhbCB0byBgZW5kQ29sdW1uYCwgdGhpcyBmdW5jdGlvbiByZXR1cm5zIG5vdGhpbmcuXG4gICAgKlxuICAgICoqL1xuICAgIHJlbW92ZUluTGluZShyb3c6IG51bWJlciwgc3RhcnRDb2x1bW46IG51bWJlciwgZW5kQ29sdW1uOiBudW1iZXIpIHtcbiAgICAgICAgaWYgKHN0YXJ0Q29sdW1uID09PSBlbmRDb2x1bW4pXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgdmFyIHJhbmdlID0gbmV3IFJhbmdlKHJvdywgc3RhcnRDb2x1bW4sIHJvdywgZW5kQ29sdW1uKTtcbiAgICAgICAgdmFyIGxpbmUgPSB0aGlzLmdldExpbmUocm93KTtcbiAgICAgICAgdmFyIHJlbW92ZWQgPSBsaW5lLnN1YnN0cmluZyhzdGFydENvbHVtbiwgZW5kQ29sdW1uKTtcbiAgICAgICAgdmFyIG5ld0xpbmUgPSBsaW5lLnN1YnN0cmluZygwLCBzdGFydENvbHVtbikgKyBsaW5lLnN1YnN0cmluZyhlbmRDb2x1bW4sIGxpbmUubGVuZ3RoKTtcbiAgICAgICAgdGhpcy4kbGluZXMuc3BsaWNlKHJvdywgMSwgbmV3TGluZSk7XG5cbiAgICAgICAgdmFyIGRlbHRhID0ge1xuICAgICAgICAgICAgYWN0aW9uOiBcInJlbW92ZVRleHRcIixcbiAgICAgICAgICAgIHJhbmdlOiByYW5nZSxcbiAgICAgICAgICAgIHRleHQ6IHJlbW92ZWRcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5fc2lnbmFsKFwiY2hhbmdlXCIsIHsgZGF0YTogZGVsdGEgfSk7XG4gICAgICAgIHJldHVybiByYW5nZS5zdGFydDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIFJlbW92ZXMgYSByYW5nZSBvZiBmdWxsIGxpbmVzLiBUaGlzIG1ldGhvZCBhbHNvIHRyaWdnZXJzIHRoZSBgJ2NoYW5nZSdgIGV2ZW50LlxuICAgICogQHBhcmFtIHtOdW1iZXJ9IGZpcnN0Um93IFRoZSBmaXJzdCByb3cgdG8gYmUgcmVtb3ZlZFxuICAgICogQHBhcmFtIHtOdW1iZXJ9IGxhc3RSb3cgVGhlIGxhc3Qgcm93IHRvIGJlIHJlbW92ZWRcbiAgICAqIEByZXR1cm5zIHtbU3RyaW5nXX0gUmV0dXJucyBhbGwgdGhlIHJlbW92ZWQgbGluZXMuXG4gICAgKlxuICAgICoqL1xuICAgIHJlbW92ZUxpbmVzKGZpcnN0Um93OiBudW1iZXIsIGxhc3RSb3c6IG51bWJlcik6IHN0cmluZ1tdIHtcbiAgICAgICAgaWYgKGZpcnN0Um93IDwgMCB8fCBsYXN0Um93ID49IHRoaXMuZ2V0TGVuZ3RoKCkpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZW1vdmUobmV3IFJhbmdlKGZpcnN0Um93LCAwLCBsYXN0Um93ICsgMSwgMCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVtb3ZlTGluZXMoZmlyc3RSb3csIGxhc3RSb3cpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX3JlbW92ZUxpbmVzKGZpcnN0Um93OiBudW1iZXIsIGxhc3RSb3c6IG51bWJlcik6IHN0cmluZ1tdIHtcbiAgICAgICAgdmFyIHJhbmdlID0gbmV3IFJhbmdlKGZpcnN0Um93LCAwLCBsYXN0Um93ICsgMSwgMCk7XG4gICAgICAgIHZhciByZW1vdmVkID0gdGhpcy4kbGluZXMuc3BsaWNlKGZpcnN0Um93LCBsYXN0Um93IC0gZmlyc3RSb3cgKyAxKTtcblxuICAgICAgICB2YXIgZGVsdGEgPSB7XG4gICAgICAgICAgICBhY3Rpb246IFwicmVtb3ZlTGluZXNcIixcbiAgICAgICAgICAgIHJhbmdlOiByYW5nZSxcbiAgICAgICAgICAgIG5sOiB0aGlzLmdldE5ld0xpbmVDaGFyYWN0ZXIoKSxcbiAgICAgICAgICAgIGxpbmVzOiByZW1vdmVkXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3NpZ25hbChcImNoYW5nZVwiLCB7IGRhdGE6IGRlbHRhIH0pO1xuICAgICAgICByZXR1cm4gcmVtb3ZlZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIFJlbW92ZXMgdGhlIG5ldyBsaW5lIGJldHdlZW4gYHJvd2AgYW5kIHRoZSByb3cgaW1tZWRpYXRlbHkgZm9sbG93aW5nIGl0LiBUaGlzIG1ldGhvZCBhbHNvIHRyaWdnZXJzIHRoZSBgJ2NoYW5nZSdgIGV2ZW50LlxuICAgICogQHBhcmFtIHtOdW1iZXJ9IHJvdyBUaGUgcm93IHRvIGNoZWNrXG4gICAgKlxuICAgICoqL1xuICAgIHJlbW92ZU5ld0xpbmUocm93OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgdmFyIGZpcnN0TGluZSA9IHRoaXMuZ2V0TGluZShyb3cpO1xuICAgICAgICB2YXIgc2Vjb25kTGluZSA9IHRoaXMuZ2V0TGluZShyb3cgKyAxKTtcblxuICAgICAgICB2YXIgcmFuZ2UgPSBuZXcgUmFuZ2Uocm93LCBmaXJzdExpbmUubGVuZ3RoLCByb3cgKyAxLCAwKTtcbiAgICAgICAgdmFyIGxpbmUgPSBmaXJzdExpbmUgKyBzZWNvbmRMaW5lO1xuXG4gICAgICAgIHRoaXMuJGxpbmVzLnNwbGljZShyb3csIDIsIGxpbmUpO1xuXG4gICAgICAgIHZhciBkZWx0YSA9IHtcbiAgICAgICAgICAgIGFjdGlvbjogXCJyZW1vdmVUZXh0XCIsXG4gICAgICAgICAgICByYW5nZTogcmFuZ2UsXG4gICAgICAgICAgICB0ZXh0OiB0aGlzLmdldE5ld0xpbmVDaGFyYWN0ZXIoKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9zaWduYWwoXCJjaGFuZ2VcIiwgeyBkYXRhOiBkZWx0YSB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIFJlcGxhY2VzIGEgcmFuZ2UgaW4gdGhlIGRvY3VtZW50IHdpdGggdGhlIG5ldyBgdGV4dGAuXG4gICAgKiBAcGFyYW0ge1JhbmdlfSByYW5nZSBBIHNwZWNpZmllZCBSYW5nZSB0byByZXBsYWNlXG4gICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBUaGUgbmV3IHRleHQgdG8gdXNlIGFzIGEgcmVwbGFjZW1lbnRcbiAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGZpbmFsIHJvdyBhbmQgY29sdW1uLCBsaWtlIHRoaXM6XG4gICAgKiAgICAge3JvdzogZW5kUm93LCBjb2x1bW46IDB9XG4gICAgKiBJZiB0aGUgdGV4dCBhbmQgcmFuZ2UgYXJlIGVtcHR5LCB0aGlzIGZ1bmN0aW9uIHJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGN1cnJlbnQgYHJhbmdlLnN0YXJ0YCB2YWx1ZS5cbiAgICAqIElmIHRoZSB0ZXh0IGlzIHRoZSBleGFjdCBzYW1lIGFzIHdoYXQgY3VycmVudGx5IGV4aXN0cywgdGhpcyBmdW5jdGlvbiByZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBjdXJyZW50IGByYW5nZS5lbmRgIHZhbHVlLlxuICAgICpcbiAgICAqKi9cbiAgICByZXBsYWNlKHJhbmdlOiBSYW5nZSwgdGV4dDogc3RyaW5nKSB7XG4gICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA9PSAwICYmIHJhbmdlLmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiByYW5nZS5zdGFydDtcblxuICAgICAgICAvLyBTaG9ydGN1dDogSWYgdGhlIHRleHQgd2Ugd2FudCB0byBpbnNlcnQgaXMgdGhlIHNhbWUgYXMgaXQgaXMgYWxyZWFkeVxuICAgICAgICAvLyBpbiB0aGUgZG9jdW1lbnQsIHdlIGRvbid0IGhhdmUgdG8gcmVwbGFjZSBhbnl0aGluZy5cbiAgICAgICAgaWYgKHRleHQgPT0gdGhpcy5nZXRUZXh0UmFuZ2UocmFuZ2UpKVxuICAgICAgICAgICAgcmV0dXJuIHJhbmdlLmVuZDtcblxuICAgICAgICB0aGlzLnJlbW92ZShyYW5nZSk7XG4gICAgICAgIGlmICh0ZXh0KSB7XG4gICAgICAgICAgICB2YXIgZW5kID0gdGhpcy5pbnNlcnQocmFuZ2Uuc3RhcnQsIHRleHQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZW5kID0gcmFuZ2Uuc3RhcnQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZW5kO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogQXBwbGllcyBhbGwgdGhlIGNoYW5nZXMgcHJldmlvdXNseSBhY2N1bXVsYXRlZC4gVGhlc2UgY2FuIGJlIGVpdGhlciBgJ2luY2x1ZGVUZXh0J2AsIGAnaW5zZXJ0TGluZXMnYCwgYCdyZW1vdmVUZXh0J2AsIGFuZCBgJ3JlbW92ZUxpbmVzJ2AuXG4gICAgKiovXG4gICAgYXBwbHlEZWx0YXMoZGVsdGFzOiB7IGFjdGlvbjogc3RyaW5nOyBsaW5lczogc3RyaW5nW107IHJhbmdlOiB7IHN0YXJ0OiB7IHJvdzogbnVtYmVyOyBjb2x1bW46IG51bWJlciB9OyBlbmQ6IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0gfTsgdGV4dDogc3RyaW5nIH1bXSkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRlbHRhcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGRlbHRhID0gZGVsdGFzW2ldO1xuICAgICAgICAgICAgdmFyIHJhbmdlID0gUmFuZ2UuZnJvbVBvaW50cyhkZWx0YS5yYW5nZS5zdGFydCwgZGVsdGEucmFuZ2UuZW5kKTtcblxuICAgICAgICAgICAgaWYgKGRlbHRhLmFjdGlvbiA9PSBcImluc2VydExpbmVzXCIpXG4gICAgICAgICAgICAgICAgdGhpcy5pbnNlcnRMaW5lcyhyYW5nZS5zdGFydC5yb3csIGRlbHRhLmxpbmVzKTtcbiAgICAgICAgICAgIGVsc2UgaWYgKGRlbHRhLmFjdGlvbiA9PSBcImluc2VydFRleHRcIilcbiAgICAgICAgICAgICAgICB0aGlzLmluc2VydChyYW5nZS5zdGFydCwgZGVsdGEudGV4dCk7XG4gICAgICAgICAgICBlbHNlIGlmIChkZWx0YS5hY3Rpb24gPT0gXCJyZW1vdmVMaW5lc1wiKVxuICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUxpbmVzKHJhbmdlLnN0YXJ0LnJvdywgcmFuZ2UuZW5kLnJvdyAtIDEpO1xuICAgICAgICAgICAgZWxzZSBpZiAoZGVsdGEuYWN0aW9uID09IFwicmVtb3ZlVGV4dFwiKVxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKHJhbmdlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICogUmV2ZXJ0cyBhbnkgY2hhbmdlcyBwcmV2aW91c2x5IGFwcGxpZWQuIFRoZXNlIGNhbiBiZSBlaXRoZXIgYCdpbmNsdWRlVGV4dCdgLCBgJ2luc2VydExpbmVzJ2AsIGAncmVtb3ZlVGV4dCdgLCBhbmQgYCdyZW1vdmVMaW5lcydgLlxuICAgICoqL1xuICAgIHJldmVydERlbHRhcyhkZWx0YXM6IHsgYWN0aW9uOiBzdHJpbmc7IHJhbmdlOiBSYW5nZTsgbGluZXM6IHN0cmluZ1tdOyB0ZXh0OiBzdHJpbmcgfVtdKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSBkZWx0YXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIHZhciBkZWx0YSA9IGRlbHRhc1tpXTtcblxuICAgICAgICAgICAgdmFyIHJhbmdlID0gUmFuZ2UuZnJvbVBvaW50cyhkZWx0YS5yYW5nZS5zdGFydCwgZGVsdGEucmFuZ2UuZW5kKTtcblxuICAgICAgICAgICAgaWYgKGRlbHRhLmFjdGlvbiA9PSBcImluc2VydExpbmVzXCIpXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlTGluZXMocmFuZ2Uuc3RhcnQucm93LCByYW5nZS5lbmQucm93IC0gMSk7XG4gICAgICAgICAgICBlbHNlIGlmIChkZWx0YS5hY3Rpb24gPT0gXCJpbnNlcnRUZXh0XCIpXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUocmFuZ2UpO1xuICAgICAgICAgICAgZWxzZSBpZiAoZGVsdGEuYWN0aW9uID09IFwicmVtb3ZlTGluZXNcIilcbiAgICAgICAgICAgICAgICB0aGlzLl9pbnNlcnRMaW5lcyhyYW5nZS5zdGFydC5yb3csIGRlbHRhLmxpbmVzKTtcbiAgICAgICAgICAgIGVsc2UgaWYgKGRlbHRhLmFjdGlvbiA9PSBcInJlbW92ZVRleHRcIilcbiAgICAgICAgICAgICAgICB0aGlzLmluc2VydChyYW5nZS5zdGFydCwgZGVsdGEudGV4dCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBhbiBpbmRleCBwb3NpdGlvbiBpbiBhIGRvY3VtZW50IHRvIGEgYHtyb3csIGNvbHVtbn1gIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEluZGV4IHJlZmVycyB0byB0aGUgXCJhYnNvbHV0ZSBwb3NpdGlvblwiIG9mIGEgY2hhcmFjdGVyIGluIHRoZSBkb2N1bWVudC4gRm9yIGV4YW1wbGU6XG4gICAgICpcbiAgICAgKiBgYGBqYXZhc2NyaXB0XG4gICAgICogdmFyIHggPSAwOyAvLyAxMCBjaGFyYWN0ZXJzLCBwbHVzIG9uZSBmb3IgbmV3bGluZVxuICAgICAqIHZhciB5ID0gLTE7XG4gICAgICogYGBgXG4gICAgICogXG4gICAgICogSGVyZSwgYHlgIGlzIGFuIGluZGV4IDE1OiAxMSBjaGFyYWN0ZXJzIGZvciB0aGUgZmlyc3Qgcm93LCBhbmQgNSBjaGFyYWN0ZXJzIHVudGlsIGB5YCBpbiB0aGUgc2Vjb25kLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4IEFuIGluZGV4IHRvIGNvbnZlcnRcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gc3RhcnRSb3c9MCBUaGUgcm93IGZyb20gd2hpY2ggdG8gc3RhcnQgdGhlIGNvbnZlcnNpb25cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBBIGB7cm93LCBjb2x1bW59YCBvYmplY3Qgb2YgdGhlIGBpbmRleGAgcG9zaXRpb25cbiAgICAgKi9cbiAgICBpbmRleFRvUG9zaXRpb24oaW5kZXg6IG51bWJlciwgc3RhcnRSb3c6IG51bWJlcikge1xuICAgICAgICB2YXIgbGluZXMgPSB0aGlzLiRsaW5lcyB8fCB0aGlzLmdldEFsbExpbmVzKCk7XG4gICAgICAgIHZhciBuZXdsaW5lTGVuZ3RoID0gdGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCkubGVuZ3RoO1xuICAgICAgICBmb3IgKHZhciBpID0gc3RhcnRSb3cgfHwgMCwgbCA9IGxpbmVzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgaW5kZXggLT0gbGluZXNbaV0ubGVuZ3RoICsgbmV3bGluZUxlbmd0aDtcbiAgICAgICAgICAgIGlmIChpbmRleCA8IDApXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgcm93OiBpLCBjb2x1bW46IGluZGV4ICsgbGluZXNbaV0ubGVuZ3RoICsgbmV3bGluZUxlbmd0aCB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHJvdzogbCAtIDEsIGNvbHVtbjogbGluZXNbbCAtIDFdLmxlbmd0aCB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIHRoZSBge3JvdywgY29sdW1ufWAgcG9zaXRpb24gaW4gYSBkb2N1bWVudCB0byB0aGUgY2hhcmFjdGVyJ3MgaW5kZXguXG4gICAgICpcbiAgICAgKiBJbmRleCByZWZlcnMgdG8gdGhlIFwiYWJzb2x1dGUgcG9zaXRpb25cIiBvZiBhIGNoYXJhY3RlciBpbiB0aGUgZG9jdW1lbnQuIEZvciBleGFtcGxlOlxuICAgICAqXG4gICAgICogYGBgamF2YXNjcmlwdFxuICAgICAqIHZhciB4ID0gMDsgLy8gMTAgY2hhcmFjdGVycywgcGx1cyBvbmUgZm9yIG5ld2xpbmVcbiAgICAgKiB2YXIgeSA9IC0xO1xuICAgICAqIGBgYFxuICAgICAqIFxuICAgICAqIEhlcmUsIGB5YCBpcyBhbiBpbmRleCAxNTogMTEgY2hhcmFjdGVycyBmb3IgdGhlIGZpcnN0IHJvdywgYW5kIDUgY2hhcmFjdGVycyB1bnRpbCBgeWAgaW4gdGhlIHNlY29uZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwb3MgVGhlIGB7cm93LCBjb2x1bW59YCB0byBjb252ZXJ0XG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHN0YXJ0Um93PTAgVGhlIHJvdyBmcm9tIHdoaWNoIHRvIHN0YXJ0IHRoZSBjb252ZXJzaW9uXG4gICAgICogQHJldHVybnMge051bWJlcn0gVGhlIGluZGV4IHBvc2l0aW9uIGluIHRoZSBkb2N1bWVudFxuICAgICAqL1xuICAgIHBvc2l0aW9uVG9JbmRleChwb3M6IHsgcm93OiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0sIHN0YXJ0Um93OiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICB2YXIgbGluZXMgPSB0aGlzLiRsaW5lcyB8fCB0aGlzLmdldEFsbExpbmVzKCk7XG4gICAgICAgIHZhciBuZXdsaW5lTGVuZ3RoID0gdGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCkubGVuZ3RoO1xuICAgICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgICB2YXIgcm93ID0gTWF0aC5taW4ocG9zLnJvdywgbGluZXMubGVuZ3RoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0Um93IHx8IDA7IGkgPCByb3c7ICsraSlcbiAgICAgICAgICAgIGluZGV4ICs9IGxpbmVzW2ldLmxlbmd0aCArIG5ld2xpbmVMZW5ndGg7XG5cbiAgICAgICAgcmV0dXJuIGluZGV4ICsgcG9zLmNvbHVtbjtcbiAgICB9XG59XG4iXX0=