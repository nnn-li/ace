var XHTML_NS = "http://www.w3.org/1999/xhtml";
export function getDocumentHead(doc = document) {
    return (doc.head || doc.getElementsByTagName("head")[0] || doc.documentElement);
}
export function getDocumentBody(doc = document) {
    return (doc.body || doc.getElementsByTagName("body")[0]);
}
export function createElement(tagName, namespaceURI) {
    return document.createElementNS ?
        document.createElementNS(namespaceURI || XHTML_NS, tagName) :
        document.createElement(tagName);
}
export function hasCssClass(element, name) {
    var classes = element.className.split(/\s+/g);
    return classes.indexOf(name) !== -1;
}
export function addCssClass(element, name) {
    if (!hasCssClass(element, name)) {
        element.className += " " + name;
    }
}
export function removeCssClass(element, name) {
    var classes = element.className.split(/\s+/g);
    while (true) {
        var index = classes.indexOf(name);
        if (index === -1) {
            break;
        }
        classes.splice(index, 1);
    }
    element.className = classes.join(" ");
}
export function toggleCssClass(element, name) {
    var classes = element.className.split(/\s+/g);
    var add = true;
    while (true) {
        var index = classes.indexOf(name);
        if (index == -1) {
            break;
        }
        add = false;
        classes.splice(index, 1);
    }
    if (add)
        classes.push(name);
    element.className = classes.join(" ");
    return add;
}
export function setCssClass(node, className, include) {
    if (include) {
        addCssClass(node, className);
    }
    else {
        removeCssClass(node, className);
    }
}
export function hasCssString(id, doc = document) {
    var index = 0;
    var sheets = doc.getElementsByTagName('style');
    if (sheets) {
        while (index < sheets.length) {
            if (sheets[index++].id === id) {
                return true;
            }
        }
    }
    return false;
}
export function importCssString(cssText, id, doc = document) {
    if (id && hasCssString(id, doc)) {
        return;
    }
    else {
        let style = createElement('style');
        style.appendChild(doc.createTextNode(cssText));
        if (id) {
            style.id = id;
        }
        getDocumentHead(doc).appendChild(style);
    }
}
export function importCssStylsheet(href, doc) {
    var link = createElement('link');
    link.rel = 'stylesheet';
    link.href = href;
    getDocumentHead(doc).appendChild(link);
}
function makeComputedStyle() {
    if (window.getComputedStyle) {
        return function (element, style) {
            return (window.getComputedStyle(element, "") || {})[style] || "";
        };
    }
    else {
        return function (element, style) {
            if (style) {
                return element['currentStyle'][style];
            }
            return element['currentStyle'];
        };
    }
}
export var computedStyle = makeComputedStyle();
export function scrollbarWidth(document) {
    var inner = createElement("ace_inner");
    inner.style.width = "100%";
    inner.style.minWidth = "0px";
    inner.style.height = "200px";
    inner.style.display = "block";
    var outer = createElement("ace_outer");
    var style = outer.style;
    style.position = "absolute";
    style.left = "-10000px";
    style.overflow = "hidden";
    style.width = "200px";
    style.minWidth = "0px";
    style.height = "150px";
    style.display = "block";
    outer.appendChild(inner);
    var body = document.documentElement;
    body.appendChild(outer);
    var noScrollbar = inner.offsetWidth;
    style.overflow = "scroll";
    var withScrollbar = inner.offsetWidth;
    if (noScrollbar === withScrollbar) {
        withScrollbar = outer.clientWidth;
    }
    body.removeChild(outer);
    return noScrollbar - withScrollbar;
}
export function setInnerHtml(element, innerHTML) {
    var clonedElement = element.cloneNode(false);
    clonedElement.innerHTML = innerHTML;
    element.parentNode.replaceChild(clonedElement, element);
    return clonedElement;
}
function makeGetInnerText() {
    if ("textContent" in document.documentElement) {
        return function (el) {
            return el.textContent;
        };
    }
    else {
        return function (el) {
            return el.innerText;
        };
    }
}
function makeSetInnerText() {
    if ("textContent" in document.documentElement) {
        return function (el, innerText) {
            el.textContent = innerText;
        };
    }
    else {
        return function (el, innerText) {
            el.innerText = innerText;
        };
    }
}
export var getInnerText = makeGetInnerText();
export var setInnerText = makeSetInnerText();
export function getParentWindow(document) {
    return document.defaultView;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2xpYi9kb20udHMiXSwibmFtZXMiOlsiZ2V0RG9jdW1lbnRIZWFkIiwiZ2V0RG9jdW1lbnRCb2R5IiwiY3JlYXRlRWxlbWVudCIsImhhc0Nzc0NsYXNzIiwiYWRkQ3NzQ2xhc3MiLCJyZW1vdmVDc3NDbGFzcyIsInRvZ2dsZUNzc0NsYXNzIiwic2V0Q3NzQ2xhc3MiLCJoYXNDc3NTdHJpbmciLCJpbXBvcnRDc3NTdHJpbmciLCJpbXBvcnRDc3NTdHlsc2hlZXQiLCJtYWtlQ29tcHV0ZWRTdHlsZSIsInNjcm9sbGJhcldpZHRoIiwic2V0SW5uZXJIdG1sIiwibWFrZUdldElubmVyVGV4dCIsIm1ha2VTZXRJbm5lclRleHQiLCJnZXRQYXJlbnRXaW5kb3ciXSwibWFwcGluZ3MiOiJBQThCQSxJQUFJLFFBQVEsR0FBRyw4QkFBOEIsQ0FBQztBQUU5QyxnQ0FBZ0MsR0FBRyxHQUFhLFFBQVE7SUFDcERBLE1BQU1BLENBQWtCQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxJQUFJQSxHQUFHQSxDQUFDQSxvQkFBb0JBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLGVBQWVBLENBQUNBLENBQUNBO0FBQ3JHQSxDQUFDQTtBQUVELGdDQUFnQyxHQUFHLEdBQWEsUUFBUTtJQUNwREMsTUFBTUEsQ0FBa0JBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLElBQUlBLEdBQUdBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7QUFDOUVBLENBQUNBO0FBRUQsOEJBQThCLE9BQWUsRUFBRSxZQUFxQjtJQUNoRUMsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsZUFBZUE7UUFDM0JBLFFBQVFBLENBQUNBLGVBQWVBLENBQUNBLFlBQVlBLElBQUlBLFFBQVFBLEVBQUVBLE9BQU9BLENBQUNBO1FB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LENBQUNBLENBQUNBO1FBQzVDQSxNQUFNQSxDQUFDQSxVQUFTQSxFQUFlQSxFQUFFQSxTQUFpQkE7WUFDOUMsRUFBRSxDQUFDLFdBQVcsR0FBRyxTQUFTLENBQUM7UUFDL0IsQ0FBQyxDQUFDQTtJQUNOQSxDQUFDQTtJQUNEQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNGQSxNQUFNQSxDQUFDQSxVQUFTQSxFQUFlQSxFQUFFQSxTQUFpQkE7WUFDOUMsRUFBRSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7UUFDN0IsQ0FBQyxDQUFDQTtJQUNOQSxDQUFDQTtBQUNMQSxDQUFDQTtBQUVELFdBQVcsWUFBWSxHQUFnQyxnQkFBZ0IsRUFBRSxDQUFDO0FBQzFFLFdBQVcsWUFBWSxHQUFpRCxnQkFBZ0IsRUFBRSxDQUFDO0FBRTNGLGdDQUFnQyxRQUFrQjtJQUU5Q0MsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7QUFDaENBLENBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMCwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIFxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0XG4gKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDpcbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuXG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZVxuICogICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cbiAqICAgICAqIE5laXRoZXIgdGhlIG5hbWUgb2YgQWpheC5vcmcgQi5WLiBub3IgdGhlXG4gKiAgICAgICBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0c1xuICogICAgICAgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXG4gKiBcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiIEFORFxuICogQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRURcbiAqIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkVcbiAqIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIEFKQVguT1JHIEIuVi4gQkUgTElBQkxFIEZPUiBBTllcbiAqIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTXG4gKiAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7XG4gKiBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkRcbiAqIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUXG4gKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJU1xuICogU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG4gKlxuICogKioqKiogRU5EIExJQ0VOU0UgQkxPQ0sgKioqKiogKi9cblxudmFyIFhIVE1MX05TID0gXCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREb2N1bWVudEhlYWQoZG9jOiBEb2N1bWVudCA9IGRvY3VtZW50KTogSFRNTEhlYWRFbGVtZW50IHtcbiAgICByZXR1cm4gPEhUTUxIZWFkRWxlbWVudD4oZG9jLmhlYWQgfHwgZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXSB8fCBkb2MuZG9jdW1lbnRFbGVtZW50KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldERvY3VtZW50Qm9keShkb2M6IERvY3VtZW50ID0gZG9jdW1lbnQpOiBIVE1MQm9keUVsZW1lbnQge1xuICAgIHJldHVybiA8SFRNTEJvZHlFbGVtZW50Pihkb2MuYm9keSB8fCBkb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJib2R5XCIpWzBdKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQodGFnTmFtZTogc3RyaW5nLCBuYW1lc3BhY2VVUkk/OiBzdHJpbmcpOiBFbGVtZW50IHtcbiAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TID9cbiAgICAgICAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5hbWVzcGFjZVVSSSB8fCBYSFRNTF9OUywgdGFnTmFtZSkgOlxuICAgICAgICBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFzQ3NzQ2xhc3MoZWxlbWVudDogSFRNTEVsZW1lbnQsIG5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHZhciBjbGFzc2VzOiBzdHJpbmdbXSA9IGVsZW1lbnQuY2xhc3NOYW1lLnNwbGl0KC9cXHMrL2cpO1xuICAgIHJldHVybiBjbGFzc2VzLmluZGV4T2YobmFtZSkgIT09IC0xO1xufVxuXG4vKipcbiAqIEFkZCBhIENTUyBjbGFzcyB0byB0aGUgbGlzdCBvZiBjbGFzc2VzIG9uIHRoZSBnaXZlbiBub2RlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhZGRDc3NDbGFzcyhlbGVtZW50OiBIVE1MRWxlbWVudCwgbmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKCFoYXNDc3NDbGFzcyhlbGVtZW50LCBuYW1lKSkge1xuICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSArPSBcIiBcIiArIG5hbWU7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlbW92ZSBhIENTUyBjbGFzcyBmcm9tIHRoZSBsaXN0IG9mIGNsYXNzZXMgb24gdGhlIGdpdmVuIG5vZGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZUNzc0NsYXNzKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBuYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB2YXIgY2xhc3Nlczogc3RyaW5nW10gPSBlbGVtZW50LmNsYXNzTmFtZS5zcGxpdCgvXFxzKy9nKTtcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICB2YXIgaW5kZXggPSBjbGFzc2VzLmluZGV4T2YobmFtZSk7XG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNsYXNzZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG4gICAgZWxlbWVudC5jbGFzc05hbWUgPSBjbGFzc2VzLmpvaW4oXCIgXCIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9nZ2xlQ3NzQ2xhc3MoZWxlbWVudDogSFRNTEVsZW1lbnQsIG5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHZhciBjbGFzc2VzID0gZWxlbWVudC5jbGFzc05hbWUuc3BsaXQoL1xccysvZyk7XG4gICAgdmFyIGFkZCA9IHRydWU7XG4gICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gY2xhc3Nlcy5pbmRleE9mKG5hbWUpO1xuICAgICAgICBpZiAoaW5kZXggPT0gLTEpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGFkZCA9IGZhbHNlO1xuICAgICAgICBjbGFzc2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxuICAgIGlmIChhZGQpXG4gICAgICAgIGNsYXNzZXMucHVzaChuYW1lKTtcblxuICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gY2xhc3Nlcy5qb2luKFwiIFwiKTtcbiAgICByZXR1cm4gYWRkO1xufVxuXG4vKlxuICogQWRkIG9yIHJlbW92ZSBhIENTUyBjbGFzcyBmcm9tIHRoZSBsaXN0IG9mIGNsYXNzZXMgb24gdGhlIGdpdmVuIG5vZGVcbiAqIGRlcGVuZGluZyBvbiB0aGUgdmFsdWUgb2YgPHR0PmluY2x1ZGU8L3R0PlxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Q3NzQ2xhc3Mobm9kZTogSFRNTEVsZW1lbnQsIGNsYXNzTmFtZTogc3RyaW5nLCBpbmNsdWRlOiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKGluY2x1ZGUpIHtcbiAgICAgICAgYWRkQ3NzQ2xhc3Mobm9kZSwgY2xhc3NOYW1lKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJlbW92ZUNzc0NsYXNzKG5vZGUsIGNsYXNzTmFtZSk7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFzQ3NzU3RyaW5nKGlkOiBzdHJpbmcsIGRvYzogRG9jdW1lbnQgPSBkb2N1bWVudCkge1xuICAgIHZhciBpbmRleCA9IDA7XG4gICAgdmFyIHNoZWV0cyA9IGRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3R5bGUnKTtcblxuICAgIGlmIChzaGVldHMpIHtcbiAgICAgICAgd2hpbGUgKGluZGV4IDwgc2hlZXRzLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKHNoZWV0c1tpbmRleCsrXS5pZCA9PT0gaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbXBvcnRDc3NTdHJpbmcoY3NzVGV4dDogc3RyaW5nLCBpZD86IHN0cmluZywgZG9jOiBEb2N1bWVudCA9IGRvY3VtZW50KTogdm9pZCB7XG4gICAgLy8gSWYgc3R5bGUgaXMgYWxyZWFkeSBpbXBvcnRlZCByZXR1cm4gaW1tZWRpYXRlbHkuXG4gICAgaWYgKGlkICYmIGhhc0Nzc1N0cmluZyhpZCwgZG9jKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBsZXQgc3R5bGUgPSBjcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuICAgICAgICBzdHlsZS5hcHBlbmRDaGlsZChkb2MuY3JlYXRlVGV4dE5vZGUoY3NzVGV4dCkpO1xuICAgICAgICBpZiAoaWQpIHtcbiAgICAgICAgICAgIHN0eWxlLmlkID0gaWQ7XG4gICAgICAgIH1cbiAgICAgICAgZ2V0RG9jdW1lbnRIZWFkKGRvYykuYXBwZW5kQ2hpbGQoc3R5bGUpO1xuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGltcG9ydENzc1N0eWxzaGVldChocmVmOiBzdHJpbmcsIGRvYz86IERvY3VtZW50KSB7XG4gICAgdmFyIGxpbmsgPSA8SFRNTExpbmtFbGVtZW50PmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTtcbiAgICBsaW5rLnJlbCA9ICdzdHlsZXNoZWV0JztcbiAgICBsaW5rLmhyZWYgPSBocmVmO1xuICAgIGdldERvY3VtZW50SGVhZChkb2MpLmFwcGVuZENoaWxkKGxpbmspO1xufVxuLypcbmV4cG9ydCBmdW5jdGlvbiBnZXRJbm5lcldpZHRoKGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogbnVtYmVyIHtcbiAgICByZXR1cm4gKFxuICAgICAgICBwYXJzZUludChleHBvcnRzLmNvbXB1dGVkU3R5bGUoZWxlbWVudCwgXCJwYWRkaW5nTGVmdFwiKSwgMTApICtcbiAgICAgICAgcGFyc2VJbnQoZXhwb3J0cy5jb21wdXRlZFN0eWxlKGVsZW1lbnQsIFwicGFkZGluZ1JpZ2h0XCIpLCAxMCkgK1xuICAgICAgICBlbGVtZW50LmNsaWVudFdpZHRoXG4gICAgKTtcbn1cbiovXG4vKlxuZXhwb3J0IGZ1bmN0aW9uIGdldElubmVySGVpZ2h0KGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogbnVtYmVyIHtcbiAgICByZXR1cm4gKFxuICAgICAgICBwYXJzZUludChleHBvcnRzLmNvbXB1dGVkU3R5bGUoZWxlbWVudCwgXCJwYWRkaW5nVG9wXCIpLCAxMCkgK1xuICAgICAgICBwYXJzZUludChleHBvcnRzLmNvbXB1dGVkU3R5bGUoZWxlbWVudCwgXCJwYWRkaW5nQm90dG9tXCIpLCAxMCkgK1xuICAgICAgICBlbGVtZW50LmNsaWVudEhlaWdodFxuICAgICk7XG59XG4qL1xuLypcbmlmICh3aW5kb3cucGFnZVlPZmZzZXQgIT09IHVuZGVmaW5lZCkge1xuICAgIGV4cG9ydHMuZ2V0UGFnZVNjcm9sbFRvcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gd2luZG93LnBhZ2VZT2Zmc2V0O1xuICAgIH07XG5cbiAgICBleHBvcnRzLmdldFBhZ2VTY3JvbGxMZWZ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB3aW5kb3cucGFnZVhPZmZzZXQ7XG4gICAgfTtcbn1cbmVsc2Uge1xuICAgIGV4cG9ydHMuZ2V0UGFnZVNjcm9sbFRvcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7XG4gICAgfTtcblxuICAgIGV4cG9ydHMuZ2V0UGFnZVNjcm9sbExlZnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdDtcbiAgICB9O1xufVxuKi9cbi8vIEZJWE1FOiBJIGRvbid0IGxpa2UgdGhpcyBiZWNhdXNlIHdlIGxvc2UgdHlwZSBzYWZldHkuXG5mdW5jdGlvbiBtYWtlQ29tcHV0ZWRTdHlsZSgpOiAoZWxlbWVudDogSFRNTEVsZW1lbnQsIHN0eWxlOiBzdHJpbmcpID0+IENTU1N0eWxlRGVjbGFyYXRpb24ge1xuICAgIGlmICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSkge1xuICAgICAgICAvLyBZb3UgY2FuIGFsc28gY2FsbCBnZXRQcm9wZXJ0eVZhbHVlIVxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZWxlbWVudDogSFRNTEVsZW1lbnQsIHN0eWxlOiBzdHJpbmcpOiBDU1NTdHlsZURlY2xhcmF0aW9uIHtcbiAgICAgICAgICAgIHJldHVybiAod2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgXCJcIikgfHwge30pW3N0eWxlXSB8fCBcIlwiO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBzdHlsZTogc3RyaW5nKTogQ1NTU3R5bGVEZWNsYXJhdGlvbiB7XG4gICAgICAgICAgICBpZiAoc3R5bGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudFsnY3VycmVudFN0eWxlJ11bc3R5bGVdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRbJ2N1cnJlbnRTdHlsZSddO1xuICAgICAgICB9O1xuICAgIH1cbn1cblxuZXhwb3J0IHZhciBjb21wdXRlZFN0eWxlID0gbWFrZUNvbXB1dGVkU3R5bGUoKTtcbi8vIEZJWE1FXG4vKlxuaWYgKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKVxuICAgIGV4cG9ydHMuY29tcHV0ZWRTdHlsZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIHN0eWxlKTogYW55IHtcbiAgICAgICAgaWYgKHN0eWxlKVxuICAgICAgICAgICAgcmV0dXJuICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBcIlwiKSB8fCB7fSlbc3R5bGVdIHx8IFwiXCI7XG4gICAgICAgIHJldHVybiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBcIlwiKSB8fCB7fTtcbiAgICB9O1xuZWxzZVxuICAgIGV4cG9ydHMuY29tcHV0ZWRTdHlsZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIHN0eWxlKSB7XG4gICAgICAgIGlmIChzdHlsZSlcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmN1cnJlbnRTdHlsZVtzdHlsZV07XG4gICAgICAgIHJldHVybiBlbGVtZW50LmN1cnJlbnRTdHlsZTtcbiAgICB9O1xuKi9cbmV4cG9ydCBmdW5jdGlvbiBzY3JvbGxiYXJXaWR0aChkb2N1bWVudDogRG9jdW1lbnQpOiBudW1iZXIge1xuICAgIHZhciBpbm5lcjogSFRNTEVsZW1lbnQgPSA8SFRNTEVsZW1lbnQ+Y3JlYXRlRWxlbWVudChcImFjZV9pbm5lclwiKTtcbiAgICBpbm5lci5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuICAgIGlubmVyLnN0eWxlLm1pbldpZHRoID0gXCIwcHhcIjtcbiAgICBpbm5lci5zdHlsZS5oZWlnaHQgPSBcIjIwMHB4XCI7XG4gICAgaW5uZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcblxuICAgIHZhciBvdXRlcjogSFRNTEVsZW1lbnQgPSA8SFRNTEVsZW1lbnQ+Y3JlYXRlRWxlbWVudChcImFjZV9vdXRlclwiKTtcbiAgICB2YXIgc3R5bGUgPSBvdXRlci5zdHlsZTtcblxuICAgIHN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgIHN0eWxlLmxlZnQgPSBcIi0xMDAwMHB4XCI7XG4gICAgc3R5bGUub3ZlcmZsb3cgPSBcImhpZGRlblwiO1xuICAgIHN0eWxlLndpZHRoID0gXCIyMDBweFwiO1xuICAgIHN0eWxlLm1pbldpZHRoID0gXCIwcHhcIjtcbiAgICBzdHlsZS5oZWlnaHQgPSBcIjE1MHB4XCI7XG4gICAgc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcblxuICAgIG91dGVyLmFwcGVuZENoaWxkKGlubmVyKTtcblxuICAgIHZhciBib2R5ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICAgIGJvZHkuYXBwZW5kQ2hpbGQob3V0ZXIpO1xuXG4gICAgdmFyIG5vU2Nyb2xsYmFyID0gaW5uZXIub2Zmc2V0V2lkdGg7XG5cbiAgICBzdHlsZS5vdmVyZmxvdyA9IFwic2Nyb2xsXCI7XG4gICAgdmFyIHdpdGhTY3JvbGxiYXIgPSBpbm5lci5vZmZzZXRXaWR0aDtcblxuICAgIGlmIChub1Njcm9sbGJhciA9PT0gd2l0aFNjcm9sbGJhcikge1xuICAgICAgICB3aXRoU2Nyb2xsYmFyID0gb3V0ZXIuY2xpZW50V2lkdGg7XG4gICAgfVxuXG4gICAgYm9keS5yZW1vdmVDaGlsZChvdXRlcik7XG5cbiAgICByZXR1cm4gbm9TY3JvbGxiYXIgLSB3aXRoU2Nyb2xsYmFyO1xufVxuXG4vKlxuICogT3B0aW1pemVkIHNldCBpbm5lckhUTUwuIFRoaXMgaXMgZmFzdGVyIHRoYW4gcGxhaW4gaW5uZXJIVE1MIGlmIHRoZSBlbGVtZW50XG4gKiBhbHJlYWR5IGNvbnRhaW5zIGEgbG90IG9mIGNoaWxkIGVsZW1lbnRzLlxuICpcbiAqIFNlZSBodHRwOi8vYmxvZy5zdGV2ZW5sZXZpdGhhbi5jb20vYXJjaGl2ZXMvZmFzdGVyLXRoYW4taW5uZXJodG1sIGZvciBkZXRhaWxzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRJbm5lckh0bWwoZWxlbWVudDogSFRNTEVsZW1lbnQsIGlubmVySFRNTDogc3RyaW5nKSB7XG4gICAgdmFyIGNsb25lZEVsZW1lbnQgPSA8SFRNTEVsZW1lbnQ+ZWxlbWVudC5jbG9uZU5vZGUoZmFsc2UpO1xuICAgIGNsb25lZEVsZW1lbnQuaW5uZXJIVE1MID0gaW5uZXJIVE1MO1xuICAgIGVsZW1lbnQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoY2xvbmVkRWxlbWVudCwgZWxlbWVudCk7XG4gICAgcmV0dXJuIGNsb25lZEVsZW1lbnQ7XG59XG5cbmZ1bmN0aW9uIG1ha2VHZXRJbm5lclRleHQoKTogKGVsOiBIVE1MRWxlbWVudCkgPT4gc3RyaW5nIHtcbiAgICBpZiAoXCJ0ZXh0Q29udGVudFwiIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZWw6IEhUTUxFbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZWwudGV4dENvbnRlbnQ7XG4gICAgICAgIH07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZWw6IEhUTUxFbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZWwuaW5uZXJUZXh0O1xuICAgICAgICB9O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbWFrZVNldElubmVyVGV4dCgpOiAoZWw6IEhUTUxFbGVtZW50LCBpbm5lclRleHQ6IHN0cmluZykgPT4gdm9pZCB7XG4gICAgaWYgKFwidGV4dENvbnRlbnRcIiBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVsOiBIVE1MRWxlbWVudCwgaW5uZXJUZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgICAgIGVsLnRleHRDb250ZW50ID0gaW5uZXJUZXh0O1xuICAgICAgICB9O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVsOiBIVE1MRWxlbWVudCwgaW5uZXJUZXh0OiBzdHJpbmcpIHtcbiAgICAgICAgICAgIGVsLmlubmVyVGV4dCA9IGlubmVyVGV4dDtcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmV4cG9ydCB2YXIgZ2V0SW5uZXJUZXh0OiAoZWw6IEhUTUxFbGVtZW50KSA9PiBzdHJpbmcgPSBtYWtlR2V0SW5uZXJUZXh0KCk7XG5leHBvcnQgdmFyIHNldElubmVyVGV4dDogKGVsOiBIVE1MRWxlbWVudCwgaW5uZXJUZXh0OiBzdHJpbmcpID0+IHZvaWQgPSBtYWtlU2V0SW5uZXJUZXh0KCk7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQYXJlbnRXaW5kb3coZG9jdW1lbnQ6IERvY3VtZW50KTogV2luZG93IHtcbiAgICAvLyBUaGlzIGlzIGEgYml0IHJlZHVuZGFudCBub3cgdGhhdCBwYXJlbnRXaW5kb3cgaGFzIGJlZW4gcmVtb3ZlZC5cbiAgICByZXR1cm4gZG9jdW1lbnQuZGVmYXVsdFZpZXc7XG59XG4iXX0=