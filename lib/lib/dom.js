var XHTML_NS = "http://www.w3.org/1999/xhtml";
function getDocumentHead(doc) {
    if (!doc) {
        doc = document;
    }
    return (doc.head || doc.getElementsByTagName("head")[0] || doc.documentElement);
}
exports.getDocumentHead = getDocumentHead;
function createElement(tagName, namespaceURI) {
    return document.createElementNS ?
        document.createElementNS(namespaceURI || XHTML_NS, tagName) :
        document.createElement(tagName);
}
exports.createElement = createElement;
function hasCssClass(element, name) {
    var classes = element.className.split(/\s+/g);
    return classes.indexOf(name) !== -1;
}
exports.hasCssClass = hasCssClass;
function addCssClass(element, name) {
    if (!hasCssClass(element, name)) {
        element.className += " " + name;
    }
}
exports.addCssClass = addCssClass;
function removeCssClass(element, name) {
    var classes = element.className.split(/\s+/g);
    while (true) {
        var index = classes.indexOf(name);
        if (index == -1) {
            break;
        }
        classes.splice(index, 1);
    }
    element.className = classes.join(" ");
}
exports.removeCssClass = removeCssClass;
function toggleCssClass(element, name) {
    var classes = element.className.split(/\s+/g), add = true;
    while (true) {
        var index = classes.indexOf(name);
        if (index == -1) {
            break;
        }
        add = false;
        classes.splice(index, 1);
    }
    if (add)
        classes.push(name);
    element.className = classes.join(" ");
    return add;
}
exports.toggleCssClass = toggleCssClass;
function setCssClass(node, className, include) {
    if (include) {
        addCssClass(node, className);
    }
    else {
        removeCssClass(node, className);
    }
}
exports.setCssClass = setCssClass;
function hasCssString(id, doc) {
    if (doc === void 0) { doc = document; }
    var index = 0;
    var sheets = doc.getElementsByTagName('style');
    if (sheets) {
        while (index < sheets.length)
            if (sheets[index++].id === id)
                return true;
    }
    return false;
}
exports.hasCssString = hasCssString;
function importCssString(cssText, id, doc) {
    doc = doc || document;
    if (id && hasCssString(id, doc)) {
        return;
    }
    var style;
    style = doc.createElementNS
        ? doc.createElementNS(XHTML_NS, "style")
        : doc.createElement("style");
    style.appendChild(doc.createTextNode(cssText));
    if (id)
        style.id = id;
    getDocumentHead(doc).appendChild(style);
}
exports.importCssString = importCssString;
function importCssStylsheet(uri, doc) {
    var link = createElement('link');
    link['rel'] = 'stylesheet';
    link['href'] = uri;
    getDocumentHead(doc).appendChild(link);
}
exports.importCssStylsheet = importCssStylsheet;
function getInnerWidth(element) {
    return (parseInt(exports.computedStyle(element, "paddingLeft"), 10) +
        parseInt(exports.computedStyle(element, "paddingRight"), 10) +
        element.clientWidth);
}
exports.getInnerWidth = getInnerWidth;
function getInnerHeight(element) {
    return (parseInt(exports.computedStyle(element, "paddingTop"), 10) +
        parseInt(exports.computedStyle(element, "paddingBottom"), 10) +
        element.clientHeight);
}
exports.getInnerHeight = getInnerHeight;
if (window.pageYOffset !== undefined) {
    exports.getPageScrollTop = function () {
        return window.pageYOffset;
    };
    exports.getPageScrollLeft = function () {
        return window.pageXOffset;
    };
}
else {
    exports.getPageScrollTop = function () {
        return document.body.scrollTop;
    };
    exports.getPageScrollLeft = function () {
        return document.body.scrollLeft;
    };
}
function makeComputedStyle() {
    if (window.getComputedStyle) {
        return function (element, style) {
            if (style) {
                return (window.getComputedStyle(element, "") || {})[style] || "";
            }
            return window.getComputedStyle(element, "") || {};
        };
    }
    else {
        return function (element, style) {
            if (style) {
                return element['currentStyle'][style];
            }
            return element['currentStyle'];
        };
    }
}
exports.computedStyle = makeComputedStyle();
if (window.getComputedStyle)
    exports.computedStyle = function (element, style) {
        if (style)
            return (window.getComputedStyle(element, "") || {})[style] || "";
        return window.getComputedStyle(element, "") || {};
    };
else
    exports.computedStyle = function (element, style) {
        if (style)
            return element.currentStyle[style];
        return element.currentStyle;
    };
function scrollbarWidth(document) {
    var inner = createElement("ace_inner");
    inner.style.width = "100%";
    inner.style.minWidth = "0px";
    inner.style.height = "200px";
    inner.style.display = "block";
    var outer = createElement("ace_outer");
    var style = outer.style;
    style.position = "absolute";
    style.left = "-10000px";
    style.overflow = "hidden";
    style.width = "200px";
    style.minWidth = "0px";
    style.height = "150px";
    style.display = "block";
    outer.appendChild(inner);
    var body = document.documentElement;
    body.appendChild(outer);
    var noScrollbar = inner.offsetWidth;
    style.overflow = "scroll";
    var withScrollbar = inner.offsetWidth;
    if (noScrollbar == withScrollbar) {
        withScrollbar = outer.clientWidth;
    }
    body.removeChild(outer);
    return noScrollbar - withScrollbar;
}
exports.scrollbarWidth = scrollbarWidth;
function setInnerHtml(element, innerHTML) {
    var clonedElement = element.cloneNode(false);
    clonedElement.innerHTML = innerHTML;
    element.parentNode.replaceChild(clonedElement, element);
    return clonedElement;
}
exports.setInnerHtml = setInnerHtml;
function makeGetInnerText() {
    if ("textContent" in document.documentElement) {
        return function (el) {
            return el.textContent;
        };
    }
    else {
        return function (el) {
            return el.innerText;
        };
    }
}
function makeSetInnerText() {
    if ("textContent" in document.documentElement) {
        return function (el, innerText) {
            el.textContent = innerText;
        };
    }
    else {
        return function (el, innerText) {
            el.innerText = innerText;
        };
    }
}
exports.getInnerText = makeGetInnerText();
exports.setInnerText = makeSetInnerText();
function getParentWindow(document) {
    return document.defaultView;
}
exports.getParentWindow = getParentWindow;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2xpYi9kb20udHMiXSwibmFtZXMiOlsiZ2V0RG9jdW1lbnRIZWFkIiwiY3JlYXRlRWxlbWVudCIsImhhc0Nzc0NsYXNzIiwiYWRkQ3NzQ2xhc3MiLCJyZW1vdmVDc3NDbGFzcyIsInRvZ2dsZUNzc0NsYXNzIiwic2V0Q3NzQ2xhc3MiLCJoYXNDc3NTdHJpbmciLCJpbXBvcnRDc3NTdHJpbmciLCJpbXBvcnRDc3NTdHlsc2hlZXQiLCJnZXRJbm5lcldpZHRoIiwiZ2V0SW5uZXJIZWlnaHQiLCJtYWtlQ29tcHV0ZWRTdHlsZSIsInNjcm9sbGJhcldpZHRoIiwic2V0SW5uZXJIdG1sIiwibWFrZUdldElubmVyVGV4dCIsIm1ha2VTZXRJbm5lclRleHQiLCJnZXRQYXJlbnRXaW5kb3ciXSwibWFwcGluZ3MiOiJBQW9DQSxJQUFJLFFBQVEsR0FBRyw4QkFBOEIsQ0FBQztBQUU5Qyx5QkFBZ0MsR0FBYztJQUMxQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDUEEsR0FBR0EsR0FBR0EsUUFBUUEsQ0FBQ0E7SUFDbkJBLENBQUNBO0lBQ0RBLE1BQU1BLENBQWNBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLElBQUlBLEdBQUdBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0E7QUFDakdBLENBQUNBO0FBTGUsdUJBQWUsa0JBSzlCLENBQUE7QUFFRCx1QkFBOEIsT0FBZSxFQUFFLFlBQXFCO0lBQ2hFQyxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxlQUFlQTtRQUMzQkEsUUFBUUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsWUFBWUEsSUFBSUEsUUFBUUEsRUFBRUEsT0FBT0EsQ0FBQ0E7UUFDM0RBLFFBQVFBLENBQUNBLGFBQWFBLENBQUNBLE9BQU9B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TkEsQ0FBQ0E7QUFDTEEsQ0FBQ0E7QUFFRDtJQUNJQyxFQUFFQSxDQUFDQSxDQUFDQSxhQUFhQSxJQUFJQSxRQUFRQSxDQUFDQSxlQUFlQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUM1Q0EsTUFBTUEsQ0FBQ0EsVUFBU0EsRUFBZUEsRUFBRUEsU0FBaUJBO1lBQzlDLEVBQUUsQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1FBQy9CLENBQUMsQ0FBQ0E7SUFDTkEsQ0FBQ0E7SUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDRkEsTUFBTUEsQ0FBQ0EsVUFBU0EsRUFBZUEsRUFBRUEsU0FBaUJBO1lBQzlDLEVBQUUsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQzdCLENBQUMsQ0FBQ0E7SUFDTkEsQ0FBQ0E7QUFDTEEsQ0FBQ0E7QUFFVSxvQkFBWSxHQUFnQyxnQkFBZ0IsRUFBRSxDQUFDO0FBQy9ELG9CQUFZLEdBQWlELGdCQUFnQixFQUFFLENBQUM7QUFFM0YseUJBQWdDLFFBQWtCO0lBRTlDQyxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxXQUFXQSxDQUFDQTtBQUNoQ0EsQ0FBQ0E7QUFIZSx1QkFBZSxrQkFHOUIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qICoqKioqIEJFR0lOIExJQ0VOU0UgQkxPQ0sgKioqKipcbiAqIERpc3RyaWJ1dGVkIHVuZGVyIHRoZSBCU0QgbGljZW5zZTpcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTAsIEFqYXgub3JnIEIuVi5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBcbiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dFxuICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLlxuICogICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGVcbiAqICAgICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG4gKiAgICAgKiBOZWl0aGVyIHRoZSBuYW1lIG9mIEFqYXgub3JnIEIuVi4gbm9yIHRoZVxuICogICAgICAgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHNcbiAqICAgICAgIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLlxuICogXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkRcbiAqIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEXG4gKiBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFXG4gKiBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBBSkFYLk9SRyBCLlYuIEJFIExJQUJMRSBGT1IgQU5ZXG4gKiBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFU1xuICogKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTO1xuICogTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EXG4gKiBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVNcbiAqIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICpcbiAqICoqKioqIEVORCBMSUNFTlNFIEJMT0NLICoqKioqICovXG5cbi8vXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vaWYgKHR5cGVvZiBkb2N1bWVudCA9PSBcInVuZGVmaW5lZFwiKSB7XG4vLyAgICByZXR1cm47XG4vL31cblxudmFyIFhIVE1MX05TID0gXCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREb2N1bWVudEhlYWQoZG9jPzogRG9jdW1lbnQpOiBIVE1MRWxlbWVudCB7XG4gICAgaWYgKCFkb2MpIHtcbiAgICAgICAgZG9jID0gZG9jdW1lbnQ7XG4gICAgfVxuICAgIHJldHVybiA8SFRNTEVsZW1lbnQ+KGRvYy5oZWFkIHx8IGRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF0gfHwgZG9jLmRvY3VtZW50RWxlbWVudCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVFbGVtZW50KHRhZ05hbWU6IHN0cmluZywgbmFtZXNwYWNlVVJJPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyA/XG4gICAgICAgIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2VVUkkgfHwgWEhUTUxfTlMsIHRhZ05hbWUpIDpcbiAgICAgICAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhc0Nzc0NsYXNzKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICB2YXIgY2xhc3Nlczogc3RyaW5nW10gPSBlbGVtZW50LmNsYXNzTmFtZS5zcGxpdCgvXFxzKy9nKTtcbiAgICByZXR1cm4gY2xhc3Nlcy5pbmRleE9mKG5hbWUpICE9PSAtMTtcbn1cblxuLyoqXG4gKiBBZGQgYSBDU1MgY2xhc3MgdG8gdGhlIGxpc3Qgb2YgY2xhc3NlcyBvbiB0aGUgZ2l2ZW4gbm9kZVxuICovXG5leHBvcnQgZnVuY3Rpb24gYWRkQ3NzQ2xhc3MoZWxlbWVudDogSFRNTEVsZW1lbnQsIG5hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICghaGFzQ3NzQ2xhc3MoZWxlbWVudCwgbmFtZSkpIHtcbiAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgKz0gXCIgXCIgKyBuYW1lO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZW1vdmUgYSBDU1MgY2xhc3MgZnJvbSB0aGUgbGlzdCBvZiBjbGFzc2VzIG9uIHRoZSBnaXZlbiBub2RlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmVDc3NDbGFzcyhlbGVtZW50OiBIVE1MRWxlbWVudCwgbmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdmFyIGNsYXNzZXM6IHN0cmluZ1tdID0gZWxlbWVudC5jbGFzc05hbWUuc3BsaXQoL1xccysvZyk7XG4gICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gY2xhc3Nlcy5pbmRleE9mKG5hbWUpO1xuICAgICAgICBpZiAoaW5kZXggPT0gLTEpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNsYXNzZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG4gICAgZWxlbWVudC5jbGFzc05hbWUgPSBjbGFzc2VzLmpvaW4oXCIgXCIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9nZ2xlQ3NzQ2xhc3MoZWxlbWVudDogSFRNTEVsZW1lbnQsIG5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHZhciBjbGFzc2VzID0gZWxlbWVudC5jbGFzc05hbWUuc3BsaXQoL1xccysvZyksIGFkZCA9IHRydWU7XG4gICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gY2xhc3Nlcy5pbmRleE9mKG5hbWUpO1xuICAgICAgICBpZiAoaW5kZXggPT0gLTEpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGFkZCA9IGZhbHNlO1xuICAgICAgICBjbGFzc2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxuICAgIGlmIChhZGQpXG4gICAgICAgIGNsYXNzZXMucHVzaChuYW1lKTtcblxuICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gY2xhc3Nlcy5qb2luKFwiIFwiKTtcbiAgICByZXR1cm4gYWRkO1xufVxuXG4vKlxuICogQWRkIG9yIHJlbW92ZSBhIENTUyBjbGFzcyBmcm9tIHRoZSBsaXN0IG9mIGNsYXNzZXMgb24gdGhlIGdpdmVuIG5vZGVcbiAqIGRlcGVuZGluZyBvbiB0aGUgdmFsdWUgb2YgPHR0PmluY2x1ZGU8L3R0PlxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Q3NzQ2xhc3Mobm9kZTogSFRNTEVsZW1lbnQsIGNsYXNzTmFtZTogc3RyaW5nLCBpbmNsdWRlOiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKGluY2x1ZGUpIHtcbiAgICAgICAgYWRkQ3NzQ2xhc3Mobm9kZSwgY2xhc3NOYW1lKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJlbW92ZUNzc0NsYXNzKG5vZGUsIGNsYXNzTmFtZSk7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFzQ3NzU3RyaW5nKGlkOiBzdHJpbmcsIGRvYzogRG9jdW1lbnQgPSBkb2N1bWVudCkge1xuICAgIHZhciBpbmRleCA9IDA7XG4gICAgdmFyIHNoZWV0cyA9IGRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3R5bGUnKTtcblxuICAgIGlmIChzaGVldHMpIHtcbiAgICAgICAgd2hpbGUgKGluZGV4IDwgc2hlZXRzLmxlbmd0aClcbiAgICAgICAgICAgIGlmIChzaGVldHNbaW5kZXgrK10uaWQgPT09IGlkKSByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbXBvcnRDc3NTdHJpbmcoY3NzVGV4dDogc3RyaW5nLCBpZD86IHN0cmluZywgZG9jPzogRG9jdW1lbnQpOiB2b2lkIHtcbiAgICBkb2MgPSBkb2MgfHwgZG9jdW1lbnQ7XG4gICAgLy8gSWYgc3R5bGUgaXMgYWxyZWFkeSBpbXBvcnRlZCByZXR1cm4gaW1tZWRpYXRlbHkuXG4gICAgaWYgKGlkICYmIGhhc0Nzc1N0cmluZyhpZCwgZG9jKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIHN0eWxlO1xuXG4gICAgc3R5bGUgPSBkb2MuY3JlYXRlRWxlbWVudE5TXG4gICAgICAgID8gZG9jLmNyZWF0ZUVsZW1lbnROUyhYSFRNTF9OUywgXCJzdHlsZVwiKVxuICAgICAgICA6IGRvYy5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7XG5cbiAgICBzdHlsZS5hcHBlbmRDaGlsZChkb2MuY3JlYXRlVGV4dE5vZGUoY3NzVGV4dCkpO1xuICAgIGlmIChpZClcbiAgICAgICAgc3R5bGUuaWQgPSBpZDtcblxuICAgIGdldERvY3VtZW50SGVhZChkb2MpLmFwcGVuZENoaWxkKHN0eWxlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGltcG9ydENzc1N0eWxzaGVldCh1cmk6IHN0cmluZywgZG9jPzogRG9jdW1lbnQpIHtcbiAgICB2YXIgbGluayA9IGNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTtcbiAgICAvLyBGSVhNRTogV2h5IGRvIHdlIG5lZWQgdG8gdXNlIHRoZSBsaXRlcmFscz9cbiAgICBsaW5rWydyZWwnXSA9ICdzdHlsZXNoZWV0JztcbiAgICBsaW5rWydocmVmJ10gPSB1cmk7XG5cbiAgICBnZXREb2N1bWVudEhlYWQoZG9jKS5hcHBlbmRDaGlsZChsaW5rKTtcbn1cblxuLy8gRklYTUU6IFRoaXMgc2VlbXMga2luZGEgaGFja3kuXG5kZWNsYXJlIHZhciBleHBvcnRzOiBhbnk7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRJbm5lcldpZHRoKGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogbnVtYmVyIHtcbiAgICByZXR1cm4gKFxuICAgICAgICBwYXJzZUludChleHBvcnRzLmNvbXB1dGVkU3R5bGUoZWxlbWVudCwgXCJwYWRkaW5nTGVmdFwiKSwgMTApICtcbiAgICAgICAgcGFyc2VJbnQoZXhwb3J0cy5jb21wdXRlZFN0eWxlKGVsZW1lbnQsIFwicGFkZGluZ1JpZ2h0XCIpLCAxMCkgK1xuICAgICAgICBlbGVtZW50LmNsaWVudFdpZHRoXG4gICAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldElubmVySGVpZ2h0KGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogbnVtYmVyIHtcbiAgICByZXR1cm4gKFxuICAgICAgICBwYXJzZUludChleHBvcnRzLmNvbXB1dGVkU3R5bGUoZWxlbWVudCwgXCJwYWRkaW5nVG9wXCIpLCAxMCkgK1xuICAgICAgICBwYXJzZUludChleHBvcnRzLmNvbXB1dGVkU3R5bGUoZWxlbWVudCwgXCJwYWRkaW5nQm90dG9tXCIpLCAxMCkgK1xuICAgICAgICBlbGVtZW50LmNsaWVudEhlaWdodFxuICAgICk7XG59XG5cbmlmICh3aW5kb3cucGFnZVlPZmZzZXQgIT09IHVuZGVmaW5lZCkge1xuICAgIGV4cG9ydHMuZ2V0UGFnZVNjcm9sbFRvcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gd2luZG93LnBhZ2VZT2Zmc2V0O1xuICAgIH07XG5cbiAgICBleHBvcnRzLmdldFBhZ2VTY3JvbGxMZWZ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB3aW5kb3cucGFnZVhPZmZzZXQ7XG4gICAgfTtcbn1cbmVsc2Uge1xuICAgIGV4cG9ydHMuZ2V0UGFnZVNjcm9sbFRvcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7XG4gICAgfTtcblxuICAgIGV4cG9ydHMuZ2V0UGFnZVNjcm9sbExlZnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdDtcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBtYWtlQ29tcHV0ZWRTdHlsZSgpOiAoZWxlbWVudDogSFRNTEVsZW1lbnQsIHN0eWxlPzogc3RyaW5nKSA9PiBhbnkge1xuICAgIGlmICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZWxlbWVudDogSFRNTEVsZW1lbnQsIHN0eWxlPzogc3RyaW5nKTogYW55IHtcbiAgICAgICAgICAgIGlmIChzdHlsZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAod2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgXCJcIikgfHwge30pW3N0eWxlXSB8fCBcIlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsIFwiXCIpIHx8IHt9O1xuICAgICAgICB9O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBzdHlsZT86IHN0cmluZyk6IGFueSB7XG4gICAgICAgICAgICBpZiAoc3R5bGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudFsnY3VycmVudFN0eWxlJ11bc3R5bGVdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRbJ2N1cnJlbnRTdHlsZSddO1xuICAgICAgICB9O1xuICAgIH1cbn1cblxuZXhwb3J0IHZhciBjb21wdXRlZFN0eWxlID0gbWFrZUNvbXB1dGVkU3R5bGUoKTtcblxuaWYgKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKVxuICAgIGV4cG9ydHMuY29tcHV0ZWRTdHlsZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIHN0eWxlKTogYW55IHtcbiAgICAgICAgaWYgKHN0eWxlKVxuICAgICAgICAgICAgcmV0dXJuICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBcIlwiKSB8fCB7fSlbc3R5bGVdIHx8IFwiXCI7XG4gICAgICAgIHJldHVybiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBcIlwiKSB8fCB7fTtcbiAgICB9O1xuZWxzZVxuICAgIGV4cG9ydHMuY29tcHV0ZWRTdHlsZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIHN0eWxlKSB7XG4gICAgICAgIGlmIChzdHlsZSlcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmN1cnJlbnRTdHlsZVtzdHlsZV07XG4gICAgICAgIHJldHVybiBlbGVtZW50LmN1cnJlbnRTdHlsZTtcbiAgICB9O1xuXG5leHBvcnQgZnVuY3Rpb24gc2Nyb2xsYmFyV2lkdGgoZG9jdW1lbnQpIHtcbiAgICB2YXIgaW5uZXI6IGFueSA9IGNyZWF0ZUVsZW1lbnQoXCJhY2VfaW5uZXJcIik7XG4gICAgaW5uZXIuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcbiAgICBpbm5lci5zdHlsZS5taW5XaWR0aCA9IFwiMHB4XCI7XG4gICAgaW5uZXIuc3R5bGUuaGVpZ2h0ID0gXCIyMDBweFwiO1xuICAgIGlubmVyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG5cbiAgICB2YXIgb3V0ZXI6IGFueSA9IGNyZWF0ZUVsZW1lbnQoXCJhY2Vfb3V0ZXJcIik7XG4gICAgdmFyIHN0eWxlID0gb3V0ZXIuc3R5bGU7XG5cbiAgICBzdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICBzdHlsZS5sZWZ0ID0gXCItMTAwMDBweFwiO1xuICAgIHN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcbiAgICBzdHlsZS53aWR0aCA9IFwiMjAwcHhcIjtcbiAgICBzdHlsZS5taW5XaWR0aCA9IFwiMHB4XCI7XG4gICAgc3R5bGUuaGVpZ2h0ID0gXCIxNTBweFwiO1xuICAgIHN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG5cbiAgICBvdXRlci5hcHBlbmRDaGlsZChpbm5lcik7XG5cbiAgICB2YXIgYm9keSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgICBib2R5LmFwcGVuZENoaWxkKG91dGVyKTtcblxuICAgIHZhciBub1Njcm9sbGJhciA9IGlubmVyLm9mZnNldFdpZHRoO1xuXG4gICAgc3R5bGUub3ZlcmZsb3cgPSBcInNjcm9sbFwiO1xuICAgIHZhciB3aXRoU2Nyb2xsYmFyID0gaW5uZXIub2Zmc2V0V2lkdGg7XG5cbiAgICBpZiAobm9TY3JvbGxiYXIgPT0gd2l0aFNjcm9sbGJhcikge1xuICAgICAgICB3aXRoU2Nyb2xsYmFyID0gb3V0ZXIuY2xpZW50V2lkdGg7XG4gICAgfVxuXG4gICAgYm9keS5yZW1vdmVDaGlsZChvdXRlcik7XG5cbiAgICByZXR1cm4gbm9TY3JvbGxiYXIgLSB3aXRoU2Nyb2xsYmFyO1xufVxuXG4vKlxuICogT3B0aW1pemVkIHNldCBpbm5lckhUTUwuIFRoaXMgaXMgZmFzdGVyIHRoYW4gcGxhaW4gaW5uZXJIVE1MIGlmIHRoZSBlbGVtZW50XG4gKiBhbHJlYWR5IGNvbnRhaW5zIGEgbG90IG9mIGNoaWxkIGVsZW1lbnRzLlxuICpcbiAqIFNlZSBodHRwOi8vYmxvZy5zdGV2ZW5sZXZpdGhhbi5jb20vYXJjaGl2ZXMvZmFzdGVyLXRoYW4taW5uZXJodG1sIGZvciBkZXRhaWxzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRJbm5lckh0bWwoZWxlbWVudDogSFRNTEVsZW1lbnQsIGlubmVySFRNTDogc3RyaW5nKSB7XG4gICAgdmFyIGNsb25lZEVsZW1lbnQgPSA8SFRNTEVsZW1lbnQ+ZWxlbWVudC5jbG9uZU5vZGUoZmFsc2UpO1xuICAgIGNsb25lZEVsZW1lbnQuaW5uZXJIVE1MID0gaW5uZXJIVE1MO1xuICAgIGVsZW1lbnQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoY2xvbmVkRWxlbWVudCwgZWxlbWVudCk7XG4gICAgcmV0dXJuIGNsb25lZEVsZW1lbnQ7XG59XG5cbmZ1bmN0aW9uIG1ha2VHZXRJbm5lclRleHQoKTogKGVsOiBIVE1MRWxlbWVudCkgPT4gc3RyaW5nIHtcbiAgICBpZiAoXCJ0ZXh0Q29udGVudFwiIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZWw6IEhUTUxFbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZWwudGV4dENvbnRlbnQ7XG4gICAgICAgIH07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZWw6IEhUTUxFbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZWwuaW5uZXJUZXh0O1xuICAgICAgICB9O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbWFrZVNldElubmVyVGV4dCgpOiAoZWw6IEhUTUxFbGVtZW50LCBpbm5lclRleHQ6IHN0cmluZykgPT4gdm9pZCB7XG4gICAgaWYgKFwidGV4dENvbnRlbnRcIiBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVsOiBIVE1MRWxlbWVudCwgaW5uZXJUZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgICAgIGVsLnRleHRDb250ZW50ID0gaW5uZXJUZXh0O1xuICAgICAgICB9O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVsOiBIVE1MRWxlbWVudCwgaW5uZXJUZXh0OiBzdHJpbmcpIHtcbiAgICAgICAgICAgIGVsLmlubmVyVGV4dCA9IGlubmVyVGV4dDtcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmV4cG9ydCB2YXIgZ2V0SW5uZXJUZXh0OiAoZWw6IEhUTUxFbGVtZW50KSA9PiBzdHJpbmcgPSBtYWtlR2V0SW5uZXJUZXh0KCk7XG5leHBvcnQgdmFyIHNldElubmVyVGV4dDogKGVsOiBIVE1MRWxlbWVudCwgaW5uZXJUZXh0OiBzdHJpbmcpID0+IHZvaWQgPSBtYWtlU2V0SW5uZXJUZXh0KCk7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQYXJlbnRXaW5kb3coZG9jdW1lbnQ6IERvY3VtZW50KTogV2luZG93IHtcbiAgICAvLyBUaGlzIGlzIGEgYml0IHJlZHVuZGFudCBub3cgdGhhdCBwYXJlbnRXaW5kb3cgaGFzIGJlZW4gcmVtb3ZlZC5cbiAgICByZXR1cm4gZG9jdW1lbnQuZGVmYXVsdFZpZXc7XG59XG4iXX0=