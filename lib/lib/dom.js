var XHTML_NS = "http://www.w3.org/1999/xhtml";
export function getDocumentHead(doc) {
    if (!doc) {
        doc = document;
    }
    return (doc.head || doc.getElementsByTagName("head")[0] || doc.documentElement);
}
export function createElement(tagName, namespaceURI) {
    return document.createElementNS ?
        document.createElementNS(namespaceURI || XHTML_NS, tagName) :
        document.createElement(tagName);
}
export function hasCssClass(element, name) {
    var classes = element.className.split(/\s+/g);
    return classes.indexOf(name) !== -1;
}
export function addCssClass(element, name) {
    if (!hasCssClass(element, name)) {
        element.className += " " + name;
    }
}
export function removeCssClass(element, name) {
    var classes = element.className.split(/\s+/g);
    while (true) {
        var index = classes.indexOf(name);
        if (index == -1) {
            break;
        }
        classes.splice(index, 1);
    }
    element.className = classes.join(" ");
}
export function toggleCssClass(element, name) {
    var classes = element.className.split(/\s+/g), add = true;
    while (true) {
        var index = classes.indexOf(name);
        if (index == -1) {
            break;
        }
        add = false;
        classes.splice(index, 1);
    }
    if (add)
        classes.push(name);
    element.className = classes.join(" ");
    return add;
}
export function setCssClass(node, className, include) {
    if (include) {
        addCssClass(node, className);
    }
    else {
        removeCssClass(node, className);
    }
}
export function hasCssString(id, doc = document) {
    var index = 0;
    var sheets = doc.getElementsByTagName('style');
    if (sheets) {
        while (index < sheets.length)
            if (sheets[index++].id === id)
                return true;
    }
    return false;
}
export function importCssString(cssText, id, doc) {
    doc = doc || document;
    if (id && hasCssString(id, doc)) {
        return;
    }
    var style;
    style = doc.createElementNS
        ? doc.createElementNS(XHTML_NS, "style")
        : doc.createElement("style");
    style.appendChild(doc.createTextNode(cssText));
    if (id)
        style.id = id;
    getDocumentHead(doc).appendChild(style);
}
export function importCssStylsheet(uri, doc) {
    var link = createElement('link');
    link['rel'] = 'stylesheet';
    link['href'] = uri;
    getDocumentHead(doc).appendChild(link);
}
export function getInnerWidth(element) {
    return (parseInt(exports.computedStyle(element, "paddingLeft"), 10) +
        parseInt(exports.computedStyle(element, "paddingRight"), 10) +
        element.clientWidth);
}
export function getInnerHeight(element) {
    return (parseInt(exports.computedStyle(element, "paddingTop"), 10) +
        parseInt(exports.computedStyle(element, "paddingBottom"), 10) +
        element.clientHeight);
}
if (window.pageYOffset !== undefined) {
    exports.getPageScrollTop = function () {
        return window.pageYOffset;
    };
    exports.getPageScrollLeft = function () {
        return window.pageXOffset;
    };
}
else {
    exports.getPageScrollTop = function () {
        return document.body.scrollTop;
    };
    exports.getPageScrollLeft = function () {
        return document.body.scrollLeft;
    };
}
function makeComputedStyle() {
    if (window.getComputedStyle) {
        return function (element, style) {
            if (style) {
                return (window.getComputedStyle(element, "") || {})[style] || "";
            }
            return window.getComputedStyle(element, "") || {};
        };
    }
    else {
        return function (element, style) {
            if (style) {
                return element['currentStyle'][style];
            }
            return element['currentStyle'];
        };
    }
}
export var computedStyle = makeComputedStyle();
if (window.getComputedStyle)
    exports.computedStyle = function (element, style) {
        if (style)
            return (window.getComputedStyle(element, "") || {})[style] || "";
        return window.getComputedStyle(element, "") || {};
    };
else
    exports.computedStyle = function (element, style) {
        if (style)
            return element.currentStyle[style];
        return element.currentStyle;
    };
export function scrollbarWidth(document) {
    var inner = createElement("ace_inner");
    inner.style.width = "100%";
    inner.style.minWidth = "0px";
    inner.style.height = "200px";
    inner.style.display = "block";
    var outer = createElement("ace_outer");
    var style = outer.style;
    style.position = "absolute";
    style.left = "-10000px";
    style.overflow = "hidden";
    style.width = "200px";
    style.minWidth = "0px";
    style.height = "150px";
    style.display = "block";
    outer.appendChild(inner);
    var body = document.documentElement;
    body.appendChild(outer);
    var noScrollbar = inner.offsetWidth;
    style.overflow = "scroll";
    var withScrollbar = inner.offsetWidth;
    if (noScrollbar == withScrollbar) {
        withScrollbar = outer.clientWidth;
    }
    body.removeChild(outer);
    return noScrollbar - withScrollbar;
}
export function setInnerHtml(element, innerHTML) {
    var clonedElement = element.cloneNode(false);
    clonedElement.innerHTML = innerHTML;
    element.parentNode.replaceChild(clonedElement, element);
    return clonedElement;
}
function makeGetInnerText() {
    if ("textContent" in document.documentElement) {
        return function (el) {
            return el.textContent;
        };
    }
    else {
        return function (el) {
            return el.innerText;
        };
    }
}
function makeSetInnerText() {
    if ("textContent" in document.documentElement) {
        return function (el, innerText) {
            el.textContent = innerText;
        };
    }
    else {
        return function (el, innerText) {
            el.innerText = innerText;
        };
    }
}
export var getInnerText = makeGetInnerText();
export var setInnerText = makeSetInnerText();
export function getParentWindow(document) {
    return document.defaultView;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2xpYi9kb20udHMiXSwibmFtZXMiOlsiZ2V0RG9jdW1lbnRIZWFkIiwiY3JlYXRlRWxlbWVudCIsImhhc0Nzc0NsYXNzIiwiYWRkQ3NzQ2xhc3MiLCJyZW1vdmVDc3NDbGFzcyIsInRvZ2dsZUNzc0NsYXNzIiwic2V0Q3NzQ2xhc3MiLCJoYXNDc3NTdHJpbmciLCJpbXBvcnRDc3NTdHJpbmciLCJpbXBvcnRDc3NTdHlsc2hlZXQiLCJnZXRJbm5lcldpZHRoIiwiZ2V0SW5uZXJIZWlnaHQiLCJtYWtlQ29tcHV0ZWRTdHlsZSIsInNjcm9sbGJhcldpZHRoIiwic2V0SW5uZXJIdG1sIiwibWFrZUdldElubmVyVGV4dCIsIm1ha2VTZXRJbm5lclRleHQiLCJnZXRQYXJlbnRXaW5kb3ciXSwibWFwcGluZ3MiOiJBQW9DQSxJQUFJLFFBQVEsR0FBRyw4QkFBOEIsQ0FBQztBQUU5QyxnQ0FBZ0MsR0FBYztJQUMxQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDUEEsR0FBR0EsR0FBR0EsUUFBUUEsQ0FBQ0E7SUFDbkJBLENBQUNBO0lBQ0RBLE1BQU1BLENBQWNBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLElBQUlBLEdBQUdBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0E7QUFDakdBLENBQUNBO0FBRUQsOEJBQThCLE9BQWUsRUFBRSxZQUFxQjtJQUNoRUMsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsZUFBZUE7UUFDM0JBLFFBQVFBLENBQUNBLGVBQWVBLENBQUNBLFlBQVlBLElBQUlBLFFBQVFBLEVBQUVBLE9BQU9BLENBQUNBO1FBQzNEQSxRQUFRQSxDQUFDQSxhQUFhQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtBQUN4Q0EsQ0FB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O0FBQ0xBLENBQUNBO0FBRUQsV0FBVyxZQUFZLEdBQWdDLGdCQUFnQixFQUFFLENBQUM7QUFDMUUsV0FBVyxZQUFZLEdBQWlELGdCQUFnQixFQUFFLENBQUM7QUFFM0YsZ0NBQWdDLFFBQWtCO0lBRTlDQyxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxXQUFXQSxDQUFDQTtBQUNoQ0EsQ0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIvKiAqKioqKiBCRUdJTiBMSUNFTlNFIEJMT0NLICoqKioqXG4gKiBEaXN0cmlidXRlZCB1bmRlciB0aGUgQlNEIGxpY2Vuc2U6XG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEwLCBBamF4Lm9yZyBCLlYuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogXG4gKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXRcbiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuICogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlXG4gKiAgICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICogICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBBamF4Lm9yZyBCLlYuIG5vciB0aGVcbiAqICAgICAgIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzXG4gKiAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cbiAqIFxuICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyBcIkFTIElTXCIgQU5EXG4gKiBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRFxuICogV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRVxuICogRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgQUpBWC5PUkcgQi5WLiBCRSBMSUFCTEUgRk9SIEFOWVxuICogRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVNcbiAqIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUztcbiAqIExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORFxuICogT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbiAqIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTXG4gKiBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cbiAqXG4gKiAqKioqKiBFTkQgTElDRU5TRSBCTE9DSyAqKioqKiAqL1xuXG4vL1widXNlIHN0cmljdFwiO1xuXG4vL2lmICh0eXBlb2YgZG9jdW1lbnQgPT0gXCJ1bmRlZmluZWRcIikge1xuLy8gICAgcmV0dXJuO1xuLy99XG5cbnZhciBYSFRNTF9OUyA9IFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RG9jdW1lbnRIZWFkKGRvYz86IERvY3VtZW50KTogSFRNTEVsZW1lbnQge1xuICAgIGlmICghZG9jKSB7XG4gICAgICAgIGRvYyA9IGRvY3VtZW50O1xuICAgIH1cbiAgICByZXR1cm4gPEhUTUxFbGVtZW50Pihkb2MuaGVhZCB8fCBkb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdIHx8IGRvYy5kb2N1bWVudEVsZW1lbnQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRWxlbWVudCh0YWdOYW1lOiBzdHJpbmcsIG5hbWVzcGFjZVVSST86IHN0cmluZykge1xuICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMgP1xuICAgICAgICBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMobmFtZXNwYWNlVVJJIHx8IFhIVE1MX05TLCB0YWdOYW1lKSA6XG4gICAgICAgIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYXNDc3NDbGFzcyhlbGVtZW50OiBIVE1MRWxlbWVudCwgbmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgdmFyIGNsYXNzZXM6IHN0cmluZ1tdID0gZWxlbWVudC5jbGFzc05hbWUuc3BsaXQoL1xccysvZyk7XG4gICAgcmV0dXJuIGNsYXNzZXMuaW5kZXhPZihuYW1lKSAhPT0gLTE7XG59XG5cbi8qKlxuICogQWRkIGEgQ1NTIGNsYXNzIHRvIHRoZSBsaXN0IG9mIGNsYXNzZXMgb24gdGhlIGdpdmVuIG5vZGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFkZENzc0NsYXNzKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBuYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoIWhhc0Nzc0NsYXNzKGVsZW1lbnQsIG5hbWUpKSB7XG4gICAgICAgIGVsZW1lbnQuY2xhc3NOYW1lICs9IFwiIFwiICsgbmFtZTtcbiAgICB9XG59XG5cbi8qKlxuICogUmVtb3ZlIGEgQ1NTIGNsYXNzIGZyb20gdGhlIGxpc3Qgb2YgY2xhc3NlcyBvbiB0aGUgZ2l2ZW4gbm9kZVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlQ3NzQ2xhc3MoZWxlbWVudDogSFRNTEVsZW1lbnQsIG5hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgIHZhciBjbGFzc2VzOiBzdHJpbmdbXSA9IGVsZW1lbnQuY2xhc3NOYW1lLnNwbGl0KC9cXHMrL2cpO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIHZhciBpbmRleCA9IGNsYXNzZXMuaW5kZXhPZihuYW1lKTtcbiAgICAgICAgaWYgKGluZGV4ID09IC0xKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjbGFzc2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxuICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gY2xhc3Nlcy5qb2luKFwiIFwiKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRvZ2dsZUNzc0NsYXNzKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICB2YXIgY2xhc3NlcyA9IGVsZW1lbnQuY2xhc3NOYW1lLnNwbGl0KC9cXHMrL2cpLCBhZGQgPSB0cnVlO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIHZhciBpbmRleCA9IGNsYXNzZXMuaW5kZXhPZihuYW1lKTtcbiAgICAgICAgaWYgKGluZGV4ID09IC0xKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBhZGQgPSBmYWxzZTtcbiAgICAgICAgY2xhc3Nlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIH1cbiAgICBpZiAoYWRkKVxuICAgICAgICBjbGFzc2VzLnB1c2gobmFtZSk7XG5cbiAgICBlbGVtZW50LmNsYXNzTmFtZSA9IGNsYXNzZXMuam9pbihcIiBcIik7XG4gICAgcmV0dXJuIGFkZDtcbn1cblxuLypcbiAqIEFkZCBvciByZW1vdmUgYSBDU1MgY2xhc3MgZnJvbSB0aGUgbGlzdCBvZiBjbGFzc2VzIG9uIHRoZSBnaXZlbiBub2RlXG4gKiBkZXBlbmRpbmcgb24gdGhlIHZhbHVlIG9mIDx0dD5pbmNsdWRlPC90dD5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldENzc0NsYXNzKG5vZGU6IEhUTUxFbGVtZW50LCBjbGFzc05hbWU6IHN0cmluZywgaW5jbHVkZTogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmIChpbmNsdWRlKSB7XG4gICAgICAgIGFkZENzc0NsYXNzKG5vZGUsIGNsYXNzTmFtZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZW1vdmVDc3NDbGFzcyhub2RlLCBjbGFzc05hbWUpO1xuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhc0Nzc1N0cmluZyhpZDogc3RyaW5nLCBkb2M6IERvY3VtZW50ID0gZG9jdW1lbnQpIHtcbiAgICB2YXIgaW5kZXggPSAwO1xuICAgIHZhciBzaGVldHMgPSBkb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3N0eWxlJyk7XG5cbiAgICBpZiAoc2hlZXRzKSB7XG4gICAgICAgIHdoaWxlIChpbmRleCA8IHNoZWV0cy5sZW5ndGgpXG4gICAgICAgICAgICBpZiAoc2hlZXRzW2luZGV4KytdLmlkID09PSBpZCkgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW1wb3J0Q3NzU3RyaW5nKGNzc1RleHQ6IHN0cmluZywgaWQ/OiBzdHJpbmcsIGRvYz86IERvY3VtZW50KTogdm9pZCB7XG4gICAgZG9jID0gZG9jIHx8IGRvY3VtZW50O1xuICAgIC8vIElmIHN0eWxlIGlzIGFscmVhZHkgaW1wb3J0ZWQgcmV0dXJuIGltbWVkaWF0ZWx5LlxuICAgIGlmIChpZCAmJiBoYXNDc3NTdHJpbmcoaWQsIGRvYykpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBzdHlsZTtcblxuICAgIHN0eWxlID0gZG9jLmNyZWF0ZUVsZW1lbnROU1xuICAgICAgICA/IGRvYy5jcmVhdGVFbGVtZW50TlMoWEhUTUxfTlMsIFwic3R5bGVcIilcbiAgICAgICAgOiBkb2MuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO1xuXG4gICAgc3R5bGUuYXBwZW5kQ2hpbGQoZG9jLmNyZWF0ZVRleHROb2RlKGNzc1RleHQpKTtcbiAgICBpZiAoaWQpXG4gICAgICAgIHN0eWxlLmlkID0gaWQ7XG5cbiAgICBnZXREb2N1bWVudEhlYWQoZG9jKS5hcHBlbmRDaGlsZChzdHlsZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbXBvcnRDc3NTdHlsc2hlZXQodXJpOiBzdHJpbmcsIGRvYz86IERvY3VtZW50KSB7XG4gICAgdmFyIGxpbmsgPSBjcmVhdGVFbGVtZW50KCdsaW5rJyk7XG4gICAgLy8gRklYTUU6IFdoeSBkbyB3ZSBuZWVkIHRvIHVzZSB0aGUgbGl0ZXJhbHM/XG4gICAgbGlua1sncmVsJ10gPSAnc3R5bGVzaGVldCc7XG4gICAgbGlua1snaHJlZiddID0gdXJpO1xuXG4gICAgZ2V0RG9jdW1lbnRIZWFkKGRvYykuYXBwZW5kQ2hpbGQobGluayk7XG59XG5cbi8vIEZJWE1FOiBUaGlzIHNlZW1zIGtpbmRhIGhhY2t5LlxuZGVjbGFyZSB2YXIgZXhwb3J0czogYW55O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW5uZXJXaWR0aChlbGVtZW50OiBIVE1MRWxlbWVudCk6IG51bWJlciB7XG4gICAgcmV0dXJuIChcbiAgICAgICAgcGFyc2VJbnQoZXhwb3J0cy5jb21wdXRlZFN0eWxlKGVsZW1lbnQsIFwicGFkZGluZ0xlZnRcIiksIDEwKSArXG4gICAgICAgIHBhcnNlSW50KGV4cG9ydHMuY29tcHV0ZWRTdHlsZShlbGVtZW50LCBcInBhZGRpbmdSaWdodFwiKSwgMTApICtcbiAgICAgICAgZWxlbWVudC5jbGllbnRXaWR0aFxuICAgICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRJbm5lckhlaWdodChlbGVtZW50OiBIVE1MRWxlbWVudCk6IG51bWJlciB7XG4gICAgcmV0dXJuIChcbiAgICAgICAgcGFyc2VJbnQoZXhwb3J0cy5jb21wdXRlZFN0eWxlKGVsZW1lbnQsIFwicGFkZGluZ1RvcFwiKSwgMTApICtcbiAgICAgICAgcGFyc2VJbnQoZXhwb3J0cy5jb21wdXRlZFN0eWxlKGVsZW1lbnQsIFwicGFkZGluZ0JvdHRvbVwiKSwgMTApICtcbiAgICAgICAgZWxlbWVudC5jbGllbnRIZWlnaHRcbiAgICApO1xufVxuXG5pZiAod2luZG93LnBhZ2VZT2Zmc2V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICBleHBvcnRzLmdldFBhZ2VTY3JvbGxUb3AgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5wYWdlWU9mZnNldDtcbiAgICB9O1xuXG4gICAgZXhwb3J0cy5nZXRQYWdlU2Nyb2xsTGVmdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gd2luZG93LnBhZ2VYT2Zmc2V0O1xuICAgIH07XG59XG5lbHNlIHtcbiAgICBleHBvcnRzLmdldFBhZ2VTY3JvbGxUb3AgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wO1xuICAgIH07XG5cbiAgICBleHBvcnRzLmdldFBhZ2VTY3JvbGxMZWZ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQ7XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gbWFrZUNvbXB1dGVkU3R5bGUoKTogKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBzdHlsZT86IHN0cmluZykgPT4gYW55IHtcbiAgICBpZiAod2luZG93LmdldENvbXB1dGVkU3R5bGUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBzdHlsZT86IHN0cmluZyk6IGFueSB7XG4gICAgICAgICAgICBpZiAoc3R5bGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsIFwiXCIpIHx8IHt9KVtzdHlsZV0gfHwgXCJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBcIlwiKSB8fCB7fTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihlbGVtZW50OiBIVE1MRWxlbWVudCwgc3R5bGU/OiBzdHJpbmcpOiBhbnkge1xuICAgICAgICAgICAgaWYgKHN0eWxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRbJ2N1cnJlbnRTdHlsZSddW3N0eWxlXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50WydjdXJyZW50U3R5bGUnXTtcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmV4cG9ydCB2YXIgY29tcHV0ZWRTdHlsZSA9IG1ha2VDb21wdXRlZFN0eWxlKCk7XG5cbmlmICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSlcbiAgICBleHBvcnRzLmNvbXB1dGVkU3R5bGUgPSBmdW5jdGlvbihlbGVtZW50LCBzdHlsZSk6IGFueSB7XG4gICAgICAgIGlmIChzdHlsZSlcbiAgICAgICAgICAgIHJldHVybiAod2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgXCJcIikgfHwge30pW3N0eWxlXSB8fCBcIlwiO1xuICAgICAgICByZXR1cm4gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgXCJcIikgfHwge307XG4gICAgfTtcbmVsc2VcbiAgICBleHBvcnRzLmNvbXB1dGVkU3R5bGUgPSBmdW5jdGlvbihlbGVtZW50LCBzdHlsZSkge1xuICAgICAgICBpZiAoc3R5bGUpXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudC5jdXJyZW50U3R5bGVbc3R5bGVdO1xuICAgICAgICByZXR1cm4gZWxlbWVudC5jdXJyZW50U3R5bGU7XG4gICAgfTtcblxuZXhwb3J0IGZ1bmN0aW9uIHNjcm9sbGJhcldpZHRoKGRvY3VtZW50KSB7XG4gICAgdmFyIGlubmVyOiBhbnkgPSBjcmVhdGVFbGVtZW50KFwiYWNlX2lubmVyXCIpO1xuICAgIGlubmVyLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gICAgaW5uZXIuc3R5bGUubWluV2lkdGggPSBcIjBweFwiO1xuICAgIGlubmVyLnN0eWxlLmhlaWdodCA9IFwiMjAwcHhcIjtcbiAgICBpbm5lci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuXG4gICAgdmFyIG91dGVyOiBhbnkgPSBjcmVhdGVFbGVtZW50KFwiYWNlX291dGVyXCIpO1xuICAgIHZhciBzdHlsZSA9IG91dGVyLnN0eWxlO1xuXG4gICAgc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgc3R5bGUubGVmdCA9IFwiLTEwMDAwcHhcIjtcbiAgICBzdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XG4gICAgc3R5bGUud2lkdGggPSBcIjIwMHB4XCI7XG4gICAgc3R5bGUubWluV2lkdGggPSBcIjBweFwiO1xuICAgIHN0eWxlLmhlaWdodCA9IFwiMTUwcHhcIjtcbiAgICBzdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuXG4gICAgb3V0ZXIuYXBwZW5kQ2hpbGQoaW5uZXIpO1xuXG4gICAgdmFyIGJvZHkgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgYm9keS5hcHBlbmRDaGlsZChvdXRlcik7XG5cbiAgICB2YXIgbm9TY3JvbGxiYXIgPSBpbm5lci5vZmZzZXRXaWR0aDtcblxuICAgIHN0eWxlLm92ZXJmbG93ID0gXCJzY3JvbGxcIjtcbiAgICB2YXIgd2l0aFNjcm9sbGJhciA9IGlubmVyLm9mZnNldFdpZHRoO1xuXG4gICAgaWYgKG5vU2Nyb2xsYmFyID09IHdpdGhTY3JvbGxiYXIpIHtcbiAgICAgICAgd2l0aFNjcm9sbGJhciA9IG91dGVyLmNsaWVudFdpZHRoO1xuICAgIH1cblxuICAgIGJvZHkucmVtb3ZlQ2hpbGQob3V0ZXIpO1xuXG4gICAgcmV0dXJuIG5vU2Nyb2xsYmFyIC0gd2l0aFNjcm9sbGJhcjtcbn1cblxuLypcbiAqIE9wdGltaXplZCBzZXQgaW5uZXJIVE1MLiBUaGlzIGlzIGZhc3RlciB0aGFuIHBsYWluIGlubmVySFRNTCBpZiB0aGUgZWxlbWVudFxuICogYWxyZWFkeSBjb250YWlucyBhIGxvdCBvZiBjaGlsZCBlbGVtZW50cy5cbiAqXG4gKiBTZWUgaHR0cDovL2Jsb2cuc3RldmVubGV2aXRoYW4uY29tL2FyY2hpdmVzL2Zhc3Rlci10aGFuLWlubmVyaHRtbCBmb3IgZGV0YWlsc1xuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0SW5uZXJIdG1sKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBpbm5lckhUTUw6IHN0cmluZykge1xuICAgIHZhciBjbG9uZWRFbGVtZW50ID0gPEhUTUxFbGVtZW50PmVsZW1lbnQuY2xvbmVOb2RlKGZhbHNlKTtcbiAgICBjbG9uZWRFbGVtZW50LmlubmVySFRNTCA9IGlubmVySFRNTDtcbiAgICBlbGVtZW50LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGNsb25lZEVsZW1lbnQsIGVsZW1lbnQpO1xuICAgIHJldHVybiBjbG9uZWRFbGVtZW50O1xufVxuXG5mdW5jdGlvbiBtYWtlR2V0SW5uZXJUZXh0KCk6IChlbDogSFRNTEVsZW1lbnQpID0+IHN0cmluZyB7XG4gICAgaWYgKFwidGV4dENvbnRlbnRcIiBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVsOiBIVE1MRWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGVsLnRleHRDb250ZW50O1xuICAgICAgICB9O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVsOiBIVE1MRWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGVsLmlubmVyVGV4dDtcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIG1ha2VTZXRJbm5lclRleHQoKTogKGVsOiBIVE1MRWxlbWVudCwgaW5uZXJUZXh0OiBzdHJpbmcpID0+IHZvaWQge1xuICAgIGlmIChcInRleHRDb250ZW50XCIgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihlbDogSFRNTEVsZW1lbnQsIGlubmVyVGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgICAgICBlbC50ZXh0Q29udGVudCA9IGlubmVyVGV4dDtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihlbDogSFRNTEVsZW1lbnQsIGlubmVyVGV4dDogc3RyaW5nKSB7XG4gICAgICAgICAgICBlbC5pbm5lclRleHQgPSBpbm5lclRleHQ7XG4gICAgICAgIH07XG4gICAgfVxufVxuXG5leHBvcnQgdmFyIGdldElubmVyVGV4dDogKGVsOiBIVE1MRWxlbWVudCkgPT4gc3RyaW5nID0gbWFrZUdldElubmVyVGV4dCgpO1xuZXhwb3J0IHZhciBzZXRJbm5lclRleHQ6IChlbDogSFRNTEVsZW1lbnQsIGlubmVyVGV4dDogc3RyaW5nKSA9PiB2b2lkID0gbWFrZVNldElubmVyVGV4dCgpO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGFyZW50V2luZG93KGRvY3VtZW50OiBEb2N1bWVudCk6IFdpbmRvdyB7XG4gICAgLy8gVGhpcyBpcyBhIGJpdCByZWR1bmRhbnQgbm93IHRoYXQgcGFyZW50V2luZG93IGhhcyBiZWVuIHJlbW92ZWQuXG4gICAgcmV0dXJuIGRvY3VtZW50LmRlZmF1bHRWaWV3O1xufVxuIl19