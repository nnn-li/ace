import { decodeEventType, getDistance, INPUT_START, INPUT_MOVE, INPUT_END, INPUT_CANCEL, Recognizer, STATE_BEGAN, STATE_FAILED, STATE_RECOGNIZED, TOUCH_ACTION_MANIPULATION } from '../hammer';
import { setTimeoutContext } from '../utils';
function isCorrectTouchCount(input) {
    switch (input.eventType) {
        case INPUT_START:
            {
                return input.touchesLength === 1;
            }
            break;
        case INPUT_MOVE:
            {
                return input.touchesLength === 1;
            }
            break;
        case INPUT_END:
            {
                return input.touchesLength === 0;
            }
            break;
        case INPUT_CANCEL:
            {
                return true;
            }
            break;
        default: {
            throw new Error(decodeEventType(input.eventType));
        }
    }
}
export class TapRecognizer extends Recognizer {
    constructor(eventName, enabled) {
        super(eventName ? eventName : 'tap', enabled);
        this.count = 0;
        this.taps = 1;
        this.pointers = 1;
        this.time = 250;
        this.threshold = 6;
        this.interval = 300;
        this.posThreshold = 10;
    }
    getTouchAction() {
        return [TOUCH_ACTION_MANIPULATION];
    }
    process(input) {
        this.reset();
        if (!isCorrectTouchCount(input)) {
            return STATE_FAILED;
        }
        if ((input.eventType & INPUT_START) && (this.count === 0)) {
            this.center = input.center;
            return this.failTimeout();
        }
        if (input.distance >= this.threshold) {
            return STATE_FAILED;
        }
        if (input.deltaTime >= this.time) {
            return STATE_FAILED;
        }
        if (input.eventType !== INPUT_END) {
            this.center = input.center;
            return this.failTimeout();
        }
        else {
        }
        var validInterval = this.pTime ? (input.timeStamp - this.pTime < this.interval) : true;
        var validMultiTap = !this.pCenter || getDistance(this.pCenter, input.center) < this.posThreshold;
        this.pTime = input.timeStamp;
        this.pCenter = input.center;
        if (!validMultiTap || !validInterval) {
            this.count = 1;
        }
        else {
            this.count += 1;
        }
        var tapCount = this.count % this.taps;
        if (tapCount === 0) {
            if (!this.hasRequireFailures()) {
                return STATE_RECOGNIZED;
            }
            else {
                this._timer = setTimeoutContext(function () {
                    this.state = STATE_RECOGNIZED;
                    this.tryEmit();
                }, this.interval, this);
                return STATE_BEGAN;
            }
        }
        return STATE_FAILED;
    }
    failTimeout() {
        this._timer = setTimeoutContext(function () {
            this.state = STATE_FAILED;
        }, this.interval, this);
        return STATE_FAILED;
    }
    reset() {
        clearTimeout(this._timer);
    }
    emit() {
        if (this.state === STATE_RECOGNIZED) {
            this.manager.emit(this.eventName, this.center);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2hhbW1lci9yZWNvZ25pemVycy90YXAudHMiXSwibmFtZXMiOlsiaXNDb3JyZWN0VG91Y2hDb3VudCIsIlRhcFJlY29nbml6ZXIiLCJUYXBSZWNvZ25pemVyLmNvbnN0cnVjdG9yIiwiVGFwUmVjb2duaXplci5nZXRUb3VjaEFjdGlvbiIsIlRhcFJlY29nbml6ZXIucHJvY2VzcyIsIlRhcFJlY29nbml6ZXIuZmFpbFRpbWVvdXQiLCJUYXBSZWNvZ25pemVyLnJlc2V0IiwiVGFwUmVjb2duaXplci5lbWl0Il0sIm1hcHBpbmdzIjoiT0FBTyxFQUVQLGVBQWUsRUFDZixXQUFXLEVBRVgsV0FBVyxFQUNYLFVBQVUsRUFDVixTQUFTLEVBQ1QsWUFBWSxFQUNaLFVBQVUsRUFDVixXQUFXLEVBQ1gsWUFBWSxFQUNaLGdCQUFnQixFQUNoQix5QkFBeUIsRUFDeEIsTUFBTSxXQUFXO09BQ1gsRUFBQyxpQkFBaUIsRUFBQyxNQUFNLFVBQVU7QUFFMUMsNkJBQTZCLEtBQXFCO0lBQzlDQSxNQUFNQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN0QkEsS0FBS0EsV0FBV0E7WUFBRUEsQ0FBQ0E7Z0JBQ2ZBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLGFBQWFBLEtBQUtBLENBQUNBLENBQUNBO1lBQ3JDQSxDQUFDQTtZQUNHQSxLQUFLQSxDQUFDQTtRQUNWQSxLQUFLQSxVQUFVQTtZQUFFQSxDQUFDQTtnQkFDZEEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsYUFBYUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFDckNBLENBQUNBO1lBQ0dBLEtBQUtBLENBQUNBO1FBQ1ZBLEtBQUtBLFNBQVNBO1lBQUVBLENBQUNBO2dCQUNiQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxhQUFhQSxLQUFLQSxDQUFDQSxDQUFDQTtZQUNyQ0EsQ0FBQ0E7WUFDR0EsS0FBS0EsQ0FBQ0E7UUFDVkEsS0FBS0EsWUFBWUE7WUFBRUEsQ0FBQ0E7Z0JBQ2hCQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTtZQUNoQkEsQ0FBQ0E7WUFDR0EsS0FBS0EsQ0FBQ0E7UUFDVkEsU0FBU0EsQ0FBQ0E7WUFDTkEsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0EsZUFBZUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdERBLENBQUNBO0lBQ0xBLENBQUNBO0FBQ0xBLENBQUNBO0FBRUQsbUNBQW1DLFVBQVU7SUFlekNDLFlBQVlBLFNBQWlCQSxFQUFFQSxPQUFnQkE7UUFDM0NDLE1BQU1BLFNBQVNBLEdBQUdBLFNBQVNBLEdBQUdBLEtBQUtBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBO1FBVDFDQSxVQUFLQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNWQSxTQUFJQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNUQSxhQUFRQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNiQSxTQUFJQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNYQSxjQUFTQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNkQSxhQUFRQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNmQSxpQkFBWUEsR0FBR0EsRUFBRUEsQ0FBQ0E7SUFJMUJBLENBQUNBO0lBQ0RELGNBQWNBO1FBQ1ZFLE1BQU1BLENBQUNBLENBQUNBLHlCQUF5QkEsQ0FBQ0EsQ0FBQ0E7SUFDdkNBLENBQUNBO0lBQ0RGLE9BQU9BLENBQUNBLEtBQXFCQTtRQUV6QkcsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7UUFFYkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsbUJBQW1CQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM5QkEsTUFBTUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7UUFDeEJBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLFNBQVNBLEdBQUdBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3hEQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUMzQkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0E7UUFDOUJBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLFFBQVFBLElBQUlBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1lBQ25DQSxNQUFNQSxDQUFDQSxZQUFZQSxDQUFDQTtRQUN4QkEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsSUFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDL0JBLE1BQU1BLENBQUNBLFlBQVlBLENBQUNBO1FBQ3hCQSxDQUFDQTtRQUdEQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxTQUFTQSxLQUFLQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNoQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDM0JBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBO1FBQzlCQSxDQUFDQTtRQUNEQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUVOQSxDQUFDQTtRQUVEQSxJQUFJQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxLQUFLQSxDQUFDQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUN2RkEsSUFBSUEsYUFBYUEsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsSUFBSUEsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7UUFFakdBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLEtBQUtBLENBQUNBLFNBQVNBLENBQUNBO1FBQzdCQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUU1QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsYUFBYUEsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbkNBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBO1FBQ25CQSxDQUFDQTtRQUNEQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNGQSxJQUFJQSxDQUFDQSxLQUFLQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNwQkEsQ0FBQ0E7UUFJREEsSUFBSUEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7UUFDdENBLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBR2pCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO2dCQUM3QkEsTUFBTUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQTtZQUM1QkEsQ0FBQ0E7WUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ0ZBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLGlCQUFpQkEsQ0FBQ0E7b0JBQzVCLElBQUksQ0FBQyxLQUFLLEdBQUcsZ0JBQWdCLENBQUM7b0JBQzlCLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDbkIsQ0FBQyxFQUFFQSxJQUFJQSxDQUFDQSxRQUFRQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtnQkFDeEJBLE1BQU1BLENBQUNBLFdBQVdBLENBQUNBO1lBQ3ZCQSxDQUFDQTtRQUNMQSxDQUFDQTtRQUNEQSxNQUFNQSxDQUFDQSxZQUFZQSxDQUFDQTtJQUN4QkEsQ0FBQ0E7SUFFREgsV0FBV0E7UUFDUEksSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsaUJBQWlCQSxDQUFDQTtZQUM1QixJQUFJLENBQUMsS0FBSyxHQUFHLFlBQVksQ0FBQztRQUM5QixDQUFDLEVBQUVBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1FBQ3hCQSxNQUFNQSxDQUFDQSxZQUFZQSxDQUFDQTtJQUN4QkEsQ0FBQ0E7SUFFREosS0FBS0E7UUFDREssWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7SUFDOUJBLENBQUNBO0lBRURMLElBQUlBO1FBQ0FNLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEtBQUtBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbENBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ25EQSxDQUFDQTtJQUNMQSxDQUFDQTtBQUNMTixDQUFDQTtBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbkNsaWVudExvY2F0aW9uLFxuZGVjb2RlRXZlbnRUeXBlLFxuZ2V0RGlzdGFuY2UsXG5JQ29tcHV0ZWRFdmVudCxcbklOUFVUX1NUQVJULFxuSU5QVVRfTU9WRSxcbklOUFVUX0VORCxcbklOUFVUX0NBTkNFTCxcblJlY29nbml6ZXIsXG5TVEFURV9CRUdBTixcblNUQVRFX0ZBSUxFRCxcblNUQVRFX1JFQ09HTklaRUQsXG5UT1VDSF9BQ1RJT05fTUFOSVBVTEFUSU9OXG59IGZyb20gJy4uL2hhbW1lcic7XG5pbXBvcnQge3NldFRpbWVvdXRDb250ZXh0fSBmcm9tICcuLi91dGlscyc7XG5cbmZ1bmN0aW9uIGlzQ29ycmVjdFRvdWNoQ291bnQoaW5wdXQ6IElDb21wdXRlZEV2ZW50KTogYm9vbGVhbiB7XG4gICAgc3dpdGNoIChpbnB1dC5ldmVudFR5cGUpIHtcbiAgICAgICAgY2FzZSBJTlBVVF9TVEFSVDoge1xuICAgICAgICAgICAgcmV0dXJuIGlucHV0LnRvdWNoZXNMZW5ndGggPT09IDE7XG4gICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIElOUFVUX01PVkU6IHtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dC50b3VjaGVzTGVuZ3RoID09PSAxO1xuICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBJTlBVVF9FTkQ6IHtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dC50b3VjaGVzTGVuZ3RoID09PSAwO1xuICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBJTlBVVF9DQU5DRUw6IHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGRlY29kZUV2ZW50VHlwZShpbnB1dC5ldmVudFR5cGUpKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFRhcFJlY29nbml6ZXIgZXh0ZW5kcyBSZWNvZ25pemVyIHtcbiAgICAvLyBwcmV2aW91cyB0aW1lIGFuZCBjZW50ZXIsXG4gICAgLy8gdXNlZCBmb3IgdGFwIGNvdW50aW5nXG4gICAgcHJpdmF0ZSBwVGltZTogbnVtYmVyO1xuICAgIHByaXZhdGUgcENlbnRlcjogQ2xpZW50TG9jYXRpb247XG4gICAgcHJpdmF0ZSBfdGltZXI7XG4gICAgLy9wcml2YXRlIF9pbnB1dDogSUNvbXB1dGVkRXZlbnQ7XG4gICAgcHJpdmF0ZSBjb3VudCA9IDA7XG4gICAgcHJpdmF0ZSB0YXBzID0gMTtcbiAgICBwcml2YXRlIHBvaW50ZXJzID0gMTtcbiAgICBwcml2YXRlIHRpbWUgPSAyNTA7IC8vIG1heCB0aW1lIG9mIHRoZSBwb2ludGVyIHRvIGJlIGRvd24gKGxpa2UgZmluZ2VyIG9uIHRoZSBzY3JlZW4pXG4gICAgcHJpdmF0ZSB0aHJlc2hvbGQgPSA2OyAvLyBhIG1pbmltYWwgbW92ZW1lbnQgaXMgb2ssIGJ1dCBrZWVwIGl0IGxvd1xuICAgIHByaXZhdGUgaW50ZXJ2YWwgPSAzMDA7IC8vIG1heCB0aW1lIGJldHdlZW4gdGhlIG11bHRpLXRhcCB0YXBzXG4gICAgcHJpdmF0ZSBwb3NUaHJlc2hvbGQgPSAxMDsgLy8gYSBtdWx0aS10YXAgY2FuIGJlIGEgYml0IG9mZiB0aGUgaW5pdGlhbCBwb3NpdGlvblxuICAgIHByaXZhdGUgY2VudGVyOiBDbGllbnRMb2NhdGlvbjtcbiAgICBjb25zdHJ1Y3RvcihldmVudE5hbWU6IHN0cmluZywgZW5hYmxlZDogYm9vbGVhbikge1xuICAgICAgICBzdXBlcihldmVudE5hbWUgPyBldmVudE5hbWUgOiAndGFwJywgZW5hYmxlZCk7XG4gICAgfVxuICAgIGdldFRvdWNoQWN0aW9uKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIFtUT1VDSF9BQ1RJT05fTUFOSVBVTEFUSU9OXTtcbiAgICB9XG4gICAgcHJvY2VzcyhpbnB1dDogSUNvbXB1dGVkRXZlbnQpOiBudW1iZXIge1xuXG4gICAgICAgIHRoaXMucmVzZXQoKTtcblxuICAgICAgICBpZiAoIWlzQ29ycmVjdFRvdWNoQ291bnQoaW5wdXQpKSB7XG4gICAgICAgICAgICByZXR1cm4gU1RBVEVfRkFJTEVEO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKChpbnB1dC5ldmVudFR5cGUgJiBJTlBVVF9TVEFSVCkgJiYgKHRoaXMuY291bnQgPT09IDApKSB7XG4gICAgICAgICAgICB0aGlzLmNlbnRlciA9IGlucHV0LmNlbnRlcjtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZhaWxUaW1lb3V0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW5wdXQuZGlzdGFuY2UgPj0gdGhpcy50aHJlc2hvbGQpIHtcbiAgICAgICAgICAgIHJldHVybiBTVEFURV9GQUlMRUQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW5wdXQuZGVsdGFUaW1lID49IHRoaXMudGltZSkge1xuICAgICAgICAgICAgcmV0dXJuIFNUQVRFX0ZBSUxFRDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFuZCB3ZSd2ZSByZWFjaGVkIGFuIGVuZCBldmVudCwgc28gYSB0YXAgaXMgcG9zc2libGVcbiAgICAgICAgaWYgKGlucHV0LmV2ZW50VHlwZSAhPT0gSU5QVVRfRU5EKSB7XG4gICAgICAgICAgICB0aGlzLmNlbnRlciA9IGlucHV0LmNlbnRlcjtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZhaWxUaW1lb3V0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBXZSBhcmUgaW4gdGhlIGVuZCBzdGF0ZSBzbyB0aGVyZSB3aWxsIGJlIG5vIHRvdWNoZXMuXG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdmFsaWRJbnRlcnZhbCA9IHRoaXMucFRpbWUgPyAoaW5wdXQudGltZVN0YW1wIC0gdGhpcy5wVGltZSA8IHRoaXMuaW50ZXJ2YWwpIDogdHJ1ZTtcbiAgICAgICAgdmFyIHZhbGlkTXVsdGlUYXAgPSAhdGhpcy5wQ2VudGVyIHx8IGdldERpc3RhbmNlKHRoaXMucENlbnRlciwgaW5wdXQuY2VudGVyKSA8IHRoaXMucG9zVGhyZXNob2xkO1xuXG4gICAgICAgIHRoaXMucFRpbWUgPSBpbnB1dC50aW1lU3RhbXA7XG4gICAgICAgIHRoaXMucENlbnRlciA9IGlucHV0LmNlbnRlcjtcblxuICAgICAgICBpZiAoIXZhbGlkTXVsdGlUYXAgfHwgIXZhbGlkSW50ZXJ2YWwpIHtcbiAgICAgICAgICAgIHRoaXMuY291bnQgPSAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jb3VudCArPSAxO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaWYgdGFwIGNvdW50IG1hdGNoZXMgd2UgaGF2ZSByZWNvZ25pemVkIGl0LFxuICAgICAgICAvLyBlbHNlIGl0IGhhcyBiZWdhbiByZWNvZ25pemluZy4uLlxuICAgICAgICB2YXIgdGFwQ291bnQgPSB0aGlzLmNvdW50ICUgdGhpcy50YXBzO1xuICAgICAgICBpZiAodGFwQ291bnQgPT09IDApIHtcbiAgICAgICAgICAgIC8vIG5vIGZhaWxpbmcgcmVxdWlyZW1lbnRzLCBpbW1lZGlhdGVseSB0cmlnZ2VyIHRoZSB0YXAgZXZlbnRcbiAgICAgICAgICAgIC8vIG9yIHdhaXQgYXMgbG9uZyBhcyB0aGUgbXVsdGl0YXAgaW50ZXJ2YWwgdG8gdHJpZ2dlclxuICAgICAgICAgICAgaWYgKCF0aGlzLmhhc1JlcXVpcmVGYWlsdXJlcygpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFNUQVRFX1JFQ09HTklaRUQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90aW1lciA9IHNldFRpbWVvdXRDb250ZXh0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID0gU1RBVEVfUkVDT0dOSVpFRDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cnlFbWl0KCk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcy5pbnRlcnZhbCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFNUQVRFX0JFR0FOO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBTVEFURV9GQUlMRUQ7XG4gICAgfVxuXG4gICAgZmFpbFRpbWVvdXQoKSB7XG4gICAgICAgIHRoaXMuX3RpbWVyID0gc2V0VGltZW91dENvbnRleHQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gU1RBVEVfRkFJTEVEO1xuICAgICAgICB9LCB0aGlzLmludGVydmFsLCB0aGlzKTtcbiAgICAgICAgcmV0dXJuIFNUQVRFX0ZBSUxFRDtcbiAgICB9XG5cbiAgICByZXNldCgpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVyKTtcbiAgICB9XG5cbiAgICBlbWl0KCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gU1RBVEVfUkVDT0dOSVpFRCkge1xuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLmVtaXQodGhpcy5ldmVudE5hbWUsIHRoaXMuY2VudGVyKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==