var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var hammer = require('../hammer');
var utils = require('../utils');
function isCorrectTouchCount(input) {
    switch (input.eventType) {
        case hammer.INPUT_START:
            {
                return input.touchesLength === 1;
            }
            break;
        case hammer.INPUT_MOVE:
            {
                return input.touchesLength === 1;
            }
            break;
        case hammer.INPUT_END:
            {
                return input.touchesLength === 0;
            }
            break;
        case hammer.INPUT_CANCEL:
            {
                return true;
            }
            break;
        default: {
            throw new Error(hammer.decodeEventType(input.eventType));
        }
    }
}
var TapRecognizer = (function (_super) {
    __extends(TapRecognizer, _super);
    function TapRecognizer(eventName, enabled) {
        _super.call(this, eventName ? eventName : 'tap', enabled);
        this.count = 0;
        this.taps = 1;
        this.pointers = 1;
        this.time = 250;
        this.threshold = 6;
        this.interval = 300;
        this.posThreshold = 10;
    }
    TapRecognizer.prototype.getTouchAction = function () {
        return [hammer.TOUCH_ACTION_MANIPULATION];
    };
    TapRecognizer.prototype.process = function (input) {
        this.reset();
        if (!isCorrectTouchCount(input)) {
            return hammer.STATE_FAILED;
        }
        if ((input.eventType & hammer.INPUT_START) && (this.count === 0)) {
            this.center = input.center;
            return this.failTimeout();
        }
        if (input.distance >= this.threshold) {
            return hammer.STATE_FAILED;
        }
        if (input.deltaTime >= this.time) {
            return hammer.STATE_FAILED;
        }
        if (input.eventType !== hammer.INPUT_END) {
            this.center = input.center;
            return this.failTimeout();
        }
        else {
        }
        var validInterval = this.pTime ? (input.timeStamp - this.pTime < this.interval) : true;
        var validMultiTap = !this.pCenter || hammer.getDistance(this.pCenter, input.center) < this.posThreshold;
        this.pTime = input.timeStamp;
        this.pCenter = input.center;
        if (!validMultiTap || !validInterval) {
            this.count = 1;
        }
        else {
            this.count += 1;
        }
        var tapCount = this.count % this.taps;
        if (tapCount === 0) {
            if (!this.hasRequireFailures()) {
                return hammer.STATE_RECOGNIZED;
            }
            else {
                this._timer = utils.setTimeoutContext(function () {
                    this.state = hammer.STATE_RECOGNIZED;
                    this.tryEmit();
                }, this.interval, this);
                return hammer.STATE_BEGAN;
            }
        }
        return hammer.STATE_FAILED;
    };
    TapRecognizer.prototype.failTimeout = function () {
        this._timer = utils.setTimeoutContext(function () {
            this.state = hammer.STATE_FAILED;
        }, this.interval, this);
        return hammer.STATE_FAILED;
    };
    TapRecognizer.prototype.reset = function () {
        clearTimeout(this._timer);
    };
    TapRecognizer.prototype.emit = function () {
        if (this.state === hammer.STATE_RECOGNIZED) {
            this.manager.emit(this.eventName, this.center);
        }
    };
    return TapRecognizer;
})(hammer.Recognizer);
exports.TapRecognizer = TapRecognizer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2hhbW1lci9yZWNvZ25pemVycy90YXAudHMiXSwibmFtZXMiOlsiaXNDb3JyZWN0VG91Y2hDb3VudCIsIlRhcFJlY29nbml6ZXIiLCJUYXBSZWNvZ25pemVyLmNvbnN0cnVjdG9yIiwiVGFwUmVjb2duaXplci5nZXRUb3VjaEFjdGlvbiIsIlRhcFJlY29nbml6ZXIucHJvY2VzcyIsIlRhcFJlY29nbml6ZXIuZmFpbFRpbWVvdXQiLCJUYXBSZWNvZ25pemVyLnJlc2V0IiwiVGFwUmVjb2duaXplci5lbWl0Il0sIm1hcHBpbmdzIjoiOzs7OztBQUFBLElBQU8sTUFBTSxXQUFXLFdBQVcsQ0FBQyxDQUFDO0FBQ3JDLElBQU8sS0FBSyxXQUFXLFVBQVUsQ0FBQyxDQUFDO0FBRW5DLDZCQUE2QixLQUE0QjtJQUN2REEsTUFBTUEsQ0FBQUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdkJBLEtBQUtBLE1BQU1BLENBQUNBLFdBQVdBO1lBQUVBLENBQUNBO2dCQUN4QkEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsYUFBYUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFDbkNBLENBQUNBO1lBQ0RBLEtBQUtBLENBQUNBO1FBQ05BLEtBQUtBLE1BQU1BLENBQUNBLFVBQVVBO1lBQUVBLENBQUNBO2dCQUN2QkEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsYUFBYUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFDbkNBLENBQUNBO1lBQ0RBLEtBQUtBLENBQUNBO1FBQ05BLEtBQUtBLE1BQU1BLENBQUNBLFNBQVNBO1lBQUVBLENBQUNBO2dCQUN0QkEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsYUFBYUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFDbkNBLENBQUNBO1lBQ0RBLEtBQUtBLENBQUNBO1FBQ05BLEtBQUtBLE1BQU1BLENBQUNBLFlBQVlBO1lBQUVBLENBQUNBO2dCQUN6QkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7WUFDZEEsQ0FBQ0E7WUFDREEsS0FBS0EsQ0FBQ0E7UUFDTkEsU0FBVUEsQ0FBQ0E7WUFDVEEsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0RBLENBQUNBO0lBQ0hBLENBQUNBO0FBQ0hBLENBQUNBO0FBRUQ7SUFBbUNDLGlDQUFpQkE7SUFlbERBLHVCQUFZQSxTQUFpQkEsRUFBRUEsT0FBZ0JBO1FBQzdDQyxrQkFBTUEsU0FBU0EsR0FBR0EsU0FBU0EsR0FBR0EsS0FBS0EsRUFBRUEsT0FBT0EsQ0FBQ0EsQ0FBQ0E7UUFUeENBLFVBQUtBLEdBQUdBLENBQUNBLENBQUNBO1FBQ1ZBLFNBQUlBLEdBQUdBLENBQUNBLENBQUNBO1FBQ1RBLGFBQVFBLEdBQUdBLENBQUNBLENBQUNBO1FBQ2JBLFNBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1FBQ1hBLGNBQVNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ2RBLGFBQVFBLEdBQUdBLEdBQUdBLENBQUNBO1FBQ2ZBLGlCQUFZQSxHQUFHQSxFQUFFQSxDQUFDQTtJQUkxQkEsQ0FBQ0E7SUFDREQsc0NBQWNBLEdBQWRBO1FBQ0VFLE1BQU1BLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLHlCQUF5QkEsQ0FBQ0EsQ0FBQ0E7SUFDNUNBLENBQUNBO0lBQ0RGLCtCQUFPQSxHQUFQQSxVQUFRQSxLQUE0QkE7UUFFbENHLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBO1FBRWJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDaENBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLFlBQVlBLENBQUNBO1FBQzdCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxTQUFTQSxHQUFHQSxNQUFNQSxDQUFDQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNqRUEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDM0JBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBO1FBQzVCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxRQUFRQSxJQUFJQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNyQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7UUFDN0JBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLFNBQVNBLElBQUlBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQ2pDQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxZQUFZQSxDQUFDQTtRQUM3QkEsQ0FBQ0E7UUFHREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsS0FBS0EsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDekNBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBO1lBQzNCQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQTtRQUM1QkEsQ0FBQ0E7UUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFFTkEsQ0FBQ0E7UUFFREEsSUFBSUEsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDdkZBLElBQUlBLGFBQWFBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLElBQUlBLE1BQU1BLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLEVBQUVBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBO1FBRXhHQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxTQUFTQSxDQUFDQTtRQUM3QkEsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFFNUJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLGFBQWFBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLENBQUNBO1lBQ3JDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNqQkEsQ0FBQ0E7UUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDSkEsSUFBSUEsQ0FBQ0EsS0FBS0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDbEJBLENBQUNBO1FBSURBLElBQUlBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO1FBQ3RDQSxFQUFFQSxDQUFDQSxDQUFDQSxRQUFRQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUduQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDL0JBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLGdCQUFnQkEsQ0FBQ0E7WUFDakNBLENBQUNBO1lBQ0RBLElBQUlBLENBQUNBLENBQUNBO2dCQUNKQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxLQUFLQSxDQUFDQSxpQkFBaUJBLENBQUNBO29CQUNwQyxJQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztvQkFDckMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO2dCQUNqQixDQUFDLEVBQUVBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO2dCQUN4QkEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7WUFDNUJBLENBQUNBO1FBQ0hBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLFlBQVlBLENBQUNBO0lBQzdCQSxDQUFDQTtJQUVESCxtQ0FBV0EsR0FBWEE7UUFDRUksSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0EsaUJBQWlCQSxDQUFDQTtZQUNwQyxJQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUM7UUFDbkMsQ0FBQyxFQUFFQSxJQUFJQSxDQUFDQSxRQUFRQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUN4QkEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7SUFDN0JBLENBQUNBO0lBRURKLDZCQUFLQSxHQUFMQTtRQUNFSyxZQUFZQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtJQUM1QkEsQ0FBQ0E7SUFFREwsNEJBQUlBLEdBQUpBO1FBQ0VNLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEtBQUtBLE1BQU1BLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDM0NBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ2pEQSxDQUFDQTtJQUNIQSxDQUFDQTtJQUNITixvQkFBQ0E7QUFBREEsQ0FBQ0EsQUFwR0QsRUFBbUMsTUFBTSxDQUFDLFVBQVUsRUFvR25EO0FBcEdZLHFCQUFhLGdCQW9HekIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBoYW1tZXIgPSByZXF1aXJlKCcuLi9oYW1tZXInKTtcbmltcG9ydCB1dGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzJyk7XG5cbmZ1bmN0aW9uIGlzQ29ycmVjdFRvdWNoQ291bnQoaW5wdXQ6IGhhbW1lci5JQ29tcHV0ZWRFdmVudCk6IGJvb2xlYW4ge1xuICBzd2l0Y2goaW5wdXQuZXZlbnRUeXBlKSB7XG4gICAgY2FzZSBoYW1tZXIuSU5QVVRfU1RBUlQ6IHtcbiAgICAgIHJldHVybiBpbnB1dC50b3VjaGVzTGVuZ3RoID09PSAxO1xuICAgIH1cbiAgICBicmVhaztcbiAgICBjYXNlIGhhbW1lci5JTlBVVF9NT1ZFOiB7XG4gICAgICByZXR1cm4gaW5wdXQudG91Y2hlc0xlbmd0aCA9PT0gMTtcbiAgICB9XG4gICAgYnJlYWs7XG4gICAgY2FzZSBoYW1tZXIuSU5QVVRfRU5EOiB7XG4gICAgICByZXR1cm4gaW5wdXQudG91Y2hlc0xlbmd0aCA9PT0gMDtcbiAgICB9XG4gICAgYnJlYWs7XG4gICAgY2FzZSBoYW1tZXIuSU5QVVRfQ0FOQ0VMOiB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgYnJlYWs7XG4gICAgZGVmYXVsdCA6IHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihoYW1tZXIuZGVjb2RlRXZlbnRUeXBlKGlucHV0LmV2ZW50VHlwZSkpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgVGFwUmVjb2duaXplciBleHRlbmRzIGhhbW1lci5SZWNvZ25pemVyIHtcbiAgLy8gcHJldmlvdXMgdGltZSBhbmQgY2VudGVyLFxuICAvLyB1c2VkIGZvciB0YXAgY291bnRpbmdcbiAgcHJpdmF0ZSBwVGltZTogbnVtYmVyO1xuICBwcml2YXRlIHBDZW50ZXI6IGhhbW1lci5DbGllbnRMb2NhdGlvbjtcbiAgcHJpdmF0ZSBfdGltZXI7XG4vL3ByaXZhdGUgX2lucHV0OiBoYW1tZXIuSUNvbXB1dGVkRXZlbnQ7XG4gIHByaXZhdGUgY291bnQgPSAwO1xuICBwcml2YXRlIHRhcHMgPSAxO1xuICBwcml2YXRlIHBvaW50ZXJzID0gMTtcbiAgcHJpdmF0ZSB0aW1lID0gMjUwOyAvLyBtYXggdGltZSBvZiB0aGUgcG9pbnRlciB0byBiZSBkb3duIChsaWtlIGZpbmdlciBvbiB0aGUgc2NyZWVuKVxuICBwcml2YXRlIHRocmVzaG9sZCA9IDY7IC8vIGEgbWluaW1hbCBtb3ZlbWVudCBpcyBvaywgYnV0IGtlZXAgaXQgbG93XG4gIHByaXZhdGUgaW50ZXJ2YWwgPSAzMDA7IC8vIG1heCB0aW1lIGJldHdlZW4gdGhlIG11bHRpLXRhcCB0YXBzXG4gIHByaXZhdGUgcG9zVGhyZXNob2xkID0gMTA7IC8vIGEgbXVsdGktdGFwIGNhbiBiZSBhIGJpdCBvZmYgdGhlIGluaXRpYWwgcG9zaXRpb25cbiAgcHJpdmF0ZSBjZW50ZXI6IGhhbW1lci5DbGllbnRMb2NhdGlvbjtcbiAgY29uc3RydWN0b3IoZXZlbnROYW1lOiBzdHJpbmcsIGVuYWJsZWQ6IGJvb2xlYW4pIHtcbiAgICBzdXBlcihldmVudE5hbWUgPyBldmVudE5hbWUgOiAndGFwJywgZW5hYmxlZCk7XG4gIH1cbiAgZ2V0VG91Y2hBY3Rpb24oKTogc3RyaW5nW10ge1xuICAgIHJldHVybiBbaGFtbWVyLlRPVUNIX0FDVElPTl9NQU5JUFVMQVRJT05dO1xuICB9XG4gIHByb2Nlc3MoaW5wdXQ6IGhhbW1lci5JQ29tcHV0ZWRFdmVudCk6IG51bWJlciB7XG5cbiAgICB0aGlzLnJlc2V0KCk7XG5cbiAgICBpZiAoIWlzQ29ycmVjdFRvdWNoQ291bnQoaW5wdXQpKSB7XG4gICAgICByZXR1cm4gaGFtbWVyLlNUQVRFX0ZBSUxFRDtcbiAgICB9XG5cbiAgICBpZiAoKGlucHV0LmV2ZW50VHlwZSAmIGhhbW1lci5JTlBVVF9TVEFSVCkgJiYgKHRoaXMuY291bnQgPT09IDApKSB7XG4gICAgICB0aGlzLmNlbnRlciA9IGlucHV0LmNlbnRlcjtcbiAgICAgIHJldHVybiB0aGlzLmZhaWxUaW1lb3V0KCk7XG4gICAgfVxuXG4gICAgaWYgKGlucHV0LmRpc3RhbmNlID49IHRoaXMudGhyZXNob2xkKSB7XG4gICAgICByZXR1cm4gaGFtbWVyLlNUQVRFX0ZBSUxFRDtcbiAgICB9XG5cbiAgICBpZiAoaW5wdXQuZGVsdGFUaW1lID49IHRoaXMudGltZSkge1xuICAgICAgcmV0dXJuIGhhbW1lci5TVEFURV9GQUlMRUQ7XG4gICAgfVxuXG4gICAgLy8gYW5kIHdlJ3ZlIHJlYWNoZWQgYW4gZW5kIGV2ZW50LCBzbyBhIHRhcCBpcyBwb3NzaWJsZVxuICAgIGlmIChpbnB1dC5ldmVudFR5cGUgIT09IGhhbW1lci5JTlBVVF9FTkQpIHtcbiAgICAgIHRoaXMuY2VudGVyID0gaW5wdXQuY2VudGVyO1xuICAgICAgcmV0dXJuIHRoaXMuZmFpbFRpbWVvdXQoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAvLyBXZSBhcmUgaW4gdGhlIGVuZCBzdGF0ZSBzbyB0aGVyZSB3aWxsIGJlIG5vIHRvdWNoZXMuXG4gICAgfVxuXG4gICAgdmFyIHZhbGlkSW50ZXJ2YWwgPSB0aGlzLnBUaW1lID8gKGlucHV0LnRpbWVTdGFtcCAtIHRoaXMucFRpbWUgPCB0aGlzLmludGVydmFsKSA6IHRydWU7XG4gICAgdmFyIHZhbGlkTXVsdGlUYXAgPSAhdGhpcy5wQ2VudGVyIHx8IGhhbW1lci5nZXREaXN0YW5jZSh0aGlzLnBDZW50ZXIsIGlucHV0LmNlbnRlcikgPCB0aGlzLnBvc1RocmVzaG9sZDtcblxuICAgIHRoaXMucFRpbWUgPSBpbnB1dC50aW1lU3RhbXA7XG4gICAgdGhpcy5wQ2VudGVyID0gaW5wdXQuY2VudGVyO1xuXG4gICAgaWYgKCF2YWxpZE11bHRpVGFwIHx8ICF2YWxpZEludGVydmFsKSB7XG4gICAgICB0aGlzLmNvdW50ID0gMTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmNvdW50ICs9IDE7XG4gICAgfVxuXG4gICAgLy8gaWYgdGFwIGNvdW50IG1hdGNoZXMgd2UgaGF2ZSByZWNvZ25pemVkIGl0LFxuICAgIC8vIGVsc2UgaXQgaGFzIGJlZ2FuIHJlY29nbml6aW5nLi4uXG4gICAgdmFyIHRhcENvdW50ID0gdGhpcy5jb3VudCAlIHRoaXMudGFwcztcbiAgICBpZiAodGFwQ291bnQgPT09IDApIHtcbiAgICAgIC8vIG5vIGZhaWxpbmcgcmVxdWlyZW1lbnRzLCBpbW1lZGlhdGVseSB0cmlnZ2VyIHRoZSB0YXAgZXZlbnRcbiAgICAgIC8vIG9yIHdhaXQgYXMgbG9uZyBhcyB0aGUgbXVsdGl0YXAgaW50ZXJ2YWwgdG8gdHJpZ2dlclxuICAgICAgaWYgKCF0aGlzLmhhc1JlcXVpcmVGYWlsdXJlcygpKSB7XG4gICAgICAgIHJldHVybiBoYW1tZXIuU1RBVEVfUkVDT0dOSVpFRDtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLl90aW1lciA9IHV0aWxzLnNldFRpbWVvdXRDb250ZXh0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHRoaXMuc3RhdGUgPSBoYW1tZXIuU1RBVEVfUkVDT0dOSVpFRDtcbiAgICAgICAgICB0aGlzLnRyeUVtaXQoKTtcbiAgICAgICAgfSwgdGhpcy5pbnRlcnZhbCwgdGhpcyk7XG4gICAgICAgIHJldHVybiBoYW1tZXIuU1RBVEVfQkVHQU47XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBoYW1tZXIuU1RBVEVfRkFJTEVEO1xuICB9XG5cbiAgZmFpbFRpbWVvdXQoKSB7XG4gICAgdGhpcy5fdGltZXIgPSB1dGlscy5zZXRUaW1lb3V0Q29udGV4dChmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc3RhdGUgPSBoYW1tZXIuU1RBVEVfRkFJTEVEO1xuICAgIH0sIHRoaXMuaW50ZXJ2YWwsIHRoaXMpO1xuICAgIHJldHVybiBoYW1tZXIuU1RBVEVfRkFJTEVEO1xuICB9XG5cbiAgcmVzZXQoKSB7XG4gICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVyKTtcbiAgfVxuXG4gIGVtaXQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuc3RhdGUgPT09IGhhbW1lci5TVEFURV9SRUNPR05JWkVEKSB7XG4gICAgICB0aGlzLm1hbmFnZXIuZW1pdCh0aGlzLmV2ZW50TmFtZSwgdGhpcy5jZW50ZXIpO1xuICAgIH1cbiAgfVxufVxuIl19