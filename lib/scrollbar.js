var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var dom = require("./lib/dom");
var event = require("./lib/event");
var eem = require("./lib/event_emitter");
var ScrollBar = (function (_super) {
    __extends(ScrollBar, _super);
    function ScrollBar(parent, classSuffix) {
        _super.call(this);
        this.element = dom.createElement("div");
        this.element.className = "ace_scrollbar ace_scrollbar" + classSuffix;
        this.inner = dom.createElement("div");
        this.inner.className = "ace_scrollbar-inner";
        this.element.appendChild(this.inner);
        parent.appendChild(this.element);
        this.setVisible(false);
        this.skipEvent = false;
        event.addListener(this.element, "mousedown", event.preventDefault);
    }
    ScrollBar.prototype.setVisible = function (isVisible) {
        this.element.style.display = isVisible ? "" : "none";
        this.isVisible = isVisible;
    };
    return ScrollBar;
})(eem.EventEmitterClass);
exports.ScrollBar = ScrollBar;
var VScrollBar = (function (_super) {
    __extends(VScrollBar, _super);
    function VScrollBar(parent, renderer) {
        _super.call(this, parent, '-v');
        this._scrollTop = 0;
        renderer.$scrollbarWidth =
            this._width = dom.scrollbarWidth(parent.ownerDocument);
        this.inner.style.width =
            this.element.style.width = (this._width || 15) + 5 + "px";
        event.addListener(this.element, "scroll", this.onScroll.bind(this));
    }
    VScrollBar.prototype.onScroll = function () {
        if (!this.skipEvent) {
            this._scrollTop = this.element.scrollTop;
            this._emit("scroll", { data: this._scrollTop });
        }
        this.skipEvent = false;
    };
    Object.defineProperty(VScrollBar.prototype, "width", {
        get: function () {
            return this.isVisible ? this._width : 0;
        },
        enumerable: true,
        configurable: true
    });
    VScrollBar.prototype.setHeight = function (height) {
        this.element.style.height = height + "px";
    };
    VScrollBar.prototype.setInnerHeight = function (height) {
        this.inner.style.height = height + "px";
    };
    VScrollBar.prototype.setScrollHeight = function (height) {
        this.inner.style.height = height + "px";
    };
    VScrollBar.prototype.setScrollTop = function (scrollTop) {
        if (this._scrollTop != scrollTop) {
            this.skipEvent = true;
            this._scrollTop = this.element.scrollTop = scrollTop;
        }
    };
    Object.defineProperty(VScrollBar.prototype, "scrollTop", {
        get: function () {
            return this._scrollTop;
        },
        enumerable: true,
        configurable: true
    });
    return VScrollBar;
})(ScrollBar);
exports.VScrollBar = VScrollBar;
var HScrollBar = (function (_super) {
    __extends(HScrollBar, _super);
    function HScrollBar(parent, renderer) {
        _super.call(this, parent, '-h');
        this._scrollLeft = 0;
        this._height = renderer.$scrollbarWidth;
        this.inner.style.height =
            this.element.style.height = (this._height || 15) + 5 + "px";
        event.addListener(this.element, "scroll", this.onScroll.bind(this));
    }
    HScrollBar.prototype.onScroll = function () {
        if (!this.skipEvent) {
            this._scrollLeft = this.element.scrollLeft;
            this._emit("scroll", { data: this._scrollLeft });
        }
        this.skipEvent = false;
    };
    Object.defineProperty(HScrollBar.prototype, "height", {
        get: function () {
            return this.isVisible ? this._height : 0;
        },
        enumerable: true,
        configurable: true
    });
    HScrollBar.prototype.setWidth = function (width) {
        this.element.style.width = width + "px";
    };
    HScrollBar.prototype.setInnerWidth = function (width) {
        this.inner.style.width = width + "px";
    };
    HScrollBar.prototype.setScrollWidth = function (width) {
        this.inner.style.width = width + "px";
    };
    HScrollBar.prototype.setScrollLeft = function (scrollLeft) {
        if (this._scrollLeft != scrollLeft) {
            this.skipEvent = true;
            this._scrollLeft = this.element.scrollLeft = scrollLeft;
        }
    };
    return HScrollBar;
})(ScrollBar);
exports.HScrollBar = HScrollBar;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsYmFyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3Njcm9sbGJhci50cyJdLCJuYW1lcyI6WyJTY3JvbGxCYXIiLCJTY3JvbGxCYXIuY29uc3RydWN0b3IiLCJTY3JvbGxCYXIuc2V0VmlzaWJsZSIsIlZTY3JvbGxCYXIiLCJWU2Nyb2xsQmFyLmNvbnN0cnVjdG9yIiwiVlNjcm9sbEJhci5vblNjcm9sbCIsIlZTY3JvbGxCYXIud2lkdGgiLCJWU2Nyb2xsQmFyLnNldEhlaWdodCIsIlZTY3JvbGxCYXIuc2V0SW5uZXJIZWlnaHQiLCJWU2Nyb2xsQmFyLnNldFNjcm9sbEhlaWdodCIsIlZTY3JvbGxCYXIuc2V0U2Nyb2xsVG9wIiwiVlNjcm9sbEJhci5zY3JvbGxUb3AiLCJIU2Nyb2xsQmFyIiwiSFNjcm9sbEJhci5jb25zdHJ1Y3RvciIsIkhTY3JvbGxCYXIub25TY3JvbGwiLCJIU2Nyb2xsQmFyLmhlaWdodCIsIkhTY3JvbGxCYXIuc2V0V2lkdGgiLCJIU2Nyb2xsQmFyLnNldElubmVyV2lkdGgiLCJIU2Nyb2xsQmFyLnNldFNjcm9sbFdpZHRoIiwiSFNjcm9sbEJhci5zZXRTY3JvbGxMZWZ0Il0sIm1hcHBpbmdzIjoiOzs7OztBQStCQSxJQUFPLEdBQUcsV0FBVyxXQUFXLENBQUMsQ0FBQztBQUNsQyxJQUFPLEtBQUssV0FBVyxhQUFhLENBQUMsQ0FBQztBQUN0QyxJQUFPLEdBQUcsV0FBVyxxQkFBcUIsQ0FBQyxDQUFDO0FBYTVDO0lBQStCQSw2QkFBcUJBO0lBS2hEQSxtQkFBWUEsTUFBTUEsRUFBRUEsV0FBbUJBO1FBQ25DQyxpQkFBT0EsQ0FBQ0E7UUFDUkEsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBbUJBLEdBQUdBLENBQUNBLGFBQWFBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBQ3hEQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxTQUFTQSxHQUFHQSw2QkFBNkJBLEdBQUdBLFdBQVdBLENBQUNBO1FBRXJFQSxJQUFJ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QUlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEdBQUdBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO0lBQzFDQSxDQUFDQTtJQU1ETCxtQ0FBY0EsR0FBZEEsVUFBZUEsS0FBYUE7UUFDeEJNLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEdBQUdBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO0lBQzFDQSxDQUFDQTtJQVFETixrQ0FBYUEsR0FBYkEsVUFBY0EsVUFBa0JBO1FBQzVCTyxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxJQUFJQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNqQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDdEJBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFVBQVVBLEdBQUdBLFVBQVVBLENBQUNBO1FBQzVEQSxDQUFDQTtJQUNMQSxDQUFDQTtJQUNMUCxpQkFBQ0E7QUFBREEsQ0FBQ0EsQUE3RUQsRUFBZ0MsU0FBUyxFQTZFeEM7QUE3RVksa0JBQVUsYUE2RXRCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiAqKioqKiBCRUdJTiBMSUNFTlNFIEJMT0NLICoqKioqXG4gKiBEaXN0cmlidXRlZCB1bmRlciB0aGUgQlNEIGxpY2Vuc2U6XG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEwLCBBamF4Lm9yZyBCLlYuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogXG4gKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXRcbiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuICogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlXG4gKiAgICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICogICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBBamF4Lm9yZyBCLlYuIG5vciB0aGVcbiAqICAgICAgIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzXG4gKiAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cbiAqIFxuICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyBcIkFTIElTXCIgQU5EXG4gKiBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRFxuICogV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRVxuICogRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgQUpBWC5PUkcgQi5WLiBCRSBMSUFCTEUgRk9SIEFOWVxuICogRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVNcbiAqIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUztcbiAqIExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORFxuICogT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbiAqIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTXG4gKiBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cbiAqXG4gKiAqKioqKiBFTkQgTElDRU5TRSBCTE9DSyAqKioqKiAqL1xuXG5pbXBvcnQgb29wID0gcmVxdWlyZShcIi4vbGliL29vcFwiKTtcbmltcG9ydCBkb20gPSByZXF1aXJlKFwiLi9saWIvZG9tXCIpO1xuaW1wb3J0IGV2ZW50ID0gcmVxdWlyZShcIi4vbGliL2V2ZW50XCIpO1xuaW1wb3J0IGVlbSA9IHJlcXVpcmUoXCIuL2xpYi9ldmVudF9lbWl0dGVyXCIpO1xuXG4vKipcbiAqIEFuIGFic3RyYWN0IGNsYXNzIHJlcHJlc2VudGluZyBhIG5hdGl2ZSBzY3JvbGxiYXIgY29udHJvbC5cbiAqIEBjbGFzcyBTY3JvbGxCYXJcbiAqKi9cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGBTY3JvbGxCYXJgLiBgcGFyZW50YCBpcyB0aGUgb3duZXIgb2YgdGhlIHNjcm9sbCBiYXIuXG4gKiBAcGFyYW0ge0RPTUVsZW1lbnR9IHBhcmVudCBBIERPTSBlbGVtZW50IFxuICpcbiAqIEBjb25zdHJ1Y3RvclxuICoqL1xuZXhwb3J0IGNsYXNzIFNjcm9sbEJhciBleHRlbmRzIGVlbS5FdmVudEVtaXR0ZXJDbGFzcyB7XG4gICAgcHVibGljIGVsZW1lbnQ6IEhUTUxEaXZFbGVtZW50O1xuICAgIHB1YmxpYyBpbm5lcjogSFRNTERpdkVsZW1lbnQ7XG4gICAgcHVibGljIGlzVmlzaWJsZTogYm9vbGVhbjtcbiAgICBwdWJsaWMgc2tpcEV2ZW50O1xuICAgIGNvbnN0cnVjdG9yKHBhcmVudCwgY2xhc3NTdWZmaXg6IHN0cmluZykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSA8SFRNTERpdkVsZW1lbnQ+ZG9tLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRoaXMuZWxlbWVudC5jbGFzc05hbWUgPSBcImFjZV9zY3JvbGxiYXIgYWNlX3Njcm9sbGJhclwiICsgY2xhc3NTdWZmaXg7XG4gICAgXG4gICAgICAgIHRoaXMuaW5uZXIgPSA8SFRNTERpdkVsZW1lbnQ+ZG9tLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRoaXMuaW5uZXIuY2xhc3NOYW1lID0gXCJhY2Vfc2Nyb2xsYmFyLWlubmVyXCI7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmlubmVyKTtcbiAgICBcbiAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudCk7XG4gICAgXG4gICAgICAgIHRoaXMuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIHRoaXMuc2tpcEV2ZW50ID0gZmFsc2U7XG4gICAgXG4gICAgICAgIGV2ZW50LmFkZExpc3RlbmVyKHRoaXMuZWxlbWVudCwgXCJtb3VzZWRvd25cIiwgZXZlbnQucHJldmVudERlZmF1bHQpO1xuICAgIH1cbiAgICBzZXRWaXNpYmxlKGlzVmlzaWJsZSkge1xuICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IGlzVmlzaWJsZSA/IFwiXCIgOiBcIm5vbmVcIjtcbiAgICAgICAgdGhpcy5pc1Zpc2libGUgPSBpc1Zpc2libGU7XG4gICAgfVxufSBcblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgdmVydGljYWwgc2Nyb2xsIGJhci5cbiAqIEBjbGFzcyBWU2Nyb2xsQmFyXG4gKiovXG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBgVlNjcm9sbEJhcmAuIGBwYXJlbnRgIGlzIHRoZSBvd25lciBvZiB0aGUgc2Nyb2xsIGJhci5cbiAqIEBwYXJhbSB7RE9NRWxlbWVudH0gcGFyZW50IEEgRE9NIGVsZW1lbnRcbiAqIEBwYXJhbSB7T2JqZWN0fSByZW5kZXJlciBBbiBlZGl0b3IgcmVuZGVyZXJcbiAqXG4gKiBAY29uc3RydWN0b3JcbiAqKi9cbmV4cG9ydCBjbGFzcyBWU2Nyb2xsQmFyIGV4dGVuZHMgU2Nyb2xsQmFyIHtcbiAgICBcbiAgICBwcml2YXRlIF9zY3JvbGxUb3AgPSAwO1xuICAgIHByaXZhdGUgX3dpZHRoOiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQsIHJlbmRlcmVyKSB7XG4gICAgICAgIHN1cGVyKHBhcmVudCwgJy12Jyk7XG4gICAgICAgIC8vIGluIE9TWCBsaW9uIHRoZSBzY3JvbGxiYXJzIGFwcGVhciB0byBoYXZlIG5vIHdpZHRoLiBJbiB0aGlzIGNhc2UgcmVzaXplIHRoZVxuICAgICAgICAvLyBlbGVtZW50IHRvIHNob3cgdGhlIHNjcm9sbGJhciBidXQgc3RpbGwgcHJldGVuZCB0aGF0IHRoZSBzY3JvbGxiYXIgaGFzIGEgd2lkdGhcbiAgICAgICAgLy8gb2YgMHB4XG4gICAgICAgIC8vIGluIEZpcmVmb3ggNisgc2Nyb2xsYmFyIGlzIGhpZGRlbiBpZiBlbGVtZW50IGhhcyB0aGUgc2FtZSB3aWR0aCBhcyBzY3JvbGxiYXJcbiAgICAgICAgLy8gbWFrZSBlbGVtZW50IGEgbGl0dGxlIGJpdCB3aWRlciB0byByZXRhaW4gc2Nyb2xsYmFyIHdoZW4gcGFnZSBpcyB6b29tZWQgXG4gICAgICAgIHJlbmRlcmVyLiRzY3JvbGxiYXJXaWR0aCA9IFxuICAgICAgICB0aGlzLl93aWR0aCA9IGRvbS5zY3JvbGxiYXJXaWR0aChwYXJlbnQub3duZXJEb2N1bWVudCk7XG4gICAgICAgIHRoaXMuaW5uZXIuc3R5bGUud2lkdGggPVxuICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSAodGhpcy5fd2lkdGggfHwgMTUpICsgNSArIFwicHhcIjtcbiAgICAgICAgZXZlbnQuYWRkTGlzdGVuZXIodGhpcy5lbGVtZW50LCBcInNjcm9sbFwiLCB0aGlzLm9uU2Nyb2xsLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVtaXR0ZWQgd2hlbiB0aGUgc2Nyb2xsIGJhciwgd2VsbCwgc2Nyb2xscy5cbiAgICAgKiBAZXZlbnQgc2Nyb2xsXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGUgQ29udGFpbnMgb25lIHByb3BlcnR5LCBgXCJkYXRhXCJgLCB3aGljaCBpbmRpY2F0ZXMgdGhlIGN1cnJlbnQgc2Nyb2xsIHRvcCBwb3NpdGlvblxuICAgICAqKi9cbiAgICBvblNjcm9sbCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnNraXBFdmVudCkge1xuICAgICAgICAgICAgdGhpcy5fc2Nyb2xsVG9wID0gdGhpcy5lbGVtZW50LnNjcm9sbFRvcDtcbiAgICAgICAgICAgIHRoaXMuX2VtaXQoXCJzY3JvbGxcIiwge2RhdGE6IHRoaXMuX3Njcm9sbFRvcH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2tpcEV2ZW50ID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgd2lkdGggb2YgdGhlIHNjcm9sbCBiYXIuXG4gICAgICogQHJldHVybnMge051bWJlcn1cbiAgICAgKiovXG4gICAgZ2V0IHdpZHRoKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzVmlzaWJsZSA/IHRoaXMuX3dpZHRoIDogMDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgb2YgdGhlIHNjcm9sbCBiYXIsIGluIHBpeGVscy5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gaGVpZ2h0IFRoZSBuZXcgaGVpZ2h0XG4gICAgICoqL1xuICAgIHNldEhlaWdodChoZWlnaHQ6IG51bWJlcikge1xuICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgXCJweFwiO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGlubmVyIGhlaWdodCBvZiB0aGUgc2Nyb2xsIGJhciwgaW4gcGl4ZWxzLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBoZWlnaHQgVGhlIG5ldyBpbm5lciBoZWlnaHRcbiAgICAgKiBAZGVwcmVjYXRlZCBVc2Ugc2V0U2Nyb2xsSGVpZ2h0IGluc3RlYWRcbiAgICAgKiovXG4gICAgc2V0SW5uZXJIZWlnaHQoaGVpZ2h0OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5pbm5lci5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyBcInB4XCI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgc2Nyb2xsIGhlaWdodCBvZiB0aGUgc2Nyb2xsIGJhciwgaW4gcGl4ZWxzLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBoZWlnaHQgVGhlIG5ldyBzY3JvbGwgaGVpZ2h0XG4gICAgICoqL1xuICAgIHNldFNjcm9sbEhlaWdodChoZWlnaHQ6IG51bWJlcikge1xuICAgICAgICB0aGlzLmlubmVyLnN0eWxlLmhlaWdodCA9IGhlaWdodCArIFwicHhcIjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBzY3JvbGwgdG9wIG9mIHRoZSBzY3JvbGwgYmFyLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBzY3JvbGxUb3AgVGhlIG5ldyBzY3JvbGwgdG9wXG4gICAgICoqL1xuICAgIC8vIG9uIGNocm9tZSAxNysgZm9yIHNtYWxsIHpvb20gbGV2ZWxzIGFmdGVyIGNhbGxpbmcgdGhpcyBmdW5jdGlvblxuICAgIC8vIHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgIT0gc2Nyb2xsVG9wIHdoaWNoIG1ha2VzIHBhZ2UgdG8gc2Nyb2xsIHVwLlxuICAgIHNldFNjcm9sbFRvcChzY3JvbGxUb3A6IG51bWJlcikge1xuICAgICAgICBpZiAodGhpcy5fc2Nyb2xsVG9wICE9IHNjcm9sbFRvcCkge1xuICAgICAgICAgICAgdGhpcy5za2lwRXZlbnQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fc2Nyb2xsVG9wID0gdGhpcy5lbGVtZW50LnNjcm9sbFRvcCA9IHNjcm9sbFRvcDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBnZXQgc2Nyb2xsVG9wKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zY3JvbGxUb3A7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlcHJlc2VudHMgYSBob3Jpc29udGFsIHNjcm9sbCBiYXIuXG4gKiBAY2xhc3MgSFNjcm9sbEJhclxuICoqL1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgYEhTY3JvbGxCYXJgLiBgcGFyZW50YCBpcyB0aGUgb3duZXIgb2YgdGhlIHNjcm9sbCBiYXIuXG4gKiBAcGFyYW0ge0RPTUVsZW1lbnR9IHBhcmVudCBBIERPTSBlbGVtZW50XG4gKiBAcGFyYW0ge09iamVjdH0gcmVuZGVyZXIgQW4gZWRpdG9yIHJlbmRlcmVyXG4gKlxuICogQGNvbnN0cnVjdG9yXG4gKiovXG5leHBvcnQgY2xhc3MgSFNjcm9sbEJhciBleHRlbmRzIFNjcm9sbEJhciB7XG4gICAgXG4gICAgcHJpdmF0ZSBfc2Nyb2xsTGVmdCA9IDA7XG4gICAgcHJpdmF0ZSBfaGVpZ2h0OiBudW1iZXI7XG4gICAgXG4gICAgY29uc3RydWN0b3IocGFyZW50LCByZW5kZXJlcikge1xuICAgICAgICBzdXBlcihwYXJlbnQsICctaCcpO1xuXG4gICAgICAgIC8vIGluIE9TWCBsaW9uIHRoZSBzY3JvbGxiYXJzIGFwcGVhciB0byBoYXZlIG5vIHdpZHRoLiBJbiB0aGlzIGNhc2UgcmVzaXplIHRoZVxuICAgICAgICAvLyBlbGVtZW50IHRvIHNob3cgdGhlIHNjcm9sbGJhciBidXQgc3RpbGwgcHJldGVuZCB0aGF0IHRoZSBzY3JvbGxiYXIgaGFzIGEgd2lkdGhcbiAgICAgICAgLy8gb2YgMHB4XG4gICAgICAgIC8vIGluIEZpcmVmb3ggNisgc2Nyb2xsYmFyIGlzIGhpZGRlbiBpZiBlbGVtZW50IGhhcyB0aGUgc2FtZSB3aWR0aCBhcyBzY3JvbGxiYXJcbiAgICAgICAgLy8gbWFrZSBlbGVtZW50IGEgbGl0dGxlIGJpdCB3aWRlciB0byByZXRhaW4gc2Nyb2xsYmFyIHdoZW4gcGFnZSBpcyB6b29tZWQgXG4gICAgICAgIHRoaXMuX2hlaWdodCA9IHJlbmRlcmVyLiRzY3JvbGxiYXJXaWR0aDtcbiAgICAgICAgdGhpcy5pbm5lci5zdHlsZS5oZWlnaHQgPVxuICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gKHRoaXMuX2hlaWdodCB8fCAxNSkgKyA1ICsgXCJweFwiO1xuICAgICAgICBldmVudC5hZGRMaXN0ZW5lcih0aGlzLmVsZW1lbnQsIFwic2Nyb2xsXCIsIHRoaXMub25TY3JvbGwuYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW1pdHRlZCB3aGVuIHRoZSBzY3JvbGwgYmFyLCB3ZWxsLCBzY3JvbGxzLlxuICAgICAqIEBldmVudCBzY3JvbGxcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZSBDb250YWlucyBvbmUgcHJvcGVydHksIGBcImRhdGFcImAsIHdoaWNoIGluZGljYXRlcyB0aGUgY3VycmVudCBzY3JvbGwgbGVmdCBwb3NpdGlvblxuICAgICAqKi9cbiAgICBvblNjcm9sbCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnNraXBFdmVudCkge1xuICAgICAgICAgICAgdGhpcy5fc2Nyb2xsTGVmdCA9IHRoaXMuZWxlbWVudC5zY3JvbGxMZWZ0O1xuICAgICAgICAgICAgdGhpcy5fZW1pdChcInNjcm9sbFwiLCB7ZGF0YTogdGhpcy5fc2Nyb2xsTGVmdH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2tpcEV2ZW50ID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgaGVpZ2h0IG9mIHRoZSBzY3JvbGwgYmFyLlxuICAgICAqIEByZXR1cm5zIHtOdW1iZXJ9XG4gICAgICoqL1xuICAgIGdldCBoZWlnaHQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNWaXNpYmxlID8gdGhpcy5faGVpZ2h0IDogMDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSB3aWR0aCBvZiB0aGUgc2Nyb2xsIGJhciwgaW4gcGl4ZWxzLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB3aWR0aCBUaGUgbmV3IHdpZHRoXG4gICAgICoqL1xuICAgIHNldFdpZHRoKHdpZHRoOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLndpZHRoID0gd2lkdGggKyBcInB4XCI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgaW5uZXIgd2lkdGggb2YgdGhlIHNjcm9sbCBiYXIsIGluIHBpeGVscy5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gd2lkdGggVGhlIG5ldyBpbm5lciB3aWR0aFxuICAgICAqIEBkZXByZWNhdGVkIFVzZSBzZXRTY3JvbGxXaWR0aCBpbnN0ZWFkXG4gICAgICoqL1xuICAgIHNldElubmVyV2lkdGgod2lkdGg6IG51bWJlcikge1xuICAgICAgICB0aGlzLmlubmVyLnN0eWxlLndpZHRoID0gd2lkdGggKyBcInB4XCI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgc2Nyb2xsIHdpZHRoIG9mIHRoZSBzY3JvbGwgYmFyLCBpbiBwaXhlbHMuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHdpZHRoIFRoZSBuZXcgc2Nyb2xsIHdpZHRoXG4gICAgICoqL1xuICAgIHNldFNjcm9sbFdpZHRoKHdpZHRoOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5pbm5lci5zdHlsZS53aWR0aCA9IHdpZHRoICsgXCJweFwiO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHNjcm9sbCBsZWZ0IG9mIHRoZSBzY3JvbGwgYmFyLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBzY3JvbGxUb3AgVGhlIG5ldyBzY3JvbGwgbGVmdFxuICAgICAqKi9cbiAgICAvLyBvbiBjaHJvbWUgMTcrIGZvciBzbWFsbCB6b29tIGxldmVscyBhZnRlciBjYWxsaW5nIHRoaXMgZnVuY3Rpb25cbiAgICAvLyB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wICE9IHNjcm9sbFRvcCB3aGljaCBtYWtlcyBwYWdlIHRvIHNjcm9sbCB1cC5cbiAgICBzZXRTY3JvbGxMZWZ0KHNjcm9sbExlZnQ6IG51bWJlcikge1xuICAgICAgICBpZiAodGhpcy5fc2Nyb2xsTGVmdCAhPSBzY3JvbGxMZWZ0KSB7XG4gICAgICAgICAgICB0aGlzLnNraXBFdmVudCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLl9zY3JvbGxMZWZ0ID0gdGhpcy5lbGVtZW50LnNjcm9sbExlZnQgPSBzY3JvbGxMZWZ0O1xuICAgICAgICB9XG4gICAgfVxufVxuIl19