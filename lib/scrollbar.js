import { createElement, scrollbarWidth } from "./lib/dom";
import { addListener } from "./lib/event";
import EventEmitterClass from "./lib/event_emitter";
export class ScrollBar extends EventEmitterClass {
    constructor(parent, classSuffix) {
        super();
        this.element = createElement("div");
        this.element.className = "ace_scrollbar ace_scrollbar" + classSuffix;
        this.inner = createElement("div");
        this.inner.className = "ace_scrollbar-inner";
        this.element.appendChild(this.inner);
        parent.appendChild(this.element);
        this.setVisible(false);
        this.skipEvent = false;
        addListener(this.element, "mousedown", event.preventDefault);
    }
    setVisible(isVisible) {
        this.element.style.display = isVisible ? "" : "none";
        this.isVisible = isVisible;
    }
}
export class VScrollBar extends ScrollBar {
    constructor(parent, renderer) {
        super(parent, '-v');
        this._scrollTop = 0;
        renderer.$scrollbarWidth =
            this._width = scrollbarWidth(parent.ownerDocument);
        this.inner.style.width =
            this.element.style.width = (this._width || 15) + 5 + "px";
        addListener(this.element, "scroll", this.onScroll.bind(this));
    }
    onScroll() {
        if (!this.skipEvent) {
            this._scrollTop = this.element.scrollTop;
            this._emit("scroll", { data: this._scrollTop });
        }
        this.skipEvent = false;
    }
    get width() {
        return this.isVisible ? this._width : 0;
    }
    setHeight(height) {
        this.element.style.height = height + "px";
    }
    setInnerHeight(height) {
        this.inner.style.height = height + "px";
    }
    setScrollHeight(height) {
        this.inner.style.height = height + "px";
    }
    setScrollTop(scrollTop) {
        if (this._scrollTop != scrollTop) {
            this.skipEvent = true;
            this._scrollTop = this.element.scrollTop = scrollTop;
        }
    }
    get scrollTop() {
        return this._scrollTop;
    }
}
export class HScrollBar extends ScrollBar {
    constructor(parent, renderer) {
        super(parent, '-h');
        this._scrollLeft = 0;
        this._height = renderer.$scrollbarWidth;
        this.inner.style.height =
            this.element.style.height = (this._height || 15) + 5 + "px";
        addListener(this.element, "scroll", this.onScroll.bind(this));
    }
    onScroll() {
        if (!this.skipEvent) {
            this._scrollLeft = this.element.scrollLeft;
            this._emit("scroll", { data: this._scrollLeft });
        }
        this.skipEvent = false;
    }
    get height() {
        return this.isVisible ? this._height : 0;
    }
    setWidth(width) {
        this.element.style.width = width + "px";
    }
    setInnerWidth(width) {
        this.inner.style.width = width + "px";
    }
    setScrollWidth(width) {
        this.inner.style.width = width + "px";
    }
    setScrollLeft(scrollLeft) {
        if (this._scrollLeft != scrollLeft) {
            this.skipEvent = true;
            this._scrollLeft = this.element.scrollLeft = scrollLeft;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsYmFyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3Njcm9sbGJhci50cyJdLCJuYW1lcyI6WyJTY3JvbGxCYXIiLCJTY3JvbGxCYXIuY29uc3RydWN0b3IiLCJTY3JvbGxCYXIuc2V0VmlzaWJsZSIsIlZTY3JvbGxCYXIiLCJWU2Nyb2xsQmFyLmNvbnN0cnVjdG9yIiwiVlNjcm9sbEJhci5vblNjcm9sbCIsIlZTY3JvbGxCYXIud2lkdGgiLCJWU2Nyb2xsQmFyLnNldEhlaWdodCIsIlZTY3JvbGxCYXIuc2V0SW5uZXJIZWlnaHQiLCJWU2Nyb2xsQmFyLnNldFNjcm9sbEhlaWdodCIsIlZTY3JvbGxCYXIuc2V0U2Nyb2xsVG9wIiwiVlNjcm9sbEJhci5zY3JvbGxUb3AiLCJIU2Nyb2xsQmFyIiwiSFNjcm9sbEJhci5jb25zdHJ1Y3RvciIsIkhTY3JvbGxCYXIub25TY3JvbGwiLCJIU2Nyb2xsQmFyLmhlaWdodCIsIkhTY3JvbGxCYXIuc2V0V2lkdGgiLCJIU2Nyb2xsQmFyLnNldElubmVyV2lkdGgiLCJIU2Nyb2xsQmFyLnNldFNjcm9sbFdpZHRoIiwiSFNjcm9sbEJhci5zZXRTY3JvbGxMZWZ0Il0sIm1hcHBpbmdzIjoiT0E2Qk8sRUFBRSxhQUFhLEVBQUUsY0FBYyxFQUFFLE1BQU0sV0FBVztPQUNsRCxFQUFFLFdBQVcsRUFBRSxNQUFNLGFBQWE7T0FDbEMsaUJBQWlCLE1BQU0scUJBQXFCO0FBYW5ELCtCQUErQixpQkFBaUI7SUFLNUNBLFlBQVlBLE1BQU1BLEVBQUVBLFdBQW1CQTtRQUNuQ0MsT0FBT0EsQ0FBQ0E7UUFDUkEsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBbUJBLGFBQWFBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBQ3BEQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxTQUFTQSxHQUFHQSw2QkFBNkJBLEdBQUdBLFdBQVdBLENBQUNBO1FBRXJFQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFtQkEsYUFBYUEsQ0FBQ0Es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SUFBSUEsQ0FBQ0EsV0FBV0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsVUFBVUEsR0FBR0EsVUFBVUEsQ0FBQ0E7UUFDNURBLENBQUNBO0lBQ0xBLENBQUNBO0FBQ0xQLENBQUNBO0FBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiAqKioqKiBCRUdJTiBMSUNFTlNFIEJMT0NLICoqKioqXG4gKiBEaXN0cmlidXRlZCB1bmRlciB0aGUgQlNEIGxpY2Vuc2U6XG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEwLCBBamF4Lm9yZyBCLlYuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogXG4gKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXRcbiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuICogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlXG4gKiAgICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICogICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBBamF4Lm9yZyBCLlYuIG5vciB0aGVcbiAqICAgICAgIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzXG4gKiAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cbiAqIFxuICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyBcIkFTIElTXCIgQU5EXG4gKiBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRFxuICogV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRVxuICogRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgQUpBWC5PUkcgQi5WLiBCRSBMSUFCTEUgRk9SIEFOWVxuICogRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVNcbiAqIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUztcbiAqIExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORFxuICogT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbiAqIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTXG4gKiBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cbiAqXG4gKiAqKioqKiBFTkQgTElDRU5TRSBCTE9DSyAqKioqKiAqL1xuaW1wb3J0IHsgY3JlYXRlRWxlbWVudCwgc2Nyb2xsYmFyV2lkdGggfSBmcm9tIFwiLi9saWIvZG9tXCI7XG5pbXBvcnQgeyBhZGRMaXN0ZW5lciB9IGZyb20gXCIuL2xpYi9ldmVudFwiO1xuaW1wb3J0IEV2ZW50RW1pdHRlckNsYXNzIGZyb20gXCIuL2xpYi9ldmVudF9lbWl0dGVyXCI7XG5cbi8qKlxuICogQW4gYWJzdHJhY3QgY2xhc3MgcmVwcmVzZW50aW5nIGEgbmF0aXZlIHNjcm9sbGJhciBjb250cm9sLlxuICogQGNsYXNzIFNjcm9sbEJhclxuICoqL1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgYFNjcm9sbEJhcmAuIGBwYXJlbnRgIGlzIHRoZSBvd25lciBvZiB0aGUgc2Nyb2xsIGJhci5cbiAqIEBwYXJhbSB7RE9NRWxlbWVudH0gcGFyZW50IEEgRE9NIGVsZW1lbnQgXG4gKlxuICogQGNvbnN0cnVjdG9yXG4gKiovXG5leHBvcnQgY2xhc3MgU2Nyb2xsQmFyIGV4dGVuZHMgRXZlbnRFbWl0dGVyQ2xhc3Mge1xuICAgIHB1YmxpYyBlbGVtZW50OiBIVE1MRGl2RWxlbWVudDtcbiAgICBwdWJsaWMgaW5uZXI6IEhUTUxEaXZFbGVtZW50O1xuICAgIHB1YmxpYyBpc1Zpc2libGU6IGJvb2xlYW47XG4gICAgcHVibGljIHNraXBFdmVudDtcbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQsIGNsYXNzU3VmZml4OiBzdHJpbmcpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gPEhUTUxEaXZFbGVtZW50PmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRoaXMuZWxlbWVudC5jbGFzc05hbWUgPSBcImFjZV9zY3JvbGxiYXIgYWNlX3Njcm9sbGJhclwiICsgY2xhc3NTdWZmaXg7XG5cbiAgICAgICAgdGhpcy5pbm5lciA9IDxIVE1MRGl2RWxlbWVudD5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICB0aGlzLmlubmVyLmNsYXNzTmFtZSA9IFwiYWNlX3Njcm9sbGJhci1pbm5lclwiO1xuICAgICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5pbm5lcik7XG5cbiAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudCk7XG5cbiAgICAgICAgdGhpcy5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgdGhpcy5za2lwRXZlbnQgPSBmYWxzZTtcblxuICAgICAgICBhZGRMaXN0ZW5lcih0aGlzLmVsZW1lbnQsIFwibW91c2Vkb3duXCIsIGV2ZW50LnByZXZlbnREZWZhdWx0KTtcbiAgICB9XG4gICAgc2V0VmlzaWJsZShpc1Zpc2libGUpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBpc1Zpc2libGUgPyBcIlwiIDogXCJub25lXCI7XG4gICAgICAgIHRoaXMuaXNWaXNpYmxlID0gaXNWaXNpYmxlO1xuICAgIH1cbn0gXG5cbi8qKlxuICogUmVwcmVzZW50cyBhIHZlcnRpY2FsIHNjcm9sbCBiYXIuXG4gKiBAY2xhc3MgVlNjcm9sbEJhclxuICoqL1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgYFZTY3JvbGxCYXJgLiBgcGFyZW50YCBpcyB0aGUgb3duZXIgb2YgdGhlIHNjcm9sbCBiYXIuXG4gKiBAcGFyYW0ge0RPTUVsZW1lbnR9IHBhcmVudCBBIERPTSBlbGVtZW50XG4gKiBAcGFyYW0ge09iamVjdH0gcmVuZGVyZXIgQW4gZWRpdG9yIHJlbmRlcmVyXG4gKlxuICogQGNvbnN0cnVjdG9yXG4gKiovXG5leHBvcnQgY2xhc3MgVlNjcm9sbEJhciBleHRlbmRzIFNjcm9sbEJhciB7XG5cbiAgICBwcml2YXRlIF9zY3JvbGxUb3AgPSAwO1xuICAgIHByaXZhdGUgX3dpZHRoOiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQsIHJlbmRlcmVyKSB7XG4gICAgICAgIHN1cGVyKHBhcmVudCwgJy12Jyk7XG4gICAgICAgIC8vIGluIE9TWCBsaW9uIHRoZSBzY3JvbGxiYXJzIGFwcGVhciB0byBoYXZlIG5vIHdpZHRoLiBJbiB0aGlzIGNhc2UgcmVzaXplIHRoZVxuICAgICAgICAvLyBlbGVtZW50IHRvIHNob3cgdGhlIHNjcm9sbGJhciBidXQgc3RpbGwgcHJldGVuZCB0aGF0IHRoZSBzY3JvbGxiYXIgaGFzIGEgd2lkdGhcbiAgICAgICAgLy8gb2YgMHB4XG4gICAgICAgIC8vIGluIEZpcmVmb3ggNisgc2Nyb2xsYmFyIGlzIGhpZGRlbiBpZiBlbGVtZW50IGhhcyB0aGUgc2FtZSB3aWR0aCBhcyBzY3JvbGxiYXJcbiAgICAgICAgLy8gbWFrZSBlbGVtZW50IGEgbGl0dGxlIGJpdCB3aWRlciB0byByZXRhaW4gc2Nyb2xsYmFyIHdoZW4gcGFnZSBpcyB6b29tZWQgXG4gICAgICAgIHJlbmRlcmVyLiRzY3JvbGxiYXJXaWR0aCA9XG4gICAgICAgICAgICB0aGlzLl93aWR0aCA9IHNjcm9sbGJhcldpZHRoKHBhcmVudC5vd25lckRvY3VtZW50KTtcbiAgICAgICAgdGhpcy5pbm5lci5zdHlsZS53aWR0aCA9XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSAodGhpcy5fd2lkdGggfHwgMTUpICsgNSArIFwicHhcIjtcbiAgICAgICAgYWRkTGlzdGVuZXIodGhpcy5lbGVtZW50LCBcInNjcm9sbFwiLCB0aGlzLm9uU2Nyb2xsLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVtaXR0ZWQgd2hlbiB0aGUgc2Nyb2xsIGJhciwgd2VsbCwgc2Nyb2xscy5cbiAgICAgKiBAZXZlbnQgc2Nyb2xsXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGUgQ29udGFpbnMgb25lIHByb3BlcnR5LCBgXCJkYXRhXCJgLCB3aGljaCBpbmRpY2F0ZXMgdGhlIGN1cnJlbnQgc2Nyb2xsIHRvcCBwb3NpdGlvblxuICAgICAqKi9cbiAgICBvblNjcm9sbCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnNraXBFdmVudCkge1xuICAgICAgICAgICAgdGhpcy5fc2Nyb2xsVG9wID0gdGhpcy5lbGVtZW50LnNjcm9sbFRvcDtcbiAgICAgICAgICAgIHRoaXMuX2VtaXQoXCJzY3JvbGxcIiwgeyBkYXRhOiB0aGlzLl9zY3JvbGxUb3AgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5za2lwRXZlbnQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB3aWR0aCBvZiB0aGUgc2Nyb2xsIGJhci5cbiAgICAgKiBAcmV0dXJucyB7TnVtYmVyfVxuICAgICAqKi9cbiAgICBnZXQgd2lkdGgoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNWaXNpYmxlID8gdGhpcy5fd2lkdGggOiAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGhlaWdodCBvZiB0aGUgc2Nyb2xsIGJhciwgaW4gcGl4ZWxzLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBoZWlnaHQgVGhlIG5ldyBoZWlnaHRcbiAgICAgKiovXG4gICAgc2V0SGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyBcInB4XCI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgaW5uZXIgaGVpZ2h0IG9mIHRoZSBzY3JvbGwgYmFyLCBpbiBwaXhlbHMuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGhlaWdodCBUaGUgbmV3IGlubmVyIGhlaWdodFxuICAgICAqIEBkZXByZWNhdGVkIFVzZSBzZXRTY3JvbGxIZWlnaHQgaW5zdGVhZFxuICAgICAqKi9cbiAgICBzZXRJbm5lckhlaWdodChoZWlnaHQ6IG51bWJlcikge1xuICAgICAgICB0aGlzLmlubmVyLnN0eWxlLmhlaWdodCA9IGhlaWdodCArIFwicHhcIjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBzY3JvbGwgaGVpZ2h0IG9mIHRoZSBzY3JvbGwgYmFyLCBpbiBwaXhlbHMuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGhlaWdodCBUaGUgbmV3IHNjcm9sbCBoZWlnaHRcbiAgICAgKiovXG4gICAgc2V0U2Nyb2xsSGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuaW5uZXIuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgXCJweFwiO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHNjcm9sbCB0b3Agb2YgdGhlIHNjcm9sbCBiYXIuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHNjcm9sbFRvcCBUaGUgbmV3IHNjcm9sbCB0b3BcbiAgICAgKiovXG4gICAgLy8gb24gY2hyb21lIDE3KyBmb3Igc21hbGwgem9vbSBsZXZlbHMgYWZ0ZXIgY2FsbGluZyB0aGlzIGZ1bmN0aW9uXG4gICAgLy8gdGhpcy5lbGVtZW50LnNjcm9sbFRvcCAhPSBzY3JvbGxUb3Agd2hpY2ggbWFrZXMgcGFnZSB0byBzY3JvbGwgdXAuXG4gICAgc2V0U2Nyb2xsVG9wKHNjcm9sbFRvcDogbnVtYmVyKSB7XG4gICAgICAgIGlmICh0aGlzLl9zY3JvbGxUb3AgIT0gc2Nyb2xsVG9wKSB7XG4gICAgICAgICAgICB0aGlzLnNraXBFdmVudCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLl9zY3JvbGxUb3AgPSB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wID0gc2Nyb2xsVG9wO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IHNjcm9sbFRvcCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2Nyb2xsVG9wO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgaG9yaXNvbnRhbCBzY3JvbGwgYmFyLlxuICogQGNsYXNzIEhTY3JvbGxCYXJcbiAqKi9cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGBIU2Nyb2xsQmFyYC4gYHBhcmVudGAgaXMgdGhlIG93bmVyIG9mIHRoZSBzY3JvbGwgYmFyLlxuICogQHBhcmFtIHtET01FbGVtZW50fSBwYXJlbnQgQSBET00gZWxlbWVudFxuICogQHBhcmFtIHtPYmplY3R9IHJlbmRlcmVyIEFuIGVkaXRvciByZW5kZXJlclxuICpcbiAqIEBjb25zdHJ1Y3RvclxuICoqL1xuZXhwb3J0IGNsYXNzIEhTY3JvbGxCYXIgZXh0ZW5kcyBTY3JvbGxCYXIge1xuXG4gICAgcHJpdmF0ZSBfc2Nyb2xsTGVmdCA9IDA7XG4gICAgcHJpdmF0ZSBfaGVpZ2h0OiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQsIHJlbmRlcmVyKSB7XG4gICAgICAgIHN1cGVyKHBhcmVudCwgJy1oJyk7XG5cbiAgICAgICAgLy8gaW4gT1NYIGxpb24gdGhlIHNjcm9sbGJhcnMgYXBwZWFyIHRvIGhhdmUgbm8gd2lkdGguIEluIHRoaXMgY2FzZSByZXNpemUgdGhlXG4gICAgICAgIC8vIGVsZW1lbnQgdG8gc2hvdyB0aGUgc2Nyb2xsYmFyIGJ1dCBzdGlsbCBwcmV0ZW5kIHRoYXQgdGhlIHNjcm9sbGJhciBoYXMgYSB3aWR0aFxuICAgICAgICAvLyBvZiAwcHhcbiAgICAgICAgLy8gaW4gRmlyZWZveCA2KyBzY3JvbGxiYXIgaXMgaGlkZGVuIGlmIGVsZW1lbnQgaGFzIHRoZSBzYW1lIHdpZHRoIGFzIHNjcm9sbGJhclxuICAgICAgICAvLyBtYWtlIGVsZW1lbnQgYSBsaXR0bGUgYml0IHdpZGVyIHRvIHJldGFpbiBzY3JvbGxiYXIgd2hlbiBwYWdlIGlzIHpvb21lZCBcbiAgICAgICAgdGhpcy5faGVpZ2h0ID0gcmVuZGVyZXIuJHNjcm9sbGJhcldpZHRoO1xuICAgICAgICB0aGlzLmlubmVyLnN0eWxlLmhlaWdodCA9XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gKHRoaXMuX2hlaWdodCB8fCAxNSkgKyA1ICsgXCJweFwiO1xuICAgICAgICBhZGRMaXN0ZW5lcih0aGlzLmVsZW1lbnQsIFwic2Nyb2xsXCIsIHRoaXMub25TY3JvbGwuYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW1pdHRlZCB3aGVuIHRoZSBzY3JvbGwgYmFyLCB3ZWxsLCBzY3JvbGxzLlxuICAgICAqIEBldmVudCBzY3JvbGxcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZSBDb250YWlucyBvbmUgcHJvcGVydHksIGBcImRhdGFcImAsIHdoaWNoIGluZGljYXRlcyB0aGUgY3VycmVudCBzY3JvbGwgbGVmdCBwb3NpdGlvblxuICAgICAqKi9cbiAgICBvblNjcm9sbCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnNraXBFdmVudCkge1xuICAgICAgICAgICAgdGhpcy5fc2Nyb2xsTGVmdCA9IHRoaXMuZWxlbWVudC5zY3JvbGxMZWZ0O1xuICAgICAgICAgICAgdGhpcy5fZW1pdChcInNjcm9sbFwiLCB7IGRhdGE6IHRoaXMuX3Njcm9sbExlZnQgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5za2lwRXZlbnQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBoZWlnaHQgb2YgdGhlIHNjcm9sbCBiYXIuXG4gICAgICogQHJldHVybnMge051bWJlcn1cbiAgICAgKiovXG4gICAgZ2V0IGhlaWdodCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5pc1Zpc2libGUgPyB0aGlzLl9oZWlnaHQgOiAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHdpZHRoIG9mIHRoZSBzY3JvbGwgYmFyLCBpbiBwaXhlbHMuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHdpZHRoIFRoZSBuZXcgd2lkdGhcbiAgICAgKiovXG4gICAgc2V0V2lkdGgod2lkdGg6IG51bWJlcik6IHZvaWQge1xuICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSB3aWR0aCArIFwicHhcIjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBpbm5lciB3aWR0aCBvZiB0aGUgc2Nyb2xsIGJhciwgaW4gcGl4ZWxzLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB3aWR0aCBUaGUgbmV3IGlubmVyIHdpZHRoXG4gICAgICogQGRlcHJlY2F0ZWQgVXNlIHNldFNjcm9sbFdpZHRoIGluc3RlYWRcbiAgICAgKiovXG4gICAgc2V0SW5uZXJXaWR0aCh3aWR0aDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuaW5uZXIuc3R5bGUud2lkdGggPSB3aWR0aCArIFwicHhcIjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBzY3JvbGwgd2lkdGggb2YgdGhlIHNjcm9sbCBiYXIsIGluIHBpeGVscy5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gd2lkdGggVGhlIG5ldyBzY3JvbGwgd2lkdGhcbiAgICAgKiovXG4gICAgc2V0U2Nyb2xsV2lkdGgod2lkdGg6IG51bWJlcikge1xuICAgICAgICB0aGlzLmlubmVyLnN0eWxlLndpZHRoID0gd2lkdGggKyBcInB4XCI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgc2Nyb2xsIGxlZnQgb2YgdGhlIHNjcm9sbCBiYXIuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHNjcm9sbFRvcCBUaGUgbmV3IHNjcm9sbCBsZWZ0XG4gICAgICoqL1xuICAgIC8vIG9uIGNocm9tZSAxNysgZm9yIHNtYWxsIHpvb20gbGV2ZWxzIGFmdGVyIGNhbGxpbmcgdGhpcyBmdW5jdGlvblxuICAgIC8vIHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgIT0gc2Nyb2xsVG9wIHdoaWNoIG1ha2VzIHBhZ2UgdG8gc2Nyb2xsIHVwLlxuICAgIHNldFNjcm9sbExlZnQoc2Nyb2xsTGVmdDogbnVtYmVyKSB7XG4gICAgICAgIGlmICh0aGlzLl9zY3JvbGxMZWZ0ICE9IHNjcm9sbExlZnQpIHtcbiAgICAgICAgICAgIHRoaXMuc2tpcEV2ZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX3Njcm9sbExlZnQgPSB0aGlzLmVsZW1lbnQuc2Nyb2xsTGVmdCA9IHNjcm9sbExlZnQ7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=