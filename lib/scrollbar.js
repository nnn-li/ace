import { createElement, scrollbarWidth } from "./lib/dom";
import { addListener } from "./lib/event";
import { EventEmitterClass } from "./lib/event_emitter";
export class ScrollBar extends EventEmitterClass {
    constructor(parent, classSuffix) {
        super();
        this.element = createElement("div");
        this.element.className = "ace_scrollbar ace_scrollbar" + classSuffix;
        this.inner = createElement("div");
        this.inner.className = "ace_scrollbar-inner";
        this.element.appendChild(this.inner);
        parent.appendChild(this.element);
        this.setVisible(false);
        this.skipEvent = false;
        addListener(this.element, "mousedown", event.preventDefault);
    }
    setVisible(isVisible) {
        this.element.style.display = isVisible ? "" : "none";
        this.isVisible = isVisible;
    }
}
export class VScrollBar extends ScrollBar {
    constructor(parent, renderer) {
        super(parent, '-v');
        this._scrollTop = 0;
        renderer.$scrollbarWidth =
            this._width = scrollbarWidth(parent.ownerDocument);
        this.inner.style.width =
            this.element.style.width = (this._width || 15) + 5 + "px";
        addListener(this.element, "scroll", this.onScroll.bind(this));
    }
    onScroll() {
        if (!this.skipEvent) {
            this._scrollTop = this.element.scrollTop;
            this._emit("scroll", { data: this._scrollTop });
        }
        this.skipEvent = false;
    }
    get width() {
        return this.isVisible ? this._width : 0;
    }
    setHeight(height) {
        this.element.style.height = height + "px";
    }
    setInnerHeight(height) {
        this.inner.style.height = height + "px";
    }
    setScrollHeight(height) {
        this.inner.style.height = height + "px";
    }
    setScrollTop(scrollTop) {
        if (this._scrollTop != scrollTop) {
            this.skipEvent = true;
            this._scrollTop = this.element.scrollTop = scrollTop;
        }
    }
    get scrollTop() {
        return this._scrollTop;
    }
}
export class HScrollBar extends ScrollBar {
    constructor(parent, renderer) {
        super(parent, '-h');
        this._scrollLeft = 0;
        this._height = renderer.$scrollbarWidth;
        this.inner.style.height =
            this.element.style.height = (this._height || 15) + 5 + "px";
        addListener(this.element, "scroll", this.onScroll.bind(this));
    }
    onScroll() {
        if (!this.skipEvent) {
            this._scrollLeft = this.element.scrollLeft;
            this._emit("scroll", { data: this._scrollLeft });
        }
        this.skipEvent = false;
    }
    get height() {
        return this.isVisible ? this._height : 0;
    }
    setWidth(width) {
        this.element.style.width = width + "px";
    }
    setInnerWidth(width) {
        this.inner.style.width = width + "px";
    }
    setScrollWidth(width) {
        this.inner.style.width = width + "px";
    }
    setScrollLeft(scrollLeft) {
        if (this._scrollLeft != scrollLeft) {
            this.skipEvent = true;
            this._scrollLeft = this.element.scrollLeft = scrollLeft;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsYmFyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3Njcm9sbGJhci50cyJdLCJuYW1lcyI6WyJTY3JvbGxCYXIiLCJTY3JvbGxCYXIuY29uc3RydWN0b3IiLCJTY3JvbGxCYXIuc2V0VmlzaWJsZSIsIlZTY3JvbGxCYXIiLCJWU2Nyb2xsQmFyLmNvbnN0cnVjdG9yIiwiVlNjcm9sbEJhci5vblNjcm9sbCIsIlZTY3JvbGxCYXIud2lkdGgiLCJWU2Nyb2xsQmFyLnNldEhlaWdodCIsIlZTY3JvbGxCYXIuc2V0SW5uZXJIZWlnaHQiLCJWU2Nyb2xsQmFyLnNldFNjcm9sbEhlaWdodCIsIlZTY3JvbGxCYXIuc2V0U2Nyb2xsVG9wIiwiVlNjcm9sbEJhci5zY3JvbGxUb3AiLCJIU2Nyb2xsQmFyIiwiSFNjcm9sbEJhci5jb25zdHJ1Y3RvciIsIkhTY3JvbGxCYXIub25TY3JvbGwiLCJIU2Nyb2xsQmFyLmhlaWdodCIsIkhTY3JvbGxCYXIuc2V0V2lkdGgiLCJIU2Nyb2xsQmFyLnNldElubmVyV2lkdGgiLCJIU2Nyb2xsQmFyLnNldFNjcm9sbFdpZHRoIiwiSFNjcm9sbEJhci5zZXRTY3JvbGxMZWZ0Il0sIm1hcHBpbmdzIjoiT0E2Qk8sRUFBRSxhQUFhLEVBQUUsY0FBYyxFQUFFLE1BQU0sV0FBVztPQUNsRCxFQUFFLFdBQVcsRUFBRSxNQUFNLGFBQWE7T0FDbEMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQjtBQWF2RCwrQkFBK0IsaUJBQWlCO0lBSzVDQSxZQUFZQSxNQUFNQSxFQUFFQSxXQUFtQkE7UUFDbkNDLE9BQU9BLENBQUNBO1FBQ1JBLElBQUlBLENBQUNBLE9BQU9BLEdBQW1CQSxhQUFhQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUNwREEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsU0FBU0EsR0FBR0EsNkJBQTZCQSxHQUFHQSxXQUFXQSxDQUFDQTtRQUVyRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBbUJBLGFB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Q0E7WUFDdEJBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFVBQVVBLEdBQUdBLFVBQVVBLENBQUNBO1FBQzVEQSxDQUFDQTtJQUNMQSxDQUFDQTtBQUNMUCxDQUFDQTtBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMCwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIFxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0XG4gKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDpcbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuXG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZVxuICogICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cbiAqICAgICAqIE5laXRoZXIgdGhlIG5hbWUgb2YgQWpheC5vcmcgQi5WLiBub3IgdGhlXG4gKiAgICAgICBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0c1xuICogICAgICAgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXG4gKiBcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiIEFORFxuICogQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRURcbiAqIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkVcbiAqIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIEFKQVguT1JHIEIuVi4gQkUgTElBQkxFIEZPUiBBTllcbiAqIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTXG4gKiAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7XG4gKiBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkRcbiAqIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUXG4gKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJU1xuICogU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG4gKlxuICogKioqKiogRU5EIExJQ0VOU0UgQkxPQ0sgKioqKiogKi9cbmltcG9ydCB7IGNyZWF0ZUVsZW1lbnQsIHNjcm9sbGJhcldpZHRoIH0gZnJvbSBcIi4vbGliL2RvbVwiO1xuaW1wb3J0IHsgYWRkTGlzdGVuZXIgfSBmcm9tIFwiLi9saWIvZXZlbnRcIjtcbmltcG9ydCB7IEV2ZW50RW1pdHRlckNsYXNzIH0gZnJvbSBcIi4vbGliL2V2ZW50X2VtaXR0ZXJcIjtcblxuLyoqXG4gKiBBbiBhYnN0cmFjdCBjbGFzcyByZXByZXNlbnRpbmcgYSBuYXRpdmUgc2Nyb2xsYmFyIGNvbnRyb2wuXG4gKiBAY2xhc3MgU2Nyb2xsQmFyXG4gKiovXG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBgU2Nyb2xsQmFyYC4gYHBhcmVudGAgaXMgdGhlIG93bmVyIG9mIHRoZSBzY3JvbGwgYmFyLlxuICogQHBhcmFtIHtET01FbGVtZW50fSBwYXJlbnQgQSBET00gZWxlbWVudCBcbiAqXG4gKiBAY29uc3RydWN0b3JcbiAqKi9cbmV4cG9ydCBjbGFzcyBTY3JvbGxCYXIgZXh0ZW5kcyBFdmVudEVtaXR0ZXJDbGFzcyB7XG4gICAgcHVibGljIGVsZW1lbnQ6IEhUTUxEaXZFbGVtZW50O1xuICAgIHB1YmxpYyBpbm5lcjogSFRNTERpdkVsZW1lbnQ7XG4gICAgcHVibGljIGlzVmlzaWJsZTogYm9vbGVhbjtcbiAgICBwdWJsaWMgc2tpcEV2ZW50O1xuICAgIGNvbnN0cnVjdG9yKHBhcmVudCwgY2xhc3NTdWZmaXg6IHN0cmluZykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSA8SFRNTERpdkVsZW1lbnQ+Y3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTmFtZSA9IFwiYWNlX3Njcm9sbGJhciBhY2Vfc2Nyb2xsYmFyXCIgKyBjbGFzc1N1ZmZpeDtcblxuICAgICAgICB0aGlzLmlubmVyID0gPEhUTUxEaXZFbGVtZW50PmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRoaXMuaW5uZXIuY2xhc3NOYW1lID0gXCJhY2Vfc2Nyb2xsYmFyLWlubmVyXCI7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmlubmVyKTtcblxuICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50KTtcblxuICAgICAgICB0aGlzLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICB0aGlzLnNraXBFdmVudCA9IGZhbHNlO1xuXG4gICAgICAgIGFkZExpc3RlbmVyKHRoaXMuZWxlbWVudCwgXCJtb3VzZWRvd25cIiwgZXZlbnQucHJldmVudERlZmF1bHQpO1xuICAgIH1cbiAgICBzZXRWaXNpYmxlKGlzVmlzaWJsZSkge1xuICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IGlzVmlzaWJsZSA/IFwiXCIgOiBcIm5vbmVcIjtcbiAgICAgICAgdGhpcy5pc1Zpc2libGUgPSBpc1Zpc2libGU7XG4gICAgfVxufSBcblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgdmVydGljYWwgc2Nyb2xsIGJhci5cbiAqIEBjbGFzcyBWU2Nyb2xsQmFyXG4gKiovXG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBgVlNjcm9sbEJhcmAuIGBwYXJlbnRgIGlzIHRoZSBvd25lciBvZiB0aGUgc2Nyb2xsIGJhci5cbiAqIEBwYXJhbSB7RE9NRWxlbWVudH0gcGFyZW50IEEgRE9NIGVsZW1lbnRcbiAqIEBwYXJhbSB7T2JqZWN0fSByZW5kZXJlciBBbiBlZGl0b3IgcmVuZGVyZXJcbiAqXG4gKiBAY29uc3RydWN0b3JcbiAqKi9cbmV4cG9ydCBjbGFzcyBWU2Nyb2xsQmFyIGV4dGVuZHMgU2Nyb2xsQmFyIHtcblxuICAgIHByaXZhdGUgX3Njcm9sbFRvcCA9IDA7XG4gICAgcHJpdmF0ZSBfd2lkdGg6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKHBhcmVudCwgcmVuZGVyZXIpIHtcbiAgICAgICAgc3VwZXIocGFyZW50LCAnLXYnKTtcbiAgICAgICAgLy8gaW4gT1NYIGxpb24gdGhlIHNjcm9sbGJhcnMgYXBwZWFyIHRvIGhhdmUgbm8gd2lkdGguIEluIHRoaXMgY2FzZSByZXNpemUgdGhlXG4gICAgICAgIC8vIGVsZW1lbnQgdG8gc2hvdyB0aGUgc2Nyb2xsYmFyIGJ1dCBzdGlsbCBwcmV0ZW5kIHRoYXQgdGhlIHNjcm9sbGJhciBoYXMgYSB3aWR0aFxuICAgICAgICAvLyBvZiAwcHhcbiAgICAgICAgLy8gaW4gRmlyZWZveCA2KyBzY3JvbGxiYXIgaXMgaGlkZGVuIGlmIGVsZW1lbnQgaGFzIHRoZSBzYW1lIHdpZHRoIGFzIHNjcm9sbGJhclxuICAgICAgICAvLyBtYWtlIGVsZW1lbnQgYSBsaXR0bGUgYml0IHdpZGVyIHRvIHJldGFpbiBzY3JvbGxiYXIgd2hlbiBwYWdlIGlzIHpvb21lZCBcbiAgICAgICAgcmVuZGVyZXIuJHNjcm9sbGJhcldpZHRoID1cbiAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gc2Nyb2xsYmFyV2lkdGgocGFyZW50Lm93bmVyRG9jdW1lbnQpO1xuICAgICAgICB0aGlzLmlubmVyLnN0eWxlLndpZHRoID1cbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS53aWR0aCA9ICh0aGlzLl93aWR0aCB8fCAxNSkgKyA1ICsgXCJweFwiO1xuICAgICAgICBhZGRMaXN0ZW5lcih0aGlzLmVsZW1lbnQsIFwic2Nyb2xsXCIsIHRoaXMub25TY3JvbGwuYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW1pdHRlZCB3aGVuIHRoZSBzY3JvbGwgYmFyLCB3ZWxsLCBzY3JvbGxzLlxuICAgICAqIEBldmVudCBzY3JvbGxcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZSBDb250YWlucyBvbmUgcHJvcGVydHksIGBcImRhdGFcImAsIHdoaWNoIGluZGljYXRlcyB0aGUgY3VycmVudCBzY3JvbGwgdG9wIHBvc2l0aW9uXG4gICAgICoqL1xuICAgIG9uU2Nyb2xsKCkge1xuICAgICAgICBpZiAoIXRoaXMuc2tpcEV2ZW50KSB7XG4gICAgICAgICAgICB0aGlzLl9zY3JvbGxUb3AgPSB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgICAgICAgICAgdGhpcy5fZW1pdChcInNjcm9sbFwiLCB7IGRhdGE6IHRoaXMuX3Njcm9sbFRvcCB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNraXBFdmVudCA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHdpZHRoIG9mIHRoZSBzY3JvbGwgYmFyLlxuICAgICAqIEByZXR1cm5zIHtOdW1iZXJ9XG4gICAgICoqL1xuICAgIGdldCB3aWR0aCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5pc1Zpc2libGUgPyB0aGlzLl93aWR0aCA6IDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgaGVpZ2h0IG9mIHRoZSBzY3JvbGwgYmFyLCBpbiBwaXhlbHMuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGhlaWdodCBUaGUgbmV3IGhlaWdodFxuICAgICAqKi9cbiAgICBzZXRIZWlnaHQoaGVpZ2h0OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLmhlaWdodCA9IGhlaWdodCArIFwicHhcIjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBpbm5lciBoZWlnaHQgb2YgdGhlIHNjcm9sbCBiYXIsIGluIHBpeGVscy5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gaGVpZ2h0IFRoZSBuZXcgaW5uZXIgaGVpZ2h0XG4gICAgICogQGRlcHJlY2F0ZWQgVXNlIHNldFNjcm9sbEhlaWdodCBpbnN0ZWFkXG4gICAgICoqL1xuICAgIHNldElubmVySGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuaW5uZXIuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgXCJweFwiO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHNjcm9sbCBoZWlnaHQgb2YgdGhlIHNjcm9sbCBiYXIsIGluIHBpeGVscy5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gaGVpZ2h0IFRoZSBuZXcgc2Nyb2xsIGhlaWdodFxuICAgICAqKi9cbiAgICBzZXRTY3JvbGxIZWlnaHQoaGVpZ2h0OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5pbm5lci5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyBcInB4XCI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgc2Nyb2xsIHRvcCBvZiB0aGUgc2Nyb2xsIGJhci5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gc2Nyb2xsVG9wIFRoZSBuZXcgc2Nyb2xsIHRvcFxuICAgICAqKi9cbiAgICAvLyBvbiBjaHJvbWUgMTcrIGZvciBzbWFsbCB6b29tIGxldmVscyBhZnRlciBjYWxsaW5nIHRoaXMgZnVuY3Rpb25cbiAgICAvLyB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wICE9IHNjcm9sbFRvcCB3aGljaCBtYWtlcyBwYWdlIHRvIHNjcm9sbCB1cC5cbiAgICBzZXRTY3JvbGxUb3Aoc2Nyb2xsVG9wOiBudW1iZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuX3Njcm9sbFRvcCAhPSBzY3JvbGxUb3ApIHtcbiAgICAgICAgICAgIHRoaXMuc2tpcEV2ZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX3Njcm9sbFRvcCA9IHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgPSBzY3JvbGxUb3A7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgc2Nyb2xsVG9wKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zY3JvbGxUb3A7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlcHJlc2VudHMgYSBob3Jpc29udGFsIHNjcm9sbCBiYXIuXG4gKiBAY2xhc3MgSFNjcm9sbEJhclxuICoqL1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgYEhTY3JvbGxCYXJgLiBgcGFyZW50YCBpcyB0aGUgb3duZXIgb2YgdGhlIHNjcm9sbCBiYXIuXG4gKiBAcGFyYW0ge0RPTUVsZW1lbnR9IHBhcmVudCBBIERPTSBlbGVtZW50XG4gKiBAcGFyYW0ge09iamVjdH0gcmVuZGVyZXIgQW4gZWRpdG9yIHJlbmRlcmVyXG4gKlxuICogQGNvbnN0cnVjdG9yXG4gKiovXG5leHBvcnQgY2xhc3MgSFNjcm9sbEJhciBleHRlbmRzIFNjcm9sbEJhciB7XG5cbiAgICBwcml2YXRlIF9zY3JvbGxMZWZ0ID0gMDtcbiAgICBwcml2YXRlIF9oZWlnaHQ6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKHBhcmVudCwgcmVuZGVyZXIpIHtcbiAgICAgICAgc3VwZXIocGFyZW50LCAnLWgnKTtcblxuICAgICAgICAvLyBpbiBPU1ggbGlvbiB0aGUgc2Nyb2xsYmFycyBhcHBlYXIgdG8gaGF2ZSBubyB3aWR0aC4gSW4gdGhpcyBjYXNlIHJlc2l6ZSB0aGVcbiAgICAgICAgLy8gZWxlbWVudCB0byBzaG93IHRoZSBzY3JvbGxiYXIgYnV0IHN0aWxsIHByZXRlbmQgdGhhdCB0aGUgc2Nyb2xsYmFyIGhhcyBhIHdpZHRoXG4gICAgICAgIC8vIG9mIDBweFxuICAgICAgICAvLyBpbiBGaXJlZm94IDYrIHNjcm9sbGJhciBpcyBoaWRkZW4gaWYgZWxlbWVudCBoYXMgdGhlIHNhbWUgd2lkdGggYXMgc2Nyb2xsYmFyXG4gICAgICAgIC8vIG1ha2UgZWxlbWVudCBhIGxpdHRsZSBiaXQgd2lkZXIgdG8gcmV0YWluIHNjcm9sbGJhciB3aGVuIHBhZ2UgaXMgem9vbWVkIFxuICAgICAgICB0aGlzLl9oZWlnaHQgPSByZW5kZXJlci4kc2Nyb2xsYmFyV2lkdGg7XG4gICAgICAgIHRoaXMuaW5uZXIuc3R5bGUuaGVpZ2h0ID1cbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSAodGhpcy5faGVpZ2h0IHx8IDE1KSArIDUgKyBcInB4XCI7XG4gICAgICAgIGFkZExpc3RlbmVyKHRoaXMuZWxlbWVudCwgXCJzY3JvbGxcIiwgdGhpcy5vblNjcm9sbC5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFbWl0dGVkIHdoZW4gdGhlIHNjcm9sbCBiYXIsIHdlbGwsIHNjcm9sbHMuXG4gICAgICogQGV2ZW50IHNjcm9sbFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlIENvbnRhaW5zIG9uZSBwcm9wZXJ0eSwgYFwiZGF0YVwiYCwgd2hpY2ggaW5kaWNhdGVzIHRoZSBjdXJyZW50IHNjcm9sbCBsZWZ0IHBvc2l0aW9uXG4gICAgICoqL1xuICAgIG9uU2Nyb2xsKCkge1xuICAgICAgICBpZiAoIXRoaXMuc2tpcEV2ZW50KSB7XG4gICAgICAgICAgICB0aGlzLl9zY3JvbGxMZWZ0ID0gdGhpcy5lbGVtZW50LnNjcm9sbExlZnQ7XG4gICAgICAgICAgICB0aGlzLl9lbWl0KFwic2Nyb2xsXCIsIHsgZGF0YTogdGhpcy5fc2Nyb2xsTGVmdCB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNraXBFdmVudCA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGhlaWdodCBvZiB0aGUgc2Nyb2xsIGJhci5cbiAgICAgKiBAcmV0dXJucyB7TnVtYmVyfVxuICAgICAqKi9cbiAgICBnZXQgaGVpZ2h0KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzVmlzaWJsZSA/IHRoaXMuX2hlaWdodCA6IDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgd2lkdGggb2YgdGhlIHNjcm9sbCBiYXIsIGluIHBpeGVscy5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gd2lkdGggVGhlIG5ldyB3aWR0aFxuICAgICAqKi9cbiAgICBzZXRXaWR0aCh3aWR0aDogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS53aWR0aCA9IHdpZHRoICsgXCJweFwiO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGlubmVyIHdpZHRoIG9mIHRoZSBzY3JvbGwgYmFyLCBpbiBwaXhlbHMuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHdpZHRoIFRoZSBuZXcgaW5uZXIgd2lkdGhcbiAgICAgKiBAZGVwcmVjYXRlZCBVc2Ugc2V0U2Nyb2xsV2lkdGggaW5zdGVhZFxuICAgICAqKi9cbiAgICBzZXRJbm5lcldpZHRoKHdpZHRoOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5pbm5lci5zdHlsZS53aWR0aCA9IHdpZHRoICsgXCJweFwiO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHNjcm9sbCB3aWR0aCBvZiB0aGUgc2Nyb2xsIGJhciwgaW4gcGl4ZWxzLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB3aWR0aCBUaGUgbmV3IHNjcm9sbCB3aWR0aFxuICAgICAqKi9cbiAgICBzZXRTY3JvbGxXaWR0aCh3aWR0aDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuaW5uZXIuc3R5bGUud2lkdGggPSB3aWR0aCArIFwicHhcIjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBzY3JvbGwgbGVmdCBvZiB0aGUgc2Nyb2xsIGJhci5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gc2Nyb2xsVG9wIFRoZSBuZXcgc2Nyb2xsIGxlZnRcbiAgICAgKiovXG4gICAgLy8gb24gY2hyb21lIDE3KyBmb3Igc21hbGwgem9vbSBsZXZlbHMgYWZ0ZXIgY2FsbGluZyB0aGlzIGZ1bmN0aW9uXG4gICAgLy8gdGhpcy5lbGVtZW50LnNjcm9sbFRvcCAhPSBzY3JvbGxUb3Agd2hpY2ggbWFrZXMgcGFnZSB0byBzY3JvbGwgdXAuXG4gICAgc2V0U2Nyb2xsTGVmdChzY3JvbGxMZWZ0OiBudW1iZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuX3Njcm9sbExlZnQgIT0gc2Nyb2xsTGVmdCkge1xuICAgICAgICAgICAgdGhpcy5za2lwRXZlbnQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fc2Nyb2xsTGVmdCA9IHRoaXMuZWxlbWVudC5zY3JvbGxMZWZ0ID0gc2Nyb2xsTGVmdDtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==