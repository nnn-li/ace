var XHTML_NS = "http://www.w3.org/1999/xhtml";
export function getDocumentHead(doc = document) {
    return (doc.head || doc.getElementsByTagName("head")[0] || doc.documentElement);
}
export function getDocumentBody(doc = document) {
    return (doc.body || doc.getElementsByTagName("body")[0]);
}
export function createElement(tagName, namespaceURI) {
    return document.createElementNS ?
        document.createElementNS(namespaceURI || XHTML_NS, tagName) :
        document.createElement(tagName);
}
export function hasCssClass(element, name) {
    var classes = element.className.split(/\s+/g);
    return classes.indexOf(name) !== -1;
}
export function addCssClass(element, name) {
    if (!hasCssClass(element, name)) {
        element.className += " " + name;
    }
}
export function removeCssClass(element, name) {
    var classes = element.className.split(/\s+/g);
    while (true) {
        var index = classes.indexOf(name);
        if (index === -1) {
            break;
        }
        classes.splice(index, 1);
    }
    element.className = classes.join(" ");
}
export function toggleCssClass(element, name) {
    var classes = element.className.split(/\s+/g);
    var add = true;
    while (true) {
        var index = classes.indexOf(name);
        if (index == -1) {
            break;
        }
        add = false;
        classes.splice(index, 1);
    }
    if (add)
        classes.push(name);
    element.className = classes.join(" ");
    return add;
}
export function setCssClass(node, className, include) {
    if (include) {
        addCssClass(node, className);
    }
    else {
        removeCssClass(node, className);
    }
}
export function hasCssString(id, doc = document) {
    var index = 0;
    var sheets = doc.getElementsByTagName('style');
    if (sheets) {
        while (index < sheets.length) {
            if (sheets[index++].id === id) {
                return true;
            }
        }
    }
    return false;
}
export function ensureHTMLStyleElement(cssText, id, doc = document) {
    if (id && hasCssString(id, doc)) {
        return;
    }
    else {
        let style = createElement('style');
        style.appendChild(doc.createTextNode(cssText));
        if (id) {
            style.id = id;
        }
        getDocumentHead(doc).appendChild(style);
    }
}
export function appendHTMLLinkElement(id, rel, type, href, doc = document) {
    var link = createElement('link');
    link.id = id;
    link.rel = rel;
    if (typeof type === 'string') {
        link.type = type;
    }
    link.href = href;
    getDocumentHead(doc).appendChild(link);
}
function makeComputedStyle() {
    if (window.getComputedStyle) {
        return function (element, style) {
            return (window.getComputedStyle(element, "") || {})[style] || "";
        };
    }
    else {
        return function (element, style) {
            if (style) {
                return element['currentStyle'][style];
            }
            return element['currentStyle'];
        };
    }
}
export var computedStyle = makeComputedStyle();
export function scrollbarWidth(document) {
    var inner = createElement("ace_inner");
    inner.style.width = "100%";
    inner.style.minWidth = "0px";
    inner.style.height = "200px";
    inner.style.display = "block";
    var outer = createElement("ace_outer");
    var style = outer.style;
    style.position = "absolute";
    style.left = "-10000px";
    style.overflow = "hidden";
    style.width = "200px";
    style.minWidth = "0px";
    style.height = "150px";
    style.display = "block";
    outer.appendChild(inner);
    var body = document.documentElement;
    body.appendChild(outer);
    var noScrollbar = inner.offsetWidth;
    style.overflow = "scroll";
    var withScrollbar = inner.offsetWidth;
    if (noScrollbar === withScrollbar) {
        withScrollbar = outer.clientWidth;
    }
    body.removeChild(outer);
    return noScrollbar - withScrollbar;
}
export function setInnerHtml(element, innerHTML) {
    var clonedElement = element.cloneNode(false);
    clonedElement.innerHTML = innerHTML;
    element.parentNode.replaceChild(clonedElement, element);
    return clonedElement;
}
function makeGetInnerText() {
    if ("textContent" in document.documentElement) {
        return function (el) {
            return el.textContent;
        };
    }
    else {
        return function (el) {
            return el.innerText;
        };
    }
}
function makeSetInnerText() {
    if ("textContent" in document.documentElement) {
        return function (el, innerText) {
            el.textContent = innerText;
        };
    }
    else {
        return function (el, innerText) {
            el.innerText = innerText;
        };
    }
}
export var getInnerText = makeGetInnerText();
export var setInnerText = makeSetInnerText();
export function getParentWindow(document) {
    return document.defaultView;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZG9tLnRzIl0sIm5hbWVzIjpbImdldERvY3VtZW50SGVhZCIsImdldERvY3VtZW50Qm9keSIsImNyZWF0ZUVsZW1lbnQiLCJoYXNDc3NDbGFzcyIsImFkZENzc0NsYXNzIiwicmVtb3ZlQ3NzQ2xhc3MiLCJ0b2dnbGVDc3NDbGFzcyIsInNldENzc0NsYXNzIiwiaGFzQ3NzU3RyaW5nIiwiZW5zdXJlSFRNTFN0eWxlRWxlbWVudCIsImFwcGVuZEhUTUxMaW5rRWxlbWVudCIsIm1ha2VDb21wdXRlZFN0eWxlIiwic2Nyb2xsYmFyV2lkdGgiLCJzZXRJbm5lckh0bWwiLCJtYWtlR2V0SW5uZXJUZXh0IiwibWFrZVNldElubmVyVGV4dCIsImdldFBhcmVudFdpbmRvdyJdLCJtYXBwaW5ncyI6IkFBOEJBLElBQUksUUFBUSxHQUFHLDhCQUE4QixDQUFDO0FBRTlDLGdDQUFnQyxHQUFHLEdBQWEsUUFBUTtJQUNwREEsTUFBTUEsQ0FBa0JBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLElBQUlBLEdBQUdBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0E7QUFDckdBLENBQUNBO0FBRUQsZ0NBQWdDLEdBQUcsR0FBYSxRQUFRO0lBQ3BEQyxNQUFNQSxDQUFrQkEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsSUFBSUEsR0FBR0EsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtBQUM5RUEsQ0FBQ0E7QUFFRCw4QkFBOEIsT0FBZSxFQUFFLFlBQXFCO0lBQ2hFQyxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxlQUFlQTtRQUMzQkEsUUFBUUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsWUFBWUEsSUFBSUEsUUFBUUEsRUFBRUEsT0FBT0EsQ0FBQ0E7UUFDM0RB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QUFDQTtJQUNEQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNGQSxNQUFNQSxDQUFDQSxVQUFTQSxFQUFlQTtZQUMzQixNQUFNLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQztRQUN4QixDQUFDLENBQUNBO0lBQ05BLENBQUNBO0FBQ0xBLENBQUNBO0FBRUQ7SUFDSUMsRUFBRUEsQ0FBQ0EsQ0FBQ0EsYUFBYUEsSUFBSUEsUUFBUUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDNUNBLE1BQU1BLENBQUNBLFVBQVNBLEVBQWVBLEVBQUVBLFNBQWlCQTtZQUM5QyxFQUFFLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztRQUMvQixDQUFDLENBQUNBO0lBQ05BLENBQUNBO0lBQ0RBLElBQUlBLENBQUNBLENBQUNBO1FBQ0ZBLE1BQU1BLENBQUNBLFVBQVNBLEVBQWVBLEVBQUVBLFNBQWlCQTtZQUM5QyxFQUFFLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztRQUM3QixDQUFDLENBQUNBO0lBQ05BLENBQUNBO0FBQ0xBLENBQUNBO0FBRUQsV0FBVyxZQUFZLEdBQWdDLGdCQUFnQixFQUFFLENBQUM7QUFDMUUsV0FBVyxZQUFZLEdBQWlELGdCQUFnQixFQUFFLENBQUM7QUFFM0YsZ0NBQWdDLFFBQWtCO0lBRTlDQyxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxXQUFXQSxDQUFDQTtBQUNoQ0EsQ0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIvKiAqKioqKiBCRUdJTiBMSUNFTlNFIEJMT0NLICoqKioqXG4gKiBEaXN0cmlidXRlZCB1bmRlciB0aGUgQlNEIGxpY2Vuc2U6XG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEwLCBBamF4Lm9yZyBCLlYuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogXG4gKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXRcbiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuICogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlXG4gKiAgICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICogICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBBamF4Lm9yZyBCLlYuIG5vciB0aGVcbiAqICAgICAgIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzXG4gKiAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cbiAqIFxuICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyBcIkFTIElTXCIgQU5EXG4gKiBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRFxuICogV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRVxuICogRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgQUpBWC5PUkcgQi5WLiBCRSBMSUFCTEUgRk9SIEFOWVxuICogRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVNcbiAqIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUztcbiAqIExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORFxuICogT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbiAqIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTXG4gKiBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cbiAqXG4gKiAqKioqKiBFTkQgTElDRU5TRSBCTE9DSyAqKioqKiAqL1xuXG52YXIgWEhUTUxfTlMgPSBcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldERvY3VtZW50SGVhZChkb2M6IERvY3VtZW50ID0gZG9jdW1lbnQpOiBIVE1MSGVhZEVsZW1lbnQge1xuICAgIHJldHVybiA8SFRNTEhlYWRFbGVtZW50Pihkb2MuaGVhZCB8fCBkb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdIHx8IGRvYy5kb2N1bWVudEVsZW1lbnQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RG9jdW1lbnRCb2R5KGRvYzogRG9jdW1lbnQgPSBkb2N1bWVudCk6IEhUTUxCb2R5RWxlbWVudCB7XG4gICAgcmV0dXJuIDxIVE1MQm9keUVsZW1lbnQ+KGRvYy5ib2R5IHx8IGRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZShcImJvZHlcIilbMF0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRWxlbWVudCh0YWdOYW1lOiBzdHJpbmcsIG5hbWVzcGFjZVVSST86IHN0cmluZyk6IEVsZW1lbnQge1xuICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMgP1xuICAgICAgICBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMobmFtZXNwYWNlVVJJIHx8IFhIVE1MX05TLCB0YWdOYW1lKSA6XG4gICAgICAgIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYXNDc3NDbGFzcyhlbGVtZW50OiBIVE1MRWxlbWVudCwgbmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgdmFyIGNsYXNzZXM6IHN0cmluZ1tdID0gZWxlbWVudC5jbGFzc05hbWUuc3BsaXQoL1xccysvZyk7XG4gICAgcmV0dXJuIGNsYXNzZXMuaW5kZXhPZihuYW1lKSAhPT0gLTE7XG59XG5cbi8qKlxuICogQWRkIGEgQ1NTIGNsYXNzIHRvIHRoZSBsaXN0IG9mIGNsYXNzZXMgb24gdGhlIGdpdmVuIG5vZGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFkZENzc0NsYXNzKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBuYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoIWhhc0Nzc0NsYXNzKGVsZW1lbnQsIG5hbWUpKSB7XG4gICAgICAgIGVsZW1lbnQuY2xhc3NOYW1lICs9IFwiIFwiICsgbmFtZTtcbiAgICB9XG59XG5cbi8qKlxuICogUmVtb3ZlIGEgQ1NTIGNsYXNzIGZyb20gdGhlIGxpc3Qgb2YgY2xhc3NlcyBvbiB0aGUgZ2l2ZW4gbm9kZVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlQ3NzQ2xhc3MoZWxlbWVudDogSFRNTEVsZW1lbnQsIG5hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgIHZhciBjbGFzc2VzOiBzdHJpbmdbXSA9IGVsZW1lbnQuY2xhc3NOYW1lLnNwbGl0KC9cXHMrL2cpO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIHZhciBpbmRleCA9IGNsYXNzZXMuaW5kZXhPZihuYW1lKTtcbiAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2xhc3Nlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIH1cbiAgICBlbGVtZW50LmNsYXNzTmFtZSA9IGNsYXNzZXMuam9pbihcIiBcIik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b2dnbGVDc3NDbGFzcyhlbGVtZW50OiBIVE1MRWxlbWVudCwgbmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgdmFyIGNsYXNzZXMgPSBlbGVtZW50LmNsYXNzTmFtZS5zcGxpdCgvXFxzKy9nKTtcbiAgICB2YXIgYWRkID0gdHJ1ZTtcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICB2YXIgaW5kZXggPSBjbGFzc2VzLmluZGV4T2YobmFtZSk7XG4gICAgICAgIGlmIChpbmRleCA9PSAtMSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgYWRkID0gZmFsc2U7XG4gICAgICAgIGNsYXNzZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG4gICAgaWYgKGFkZClcbiAgICAgICAgY2xhc3Nlcy5wdXNoKG5hbWUpO1xuXG4gICAgZWxlbWVudC5jbGFzc05hbWUgPSBjbGFzc2VzLmpvaW4oXCIgXCIpO1xuICAgIHJldHVybiBhZGQ7XG59XG5cbi8qXG4gKiBBZGQgb3IgcmVtb3ZlIGEgQ1NTIGNsYXNzIGZyb20gdGhlIGxpc3Qgb2YgY2xhc3NlcyBvbiB0aGUgZ2l2ZW4gbm9kZVxuICogZGVwZW5kaW5nIG9uIHRoZSB2YWx1ZSBvZiA8dHQ+aW5jbHVkZTwvdHQ+XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRDc3NDbGFzcyhub2RlOiBIVE1MRWxlbWVudCwgY2xhc3NOYW1lOiBzdHJpbmcsIGluY2x1ZGU6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBpZiAoaW5jbHVkZSkge1xuICAgICAgICBhZGRDc3NDbGFzcyhub2RlLCBjbGFzc05hbWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmVtb3ZlQ3NzQ2xhc3Mobm9kZSwgY2xhc3NOYW1lKTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYXNDc3NTdHJpbmcoaWQ6IHN0cmluZywgZG9jOiBEb2N1bWVudCA9IGRvY3VtZW50KSB7XG4gICAgdmFyIGluZGV4ID0gMDtcbiAgICB2YXIgc2hlZXRzID0gZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzdHlsZScpO1xuXG4gICAgaWYgKHNoZWV0cykge1xuICAgICAgICB3aGlsZSAoaW5kZXggPCBzaGVldHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoc2hlZXRzW2luZGV4KytdLmlkID09PSBpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKlxuICovXG5leHBvcnQgZnVuY3Rpb24gZW5zdXJlSFRNTFN0eWxlRWxlbWVudChjc3NUZXh0OiBzdHJpbmcsIGlkPzogc3RyaW5nLCBkb2M6IERvY3VtZW50ID0gZG9jdW1lbnQpOiB2b2lkIHtcbiAgICAvLyBJZiBzdHlsZSBpcyBhbHJlYWR5IGltcG9ydGVkIHJldHVybiBpbW1lZGlhdGVseS5cbiAgICBpZiAoaWQgJiYgaGFzQ3NzU3RyaW5nKGlkLCBkb2MpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBzdHlsZTogSFRNTFN0eWxlRWxlbWVudCA9IDxIVE1MU3R5bGVFbGVtZW50PmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7XG4gICAgICAgIHN0eWxlLmFwcGVuZENoaWxkKGRvYy5jcmVhdGVUZXh0Tm9kZShjc3NUZXh0KSk7XG4gICAgICAgIGlmIChpZCkge1xuICAgICAgICAgICAgc3R5bGUuaWQgPSBpZDtcbiAgICAgICAgfVxuICAgICAgICBnZXREb2N1bWVudEhlYWQoZG9jKS5hcHBlbmRDaGlsZChzdHlsZSk7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gYXBwZW5kSFRNTExpbmtFbGVtZW50KGlkOiBzdHJpbmcsIHJlbDogc3RyaW5nLCB0eXBlOiBzdHJpbmcsIGhyZWY6IHN0cmluZywgZG9jOiBEb2N1bWVudCA9IGRvY3VtZW50KSB7XG4gICAgdmFyIGxpbmsgPSA8SFRNTExpbmtFbGVtZW50PmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTtcbiAgICBsaW5rLmlkID0gaWQ7XG4gICAgbGluay5yZWwgPSByZWw7XG4gICAgaWYgKHR5cGVvZiB0eXBlID09PSAnc3RyaW5nJykge1xuICAgICAgICBsaW5rLnR5cGUgPSB0eXBlO1xuICAgIH1cbiAgICBsaW5rLmhyZWYgPSBocmVmO1xuICAgIGdldERvY3VtZW50SGVhZChkb2MpLmFwcGVuZENoaWxkKGxpbmspO1xufVxuXG4vKlxuZXhwb3J0IGZ1bmN0aW9uIGdldElubmVyV2lkdGgoZWxlbWVudDogSFRNTEVsZW1lbnQpOiBudW1iZXIge1xuICAgIHJldHVybiAoXG4gICAgICAgIHBhcnNlSW50KGV4cG9ydHMuY29tcHV0ZWRTdHlsZShlbGVtZW50LCBcInBhZGRpbmdMZWZ0XCIpLCAxMCkgK1xuICAgICAgICBwYXJzZUludChleHBvcnRzLmNvbXB1dGVkU3R5bGUoZWxlbWVudCwgXCJwYWRkaW5nUmlnaHRcIiksIDEwKSArXG4gICAgICAgIGVsZW1lbnQuY2xpZW50V2lkdGhcbiAgICApO1xufVxuKi9cbi8qXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW5uZXJIZWlnaHQoZWxlbWVudDogSFRNTEVsZW1lbnQpOiBudW1iZXIge1xuICAgIHJldHVybiAoXG4gICAgICAgIHBhcnNlSW50KGV4cG9ydHMuY29tcHV0ZWRTdHlsZShlbGVtZW50LCBcInBhZGRpbmdUb3BcIiksIDEwKSArXG4gICAgICAgIHBhcnNlSW50KGV4cG9ydHMuY29tcHV0ZWRTdHlsZShlbGVtZW50LCBcInBhZGRpbmdCb3R0b21cIiksIDEwKSArXG4gICAgICAgIGVsZW1lbnQuY2xpZW50SGVpZ2h0XG4gICAgKTtcbn1cbiovXG4vKlxuaWYgKHdpbmRvdy5wYWdlWU9mZnNldCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZXhwb3J0cy5nZXRQYWdlU2Nyb2xsVG9wID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB3aW5kb3cucGFnZVlPZmZzZXQ7XG4gICAgfTtcblxuICAgIGV4cG9ydHMuZ2V0UGFnZVNjcm9sbExlZnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5wYWdlWE9mZnNldDtcbiAgICB9O1xufVxuZWxzZSB7XG4gICAgZXhwb3J0cy5nZXRQYWdlU2Nyb2xsVG9wID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDtcbiAgICB9O1xuXG4gICAgZXhwb3J0cy5nZXRQYWdlU2Nyb2xsTGVmdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0O1xuICAgIH07XG59XG4qL1xuLy8gRklYTUU6IEkgZG9uJ3QgbGlrZSB0aGlzIGJlY2F1c2Ugd2UgbG9zZSB0eXBlIHNhZmV0eS5cbmZ1bmN0aW9uIG1ha2VDb21wdXRlZFN0eWxlKCk6IChlbGVtZW50OiBIVE1MRWxlbWVudCwgc3R5bGU6IHN0cmluZykgPT4gQ1NTU3R5bGVEZWNsYXJhdGlvbiB7XG4gICAgaWYgKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKSB7XG4gICAgICAgIC8vIFlvdSBjYW4gYWxzbyBjYWxsIGdldFByb3BlcnR5VmFsdWUhXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihlbGVtZW50OiBIVE1MRWxlbWVudCwgc3R5bGU6IHN0cmluZyk6IENTU1N0eWxlRGVjbGFyYXRpb24ge1xuICAgICAgICAgICAgcmV0dXJuICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBcIlwiKSB8fCB7fSlbc3R5bGVdIHx8IFwiXCI7XG4gICAgICAgIH07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZWxlbWVudDogSFRNTEVsZW1lbnQsIHN0eWxlOiBzdHJpbmcpOiBDU1NTdHlsZURlY2xhcmF0aW9uIHtcbiAgICAgICAgICAgIGlmIChzdHlsZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50WydjdXJyZW50U3R5bGUnXVtzdHlsZV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudFsnY3VycmVudFN0eWxlJ107XG4gICAgICAgIH07XG4gICAgfVxufVxuXG5leHBvcnQgdmFyIGNvbXB1dGVkU3R5bGUgPSBtYWtlQ29tcHV0ZWRTdHlsZSgpO1xuLy8gRklYTUVcbi8qXG5pZiAod2luZG93LmdldENvbXB1dGVkU3R5bGUpXG4gICAgZXhwb3J0cy5jb21wdXRlZFN0eWxlID0gZnVuY3Rpb24oZWxlbWVudCwgc3R5bGUpOiBhbnkge1xuICAgICAgICBpZiAoc3R5bGUpXG4gICAgICAgICAgICByZXR1cm4gKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsIFwiXCIpIHx8IHt9KVtzdHlsZV0gfHwgXCJcIjtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsIFwiXCIpIHx8IHt9O1xuICAgIH07XG5lbHNlXG4gICAgZXhwb3J0cy5jb21wdXRlZFN0eWxlID0gZnVuY3Rpb24oZWxlbWVudCwgc3R5bGUpIHtcbiAgICAgICAgaWYgKHN0eWxlKVxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuY3VycmVudFN0eWxlW3N0eWxlXTtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQuY3VycmVudFN0eWxlO1xuICAgIH07XG4qL1xuZXhwb3J0IGZ1bmN0aW9uIHNjcm9sbGJhcldpZHRoKGRvY3VtZW50OiBEb2N1bWVudCk6IG51bWJlciB7XG4gICAgdmFyIGlubmVyOiBIVE1MRWxlbWVudCA9IDxIVE1MRWxlbWVudD5jcmVhdGVFbGVtZW50KFwiYWNlX2lubmVyXCIpO1xuICAgIGlubmVyLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gICAgaW5uZXIuc3R5bGUubWluV2lkdGggPSBcIjBweFwiO1xuICAgIGlubmVyLnN0eWxlLmhlaWdodCA9IFwiMjAwcHhcIjtcbiAgICBpbm5lci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuXG4gICAgdmFyIG91dGVyOiBIVE1MRWxlbWVudCA9IDxIVE1MRWxlbWVudD5jcmVhdGVFbGVtZW50KFwiYWNlX291dGVyXCIpO1xuICAgIHZhciBzdHlsZSA9IG91dGVyLnN0eWxlO1xuXG4gICAgc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgc3R5bGUubGVmdCA9IFwiLTEwMDAwcHhcIjtcbiAgICBzdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XG4gICAgc3R5bGUud2lkdGggPSBcIjIwMHB4XCI7XG4gICAgc3R5bGUubWluV2lkdGggPSBcIjBweFwiO1xuICAgIHN0eWxlLmhlaWdodCA9IFwiMTUwcHhcIjtcbiAgICBzdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuXG4gICAgb3V0ZXIuYXBwZW5kQ2hpbGQoaW5uZXIpO1xuXG4gICAgdmFyIGJvZHkgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgYm9keS5hcHBlbmRDaGlsZChvdXRlcik7XG5cbiAgICB2YXIgbm9TY3JvbGxiYXIgPSBpbm5lci5vZmZzZXRXaWR0aDtcblxuICAgIHN0eWxlLm92ZXJmbG93ID0gXCJzY3JvbGxcIjtcbiAgICB2YXIgd2l0aFNjcm9sbGJhciA9IGlubmVyLm9mZnNldFdpZHRoO1xuXG4gICAgaWYgKG5vU2Nyb2xsYmFyID09PSB3aXRoU2Nyb2xsYmFyKSB7XG4gICAgICAgIHdpdGhTY3JvbGxiYXIgPSBvdXRlci5jbGllbnRXaWR0aDtcbiAgICB9XG5cbiAgICBib2R5LnJlbW92ZUNoaWxkKG91dGVyKTtcblxuICAgIHJldHVybiBub1Njcm9sbGJhciAtIHdpdGhTY3JvbGxiYXI7XG59XG5cbi8qXG4gKiBPcHRpbWl6ZWQgc2V0IGlubmVySFRNTC4gVGhpcyBpcyBmYXN0ZXIgdGhhbiBwbGFpbiBpbm5lckhUTUwgaWYgdGhlIGVsZW1lbnRcbiAqIGFscmVhZHkgY29udGFpbnMgYSBsb3Qgb2YgY2hpbGQgZWxlbWVudHMuXG4gKlxuICogU2VlIGh0dHA6Ly9ibG9nLnN0ZXZlbmxldml0aGFuLmNvbS9hcmNoaXZlcy9mYXN0ZXItdGhhbi1pbm5lcmh0bWwgZm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldElubmVySHRtbChlbGVtZW50OiBIVE1MRWxlbWVudCwgaW5uZXJIVE1MOiBzdHJpbmcpIHtcbiAgICB2YXIgY2xvbmVkRWxlbWVudCA9IDxIVE1MRWxlbWVudD5lbGVtZW50LmNsb25lTm9kZShmYWxzZSk7XG4gICAgY2xvbmVkRWxlbWVudC5pbm5lckhUTUwgPSBpbm5lckhUTUw7XG4gICAgZWxlbWVudC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChjbG9uZWRFbGVtZW50LCBlbGVtZW50KTtcbiAgICByZXR1cm4gY2xvbmVkRWxlbWVudDtcbn1cblxuZnVuY3Rpb24gbWFrZUdldElubmVyVGV4dCgpOiAoZWw6IEhUTUxFbGVtZW50KSA9PiBzdHJpbmcge1xuICAgIGlmIChcInRleHRDb250ZW50XCIgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihlbDogSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBlbC50ZXh0Q29udGVudDtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihlbDogSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBlbC5pbm5lclRleHQ7XG4gICAgICAgIH07XG4gICAgfVxufVxuXG5mdW5jdGlvbiBtYWtlU2V0SW5uZXJUZXh0KCk6IChlbDogSFRNTEVsZW1lbnQsIGlubmVyVGV4dDogc3RyaW5nKSA9PiB2b2lkIHtcbiAgICBpZiAoXCJ0ZXh0Q29udGVudFwiIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZWw6IEhUTUxFbGVtZW50LCBpbm5lclRleHQ6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICAgICAgZWwudGV4dENvbnRlbnQgPSBpbm5lclRleHQ7XG4gICAgICAgIH07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZWw6IEhUTUxFbGVtZW50LCBpbm5lclRleHQ6IHN0cmluZykge1xuICAgICAgICAgICAgZWwuaW5uZXJUZXh0ID0gaW5uZXJUZXh0O1xuICAgICAgICB9O1xuICAgIH1cbn1cblxuZXhwb3J0IHZhciBnZXRJbm5lclRleHQ6IChlbDogSFRNTEVsZW1lbnQpID0+IHN0cmluZyA9IG1ha2VHZXRJbm5lclRleHQoKTtcbmV4cG9ydCB2YXIgc2V0SW5uZXJUZXh0OiAoZWw6IEhUTUxFbGVtZW50LCBpbm5lclRleHQ6IHN0cmluZykgPT4gdm9pZCA9IG1ha2VTZXRJbm5lclRleHQoKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFBhcmVudFdpbmRvdyhkb2N1bWVudDogRG9jdW1lbnQpOiBXaW5kb3cge1xuICAgIC8vIFRoaXMgaXMgYSBiaXQgcmVkdW5kYW50IG5vdyB0aGF0IHBhcmVudFdpbmRvdyBoYXMgYmVlbiByZW1vdmVkLlxuICAgIHJldHVybiBkb2N1bWVudC5kZWZhdWx0Vmlldztcbn1cbiJdfQ==