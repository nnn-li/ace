import { copyObject } from "./lib/lang";
import { implement } from "./lib/oop";
import { loadScript } from "./lib/net";
var global = (function () {
    return this || typeof window !== 'undefined' && window;
})();
var options = {
    packaged: false,
    workerPath: null,
    modePath: null,
    themePath: null,
    basePath: "",
    suffix: ".js",
    $moduleUrls: {}
};
export function get(key) {
    if (!options.hasOwnProperty(key)) {
        throw new Error("Unknown config key: " + key);
    }
    return options[key];
}
export function set(key, value) {
    if (!options.hasOwnProperty(key)) {
        throw new Error("Unknown config key: " + key);
    }
    options[key] = value;
}
export function all() {
    return copyObject(options);
}
export function moduleUrl(moduleName, component) {
    if (options.$moduleUrls[moduleName]) {
        return options.$moduleUrls[moduleName];
    }
    var parts = moduleName.split("/");
    component = component || parts[parts.length - 2] || "";
    var sep = component === "snippets" ? "/" : "-";
    var base = parts[parts.length - 1];
    if (component === 'worker' && sep === '-') {
        var re = new RegExp("^" + component + "[\\-_]|[\\-_]" + component + "$", "g");
        base = base.replace(re, "");
    }
    if ((!base || base == component) && parts.length > 1) {
        base = parts[parts.length - 2];
    }
    var path = options[component + "Path"];
    if (path == null) {
        path = options.basePath;
    }
    else if (sep == "/") {
        component = sep = "";
    }
    if (path && path.slice(-1) != "/") {
        path += "/";
    }
    return path + component + sep + base + get("suffix");
}
export function setModuleUrl(name, subst) {
    return options.$moduleUrls[name] = subst;
}
export var $loading = {};
export function loadModule(what, onLoad, doc = document) {
    var module;
    var moduleName;
    var moduleType;
    if (Array.isArray(what)) {
        moduleType = what[0];
        moduleName = what[1];
    }
    else {
        moduleName = what;
    }
    try {
    }
    catch (e) { }
    if (module && !$loading[moduleName])
        return onLoad && onLoad(module);
    if (!$loading[moduleName]) {
        $loading[moduleName] = [];
    }
    $loading[moduleName].push(onLoad);
    if ($loading[moduleName].length > 1)
        return;
    var afterLoad = function () {
    };
    if (!get("packaged")) {
        return afterLoad();
    }
    loadScript(moduleUrl(moduleName, moduleType), afterLoad, doc);
}
export function init(packaged) {
    options.packaged = packaged || module.packaged;
    if (!global.document)
        return "";
    var scriptOptions = {};
    var scriptUrl = "";
    var currentScript = (document['currentScript'] || document['_currentScript']);
    var currentDocument = currentScript && currentScript.ownerDocument || document;
    var scripts = currentDocument.getElementsByTagName("script");
    for (var i = 0; i < scripts.length; i++) {
        var script = scripts[i];
        var src = script.src || script.getAttribute("src");
        if (!src)
            continue;
        var attributes = script.attributes;
        for (var j = 0, l = attributes.length; j < l; j++) {
            var attr = attributes[j];
            if (attr.name.indexOf("data-ace-") === 0) {
                scriptOptions[deHyphenate(attr.name.replace(/^data-ace-/, ""))] = attr.value;
            }
        }
        var m = src.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);
        if (m) {
            scriptUrl = m[1];
        }
    }
    if (scriptUrl) {
        scriptOptions['base'] = scriptOptions['base'] || scriptUrl;
        scriptOptions['packaged'] = true;
    }
    scriptOptions['basePath'] = scriptOptions['base'];
    scriptOptions['workerPath'] = scriptOptions['workerPath'] || scriptOptions['base'];
    scriptOptions['modePath'] = scriptOptions['modePath'] || scriptOptions['base'];
    scriptOptions['themePath'] = scriptOptions['themePath'] || scriptOptions['base'];
    delete scriptOptions['base'];
    for (var key in scriptOptions)
        if (typeof scriptOptions[key] !== "undefined")
            set(key, scriptOptions[key]);
}
;
function deHyphenate(str) {
    return str.replace(/-(.)/g, function (m, m1) { return m1.toUpperCase(); });
}
var optionsProvider = {
    setOptions: function (optList) {
        Object.keys(optList).forEach(function (key) {
            this.setOption(key, optList[key]);
        }, this);
    },
    getOptions: function (optionNames) {
        var result = {};
        if (!optionNames) {
            optionNames = Object.keys(this.$options);
        }
        else if (!Array.isArray(optionNames)) {
            result = optionNames;
            optionNames = Object.keys(result);
        }
        optionNames.forEach(function (key) {
            result[key] = this.getOption(key);
        }, this);
        return result;
    },
    setOption: function (name, value) {
        if (this["$" + name] === value)
            return;
        var opt = this.$options[name];
        if (!opt) {
            if (typeof console != "undefined" && console.warn)
                console.warn('misspelled option "' + name + '"');
            return undefined;
        }
        if (opt.forwardTo)
            return this[opt.forwardTo] && this[opt.forwardTo].setOption(name, value);
        if (!opt.handlesSet)
            this["$" + name] = value;
        if (opt && opt.set)
            opt.set.call(this, value);
    },
    getOption: function (name) {
        var opt = this.$options[name];
        if (!opt) {
            if (typeof console != "undefined" && console.warn)
                console.warn('misspelled option "' + name + '"');
            return undefined;
        }
        if (opt.forwardTo)
            return this[opt.forwardTo] && this[opt.forwardTo].getOption(name);
        return opt && opt.get ? opt.get.call(this) : this["$" + name];
    }
};
var defaultOptions = {};
export function defineOptions(obj, path, options) {
    if (!obj.$options) {
        defaultOptions[path] = obj.$options = {};
    }
    Object.keys(options).forEach(function (key) {
        var opt = options[key];
        if (typeof opt === "string") {
            opt = { forwardTo: opt };
        }
        opt.name || (opt.name = key);
        obj.$options[opt.name] = opt;
        if ("initialValue" in opt) {
            obj["$" + opt.name] = opt.initialValue;
        }
    });
    implement(obj, optionsProvider);
    return this;
}
export function resetOptions(obj) {
    Object.keys(obj.$options).forEach(function (key) {
        var opt = obj.$options[key];
        if ("value" in opt) {
            obj.setOption(key, opt.value);
        }
    });
}
export function setDefaultValue(path, name, value) {
    var opts = defaultOptions[path] || (defaultOptions[path] = {});
    if (opts[name]) {
        if (opts.forwardTo)
            setDefaultValue(opts.forwardTo, name, value);
        else
            opts[name].value = value;
    }
}
export function setDefaultValues(path, optionHash) {
    Object.keys(optionHash).forEach(function (key) {
        setDefaultValue(path, key, optionHash[key]);
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29uZmlnLnRzIl0sIm5hbWVzIjpbImdldCIsInNldCIsImFsbCIsIm1vZHVsZVVybCIsInNldE1vZHVsZVVybCIsImxvYWRNb2R1bGUiLCJpbml0IiwiZGVIeXBoZW5hdGUiLCJkZWZpbmVPcHRpb25zIiwicmVzZXRPcHRpb25zIiwic2V0RGVmYXVsdFZhbHVlIiwic2V0RGVmYXVsdFZhbHVlcyJdLCJtYXBwaW5ncyI6Ik9Bb0RPLEVBQUMsVUFBVSxFQUFDLE1BQU0sWUFBWTtPQUM5QixFQUFDLFNBQVMsRUFBQyxNQUFNLFdBQVc7T0FDNUIsRUFBQyxVQUFVLEVBQUMsTUFBTSxXQUFXO0FBRXBDLElBQUksTUFBTSxHQUFHLENBQUM7SUFDVixNQUFNLENBQUMsSUFBSSxJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVcsSUFBSSxNQUFNLENBQUM7QUFDM0QsQ0FBQyxDQUFDLEVBQUUsQ0FBQztBQUVMLElBQUksT0FBTyxHQUE4SjtJQUNySyxRQUFRLEVBQUUsS0FBSztJQUNmLFVBQVUsRUFBRSxJQUFJO0lBQ2hCLFFBQVEsRUFBRSxJQUFJO0lBQ2QsU0FBUyxFQUFFLElBQUk7SUFDZixRQUFRLEVBQUUsRUFBRTtJQUNaLE1BQU0sRUFBRSxLQUFLO0lBQ2IsV0FBVyxFQUFFLEVBQUU7Q0FDbEIsQ0FBQztBQUVGLG9CQUFvQixHQUFXO0lBQzNCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxjQUFjQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMvQkEsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0Esc0JBQXNCQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUNsREEsQ0FBQ0E7SUFDREEsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7QUFDeEJBLENBQUNBO0FBRUQsb0JBQW9CLEdBQVcsRUFBRSxLQUFLO0lBQ2xDQyxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxjQUFjQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMvQkEsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0Esc0JBQXNCQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUNsREEsQ0FBQ0E7SUFDREEsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0E7QUFDekJBLENBQUNBO0FBRUQ7SUFDSUMsTUFBTUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7QUFDL0JBLENBQUNBO0FBS0QsMEJBQTBCLFVBQWtCLEVBQUUsU0FBaUI7SUFDM0RDLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLFdBQVdBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2xDQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxXQUFXQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtJQUMzQ0EsQ0FBQ0E7SUFFREEsSUFBSUEsS0FBS0EsR0FBR0EsVUFBVUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFDbENBLFNBQVNBLEdBQUdBLFNBQVNBLElBQUlBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBO0lBR3ZEQSxJQUFJQSxHQUFHQSxHQUFXQSxTQUFTQSxLQUFLQSxVQUFVQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtJQUN2REEsSUFBSUEsSUFBSUEsR0FBV0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDM0NBLEVBQUVBLENBQUNBLENBQUNBLFNBQVNBLEtBQUtBLFFBQVFBLElBQUlBLEdBQUdBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBQ3hDQSxJQUFJQSxFQUFFQSxHQUFHQSxJQUFJQSxNQUFNQSxDQUFDQSxHQUFHQSxHQUFHQSxTQUFTQSxHQUFHQSxlQUFlQSxHQUFHQSxTQUFTQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUM5RUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsRUFBRUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7SUFDaENBLENBQUNBO0lBRURBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLElBQUlBLElBQUlBLFNBQVNBLENBQUNBLElBQUlBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ25EQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUNuQ0EsQ0FBQ0E7SUFDREEsSUFBSUEsSUFBSUEsR0FBV0EsT0FBT0EsQ0FBQ0EsU0FBU0EsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7SUFDL0NBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1FBQ2ZBLElBQUlBLEdBQUdBLE9BQU9BLENBQUNBLFFBQVFBLENBQUNBO0lBQzVCQSxDQUFDQTtJQUNEQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNsQkEsU0FBU0EsR0FBR0EsR0FBR0EsR0FBR0EsRUFBRUEsQ0FBQ0E7SUFDekJBLENBQUNBO0lBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBQ2hDQSxJQUFJQSxJQUFJQSxHQUFHQSxDQUFDQTtJQUNoQkEsQ0FBQ0E7SUFDREEsTUFBTUEsQ0FBQ0EsSUFBSUEsR0FBR0EsU0FBU0EsR0FBR0EsR0FBR0EsR0FBR0EsSUFBSUEsR0FB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Q0EsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7SUFDL0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2JBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBO1lBQ2ZBLGVBQWVBLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLEVBQUVBLElBQUlBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1FBQ2pEQSxJQUFJQTtZQUNBQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQTtJQUNqQ0EsQ0FBQ0E7QUFDTEEsQ0FBQ0E7QUFFRCxpQ0FBaUMsSUFBSSxFQUFFLFVBQVU7SUFDN0NDLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLFVBQVNBLEdBQUdBO1FBQ3hDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ2hELENBQUMsQ0FBQ0EsQ0FBQ0E7QUFDUEEsQ0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIvKiAqKioqKiBCRUdJTiBMSUNFTlNFIEJMT0NLICoqKioqXG4gKiBUaGUgTUlUIExpY2Vuc2UgKE1JVClcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTQtMjAxNiBEYXZpZCBHZW8gSG9sbWVzIDxkYXZpZC5nZW8uaG9sbWVzQGdtYWlsLmNvbT5cbiAqXG4gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4gKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4gKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4gKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4gKlxuICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG4gKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuICpcbiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcbiAqIFNPRlRXQVJFLlxuICogKioqKiogRU5EIExJQ0VOU0UgQkxPQ0sgKioqKiogKi9cbi8qICoqKioqIEJFR0lOIExJQ0VOU0UgQkxPQ0sgKioqKipcbiAqIERpc3RyaWJ1dGVkIHVuZGVyIHRoZSBCU0QgbGljZW5zZTpcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTAsIEFqYXgub3JnIEIuVi5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBcbiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dFxuICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLlxuICogICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGVcbiAqICAgICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG4gKiAgICAgKiBOZWl0aGVyIHRoZSBuYW1lIG9mIEFqYXgub3JnIEIuVi4gbm9yIHRoZVxuICogICAgICAgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHNcbiAqICAgICAgIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLlxuICogXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkRcbiAqIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEXG4gKiBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFXG4gKiBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBBSkFYLk9SRyBCLlYuIEJFIExJQUJMRSBGT1IgQU5ZXG4gKiBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFU1xuICogKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTO1xuICogTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EXG4gKiBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVNcbiAqIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICpcbiAqICoqKioqIEVORCBMSUNFTlNFIEJMT0NLICoqKioqICovXG5pbXBvcnQge2NvcHlPYmplY3R9IGZyb20gXCIuL2xpYi9sYW5nXCI7XG5pbXBvcnQge2ltcGxlbWVudH0gZnJvbSBcIi4vbGliL29vcFwiO1xuaW1wb3J0IHtsb2FkU2NyaXB0fSBmcm9tIFwiLi9saWIvbmV0XCI7XG5cbnZhciBnbG9iYWwgPSAoZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMgfHwgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93O1xufSkoKTtcblxudmFyIG9wdGlvbnM6IHsgcGFja2FnZWQ6IGJvb2xlYW47IHdvcmtlclBhdGg6IHN0cmluZzsgbW9kZVBhdGg6IHN0cmluZzsgdGhlbWVQYXRoOiBzdHJpbmc7IGJhc2VQYXRoOiBzdHJpbmc7IHN1ZmZpeDogc3RyaW5nOyAkbW9kdWxlVXJsczogeyBbbmFtZTogc3RyaW5nXTogc3RyaW5nIH0gfSA9IHtcbiAgICBwYWNrYWdlZDogZmFsc2UsXG4gICAgd29ya2VyUGF0aDogbnVsbCxcbiAgICBtb2RlUGF0aDogbnVsbCxcbiAgICB0aGVtZVBhdGg6IG51bGwsXG4gICAgYmFzZVBhdGg6IFwiXCIsXG4gICAgc3VmZml4OiBcIi5qc1wiLFxuICAgICRtb2R1bGVVcmxzOiB7fVxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldChrZXk6IHN0cmluZykge1xuICAgIGlmICghb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVua25vd24gY29uZmlnIGtleTogXCIgKyBrZXkpO1xuICAgIH1cbiAgICByZXR1cm4gb3B0aW9uc1trZXldO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0KGtleTogc3RyaW5nLCB2YWx1ZSkge1xuICAgIGlmICghb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVua25vd24gY29uZmlnIGtleTogXCIgKyBrZXkpO1xuICAgIH1cbiAgICBvcHRpb25zW2tleV0gPSB2YWx1ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFsbCgpIHtcbiAgICByZXR1cm4gY29weU9iamVjdChvcHRpb25zKTtcbn1cblxuLyoqXG4gKlxuICovXG5leHBvcnQgZnVuY3Rpb24gbW9kdWxlVXJsKG1vZHVsZU5hbWU6IHN0cmluZywgY29tcG9uZW50OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmIChvcHRpb25zLiRtb2R1bGVVcmxzW21vZHVsZU5hbWVdKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLiRtb2R1bGVVcmxzW21vZHVsZU5hbWVdO1xuICAgIH1cblxuICAgIHZhciBwYXJ0cyA9IG1vZHVsZU5hbWUuc3BsaXQoXCIvXCIpO1xuICAgIGNvbXBvbmVudCA9IGNvbXBvbmVudCB8fCBwYXJ0c1twYXJ0cy5sZW5ndGggLSAyXSB8fCBcIlwiO1xuXG4gICAgLy8gVE9ETzogQ29uZmlndXJhYmxlIG9yIGdldCByaWQgb2YgJy0nP1xuICAgIHZhciBzZXA6IHN0cmluZyA9IGNvbXBvbmVudCA9PT0gXCJzbmlwcGV0c1wiID8gXCIvXCIgOiBcIi1cIjtcbiAgICB2YXIgYmFzZTogc3RyaW5nID0gcGFydHNbcGFydHMubGVuZ3RoIC0gMV07XG4gICAgaWYgKGNvbXBvbmVudCA9PT0gJ3dvcmtlcicgJiYgc2VwID09PSAnLScpIHtcbiAgICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cChcIl5cIiArIGNvbXBvbmVudCArIFwiW1xcXFwtX118W1xcXFwtX11cIiArIGNvbXBvbmVudCArIFwiJFwiLCBcImdcIik7XG4gICAgICAgIGJhc2UgPSBiYXNlLnJlcGxhY2UocmUsIFwiXCIpO1xuICAgIH1cblxuICAgIGlmICgoIWJhc2UgfHwgYmFzZSA9PSBjb21wb25lbnQpICYmIHBhcnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgYmFzZSA9IHBhcnRzW3BhcnRzLmxlbmd0aCAtIDJdO1xuICAgIH1cbiAgICB2YXIgcGF0aDogc3RyaW5nID0gb3B0aW9uc1tjb21wb25lbnQgKyBcIlBhdGhcIl07XG4gICAgaWYgKHBhdGggPT0gbnVsbCkge1xuICAgICAgICBwYXRoID0gb3B0aW9ucy5iYXNlUGF0aDtcbiAgICB9XG4gICAgZWxzZSBpZiAoc2VwID09IFwiL1wiKSB7XG4gICAgICAgIGNvbXBvbmVudCA9IHNlcCA9IFwiXCI7XG4gICAgfVxuICAgIGlmIChwYXRoICYmIHBhdGguc2xpY2UoLTEpICE9IFwiL1wiKSB7XG4gICAgICAgIHBhdGggKz0gXCIvXCI7XG4gICAgfVxuICAgIHJldHVybiBwYXRoICsgY29tcG9uZW50ICsgc2VwICsgYmFzZSArIGdldChcInN1ZmZpeFwiKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldE1vZHVsZVVybChuYW1lOiBzdHJpbmcsIHN1YnN0OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gb3B0aW9ucy4kbW9kdWxlVXJsc1tuYW1lXSA9IHN1YnN0O1xufVxuXG4vKipcbiAqIEEgbWFwIGZyb20gbW9kdWxlIG5hbWUgdG8gYW4gYXJyYXkgb2YgY2FsbGJhY2tzLlxuICovXG5leHBvcnQgdmFyICRsb2FkaW5nOiB7IFtuYW1lOiBzdHJpbmddOiAoKG0pID0+IGFueSlbXSB9ID0ge307XG5cbi8vIFRoaXMgaXMgYW4gaW1wb3J0YW50IGZ1bmN0aW9uLlxuLy8gRklYTUUuIEl0IHdvdWxkIGJlIG1vcmUgdHlwZS1zYWZlIGlmIHRoZSBmaXJzdCBhcmd1bWVudCB3aGVyZSBhbiBhcnJheSBvZiBzdHJpbmdzLlxuLy8gV2hhdCBpcyB0aGUgdHlwZSBvZiB0aGUgbW9kdWxlIHJldHVybmVkIGJ5IHRoZSByZXF1aXJlIGZ1bmN0aW9uP1xuLy8gV2UncmUgYWN0dWFsbHkgZ29pbmcgdG8gaW5zZXJ0IGEgc2NyaXB0IHRhZy5cbmV4cG9ydCBmdW5jdGlvbiBsb2FkTW9kdWxlKHdoYXQ6IHN0cmluZyB8IHN0cmluZ1tdLCBvbkxvYWQ6IChtKSA9PiBhbnksIGRvYzogRG9jdW1lbnQgPSBkb2N1bWVudCkge1xuICAgIHZhciBtb2R1bGU7XG4gICAgdmFyIG1vZHVsZU5hbWU6IHN0cmluZztcbiAgICB2YXIgbW9kdWxlVHlwZTogc3RyaW5nO1xuICAgIGlmIChBcnJheS5pc0FycmF5KHdoYXQpKSB7XG4gICAgICAgIG1vZHVsZVR5cGUgPSB3aGF0WzBdO1xuICAgICAgICBtb2R1bGVOYW1lID0gd2hhdFsxXTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG1vZHVsZU5hbWUgPSB3aGF0O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIC8vIEZJWE1FOiBXaGF0IGRvZXMgdGhpcyBkbz9cbiAgICAgICAgLy8gbW9kdWxlID0gcmVxdWlyZShtb2R1bGVOYW1lKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfVxuICAgIC8vIHJlcXVpcmUobW9kdWxlTmFtZSkgY2FuIHJldHVybiBlbXB0eSBvYmplY3QgaWYgY2FsbGVkIGFmdGVyIHJlcXVpcmUoW21vZHVsZU5hbWVdLCBjYWxsYmFjaylcbiAgICBpZiAobW9kdWxlICYmICEkbG9hZGluZ1ttb2R1bGVOYW1lXSlcbiAgICAgICAgcmV0dXJuIG9uTG9hZCAmJiBvbkxvYWQobW9kdWxlKTtcblxuICAgIGlmICghJGxvYWRpbmdbbW9kdWxlTmFtZV0pIHtcbiAgICAgICAgJGxvYWRpbmdbbW9kdWxlTmFtZV0gPSBbXTtcbiAgICB9XG5cbiAgICAkbG9hZGluZ1ttb2R1bGVOYW1lXS5wdXNoKG9uTG9hZCk7XG5cbiAgICBpZiAoJGxvYWRpbmdbbW9kdWxlTmFtZV0ubGVuZ3RoID4gMSlcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgdmFyIGFmdGVyTG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBGSVhNRTogUmUtaW5zdGF0ZVxuICAgICAgICAvKlxuICAgICAgICByZXF1aXJlKFttb2R1bGVOYW1lXSwgZnVuY3Rpb24obW9kdWxlKSB7XG4gICAgICAgICAgICBleHBvcnRzLl9lbWl0KFwibG9hZC5tb2R1bGVcIiwgeyBuYW1lOiBtb2R1bGVOYW1lLCBtb2R1bGU6IG1vZHVsZSB9KTtcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBBIGxvY2FsIGNvcHkgb2YgYWxsIHRoZSBsaXN0ZW5lcnMgd2hvIHdhbnQgdG8gaGVhciB3aGVuIHRoZSBtb2R1bGUgaGFzIGxvYWRlZC5cbiAgICAgICAgICAgIC8vIFdlIG1ha2UgYSBsb2NhbCBjb3B5IGJlY2F1c2Ugd2UgYXJlIGdvaW5nIHRvIGNsZWFyIHRoZSBlbnRyeSBmb3IgdGhlIG1vZHVsZS5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICB2YXIgbGlzdGVuZXJzID0gJGxvYWRpbmdbbW9kdWxlTmFtZV07XG4gICAgICAgICAgICAkbG9hZGluZ1ttb2R1bGVOYW1lXSA9IG51bGw7XG4gICAgICAgICAgICBsaXN0ZW5lcnMuZm9yRWFjaChmdW5jdGlvbihvbkxvYWQpIHtcbiAgICAgICAgICAgICAgICBvbkxvYWQgJiYgb25Mb2FkKG1vZHVsZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgICovXG4gICAgfTtcblxuICAgIC8vIFdoYXQgaXMgdGhpcyBzcGVjaWFsIG5hbWU/XG4gICAgaWYgKCFnZXQoXCJwYWNrYWdlZFwiKSkge1xuICAgICAgICByZXR1cm4gYWZ0ZXJMb2FkKCk7XG4gICAgfVxuXG4gICAgLy8gRGVsZWdhdGUgdGhlIGxvYWRpbmcgb2YgdGhlIHNjcmlwdCBidXQgaG9vayB0aGUgbm90aWZpY2F0aW9uLlxuICAgIGxvYWRTY3JpcHQobW9kdWxlVXJsKG1vZHVsZU5hbWUsIG1vZHVsZVR5cGUpLCBhZnRlckxvYWQsIGRvYyk7XG59XG5cblxuLy8gaW5pdGlhbGl6YXRpb25cbmRlY2xhcmUgdmFyIG1vZHVsZTogYW55O1xuLyoqXG4gKiBXaG8gY2FsbHMgdGhpcyBmdW5jdGlvbj9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluaXQocGFja2FnZWQ6IGJvb2xlYW4pIHtcbiAgICAvLyBGSVhNRTogUmVzdG9yZSByZXF1aXJlIG9mICdwYWNrYWdlZCcgYW5kIGRlZmluZS5cbiAgICBvcHRpb25zLnBhY2thZ2VkID0gcGFja2FnZWQgLyp8fCByZXF1aXJlWydwYWNrYWdlZCddKi8gfHwgbW9kdWxlLnBhY2thZ2VkIC8qfHwgKGdsb2JhbC5kZWZpbmUgJiYgZGVmaW5lWydwYWNrYWdlZCddKSovO1xuXG4gICAgaWYgKCFnbG9iYWwuZG9jdW1lbnQpXG4gICAgICAgIHJldHVybiBcIlwiO1xuXG4gICAgdmFyIHNjcmlwdE9wdGlvbnM6IHsgW25hbWU6IHN0cmluZ106IGFueSB9ID0ge307XG4gICAgdmFyIHNjcmlwdFVybCA9IFwiXCI7XG5cbiAgICAvLyBVc2UgY3VycmVudFNjcmlwdC5vd25lckRvY3VtZW50IGluIGNhc2UgdGhpcyBmaWxlIHdhcyBsb2FkZWQgZnJvbSBpbXBvcnRlZCBkb2N1bWVudC4gKEhUTUwgSW1wb3J0cylcbiAgICB2YXIgY3VycmVudFNjcmlwdDogSFRNTFNjcmlwdEVsZW1lbnQgPSAoZG9jdW1lbnRbJ2N1cnJlbnRTY3JpcHQnXSB8fCBkb2N1bWVudFsnX2N1cnJlbnRTY3JpcHQnXSk7IC8vIG5hdGl2ZSBvciBwb2x5ZmlsbFxuICAgIHZhciBjdXJyZW50RG9jdW1lbnQgPSBjdXJyZW50U2NyaXB0ICYmIGN1cnJlbnRTY3JpcHQub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudDtcblxuICAgIHZhciBzY3JpcHRzOiBOb2RlTGlzdE9mPEhUTUxTY3JpcHRFbGVtZW50PiA9IGN1cnJlbnREb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNjcmlwdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHNjcmlwdCA9IHNjcmlwdHNbaV07XG5cbiAgICAgICAgdmFyIHNyYyA9IHNjcmlwdC5zcmMgfHwgc2NyaXB0LmdldEF0dHJpYnV0ZShcInNyY1wiKTtcbiAgICAgICAgaWYgKCFzcmMpXG4gICAgICAgICAgICBjb250aW51ZTtcblxuICAgICAgICB2YXIgYXR0cmlidXRlczogTmFtZWROb2RlTWFwID0gc2NyaXB0LmF0dHJpYnV0ZXM7XG4gICAgICAgIGZvciAodmFyIGogPSAwLCBsID0gYXR0cmlidXRlcy5sZW5ndGg7IGogPCBsOyBqKyspIHtcbiAgICAgICAgICAgIHZhciBhdHRyOiBBdHRyID0gYXR0cmlidXRlc1tqXTtcbiAgICAgICAgICAgIGlmIChhdHRyLm5hbWUuaW5kZXhPZihcImRhdGEtYWNlLVwiKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHNjcmlwdE9wdGlvbnNbZGVIeXBoZW5hdGUoYXR0ci5uYW1lLnJlcGxhY2UoL15kYXRhLWFjZS0vLCBcIlwiKSldID0gYXR0ci52YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBtOiBSZWdFeHBNYXRjaEFycmF5ID0gc3JjLm1hdGNoKC9eKC4qKVxcL2FjZShcXC1cXHcrKT9cXC5qcyhcXD98JCkvKTtcbiAgICAgICAgaWYgKG0pIHtcbiAgICAgICAgICAgIHNjcmlwdFVybCA9IG1bMV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoc2NyaXB0VXJsKSB7XG4gICAgICAgIHNjcmlwdE9wdGlvbnNbJ2Jhc2UnXSA9IHNjcmlwdE9wdGlvbnNbJ2Jhc2UnXSB8fCBzY3JpcHRVcmw7XG4gICAgICAgIHNjcmlwdE9wdGlvbnNbJ3BhY2thZ2VkJ10gPSB0cnVlO1xuICAgIH1cblxuICAgIHNjcmlwdE9wdGlvbnNbJ2Jhc2VQYXRoJ10gPSBzY3JpcHRPcHRpb25zWydiYXNlJ107XG4gICAgc2NyaXB0T3B0aW9uc1snd29ya2VyUGF0aCddID0gc2NyaXB0T3B0aW9uc1snd29ya2VyUGF0aCddIHx8IHNjcmlwdE9wdGlvbnNbJ2Jhc2UnXTtcbiAgICBzY3JpcHRPcHRpb25zWydtb2RlUGF0aCddID0gc2NyaXB0T3B0aW9uc1snbW9kZVBhdGgnXSB8fCBzY3JpcHRPcHRpb25zWydiYXNlJ107XG4gICAgc2NyaXB0T3B0aW9uc1sndGhlbWVQYXRoJ10gPSBzY3JpcHRPcHRpb25zWyd0aGVtZVBhdGgnXSB8fCBzY3JpcHRPcHRpb25zWydiYXNlJ107XG4gICAgZGVsZXRlIHNjcmlwdE9wdGlvbnNbJ2Jhc2UnXTtcblxuICAgIGZvciAodmFyIGtleSBpbiBzY3JpcHRPcHRpb25zKVxuICAgICAgICBpZiAodHlwZW9mIHNjcmlwdE9wdGlvbnNba2V5XSAhPT0gXCJ1bmRlZmluZWRcIilcbiAgICAgICAgICAgIHNldChrZXksIHNjcmlwdE9wdGlvbnNba2V5XSk7XG59O1xuXG5mdW5jdGlvbiBkZUh5cGhlbmF0ZShzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC8tKC4pL2csIGZ1bmN0aW9uKG06IHN0cmluZywgbTE6IHN0cmluZykgeyByZXR1cm4gbTEudG9VcHBlckNhc2UoKTsgfSk7XG59XG5cbi8vIEZJWE1FOiBNYWtlIHRoaXMgYW4gT3B0aW9uc1Byb3ZpZGVyTWl4SW5cbnZhciBvcHRpb25zUHJvdmlkZXIgPSB7XG4gICAgc2V0T3B0aW9uczogZnVuY3Rpb24ob3B0TGlzdCkge1xuICAgICAgICBPYmplY3Qua2V5cyhvcHRMaXN0KS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICAgICAgdGhpcy5zZXRPcHRpb24oa2V5LCBvcHRMaXN0W2tleV0pO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9LFxuICAgIGdldE9wdGlvbnM6IGZ1bmN0aW9uKG9wdGlvbk5hbWVzKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICAgICAgaWYgKCFvcHRpb25OYW1lcykge1xuICAgICAgICAgICAgb3B0aW9uTmFtZXMgPSBPYmplY3Qua2V5cyh0aGlzLiRvcHRpb25zKTtcbiAgICAgICAgfSBlbHNlIGlmICghQXJyYXkuaXNBcnJheShvcHRpb25OYW1lcykpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IG9wdGlvbk5hbWVzO1xuICAgICAgICAgICAgb3B0aW9uTmFtZXMgPSBPYmplY3Qua2V5cyhyZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIG9wdGlvbk5hbWVzLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgICAgICByZXN1bHRba2V5XSA9IHRoaXMuZ2V0T3B0aW9uKGtleSk7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG4gICAgc2V0T3B0aW9uOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgICBpZiAodGhpc1tcIiRcIiArIG5hbWVdID09PSB2YWx1ZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdmFyIG9wdCA9IHRoaXMuJG9wdGlvbnNbbmFtZV07XG4gICAgICAgIGlmICghb3B0KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT0gXCJ1bmRlZmluZWRcIiAmJiBjb25zb2xlLndhcm4pXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdtaXNzcGVsbGVkIG9wdGlvbiBcIicgKyBuYW1lICsgJ1wiJyk7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHQuZm9yd2FyZFRvKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNbb3B0LmZvcndhcmRUb10gJiYgdGhpc1tvcHQuZm9yd2FyZFRvXS5zZXRPcHRpb24obmFtZSwgdmFsdWUpO1xuXG4gICAgICAgIGlmICghb3B0LmhhbmRsZXNTZXQpXG4gICAgICAgICAgICB0aGlzW1wiJFwiICsgbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgaWYgKG9wdCAmJiBvcHQuc2V0KVxuICAgICAgICAgICAgb3B0LnNldC5jYWxsKHRoaXMsIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldE9wdGlvbjogZnVuY3Rpb24obmFtZSkge1xuICAgICAgICB2YXIgb3B0ID0gdGhpcy4kb3B0aW9uc1tuYW1lXTtcbiAgICAgICAgaWYgKCFvcHQpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPSBcInVuZGVmaW5lZFwiICYmIGNvbnNvbGUud2FybilcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ21pc3NwZWxsZWQgb3B0aW9uIFwiJyArIG5hbWUgKyAnXCInKTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdC5mb3J3YXJkVG8pXG4gICAgICAgICAgICByZXR1cm4gdGhpc1tvcHQuZm9yd2FyZFRvXSAmJiB0aGlzW29wdC5mb3J3YXJkVG9dLmdldE9wdGlvbihuYW1lKTtcbiAgICAgICAgcmV0dXJuIG9wdCAmJiBvcHQuZ2V0ID8gb3B0LmdldC5jYWxsKHRoaXMpIDogdGhpc1tcIiRcIiArIG5hbWVdO1xuICAgIH1cbn07XG5cbnZhciBkZWZhdWx0T3B0aW9ucyA9IHt9O1xuLypcbiAqIG9wdGlvbiB7bmFtZSwgdmFsdWUsIGluaXRpYWxWYWx1ZSwgc2V0dGVyTmFtZSwgc2V0LCBnZXQgfVxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVmaW5lT3B0aW9ucyhvYmosIHBhdGg6IHN0cmluZywgb3B0aW9ucykge1xuICAgIGlmICghb2JqLiRvcHRpb25zKSB7XG4gICAgICAgIGRlZmF1bHRPcHRpb25zW3BhdGhdID0gb2JqLiRvcHRpb25zID0ge307XG4gICAgfVxuXG4gICAgT2JqZWN0LmtleXMob3B0aW9ucykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgdmFyIG9wdCA9IG9wdGlvbnNba2V5XTtcbiAgICAgICAgaWYgKHR5cGVvZiBvcHQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIG9wdCA9IHsgZm9yd2FyZFRvOiBvcHQgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9wdC5uYW1lIHx8IChvcHQubmFtZSA9IGtleSk7XG4gICAgICAgIG9iai4kb3B0aW9uc1tvcHQubmFtZV0gPSBvcHQ7XG4gICAgICAgIGlmIChcImluaXRpYWxWYWx1ZVwiIGluIG9wdCkge1xuICAgICAgICAgICAgb2JqW1wiJFwiICsgb3B0Lm5hbWVdID0gb3B0LmluaXRpYWxWYWx1ZTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gaW1wbGVtZW50IG9wdGlvbiBwcm92aWRlciBpbnRlcmZhY2VcbiAgICBpbXBsZW1lbnQob2JqLCBvcHRpb25zUHJvdmlkZXIpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXNldE9wdGlvbnMob2JqKSB7XG4gICAgT2JqZWN0LmtleXMob2JqLiRvcHRpb25zKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICB2YXIgb3B0ID0gb2JqLiRvcHRpb25zW2tleV07XG4gICAgICAgIGlmIChcInZhbHVlXCIgaW4gb3B0KSB7XG4gICAgICAgICAgICBvYmouc2V0T3B0aW9uKGtleSwgb3B0LnZhbHVlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0RGVmYXVsdFZhbHVlKHBhdGgsIG5hbWUsIHZhbHVlKSB7XG4gICAgdmFyIG9wdHMgPSBkZWZhdWx0T3B0aW9uc1twYXRoXSB8fCAoZGVmYXVsdE9wdGlvbnNbcGF0aF0gPSB7fSk7XG4gICAgaWYgKG9wdHNbbmFtZV0pIHtcbiAgICAgICAgaWYgKG9wdHMuZm9yd2FyZFRvKVxuICAgICAgICAgICAgc2V0RGVmYXVsdFZhbHVlKG9wdHMuZm9yd2FyZFRvLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG9wdHNbbmFtZV0udmFsdWUgPSB2YWx1ZTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXREZWZhdWx0VmFsdWVzKHBhdGgsIG9wdGlvbkhhc2gpIHtcbiAgICBPYmplY3Qua2V5cyhvcHRpb25IYXNoKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICBzZXREZWZhdWx0VmFsdWUocGF0aCwga2V5LCBvcHRpb25IYXNoW2tleV0pO1xuICAgIH0pO1xufVxuIl19