"use strict";
import { decodeEventType, getDistance, INPUT_START, INPUT_MOVE, INPUT_END, INPUT_CANCEL, Recognizer, STATE_BEGAN, STATE_FAILED, STATE_RECOGNIZED, TOUCH_ACTION_MANIPULATION } from '../hammer';
import { setTimeoutContext } from '../utils';
function isCorrectTouchCount(input) {
    switch (input.eventType) {
        case INPUT_START:
            {
                return input.touchesLength === 1;
            }
            break;
        case INPUT_MOVE:
            {
                return input.touchesLength === 1;
            }
            break;
        case INPUT_END:
            {
                return input.touchesLength === 0;
            }
            break;
        case INPUT_CANCEL:
            {
                return true;
            }
            break;
        default: {
            throw new Error(decodeEventType(input.eventType));
        }
    }
}
export class TapRecognizer extends Recognizer {
    constructor(eventName, enabled) {
        super(eventName ? eventName : 'tap', enabled);
        this.count = 0;
        this.taps = 1;
        this.pointers = 1;
        this.time = 250;
        this.threshold = 6;
        this.interval = 300;
        this.posThreshold = 10;
    }
    getTouchAction() {
        return [TOUCH_ACTION_MANIPULATION];
    }
    process(input) {
        this.reset();
        if (!isCorrectTouchCount(input)) {
            return STATE_FAILED;
        }
        if ((input.eventType & INPUT_START) && (this.count === 0)) {
            this.center = input.center;
            return this.failTimeout();
        }
        if (input.distance >= this.threshold) {
            return STATE_FAILED;
        }
        if (input.deltaTime >= this.time) {
            return STATE_FAILED;
        }
        if (input.eventType !== INPUT_END) {
            this.center = input.center;
            return this.failTimeout();
        }
        else {
        }
        var validInterval = this.pTime ? (input.timeStamp - this.pTime < this.interval) : true;
        var validMultiTap = !this.pCenter || getDistance(this.pCenter, input.center) < this.posThreshold;
        this.pTime = input.timeStamp;
        this.pCenter = input.center;
        if (!validMultiTap || !validInterval) {
            this.count = 1;
        }
        else {
            this.count += 1;
        }
        var tapCount = this.count % this.taps;
        if (tapCount === 0) {
            if (!this.hasRequireFailures()) {
                return STATE_RECOGNIZED;
            }
            else {
                this._timer = setTimeoutContext(function () {
                    this.state = STATE_RECOGNIZED;
                    this.tryEmit();
                }, this.interval, this);
                return STATE_BEGAN;
            }
        }
        return STATE_FAILED;
    }
    failTimeout() {
        this._timer = setTimeoutContext(function () {
            this.state = STATE_FAILED;
        }, this.interval, this);
        return STATE_FAILED;
    }
    reset() {
        clearTimeout(this._timer);
    }
    emit() {
        if (this.state === STATE_RECOGNIZED) {
            this.manager.emit(this.eventName, this.center);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidGFwLnRzIl0sIm5hbWVzIjpbImlzQ29ycmVjdFRvdWNoQ291bnQiLCJUYXBSZWNvZ25pemVyIiwiVGFwUmVjb2duaXplci5jb25zdHJ1Y3RvciIsIlRhcFJlY29nbml6ZXIuZ2V0VG91Y2hBY3Rpb24iLCJUYXBSZWNvZ25pemVyLnByb2Nlc3MiLCJUYXBSZWNvZ25pemVyLmZhaWxUaW1lb3V0IiwiVGFwUmVjb2duaXplci5yZXNldCIsIlRhcFJlY29nbml6ZXIuZW1pdCJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO09BRU4sRUFFUCxlQUFlLEVBQ2YsV0FBVyxFQUVYLFdBQVcsRUFDWCxVQUFVLEVBQ1YsU0FBUyxFQUNULFlBQVksRUFDWixVQUFVLEVBQ1YsV0FBVyxFQUNYLFlBQVksRUFDWixnQkFBZ0IsRUFDaEIseUJBQXlCLEVBQ3hCLE1BQU0sV0FBVztPQUNYLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxVQUFVO0FBRTFDLDZCQUE2QixLQUFxQjtJQUM5Q0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdEJBLEtBQUtBLFdBQVdBO1lBQUVBLENBQUNBO2dCQUNmQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxhQUFhQSxLQUFLQSxDQUFDQSxDQUFDQTtZQUNyQ0EsQ0FBQ0E7WUFDR0EsS0FBS0EsQ0FBQ0E7UUFDVkEsS0FBS0EsVUFBVUE7WUFBRUEsQ0FBQ0E7Z0JBQ2RBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLGFBQWFBLEtBQUtBLENBQUNBLENBQUNBO1lBQ3JDQSxDQUFDQTtZQUNHQSxLQUFLQSxDQUFDQTtRQUNWQSxLQUFLQSxTQUFTQTtZQUFFQSxDQUFDQTtnQkFDYkEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsYUFBYUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFDckNBLENBQUNBO1lBQ0dBLEtBQUtBLENBQUNBO1FBQ1ZBLEtBQUtBLFlBQVlBO1lBQUVBLENBQUNBO2dCQUNoQkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7WUFDaEJBLENBQUNBO1lBQ0dBLEtBQUtBLENBQUNBO1FBQ1ZBLFNBQVNBLENBQUNBO1lBQ05BLE1BQU1BLElBQUlBLEtBQUtBLENBQUNBLGVBQWVBLENBQUNBLEtBQUtBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1FBQ3REQSxDQUFDQTtJQUNMQSxDQUFDQTtBQUNMQSxDQUFDQTtBQUVELG1DQUFtQyxVQUFVO0lBZXpDQyxZQUFZQSxTQUFpQkEsRUFBRUEsT0FBZ0JBO1FBQzNDQyxNQUFNQSxTQUFTQSxHQUFHQSxTQUFTQSxHQUFHQSxLQUFLQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFDQTtRQVQxQ0EsVUFBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDVkEsU0FBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDVEEsYUFBUUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDYkEsU0FBSUEsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDWEEsY0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDZEEsYUFBUUEsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZkEsaUJBQVlBLEdBQUdBLEVBQUVBLENBQUNBO0lBSTFCQSxDQUFDQTtJQUNERCxjQUFjQTtRQUNWRSxNQUFNQSxDQUFDQSxDQUFDQSx5QkFBeUJBLENBQUNBLENBQUNBO0lBQ3ZDQSxDQUFDQTtJQUNERixPQUFPQSxDQUFDQSxLQUFxQkE7UUFFekJHLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBO1FBRWJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDOUJBLE1BQU1BLENBQUNBLFlBQVlBLENBQUNBO1FBQ3hCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxTQUFTQSxHQUFHQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN4REEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDM0JBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBO1FBQzlCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxRQUFRQSxJQUFJQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNuQ0EsTUFBTUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7UUFDeEJBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLFNBQVNBLElBQUlBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQy9CQSxNQUFNQSxDQUFDQSxZQUFZQSxDQUFDQTtRQUN4QkEsQ0FBQ0E7UUFHREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsS0FBS0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDaENBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBO1lBQzNCQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQTtRQUM5QkEsQ0FBQ0E7UUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFFTkEsQ0FBQ0E7UUFFREEsSUFBSUEsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDdkZBLElBQUlBLGFBQWFBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLElBQUlBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLEVBQUVBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBO1FBRWpHQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxTQUFTQSxDQUFDQTtRQUM3QkEsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFFNUJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLGFBQWFBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLENBQUNBO1lBQ25DQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNuQkEsQ0FBQ0E7UUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDRkEsSUFBSUEsQ0FBQ0EsS0FBS0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDcEJBLENBQUNBO1FBSURBLElBQUlBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO1FBQ3RDQSxFQUFFQSxDQUFDQSxDQUFDQSxRQUFRQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUdqQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDN0JBLE1BQU1BLENBQUNBLGdCQUFnQkEsQ0FBQ0E7WUFDNUJBLENBQUNBO1lBQ0RBLElBQUlBLENBQUNBLENBQUNBO2dCQUNGQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxpQkFBaUJBLENBQUNBO29CQUM1QixJQUFJLENBQUMsS0FBSyxHQUFHLGdCQUFnQixDQUFDO29CQUM5QixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ25CLENBQUMsRUFBRUEsSUFBSUEsQ0FBQ0EsUUFBUUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ3hCQSxNQUFNQSxDQUFDQSxXQUFXQSxDQUFDQTtZQUN2QkEsQ0FBQ0E7UUFDTEEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7SUFDeEJBLENBQUNBO0lBRURILFdBQVdBO1FBQ1BJLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLGlCQUFpQkEsQ0FBQ0E7WUFDNUIsSUFBSSxDQUFDLEtBQUssR0FBRyxZQUFZLENBQUM7UUFDOUIsQ0FBQyxFQUFFQSxJQUFJQSxDQUFDQSxRQUFRQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUN4QkEsTUFBTUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7SUFDeEJBLENBQUNBO0lBRURKLEtBQUtBO1FBQ0RLLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO0lBQzlCQSxDQUFDQTtJQUVETCxJQUFJQTtRQUNBTSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxLQUFLQSxnQkFBZ0JBLENBQUNBLENBQUNBLENBQUNBO1lBQ2xDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxFQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUNuREEsQ0FBQ0E7SUFDTEEsQ0FBQ0E7QUFDTE4sQ0FBQ0E7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQge1xuQ2xpZW50TG9jYXRpb24sXG5kZWNvZGVFdmVudFR5cGUsXG5nZXREaXN0YW5jZSxcbklDb21wdXRlZEV2ZW50LFxuSU5QVVRfU1RBUlQsXG5JTlBVVF9NT1ZFLFxuSU5QVVRfRU5ELFxuSU5QVVRfQ0FOQ0VMLFxuUmVjb2duaXplcixcblNUQVRFX0JFR0FOLFxuU1RBVEVfRkFJTEVELFxuU1RBVEVfUkVDT0dOSVpFRCxcblRPVUNIX0FDVElPTl9NQU5JUFVMQVRJT05cbn0gZnJvbSAnLi4vaGFtbWVyJztcbmltcG9ydCB7c2V0VGltZW91dENvbnRleHR9IGZyb20gJy4uL3V0aWxzJztcblxuZnVuY3Rpb24gaXNDb3JyZWN0VG91Y2hDb3VudChpbnB1dDogSUNvbXB1dGVkRXZlbnQpOiBib29sZWFuIHtcbiAgICBzd2l0Y2ggKGlucHV0LmV2ZW50VHlwZSkge1xuICAgICAgICBjYXNlIElOUFVUX1NUQVJUOiB7XG4gICAgICAgICAgICByZXR1cm4gaW5wdXQudG91Y2hlc0xlbmd0aCA9PT0gMTtcbiAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgSU5QVVRfTU9WRToge1xuICAgICAgICAgICAgcmV0dXJuIGlucHV0LnRvdWNoZXNMZW5ndGggPT09IDE7XG4gICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIElOUFVUX0VORDoge1xuICAgICAgICAgICAgcmV0dXJuIGlucHV0LnRvdWNoZXNMZW5ndGggPT09IDA7XG4gICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIElOUFVUX0NBTkNFTDoge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZGVjb2RlRXZlbnRUeXBlKGlucHV0LmV2ZW50VHlwZSkpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgVGFwUmVjb2duaXplciBleHRlbmRzIFJlY29nbml6ZXIge1xuICAgIC8vIHByZXZpb3VzIHRpbWUgYW5kIGNlbnRlcixcbiAgICAvLyB1c2VkIGZvciB0YXAgY291bnRpbmdcbiAgICBwcml2YXRlIHBUaW1lOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBwQ2VudGVyOiBDbGllbnRMb2NhdGlvbjtcbiAgICBwcml2YXRlIF90aW1lcjtcbiAgICAvL3ByaXZhdGUgX2lucHV0OiBJQ29tcHV0ZWRFdmVudDtcbiAgICBwcml2YXRlIGNvdW50ID0gMDtcbiAgICBwcml2YXRlIHRhcHMgPSAxO1xuICAgIHByaXZhdGUgcG9pbnRlcnMgPSAxO1xuICAgIHByaXZhdGUgdGltZSA9IDI1MDsgLy8gbWF4IHRpbWUgb2YgdGhlIHBvaW50ZXIgdG8gYmUgZG93biAobGlrZSBmaW5nZXIgb24gdGhlIHNjcmVlbilcbiAgICBwcml2YXRlIHRocmVzaG9sZCA9IDY7IC8vIGEgbWluaW1hbCBtb3ZlbWVudCBpcyBvaywgYnV0IGtlZXAgaXQgbG93XG4gICAgcHJpdmF0ZSBpbnRlcnZhbCA9IDMwMDsgLy8gbWF4IHRpbWUgYmV0d2VlbiB0aGUgbXVsdGktdGFwIHRhcHNcbiAgICBwcml2YXRlIHBvc1RocmVzaG9sZCA9IDEwOyAvLyBhIG11bHRpLXRhcCBjYW4gYmUgYSBiaXQgb2ZmIHRoZSBpbml0aWFsIHBvc2l0aW9uXG4gICAgcHJpdmF0ZSBjZW50ZXI6IENsaWVudExvY2F0aW9uO1xuICAgIGNvbnN0cnVjdG9yKGV2ZW50TmFtZTogc3RyaW5nLCBlbmFibGVkOiBib29sZWFuKSB7XG4gICAgICAgIHN1cGVyKGV2ZW50TmFtZSA/IGV2ZW50TmFtZSA6ICd0YXAnLCBlbmFibGVkKTtcbiAgICB9XG4gICAgZ2V0VG91Y2hBY3Rpb24oKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gW1RPVUNIX0FDVElPTl9NQU5JUFVMQVRJT05dO1xuICAgIH1cbiAgICBwcm9jZXNzKGlucHV0OiBJQ29tcHV0ZWRFdmVudCk6IG51bWJlciB7XG5cbiAgICAgICAgdGhpcy5yZXNldCgpO1xuXG4gICAgICAgIGlmICghaXNDb3JyZWN0VG91Y2hDb3VudChpbnB1dCkpIHtcbiAgICAgICAgICAgIHJldHVybiBTVEFURV9GQUlMRUQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoKGlucHV0LmV2ZW50VHlwZSAmIElOUFVUX1NUQVJUKSAmJiAodGhpcy5jb3VudCA9PT0gMCkpIHtcbiAgICAgICAgICAgIHRoaXMuY2VudGVyID0gaW5wdXQuY2VudGVyO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmFpbFRpbWVvdXQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpbnB1dC5kaXN0YW5jZSA+PSB0aGlzLnRocmVzaG9sZCkge1xuICAgICAgICAgICAgcmV0dXJuIFNUQVRFX0ZBSUxFRDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpbnB1dC5kZWx0YVRpbWUgPj0gdGhpcy50aW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gU1RBVEVfRkFJTEVEO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYW5kIHdlJ3ZlIHJlYWNoZWQgYW4gZW5kIGV2ZW50LCBzbyBhIHRhcCBpcyBwb3NzaWJsZVxuICAgICAgICBpZiAoaW5wdXQuZXZlbnRUeXBlICE9PSBJTlBVVF9FTkQpIHtcbiAgICAgICAgICAgIHRoaXMuY2VudGVyID0gaW5wdXQuY2VudGVyO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmFpbFRpbWVvdXQoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIFdlIGFyZSBpbiB0aGUgZW5kIHN0YXRlIHNvIHRoZXJlIHdpbGwgYmUgbm8gdG91Y2hlcy5cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciB2YWxpZEludGVydmFsID0gdGhpcy5wVGltZSA/IChpbnB1dC50aW1lU3RhbXAgLSB0aGlzLnBUaW1lIDwgdGhpcy5pbnRlcnZhbCkgOiB0cnVlO1xuICAgICAgICB2YXIgdmFsaWRNdWx0aVRhcCA9ICF0aGlzLnBDZW50ZXIgfHwgZ2V0RGlzdGFuY2UodGhpcy5wQ2VudGVyLCBpbnB1dC5jZW50ZXIpIDwgdGhpcy5wb3NUaHJlc2hvbGQ7XG5cbiAgICAgICAgdGhpcy5wVGltZSA9IGlucHV0LnRpbWVTdGFtcDtcbiAgICAgICAgdGhpcy5wQ2VudGVyID0gaW5wdXQuY2VudGVyO1xuXG4gICAgICAgIGlmICghdmFsaWRNdWx0aVRhcCB8fCAhdmFsaWRJbnRlcnZhbCkge1xuICAgICAgICAgICAgdGhpcy5jb3VudCA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNvdW50ICs9IDE7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiB0YXAgY291bnQgbWF0Y2hlcyB3ZSBoYXZlIHJlY29nbml6ZWQgaXQsXG4gICAgICAgIC8vIGVsc2UgaXQgaGFzIGJlZ2FuIHJlY29nbml6aW5nLi4uXG4gICAgICAgIHZhciB0YXBDb3VudCA9IHRoaXMuY291bnQgJSB0aGlzLnRhcHM7XG4gICAgICAgIGlmICh0YXBDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgLy8gbm8gZmFpbGluZyByZXF1aXJlbWVudHMsIGltbWVkaWF0ZWx5IHRyaWdnZXIgdGhlIHRhcCBldmVudFxuICAgICAgICAgICAgLy8gb3Igd2FpdCBhcyBsb25nIGFzIHRoZSBtdWx0aXRhcCBpbnRlcnZhbCB0byB0cmlnZ2VyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaGFzUmVxdWlyZUZhaWx1cmVzKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gU1RBVEVfUkVDT0dOSVpFRDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RpbWVyID0gc2V0VGltZW91dENvbnRleHQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBTVEFURV9SRUNPR05JWkVEO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyeUVtaXQoKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzLmludGVydmFsLCB0aGlzKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gU1RBVEVfQkVHQU47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFNUQVRFX0ZBSUxFRDtcbiAgICB9XG5cbiAgICBmYWlsVGltZW91dCgpIHtcbiAgICAgICAgdGhpcy5fdGltZXIgPSBzZXRUaW1lb3V0Q29udGV4dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBTVEFURV9GQUlMRUQ7XG4gICAgICAgIH0sIHRoaXMuaW50ZXJ2YWwsIHRoaXMpO1xuICAgICAgICByZXR1cm4gU1RBVEVfRkFJTEVEO1xuICAgIH1cblxuICAgIHJlc2V0KCkge1xuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fdGltZXIpO1xuICAgIH1cblxuICAgIGVtaXQoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlID09PSBTVEFURV9SRUNPR05JWkVEKSB7XG4gICAgICAgICAgICB0aGlzLm1hbmFnZXIuZW1pdCh0aGlzLmV2ZW50TmFtZSwgdGhpcy5jZW50ZXIpO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19