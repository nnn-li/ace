"use strict";
import Anchor from './Anchor';
import EventEmitterClass from './lib/EventEmitterClass';
import Range from './Range';
var $split = (function () {
    function foo(text) {
        return text.replace(/\r\n|\r/g, "\n").split("\n");
    }
    function bar(text) {
        return text.split(/\r\n|\r|\n/);
    }
    if ("aaa".split(/a/).length === 0) {
        return foo;
    }
    else {
        return bar;
    }
})();
function $clipPosition(doc, position) {
    var length = doc.getLength();
    if (position.row >= length) {
        position.row = Math.max(0, length - 1);
        position.column = doc.getLine(length - 1).length;
    }
    else if (position.row < 0) {
        position.row = 0;
    }
    return position;
}
export default class Document {
    constructor(text) {
        this.$lines = [];
        this.$autoNewLine = "";
        this.$newLineMode = "auto";
        this.eventBus = new EventEmitterClass(this);
        if (text.length === 0) {
            this.$lines = [""];
        }
        else if (Array.isArray(text)) {
            this._insertLines(0, text);
        }
        else {
            this.insert({ row: 0, column: 0 }, text);
        }
    }
    setValue(text) {
        var len = this.getLength();
        this.remove(new Range(0, 0, len, this.getLine(len - 1).length));
        this.insert({ row: 0, column: 0 }, text);
    }
    getValue() {
        return this.getAllLines().join(this.getNewLineCharacter());
    }
    createAnchor(row, column) {
        return new Anchor(this, row, column);
    }
    $detectNewLine(text) {
        var match = text.match(/^.*?(\r\n|\r|\n)/m);
        this.$autoNewLine = match ? match[1] : "\n";
        this.eventBus._signal("changeNewLineMode");
    }
    getNewLineCharacter() {
        switch (this.$newLineMode) {
            case "windows":
                return "\r\n";
            case "unix":
                return "\n";
            default:
                return this.$autoNewLine || "\n";
        }
    }
    setNewLineMode(newLineMode) {
        if (this.$newLineMode === newLineMode) {
            return;
        }
        this.$newLineMode = newLineMode;
        this.eventBus._signal("changeNewLineMode");
    }
    getNewLineMode() {
        return this.$newLineMode;
    }
    isNewLine(text) {
        return (text == "\r\n" || text == "\r" || text == "\n");
    }
    getLine(row) {
        return this.$lines[row] || "";
    }
    getLines(firstRow, lastRow) {
        return this.$lines.slice(firstRow, lastRow + 1);
    }
    getAllLines() {
        return this.getLines(0, this.getLength());
    }
    getLength() {
        return this.$lines.length;
    }
    getTextRange(range) {
        if (range.start.row === range.end.row) {
            return this.getLine(range.start.row).substring(range.start.column, range.end.column);
        }
        var lines = this.getLines(range.start.row, range.end.row);
        lines[0] = (lines[0] || "").substring(range.start.column);
        var l = lines.length - 1;
        if (range.end.row - range.start.row == l) {
            lines[l] = lines[l].substring(0, range.end.column);
        }
        return lines.join(this.getNewLineCharacter());
    }
    insert(position, text) {
        if (!text || text.length === 0) {
            return position;
        }
        position = $clipPosition(this, position);
        if (this.getLength() <= 1) {
            this.$detectNewLine(text);
        }
        var lines = $split(text);
        var firstLine = lines.splice(0, 1)[0];
        var lastLine = lines.length == 0 ? null : lines.splice(lines.length - 1, 1)[0];
        position = this.insertInLine(position, firstLine);
        if (lastLine !== null) {
            position = this.insertNewLine(position);
            position = this._insertLines(position.row, lines);
            position = this.insertInLine(position, lastLine || "");
        }
        return position;
    }
    insertLines(row, lines) {
        if (row >= this.getLength())
            return this.insert({ row: row, column: 0 }, "\n" + lines.join("\n"));
        return this._insertLines(Math.max(row, 0), lines);
    }
    _insertLines(row, lines) {
        if (lines.length == 0)
            return { row: row, column: 0 };
        while (lines.length > 0xF000) {
            var end = this._insertLines(row, lines.slice(0, 0xF000));
            lines = lines.slice(0xF000);
            row = end.row;
        }
        var args = [row, 0];
        args.push.apply(args, lines);
        this.$lines.splice.apply(this.$lines, args);
        var range = new Range(row, 0, row + lines.length, 0);
        var delta = {
            action: "insertLines",
            range: range,
            lines: lines
        };
        this.eventBus._signal("change", { data: delta });
        return range.end;
    }
    insertNewLine(position) {
        position = $clipPosition(this, position);
        var line = this.$lines[position.row] || "";
        this.$lines[position.row] = line.substring(0, position.column);
        this.$lines.splice(position.row + 1, 0, line.substring(position.column, line.length));
        var end = {
            row: position.row + 1,
            column: 0
        };
        var delta = {
            action: "insertText",
            range: Range.fromPoints(position, end),
            text: this.getNewLineCharacter()
        };
        this.eventBus._signal("change", { data: delta });
        return end;
    }
    insertInLine(position, text) {
        if (text.length === 0) {
            return position;
        }
        var line = this.$lines[position.row] || "";
        this.$lines[position.row] = line.substring(0, position.column) + text + line.substring(position.column);
        var end = {
            row: position.row,
            column: position.column + text.length
        };
        var delta = { action: "insertText", range: Range.fromPoints(position, end), text: text };
        this.eventBus._signal("change", { data: delta });
        return end;
    }
    on(eventName, callback) {
        this.eventBus.on(eventName, callback, false);
    }
    off(eventName, callback) {
        this.eventBus.off(eventName, callback);
    }
    remove(range) {
        if (!(range instanceof Range)) {
            range = Range.fromPoints(range.start, range.end);
        }
        range.start = $clipPosition(this, range.start);
        range.end = $clipPosition(this, range.end);
        if (range.isEmpty())
            return range.start;
        var firstRow = range.start.row;
        var lastRow = range.end.row;
        if (range.isMultiLine()) {
            var firstFullRow = range.start.column == 0 ? firstRow : firstRow + 1;
            var lastFullRow = lastRow - 1;
            if (range.end.column > 0)
                this.removeInLine(lastRow, 0, range.end.column);
            if (lastFullRow >= firstFullRow)
                this._removeLines(firstFullRow, lastFullRow);
            if (firstFullRow != firstRow) {
                this.removeInLine(firstRow, range.start.column, this.getLine(firstRow).length);
                this.removeNewLine(range.start.row);
            }
        }
        else {
            this.removeInLine(firstRow, range.start.column, range.end.column);
        }
        return range.start;
    }
    removeInLine(row, startColumn, endColumn) {
        if (startColumn === endColumn)
            return;
        var range = new Range(row, startColumn, row, endColumn);
        var line = this.getLine(row);
        var removed = line.substring(startColumn, endColumn);
        var newLine = line.substring(0, startColumn) + line.substring(endColumn, line.length);
        this.$lines.splice(row, 1, newLine);
        var delta = {
            action: "removeText",
            range: range,
            text: removed
        };
        this.eventBus._signal("change", { data: delta });
        return range.start;
    }
    removeLines(firstRow, lastRow) {
        if (firstRow < 0 || lastRow >= this.getLength()) {
            throw new Error("Document.removeLines");
        }
        return this._removeLines(firstRow, lastRow);
    }
    _removeLines(firstRow, lastRow) {
        var range = new Range(firstRow, 0, lastRow + 1, 0);
        var removed = this.$lines.splice(firstRow, lastRow - firstRow + 1);
        var delta = {
            action: "removeLines",
            range: range,
            nl: this.getNewLineCharacter(),
            lines: removed
        };
        this.eventBus._signal("change", { data: delta });
        return removed;
    }
    removeNewLine(row) {
        var firstLine = this.getLine(row);
        var secondLine = this.getLine(row + 1);
        var range = new Range(row, firstLine.length, row + 1, 0);
        var line = firstLine + secondLine;
        this.$lines.splice(row, 2, line);
        var delta = {
            action: "removeText",
            range: range,
            text: this.getNewLineCharacter()
        };
        this.eventBus._signal("change", { data: delta });
    }
    replace(range, text) {
        if (text.length === 0 && range.isEmpty()) {
            return range.start;
        }
        if (text === this.getTextRange(range)) {
            return range.end;
        }
        this.remove(range);
        if (text) {
            var end = this.insert(range.start, text);
        }
        else {
            end = range.start;
        }
        return end;
    }
    applyDeltas(deltas) {
        for (var i = 0; i < deltas.length; i++) {
            var delta = deltas[i];
            var range = Range.fromPoints(delta.range.start, delta.range.end);
            if (delta.action == "insertLines")
                this.insertLines(range.start.row, delta.lines);
            else if (delta.action == "insertText")
                this.insert(range.start, delta.text);
            else if (delta.action == "removeLines")
                this._removeLines(range.start.row, range.end.row - 1);
            else if (delta.action == "removeText")
                this.remove(range);
        }
    }
    revertDeltas(deltas) {
        for (var i = deltas.length - 1; i >= 0; i--) {
            var delta = deltas[i];
            var range = Range.fromPoints(delta.range.start, delta.range.end);
            if (delta.action == "insertLines")
                this._removeLines(range.start.row, range.end.row - 1);
            else if (delta.action == "insertText")
                this.remove(range);
            else if (delta.action == "removeLines")
                this._insertLines(range.start.row, delta.lines);
            else if (delta.action == "removeText")
                this.insert(range.start, delta.text);
        }
    }
    indexToPosition(index, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        for (var i = startRow || 0, l = lines.length; i < l; i++) {
            index -= lines[i].length + newlineLength;
            if (index < 0)
                return { row: i, column: index + lines[i].length + newlineLength };
        }
        return { row: l - 1, column: lines[l - 1].length };
    }
    positionToIndex(pos, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        var index = 0;
        var row = Math.min(pos.row, lines.length);
        for (var i = startRow || 0; i < row; ++i)
            index += lines[i].length + newlineLength;
        return index + pos.column;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRG9jdW1lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJEb2N1bWVudC50cyJdLCJuYW1lcyI6WyJmb28iLCJiYXIiLCIkY2xpcFBvc2l0aW9uIiwiRG9jdW1lbnQiLCJEb2N1bWVudC5jb25zdHJ1Y3RvciIsIkRvY3VtZW50LnNldFZhbHVlIiwiRG9jdW1lbnQuZ2V0VmFsdWUiLCJEb2N1bWVudC5jcmVhdGVBbmNob3IiLCJEb2N1bWVudC4kZGV0ZWN0TmV3TGluZSIsIkRvY3VtZW50LmdldE5ld0xpbmVDaGFyYWN0ZXIiLCJEb2N1bWVudC5zZXROZXdMaW5lTW9kZSIsIkRvY3VtZW50LmdldE5ld0xpbmVNb2RlIiwiRG9jdW1lbnQuaXNOZXdMaW5lIiwiRG9jdW1lbnQuZ2V0TGluZSIsIkRvY3VtZW50LmdldExpbmVzIiwiRG9jdW1lbnQuZ2V0QWxsTGluZXMiLCJEb2N1bWVudC5nZXRMZW5ndGgiLCJEb2N1bWVudC5nZXRUZXh0UmFuZ2UiLCJEb2N1bWVudC5pbnNlcnQiLCJEb2N1bWVudC5pbnNlcnRMaW5lcyIsIkRvY3VtZW50Ll9pbnNlcnRMaW5lcyIsIkRvY3VtZW50Lmluc2VydE5ld0xpbmUiLCJEb2N1bWVudC5pbnNlcnRJbkxpbmUiLCJEb2N1bWVudC5vbiIsIkRvY3VtZW50Lm9mZiIsIkRvY3VtZW50LnJlbW92ZSIsIkRvY3VtZW50LnJlbW92ZUluTGluZSIsIkRvY3VtZW50LnJlbW92ZUxpbmVzIiwiRG9jdW1lbnQuX3JlbW92ZUxpbmVzIiwiRG9jdW1lbnQucmVtb3ZlTmV3TGluZSIsIkRvY3VtZW50LnJlcGxhY2UiLCJEb2N1bWVudC5hcHBseURlbHRhcyIsIkRvY3VtZW50LnJldmVydERlbHRhcyIsIkRvY3VtZW50LmluZGV4VG9Qb3NpdGlvbiIsIkRvY3VtZW50LnBvc2l0aW9uVG9JbmRleCJdLCJtYXBwaW5ncyI6IkFBb0RBLFlBQVksQ0FBQztPQUVOLE1BQU0sTUFBTSxVQUFVO09BR3RCLGlCQUFpQixNQUFNLHlCQUF5QjtP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QUFDQSxDQUFDQTtJQUM5Q0EsQ0FBQ0E7SUFRRFosU0FBU0E7UUFDTGEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7SUFDOUJBLENBQUNBO0lBU0RiLFlBQVlBLENBQUNBLEtBQVlBO1FBQ3JCYyxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxLQUFLQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNwQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDekZBLENBQUNBO1FBQ0RBLElBQUlBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQzFEQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxDQUFDQSxTQUFTQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUMxREEsSUFBSUEsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDekJBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3ZDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUN2REEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxDQUFDQSxDQUFDQTtJQUNsREEsQ0FBQ0E7SUFVRGQsTUFBTUEsQ0FBQ0EsUUFBa0JBLEVBQUVBLElBQVlBO1FBQ25DZSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxJQUFJQSxJQUFJQSxDQUFDQSxNQUFNQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3QkEsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0E7UUFDcEJBLENBQUNBO1FBRURBLFFBQVFBLEdBQUdBLGFBQWFBLENBQUNBLElBQUlBLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO1FBR3pDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN4QkEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDOUJBLENBQUNBO1FBRURBLElBQUlBLEtBQUtBLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ3pCQSxJQUFJQSxTQUFTQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN0Q0EsSUFBSUEsUUFBUUEsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsQ0FBQ0EsR0FBR0EsSUFBSUEsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFL0VBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFFBQVFBLEVBQUVBLFNBQVNBLENBQUNBLENBQUNBO1FBQ2xEQSxFQUFFQSxDQUFDQSxDQUFDQSxRQUFRQSxLQUFLQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNwQkEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7WUFDeENBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1lBQ2xEQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxRQUFRQSxFQUFFQSxRQUFRQSxJQUFJQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUMzREEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0E7SUFDcEJBLENBQUNBO0lBMENEZixXQUFXQSxDQUFDQSxHQUFXQSxFQUFFQSxLQUFlQTtRQUNwQ2dCLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLElBQUlBLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBO1lBQ3hCQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxFQUFFQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6RUEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7SUFDdERBLENBQUNBO0lBRU9oQixZQUFZQSxDQUFDQSxHQUFXQSxFQUFFQSxLQUFlQTtRQUM3Q2lCLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLElBQUlBLENBQUNBLENBQUNBO1lBQ2xCQSxNQUFNQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxFQUFFQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUluQ0EsT0FBT0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsTUFBTUEsRUFBRUEsQ0FBQ0E7WUFDM0JBLElBQUlBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLEVBQUVBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1lBQ3pEQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtZQUM1QkEsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7UUFDbEJBLENBQUNBO1FBRURBLElBQUlBLElBQUlBLEdBQUdBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ3BCQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUM3QkEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFFNUNBLElBQUlBLEtBQUtBLEdBQUdBLElBQUlBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ3JEQSxJQUFJQSxLQUFLQSxHQUFHQTtZQUNSQSxNQUFNQSxFQUFFQSxhQUFhQTtZQUNyQkEsS0FBS0EsRUFBRUEsS0FBS0E7WUFDWkEsS0FBS0EsRUFBRUEsS0FBS0E7U0FDZkEsQ0FBQ0E7UUFLRkEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsRUFBRUEsSUFBSUEsRUFBRUEsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDakRBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBO0lBQ3JCQSxDQUFDQTtJQWFEakIsYUFBYUEsQ0FBQ0EsUUFBa0JBO1FBQzVCa0IsUUFBUUEsR0FBR0EsYUFBYUEsQ0FBQ0EsSUFBSUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFDekNBLElBQUlBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBO1FBRTNDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxRQUFRQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUMvREEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFdEZBLElBQUlBLEdBQUdBLEdBQWFBO1lBQ2hCQSxHQUFHQSxFQUFFQSxRQUFRQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtZQUNyQkEsTUFBTUEsRUFBRUEsQ0FBQ0E7U0FDWkEsQ0FBQ0E7UUFFRkEsSUFBSUEsS0FBS0EsR0FBR0E7WUFDUkEsTUFBTUEsRUFBRUEsWUFBWUE7WUFDcEJBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLFVBQVVBLENBQUNBLFFBQVFBLEVBQUVBLEdBQUdBLENBQUNBO1lBQ3RDQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEVBQUVBO1NBQ25DQSxDQUFDQTtRQU1GQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxPQUFPQSxDQUFDQSxRQUFRQSxFQUFFQSxFQUFFQSxJQUFJQSxFQUFFQSxLQUFLQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUVqREEsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7SUFDZkEsQ0FBQ0E7SUFXRGxCLFlBQVlBLENBQUNBLFFBQWtCQSxFQUFFQSxJQUFZQTtRQUV6Q21CLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3BCQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQTtRQUNwQkEsQ0FBQ0E7UUFFREEsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0E7UUFFM0NBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLEVBQUVBLFFBQVFBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBRXhHQSxJQUFJQSxHQUFHQSxHQUFhQTtZQUNoQkEsR0FBR0EsRUFBRUEsUUFBUUEsQ0FBQ0EsR0FBR0E7WUFDakJBLE1BQU1BLEVBQUVBLFFBQVFBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BO1NBQ3hDQSxDQUFDQTtRQUVGQSxJQUFJQSxLQUFLQSxHQUFVQSxFQUFFQSxNQUFNQSxFQUFFQSxZQUFZQSxFQUFFQSxLQUFLQSxFQUFFQSxLQUFLQSxDQUFDQSxVQUFVQSxDQUFDQSxRQUFRQSxFQUFFQSxHQUFHQSxDQUFDQSxFQUFFQSxJQUFJQSxFQUFFQSxJQUFJQSxFQUFFQSxDQUFDQTtRQU1oR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsRUFBRUEsSUFBSUEsRUFBRUEsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFFakRBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBO0lBQ2ZBLENBQUNBO0lBUURuQixFQUFFQSxDQUFDQSxTQUFpQkEsRUFBRUEsUUFBK0NBO1FBQ2pFb0IsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsU0FBU0EsRUFBRUEsUUFBUUEsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7SUFDakRBLENBQUNBO0lBUURwQixHQUFHQSxDQUFDQSxTQUFpQkEsRUFBRUEsUUFBK0NBO1FBQ2xFcUIsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsU0FBU0EsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7SUFDM0NBLENBQUNBO0lBVURyQixNQUFNQSxDQUFDQSxLQUFZQTtRQUNmc0IsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsWUFBWUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDNUJBLEtBQUtBLEdBQUdBLEtBQUtBLENBQUNBLFVBQVVBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3JEQSxDQUFDQTtRQUVEQSxLQUFLQSxDQUFDQSxLQUFLQSxHQUFHQSxhQUFhQSxDQUFDQSxJQUFJQSxFQUFFQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUMvQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsR0FBR0EsYUFBYUEsQ0FBQ0EsSUFBSUEsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFM0NBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBO1lBQ2hCQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUV2QkEsSUFBSUEsUUFBUUEsR0FBR0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7UUFDL0JBLElBQUlBLE9BQU9BLEdBQUdBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBO1FBRTVCQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN0QkEsSUFBSUEsWUFBWUEsR0FBR0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsQ0FBQ0EsR0FBR0EsUUFBUUEsR0FBR0EsUUFBUUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDckVBLElBQUlBLFdBQVdBLEdBQUdBLE9BQU9BLEdBQUdBLENBQUNBLENBQUNBO1lBRTlCQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDckJBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBLEVBQUVBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1lBRXBEQSxFQUFFQSxDQUFDQSxDQUFDQSxXQUFXQSxJQUFJQSxZQUFZQSxDQUFDQTtnQkFDNUJBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFlBQVlBLEVBQUVBLFdBQVdBLENBQUNBLENBQUNBO1lBRWpEQSxFQUFFQSxDQUFDQSxDQUFDQSxZQUFZQSxJQUFJQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDM0JBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFFBQVFBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO2dCQUMvRUEsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDeENBLENBQUNBO1FBQ0xBLENBQUNBO1FBQ0RBLElBQUlBLENBQUNBLENBQUNBO1lBQ0ZBLElBQUlBLENBQUNBLFlBQVlB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S0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDdkJBLENBQUNBO1FBSURBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLEtBQUtBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3BDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQTtRQUNyQkEsQ0FBQ0E7UUFFREEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFFbkJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQ1BBLElBQUlBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1FBQzdDQSxDQUFDQTtRQUNEQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNGQSxHQUFHQSxHQUFHQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUN0QkEsQ0FBQ0E7UUFFREEsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7SUFDZkEsQ0FBQ0E7SUFVRDNCLFdBQVdBLENBQUNBLE1BQWVBO1FBQ3ZCNEIsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDckNBLElBQUlBLEtBQUtBLEdBQUdBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3RCQSxJQUFJQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxVQUFVQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxFQUFFQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUVqRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsYUFBYUEsQ0FBQ0E7Z0JBQzlCQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtZQUNuREEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsWUFBWUEsQ0FBQ0E7Z0JBQ2xDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxFQUFFQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUN6Q0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsYUFBYUEsQ0FBQ0E7Z0JBQ25DQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMxREEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsWUFBWUEsQ0FBQ0E7Z0JBQ2xDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFVRDVCLFlBQVlBLENBQUNBLE1BQWVBO1FBQ3hCNkIsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDMUNBLElBQUlBLEtBQUtBLEdBQUdBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBRXRCQSxJQUFJQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxVQUFVQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxFQUFFQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUVqRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsYUFBYUEsQ0FBQ0E7Z0JBQzlCQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMxREEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsWUFBWUEsQ0FBQ0E7Z0JBQ2xDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtZQUN2QkEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsYUFBYUEsQ0FBQ0E7Z0JBQ25DQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtZQUNwREEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsWUFBWUEsQ0FBQ0E7Z0JBQ2xDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxFQUFFQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUM3Q0EsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFtQkQ3QixlQUFlQSxDQUFDQSxLQUFhQSxFQUFFQSxRQUFnQkE7UUFDM0M4QixJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxJQUFJQSxJQUFJQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQTtRQUM5Q0EsSUFBSUEsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUN0REEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsUUFBUUEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDdkRBLEtBQUtBLElBQUlBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLEdBQUdBLGFBQWFBLENBQUNBO1lBQ3pDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDVkEsTUFBTUEsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsRUFBRUEsTUFBTUEsRUFBRUEsS0FBS0EsR0FBR0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsYUFBYUEsRUFBRUEsQ0FBQ0E7UUFDM0VBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLE1BQU1BLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO0lBQ3ZEQSxDQUFDQTtJQW1CRDlCLGVBQWVBLENBQUNBLEdBQWFBLEVBQUVBLFFBQWdCQTtRQUMzQytCLElBQUlBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLElBQUlBLElBQUlBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBO1FBQzlDQSxJQUFJQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEVBQUVBLENBQUNBLE1BQU1BLENBQUNBO1FBQ3REQSxJQUFJQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNkQSxJQUFJQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxFQUFFQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUMxQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsUUFBUUEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDcENBLEtBQUtBLElBQUlBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLEdBQUdBLGFBQWFBLENBQUNBO1FBRTdDQSxNQUFNQSxDQUFDQSxLQUFLQSxHQUFHQSxHQUFHQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUM5QkEsQ0FBQ0E7QUFDTC9CLENBQUNBO0FBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiAqKioqKiBCRUdJTiBMSUNFTlNFIEJMT0NLICoqKioqXG4gKiBUaGUgTUlUIExpY2Vuc2UgKE1JVClcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTQtMjAxNiBEYXZpZCBHZW8gSG9sbWVzIDxkYXZpZC5nZW8uaG9sbWVzQGdtYWlsLmNvbT5cbiAqXG4gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4gKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4gKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4gKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4gKlxuICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG4gKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuICpcbiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcbiAqIFNPRlRXQVJFLlxuICogKioqKiogRU5EIExJQ0VOU0UgQkxPQ0sgKioqKiogKi9cbi8qICoqKioqIEJFR0lOIExJQ0VOU0UgQkxPQ0sgKioqKipcbiAqIERpc3RyaWJ1dGVkIHVuZGVyIHRoZSBCU0QgbGljZW5zZTpcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTAsIEFqYXgub3JnIEIuVi5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBcbiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dFxuICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLlxuICogICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGVcbiAqICAgICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG4gKiAgICAgKiBOZWl0aGVyIHRoZSBuYW1lIG9mIEFqYXgub3JnIEIuVi4gbm9yIHRoZVxuICogICAgICAgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHNcbiAqICAgICAgIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLlxuICogXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkRcbiAqIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEXG4gKiBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFXG4gKiBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBBSkFYLk9SRyBCLlYuIEJFIExJQUJMRSBGT1IgQU5ZXG4gKiBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFU1xuICogKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTO1xuICogTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EXG4gKiBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVNcbiAqIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICpcbiAqICoqKioqIEVORCBMSUNFTlNFIEJMT0NLICoqKioqICovXG5cInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IEFuY2hvciBmcm9tICcuL0FuY2hvcic7XG5pbXBvcnQgRGVsdGEgZnJvbSAnLi9EZWx0YSc7XG5pbXBvcnQgRXZlbnRCdXMgZnJvbSAnLi9FdmVudEJ1cyc7XG5pbXBvcnQgRXZlbnRFbWl0dGVyQ2xhc3MgZnJvbSAnLi9saWIvRXZlbnRFbWl0dGVyQ2xhc3MnO1xuaW1wb3J0IFBvc2l0aW9uIGZyb20gJy4vUG9zaXRpb24nO1xuaW1wb3J0IFJhbmdlIGZyb20gJy4vUmFuZ2UnO1xuXG52YXIgJHNwbGl0OiAodGV4dDogc3RyaW5nKSA9PiBzdHJpbmdbXSA9IChmdW5jdGlvbigpIHtcbiAgICBmdW5jdGlvbiBmb28odGV4dDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9cXHJcXG58XFxyL2csIFwiXFxuXCIpLnNwbGl0KFwiXFxuXCIpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBiYXIodGV4dDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGV4dC5zcGxpdCgvXFxyXFxufFxccnxcXG4vKTtcbiAgICB9XG4gICAgLy8gRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIHNwbGl0IGZ1bmN0aW9uIHBlcmZvcm1zIGFzIHdlIGV4cGVjdC5cbiAgICAvLyBIZXJlIHdlIGF0dGVtcHQgdG8gc2VwYXJhdGUgYSBzdHJpbmcgb2YgdGhyZWUgc2VwYXJhdG9ycy5cbiAgICAvLyBJZiBhbGwgd29ya3Mgb3V0LCB3ZSBzaG91bGQgZ2V0IGJhY2sgYW4gYXJyYXkgb2YgZm91ciAoNCkgZW1wdHkgc3RyaW5ncy5cbiAgICBpZiAoXCJhYWFcIi5zcGxpdCgvYS8pLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gZm9vO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gSW4gQ2hyb21lLCB0aGlzIGlzIHRoZSBtYWlubGluZSBiZWNhdXNlIHRoZSByZXN1bHRcbiAgICAgICAgLy8gb2YgdGhlIHRlc3QgY29uZGl0aW9uIGxlbmd0aCBpcyA0LlxuICAgICAgICByZXR1cm4gYmFyO1xuICAgIH1cbn0pKCk7XG5cbmZ1bmN0aW9uICRjbGlwUG9zaXRpb24oZG9jOiBEb2N1bWVudCwgcG9zaXRpb246IFBvc2l0aW9uKTogUG9zaXRpb24ge1xuICAgIHZhciBsZW5ndGggPSBkb2MuZ2V0TGVuZ3RoKCk7XG4gICAgaWYgKHBvc2l0aW9uLnJvdyA+PSBsZW5ndGgpIHtcbiAgICAgICAgcG9zaXRpb24ucm93ID0gTWF0aC5tYXgoMCwgbGVuZ3RoIC0gMSk7XG4gICAgICAgIHBvc2l0aW9uLmNvbHVtbiA9IGRvYy5nZXRMaW5lKGxlbmd0aCAtIDEpLmxlbmd0aDtcbiAgICB9XG4gICAgZWxzZSBpZiAocG9zaXRpb24ucm93IDwgMCkge1xuICAgICAgICBwb3NpdGlvbi5yb3cgPSAwO1xuICAgIH1cbiAgICByZXR1cm4gcG9zaXRpb247XG59XG5cbi8qKlxuICogQGNsYXNzIERvY3VtZW50XG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERvY3VtZW50IGltcGxlbWVudHMgRXZlbnRCdXM8RG9jdW1lbnQ+IHtcblxuICAgIC8qKlxuICAgICAqIEBwcm9wZXJ0eSAkbGluZXNcbiAgICAgKiBAdHlwZSBzdHJpbmdbXVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSAkbGluZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICAvKipcbiAgICAgKiBAcHJvcGVydCAkYXV0b05ld0xpbmVcbiAgICAgKiBAdHlwZSBzdHJpbmdcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgJGF1dG9OZXdMaW5lOiBzdHJpbmcgPSBcIlwiO1xuXG4gICAgLyoqXG4gICAgICogQHByb3BlcnR5ICRuZXdMaW5lTW9kZVxuICAgICAqIEB0eXBlIHN0cmluZ1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSAkbmV3TGluZU1vZGU6IHN0cmluZyA9IFwiYXV0b1wiO1xuXG4gICAgLyoqXG4gICAgICogQHByb3BlcnR5IGV2ZW50QnVzXG4gICAgICogQHR5cGUgRXZlbnRFbWl0dGVyQ2xhc3NcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgZXZlbnRCdXM6IEV2ZW50RW1pdHRlckNsYXNzPERvY3VtZW50PjtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgRG9jdW1lbnQuXG4gICAgICogSWYgdGV4dCBpcyBpbmNsdWRlZCwgdGhlIERvY3VtZW50IGNvbnRhaW5zIHRob3NlIHN0cmluZ3M7IG90aGVyd2lzZSwgaXQncyBlbXB0eS5cbiAgICAgKlxuICAgICAqIEBjbGFzcyBEb2N1bWVudFxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSB0ZXh0IHtzdHJpbmcgfCBBcnJheTxzdHJpbmc+fVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHRleHQ6IHN0cmluZyB8IEFycmF5PHN0cmluZz4pIHtcblxuICAgICAgICB0aGlzLmV2ZW50QnVzID0gbmV3IEV2ZW50RW1pdHRlckNsYXNzPERvY3VtZW50Pih0aGlzKTtcblxuICAgICAgICAvLyBUaGVyZSBoYXMgdG8gYmUgb25lIGxpbmUgYXQgbGVhc3QgaW4gdGhlIGRvY3VtZW50LiBJZiB5b3UgcGFzcyBhbiBlbXB0eVxuICAgICAgICAvLyBzdHJpbmcgdG8gdGhlIGluc2VydCBmdW5jdGlvbiwgbm90aGluZyB3aWxsIGhhcHBlbi4gV29ya2Fyb3VuZC5cbiAgICAgICAgaWYgKHRleHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLiRsaW5lcyA9IFtcIlwiXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KHRleHQpKSB7XG4gICAgICAgICAgICB0aGlzLl9pbnNlcnRMaW5lcygwLCB0ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHsgcm93OiAwLCBjb2x1bW46IDAgfSwgdGV4dCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXBsYWNlcyBhbGwgdGhlIGxpbmVzIGluIHRoZSBjdXJyZW50IGBEb2N1bWVudGAgd2l0aCB0aGUgdmFsdWUgb2YgYHRleHRgLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBzZXRWYWx1ZVxuICAgICAqIEBwYXJhbSB0ZXh0IHtzdHJpbmd9IFRoZSB0ZXh0IHRvIHVzZVxuICAgICAqIEByZXR1cm4ge3ZvaWR9XG4gICAgICovXG4gICAgc2V0VmFsdWUodGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHZhciBsZW4gPSB0aGlzLmdldExlbmd0aCgpO1xuICAgICAgICB0aGlzLnJlbW92ZShuZXcgUmFuZ2UoMCwgMCwgbGVuLCB0aGlzLmdldExpbmUobGVuIC0gMSkubGVuZ3RoKSk7XG4gICAgICAgIHRoaXMuaW5zZXJ0KHsgcm93OiAwLCBjb2x1bW46IDAgfSwgdGV4dCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbGwgdGhlIGxpbmVzIGluIHRoZSBkb2N1bWVudCBhcyBhIHNpbmdsZSBzdHJpbmcsIGpvaW5lZCBieSB0aGUgbmV3IGxpbmUgY2hhcmFjdGVyLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBnZXRWYWx1ZVxuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKi9cbiAgICBnZXRWYWx1ZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBbGxMaW5lcygpLmpvaW4odGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCkpO1xuICAgIH1cblxuICAgIC8qKiBcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGBBbmNob3JgIHRvIGRlZmluZSBhIGZsb2F0aW5nIHBvaW50IGluIHRoZSBkb2N1bWVudC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgY3JlYXRlQW5jaG9yXG4gICAgICogQHBhcmFtIHJvdyB7bnVtYmVyfSBUaGUgcm93IG51bWJlciB0byB1c2UuXG4gICAgICogQHBhcmFtIGNvbHVtbiB7bnVtYmVyfSBUaGUgY29sdW1uIG51bWJlciB0byB1c2UuXG4gICAgICogQHJldHVybiB7QW5jaG9yfVxuICAgICAqL1xuICAgIGNyZWF0ZUFuY2hvcihyb3c6IG51bWJlciwgY29sdW1uOiBudW1iZXIpOiBBbmNob3Ige1xuICAgICAgICByZXR1cm4gbmV3IEFuY2hvcih0aGlzLCByb3csIGNvbHVtbik7XG4gICAgfVxuXG4gICAgLyoqIFxuICAgICAqIERldGVybWluZXMgdGhlIG5ld2xpbmUgY2hhcmFjdGVyIHRoYXQgaXMgcHJlc2VudCBpbiB0aGUgcHJlc2VudGVkIHRleHRcbiAgICAgKiBhbmQgY2FjaGVzIHRoZSByZXN1bHQgaW4gJGF1dG9OZXdMaW5lLlxuICAgICAqXG4gICAgICogQG1ldGhvZCAkZGV0ZWN0TmV3TGluZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IFRoZSB0ZXh0IHRvIHdvcmsgd2l0aC5cbiAgICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSAkZGV0ZWN0TmV3TGluZSh0ZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdmFyIG1hdGNoID0gdGV4dC5tYXRjaCgvXi4qPyhcXHJcXG58XFxyfFxcbikvbSk7XG4gICAgICAgIHRoaXMuJGF1dG9OZXdMaW5lID0gbWF0Y2ggPyBtYXRjaFsxXSA6IFwiXFxuXCI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAZXZlbnQgY2hhbmdlTmV3TGluZU1vZGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXZlbnRCdXMuX3NpZ25hbChcImNoYW5nZU5ld0xpbmVNb2RlXCIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIG5ld2xpbmUgY2hhcmFjdGVyIHRoYXQncyBiZWluZyB1c2VkLCBkZXBlbmRpbmcgb24gdGhlIHZhbHVlIG9mIGBuZXdMaW5lTW9kZWAuXG4gICAgICogIElmIGBuZXdMaW5lTW9kZSA9PSB3aW5kb3dzYCwgYFxcclxcbmAgaXMgcmV0dXJuZWQuICBcbiAgICAgKiAgSWYgYG5ld0xpbmVNb2RlID09IHVuaXhgLCBgXFxuYCBpcyByZXR1cm5lZC4gIFxuICAgICAqICBJZiBgbmV3TGluZU1vZGUgPT0gYXV0b2AsIHRoZSB2YWx1ZSBvZiBgYXV0b05ld0xpbmVgIGlzIHJldHVybmVkLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBnZXROZXdMaW5lQ2hhcmFjdGVyXG4gICAgICogQHJldHVybiB7c3RyaW5nfVxuICAgICAqL1xuICAgIGdldE5ld0xpbmVDaGFyYWN0ZXIoKTogc3RyaW5nIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLiRuZXdMaW5lTW9kZSkge1xuICAgICAgICAgICAgY2FzZSBcIndpbmRvd3NcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJcXHJcXG5cIjtcbiAgICAgICAgICAgIGNhc2UgXCJ1bml4XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiXFxuXCI7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRhdXRvTmV3TGluZSB8fCBcIlxcblwiO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgbmV3IGxpbmUgbW9kZS5cbiAgICAgKlxuICAgICAqIEBtZXRob2Qgc2V0TmV3TGluZU1vZGVcbiAgICAgKiBAcGFyYW0gbmV3TGluZU1vZGUge3N0cmluZ30gVGhlIG5ld2xpbmUgbW9kZSB0byB1c2U7IGNhbiBiZSBlaXRoZXIgYHdpbmRvd3NgLCBgdW5peGAsIG9yIGBhdXRvYC5cbiAgICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgICAqL1xuICAgIHNldE5ld0xpbmVNb2RlKG5ld0xpbmVNb2RlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuJG5ld0xpbmVNb2RlID09PSBuZXdMaW5lTW9kZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuJG5ld0xpbmVNb2RlID0gbmV3TGluZU1vZGU7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAZXZlbnQgY2hhbmdlTmV3TGluZU1vZGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXZlbnRCdXMuX3NpZ25hbChcImNoYW5nZU5ld0xpbmVNb2RlXCIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHR5cGUgb2YgbmV3bGluZXMgYmVpbmcgdXNlZDsgZWl0aGVyIGB3aW5kb3dzYCwgYHVuaXhgLCBvciBgYXV0b2AuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGdldE5ld0xpbmVNb2RlXG4gICAgICogQHJldHVybiB7c3RyaW5nfVxuICAgICAqL1xuICAgIGdldE5ld0xpbmVNb2RlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLiRuZXdMaW5lTW9kZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGB0cnVlYCBpZiBgdGV4dGAgaXMgYSBuZXdsaW5lIGNoYXJhY3RlciAoZWl0aGVyIGBcXHJcXG5gLCBgXFxyYCwgb3IgYFxcbmApLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBpc05ld0xpbmVcbiAgICAgKiBAcGFyYW0gdGV4dCB7c3RyaW5nfSBUaGUgdGV4dCB0byBjaGVja1xuICAgICAqIEByZXR1cm4ge2Jvb2xlYW59XG4gICAgICovXG4gICAgaXNOZXdMaW5lKHRleHQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKHRleHQgPT0gXCJcXHJcXG5cIiB8fCB0ZXh0ID09IFwiXFxyXCIgfHwgdGV4dCA9PSBcIlxcblwiKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgdmVyYmF0aW0gY29weSBvZiB0aGUgZ2l2ZW4gbGluZSBhcyBpdCBpcyBpbiB0aGUgZG9jdW1lbnQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGdldExpbmVcbiAgICAgKiBAcGFyYW0gcm93IHtOdW1iZXJ9IFRoZSByb3cgaW5kZXggdG8gcmV0cmlldmUuXG4gICAgICogQHJldHVybiB7c3RyaW5nfVxuICAgICAqL1xuICAgIGdldExpbmUocm93OiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy4kbGluZXNbcm93XSB8fCBcIlwiO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYW4gYXJyYXkgb2Ygc3RyaW5ncyBvZiB0aGUgcm93cyBiZXR3ZWVuIGBmaXJzdFJvd2AgYW5kIGBsYXN0Um93YC5cbiAgICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGluY2x1c2l2ZSBvZiBgbGFzdFJvd2AuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGdldExpbmVzXG4gICAgICogQHBhcmFtIFtmaXJzdFJvd10ge251bWJlcn0gVGhlIGZpcnN0IHJvdyBpbmRleCB0byByZXRyaWV2ZVxuICAgICAqIEBwYXJhbSBbbGFzdFJvd10ge251bWJlcn0gVGhlIGZpbmFsIHJvdyBpbmRleCB0byByZXRyaWV2ZVxuICAgICAqIEByZXR1cm4ge3N0cmluZ1tdfVxuICAgICAqL1xuICAgIGdldExpbmVzKGZpcnN0Um93PzogbnVtYmVyLCBsYXN0Um93PzogbnVtYmVyKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGhpcy4kbGluZXMuc2xpY2UoZmlyc3RSb3csIGxhc3RSb3cgKyAxKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFsbCBsaW5lcyBpbiB0aGUgZG9jdW1lbnQgYXMgc3RyaW5nIGFycmF5LlxuICAgICAqXG4gICAgICogQG1ldGhvZCBnZXRBbGxMaW5lcygpXG4gICAgICogQHJldHVybiB7c3RyaW5nW119XG4gICAgICovXG4gICAgZ2V0QWxsTGluZXMoKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRMaW5lcygwLCB0aGlzLmdldExlbmd0aCgpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygcm93cyBpbiB0aGUgZG9jdW1lbnQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGdldExlbmd0aFxuICAgICAqIEByZXR1cm4ge251bWJlcn1cbiAgICAgKi9cbiAgICBnZXRMZW5ndGgoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGxpbmVzLmxlbmd0aDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHaXZlbiBhIHJhbmdlIHdpdGhpbiB0aGUgZG9jdW1lbnQsIHJldHVybnMgYWxsIHRoZSB0ZXh0IHdpdGhpbiB0aGF0IHJhbmdlIGFzIGEgc2luZ2xlIHN0cmluZy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgZ2V0VGV4dFJhbmdlXG4gICAgICogQHBhcmFtIHJhbmdlIHtSYW5nZX0gVGhlIHJhbmdlIHRvIHdvcmsgd2l0aC5cbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICovXG4gICAgZ2V0VGV4dFJhbmdlKHJhbmdlOiBSYW5nZSk6IHN0cmluZyB7XG4gICAgICAgIGlmIChyYW5nZS5zdGFydC5yb3cgPT09IHJhbmdlLmVuZC5yb3cpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldExpbmUocmFuZ2Uuc3RhcnQucm93KS5zdWJzdHJpbmcocmFuZ2Uuc3RhcnQuY29sdW1uLCByYW5nZS5lbmQuY29sdW1uKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbGluZXMgPSB0aGlzLmdldExpbmVzKHJhbmdlLnN0YXJ0LnJvdywgcmFuZ2UuZW5kLnJvdyk7XG4gICAgICAgIGxpbmVzWzBdID0gKGxpbmVzWzBdIHx8IFwiXCIpLnN1YnN0cmluZyhyYW5nZS5zdGFydC5jb2x1bW4pO1xuICAgICAgICB2YXIgbCA9IGxpbmVzLmxlbmd0aCAtIDE7XG4gICAgICAgIGlmIChyYW5nZS5lbmQucm93IC0gcmFuZ2Uuc3RhcnQucm93ID09IGwpIHtcbiAgICAgICAgICAgIGxpbmVzW2xdID0gbGluZXNbbF0uc3Vic3RyaW5nKDAsIHJhbmdlLmVuZC5jb2x1bW4pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsaW5lcy5qb2luKHRoaXMuZ2V0TmV3TGluZUNoYXJhY3RlcigpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbnNlcnRzIGEgYmxvY2sgb2YgYHRleHRgIGF0IHRoZSBpbmRpY2F0ZWQgYHBvc2l0aW9uYC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgaW5zZXJ0XG4gICAgICogQHBhcmFtIHBvc2l0aW9uIHtQb3NpdGlvbn0gVGhlIHBvc2l0aW9uIHRvIHN0YXJ0IGluc2VydGluZyBhdC5cbiAgICAgKiBAcGFyYW0gdGV4dCB7c3RyaW5nfSBBIGNodW5rIG9mIHRleHQgdG8gaW5zZXJ0LlxuICAgICAqIEByZXR1cm4ge1Bvc2l0aW9ufSBUaGUgcG9zaXRpb24gKHtyb3csIGNvbHVtbn0pIG9mIHRoZSBsYXN0IGxpbmUgb2YgYHRleHRgLiBJZiB0aGUgbGVuZ3RoIG9mIGB0ZXh0YCBpcyAwLCB0aGlzIGZ1bmN0aW9uIHNpbXBseSByZXR1cm5zIGBwb3NpdGlvbmAuIFxuICAgICAqL1xuICAgIGluc2VydChwb3NpdGlvbjogUG9zaXRpb24sIHRleHQ6IHN0cmluZyk6IFBvc2l0aW9uIHtcbiAgICAgICAgaWYgKCF0ZXh0IHx8IHRleHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb247XG4gICAgICAgIH1cblxuICAgICAgICBwb3NpdGlvbiA9ICRjbGlwUG9zaXRpb24odGhpcywgcG9zaXRpb24pO1xuXG4gICAgICAgIC8vIE9ubHkgZGV0ZWN0IG5ldyBsaW5lcyBpZiB0aGUgZG9jdW1lbnQgaGFzIG5vIGxpbmUgYnJlYWsgeWV0XG4gICAgICAgIGlmICh0aGlzLmdldExlbmd0aCgpIDw9IDEpIHtcbiAgICAgICAgICAgIHRoaXMuJGRldGVjdE5ld0xpbmUodGV4dCk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbGluZXMgPSAkc3BsaXQodGV4dCk7XG4gICAgICAgIHZhciBmaXJzdExpbmUgPSBsaW5lcy5zcGxpY2UoMCwgMSlbMF07XG4gICAgICAgIHZhciBsYXN0TGluZSA9IGxpbmVzLmxlbmd0aCA9PSAwID8gbnVsbCA6IGxpbmVzLnNwbGljZShsaW5lcy5sZW5ndGggLSAxLCAxKVswXTtcblxuICAgICAgICBwb3NpdGlvbiA9IHRoaXMuaW5zZXJ0SW5MaW5lKHBvc2l0aW9uLCBmaXJzdExpbmUpO1xuICAgICAgICBpZiAobGFzdExpbmUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHBvc2l0aW9uID0gdGhpcy5pbnNlcnROZXdMaW5lKHBvc2l0aW9uKTsgLy8gdGVybWluYXRlIGZpcnN0IGxpbmVcbiAgICAgICAgICAgIHBvc2l0aW9uID0gdGhpcy5faW5zZXJ0TGluZXMocG9zaXRpb24ucm93LCBsaW5lcyk7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IHRoaXMuaW5zZXJ0SW5MaW5lKHBvc2l0aW9uLCBsYXN0TGluZSB8fCBcIlwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcG9zaXRpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmlyZXMgd2hlbmV2ZXIgdGhlIGRvY3VtZW50IGNoYW5nZXMuXG4gICAgICpcbiAgICAgKiBTZXZlcmFsIG1ldGhvZHMgdHJpZ2dlciBkaWZmZXJlbnQgYFwiY2hhbmdlXCJgIGV2ZW50cy4gQmVsb3cgaXMgYSBsaXN0IG9mIGVhY2ggYWN0aW9uIHR5cGUsIGZvbGxvd2VkIGJ5IGVhY2ggcHJvcGVydHkgdGhhdCdzIGFsc28gYXZhaWxhYmxlOlxuICAgICAqXG4gICAgICogICogYFwiaW5zZXJ0TGluZXNcImAgKGVtaXR0ZWQgYnkgW1tEb2N1bWVudC5pbnNlcnRMaW5lc11dKVxuICAgICAqICAgICogYHJhbmdlYDogdGhlIFtbUmFuZ2VdXSBvZiB0aGUgY2hhbmdlIHdpdGhpbiB0aGUgZG9jdW1lbnRcbiAgICAgKiAgICAqIGBsaW5lc2A6IHRoZSBsaW5lcyBpbiB0aGUgZG9jdW1lbnQgdGhhdCBhcmUgY2hhbmdpbmdcbiAgICAgKiAgKiBgXCJpbnNlcnRUZXh0XCJgIChlbWl0dGVkIGJ5IFtbRG9jdW1lbnQuaW5zZXJ0TmV3TGluZV1dKVxuICAgICAqICAgICogYHJhbmdlYDogdGhlIFtbUmFuZ2VdXSBvZiB0aGUgY2hhbmdlIHdpdGhpbiB0aGUgZG9jdW1lbnRcbiAgICAgKiAgICAqIGB0ZXh0YDogdGhlIHRleHQgdGhhdCdzIGJlaW5nIGFkZGVkXG4gICAgICogICogYFwicmVtb3ZlTGluZXNcImAgKGVtaXR0ZWQgYnkgW1tEb2N1bWVudC5pbnNlcnRMaW5lc11dKVxuICAgICAqICAgICogYHJhbmdlYDogdGhlIFtbUmFuZ2VdXSBvZiB0aGUgY2hhbmdlIHdpdGhpbiB0aGUgZG9jdW1lbnRcbiAgICAgKiAgICAqIGBsaW5lc2A6IHRoZSBsaW5lcyBpbiB0aGUgZG9jdW1lbnQgdGhhdCB3ZXJlIHJlbW92ZWRcbiAgICAgKiAgICAqIGBubGA6IHRoZSBuZXcgbGluZSBjaGFyYWN0ZXIgKGFzIGRlZmluZWQgYnkgW1tEb2N1bWVudC5nZXROZXdMaW5lQ2hhcmFjdGVyXV0pXG4gICAgICogICogYFwicmVtb3ZlVGV4dFwiYCAoZW1pdHRlZCBieSBbW0RvY3VtZW50LnJlbW92ZUluTGluZV1dIGFuZCBbW0RvY3VtZW50LnJlbW92ZU5ld0xpbmVdXSlcbiAgICAgKiAgICAqIGByYW5nZWA6IHRoZSBbW1JhbmdlXV0gb2YgdGhlIGNoYW5nZSB3aXRoaW4gdGhlIGRvY3VtZW50XG4gICAgICogICAgKiBgdGV4dGA6IHRoZSB0ZXh0IHRoYXQncyBiZWluZyByZW1vdmVkXG4gICAgICpcbiAgICAgKiBAZXZlbnQgY2hhbmdlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGUgQ29udGFpbnMgYXQgbGVhc3Qgb25lIHByb3BlcnR5IGNhbGxlZCBgXCJhY3Rpb25cImAuIGBcImFjdGlvblwiYCBpbmRpY2F0ZXMgdGhlIGFjdGlvbiB0aGF0IHRyaWdnZXJlZCB0aGUgY2hhbmdlLiBFYWNoIGFjdGlvbiBhbHNvIGhhcyBhIHNldCBvZiBhZGRpdGlvbmFsIHByb3BlcnRpZXMuXG4gICAgICpcbiAgICAgKiovXG5cbiAgICAvKipcbiAgICAgKiBJbnNlcnRzIHRoZSBlbGVtZW50cyBpbiBgbGluZXNgIGludG8gdGhlIGRvY3VtZW50LCBzdGFydGluZyBhdCB0aGUgcm93IGluZGV4IGdpdmVuIGJ5IGByb3dgLlxuICAgICAqIFRoaXMgbWV0aG9kIGFsc28gdHJpZ2dlcnMgdGhlIGAnY2hhbmdlJ2AgZXZlbnQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGluc2VydExpbmVzXG4gICAgICogQHBhcmFtIHJvdyB7bnVtYmVyfSBUaGUgaW5kZXggb2YgdGhlIHJvdyB0byBpbnNlcnQgYXRcbiAgICAgKiBAcGFyYW0gbGluZXMge0FycmF5PHN0cmluZz59IEFuIGFycmF5IG9mIHN0cmluZ3NcbiAgICAgKiBAcmV0dXJuIHtQb3NpdGlvbn0gQ29udGFpbnMgdGhlIGZpbmFsIHJvdyBhbmQgY29sdW1uLCBsaWtlIHRoaXM6ICBcbiAgICAgKiAgIGBgYFxuICAgICAqICAge3JvdzogZW5kUm93LCBjb2x1bW46IDB9XG4gICAgICogICBgYGAgIFxuICAgICAqICAgSWYgYGxpbmVzYCBpcyBlbXB0eSwgdGhpcyBmdW5jdGlvbiByZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBjdXJyZW50IHJvdywgYW5kIGNvbHVtbiwgbGlrZSB0aGlzOiAgXG4gICAgICogICBgYGAgXG4gICAgICogICB7cm93OiByb3csIGNvbHVtbjogMH1cbiAgICAgKiAgIGBgYFxuICAgICAqL1xuICAgIGluc2VydExpbmVzKHJvdzogbnVtYmVyLCBsaW5lczogc3RyaW5nW10pOiBQb3NpdGlvbiB7XG4gICAgICAgIGlmIChyb3cgPj0gdGhpcy5nZXRMZW5ndGgoKSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluc2VydCh7IHJvdzogcm93LCBjb2x1bW46IDAgfSwgXCJcXG5cIiArIGxpbmVzLmpvaW4oXCJcXG5cIikpO1xuICAgICAgICByZXR1cm4gdGhpcy5faW5zZXJ0TGluZXMoTWF0aC5tYXgocm93LCAwKSwgbGluZXMpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2luc2VydExpbmVzKHJvdzogbnVtYmVyLCBsaW5lczogc3RyaW5nW10pIHtcbiAgICAgICAgaWYgKGxpbmVzLmxlbmd0aCA9PSAwKVxuICAgICAgICAgICAgcmV0dXJuIHsgcm93OiByb3csIGNvbHVtbjogMCB9O1xuXG4gICAgICAgIC8vIGFwcGx5IGRvZXNuJ3Qgd29yayBmb3IgYmlnIGFycmF5cyAoc21hbGxlc3QgdGhyZXNob2xkIGlzIG9uIHNhZmFyaSAweEZGRkYpXG4gICAgICAgIC8vIHRvIGNpcmN1bXZlbnQgdGhhdCB3ZSBoYXZlIHRvIGJyZWFrIGh1Z2UgaW5zZXJ0cyBpbnRvIHNtYWxsZXIgY2h1bmtzIGhlcmVcbiAgICAgICAgd2hpbGUgKGxpbmVzLmxlbmd0aCA+IDB4RjAwMCkge1xuICAgICAgICAgICAgdmFyIGVuZCA9IHRoaXMuX2luc2VydExpbmVzKHJvdywgbGluZXMuc2xpY2UoMCwgMHhGMDAwKSk7XG4gICAgICAgICAgICBsaW5lcyA9IGxpbmVzLnNsaWNlKDB4RjAwMCk7XG4gICAgICAgICAgICByb3cgPSBlbmQucm93O1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGFyZ3MgPSBbcm93LCAwXTtcbiAgICAgICAgYXJncy5wdXNoLmFwcGx5KGFyZ3MsIGxpbmVzKTtcbiAgICAgICAgdGhpcy4kbGluZXMuc3BsaWNlLmFwcGx5KHRoaXMuJGxpbmVzLCBhcmdzKTtcblxuICAgICAgICB2YXIgcmFuZ2UgPSBuZXcgUmFuZ2Uocm93LCAwLCByb3cgKyBsaW5lcy5sZW5ndGgsIDApO1xuICAgICAgICB2YXIgZGVsdGEgPSB7XG4gICAgICAgICAgICBhY3Rpb246IFwiaW5zZXJ0TGluZXNcIixcbiAgICAgICAgICAgIHJhbmdlOiByYW5nZSxcbiAgICAgICAgICAgIGxpbmVzOiBsaW5lc1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAZXZlbnQgY2hhbmdlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV2ZW50QnVzLl9zaWduYWwoXCJjaGFuZ2VcIiwgeyBkYXRhOiBkZWx0YSB9KTtcbiAgICAgICAgcmV0dXJuIHJhbmdlLmVuZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbnNlcnRzIGEgbmV3IGxpbmUgaW50byB0aGUgZG9jdW1lbnQgYXQgdGhlIGN1cnJlbnQgcm93J3MgYHBvc2l0aW9uYC5cbiAgICAgKiBUaGlzIG1ldGhvZCBhbHNvIHRyaWdnZXJzIHRoZSBgJ2NoYW5nZSdgIGV2ZW50LlxuICAgICAqXG4gICAgICogQG1ldGhvZCBpbnNlcnROZXdMaW5lXG4gICAgICogQHBhcmFtIHBvc2l0aW9uIHtQb3NpdGlvbn0gVGhlIHBvc2l0aW9uIHRvIGluc2VydCBhdC5cbiAgICAgKiBAcmV0dXJuIHtQb3NpdGlvbn0gUmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgZmluYWwgcm93IGFuZCBjb2x1bW4sIGxpa2UgdGhpczo8YnIvPlxuICAgICAqICAgIGBgYFxuICAgICAqICAgIHtyb3c6IGVuZFJvdywgY29sdW1uOiAwfVxuICAgICAqICAgIGBgYFxuICAgICAqL1xuICAgIGluc2VydE5ld0xpbmUocG9zaXRpb246IFBvc2l0aW9uKTogUG9zaXRpb24ge1xuICAgICAgICBwb3NpdGlvbiA9ICRjbGlwUG9zaXRpb24odGhpcywgcG9zaXRpb24pO1xuICAgICAgICB2YXIgbGluZSA9IHRoaXMuJGxpbmVzW3Bvc2l0aW9uLnJvd10gfHwgXCJcIjtcblxuICAgICAgICB0aGlzLiRsaW5lc1twb3NpdGlvbi5yb3ddID0gbGluZS5zdWJzdHJpbmcoMCwgcG9zaXRpb24uY29sdW1uKTtcbiAgICAgICAgdGhpcy4kbGluZXMuc3BsaWNlKHBvc2l0aW9uLnJvdyArIDEsIDAsIGxpbmUuc3Vic3RyaW5nKHBvc2l0aW9uLmNvbHVtbiwgbGluZS5sZW5ndGgpKTtcblxuICAgICAgICB2YXIgZW5kOiBQb3NpdGlvbiA9IHtcbiAgICAgICAgICAgIHJvdzogcG9zaXRpb24ucm93ICsgMSxcbiAgICAgICAgICAgIGNvbHVtbjogMFxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBkZWx0YSA9IHtcbiAgICAgICAgICAgIGFjdGlvbjogXCJpbnNlcnRUZXh0XCIsXG4gICAgICAgICAgICByYW5nZTogUmFuZ2UuZnJvbVBvaW50cyhwb3NpdGlvbiwgZW5kKSxcbiAgICAgICAgICAgIHRleHQ6IHRoaXMuZ2V0TmV3TGluZUNoYXJhY3RlcigpXG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBldmVudCBjaGFuZ2VcbiAgICAgICAgICogQHBhcmFtIGRlbHRhIHtEZWx0YX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXZlbnRCdXMuX3NpZ25hbChcImNoYW5nZVwiLCB7IGRhdGE6IGRlbHRhIH0pO1xuXG4gICAgICAgIHJldHVybiBlbmQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5zZXJ0cyBgdGV4dGAgaW50byB0aGUgYHBvc2l0aW9uYCBhdCB0aGUgY3VycmVudCByb3cuXG4gICAgICogVGhpcyBtZXRob2QgYWxzbyB0cmlnZ2VycyB0aGUgYCdjaGFuZ2UnYCBldmVudC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgaW5zZXJ0SW5MaW5lXG4gICAgICogQHBhcmFtIHBvc2l0aW9uIHtQb3NpdGlvbn0gVGhlIHBvc2l0aW9uIHRvIGluc2VydCBhdC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBBIGNodW5rIG9mIHRleHRcbiAgICAgKiBAcmV0dXJuIHtQb3NpdGlvbn0gUmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgZmluYWwgcm93IGFuZCBjb2x1bW4uXG4gICAgICovXG4gICAgaW5zZXJ0SW5MaW5lKHBvc2l0aW9uOiBQb3NpdGlvbiwgdGV4dDogc3RyaW5nKTogUG9zaXRpb24ge1xuXG4gICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGxpbmUgPSB0aGlzLiRsaW5lc1twb3NpdGlvbi5yb3ddIHx8IFwiXCI7XG5cbiAgICAgICAgdGhpcy4kbGluZXNbcG9zaXRpb24ucm93XSA9IGxpbmUuc3Vic3RyaW5nKDAsIHBvc2l0aW9uLmNvbHVtbikgKyB0ZXh0ICsgbGluZS5zdWJzdHJpbmcocG9zaXRpb24uY29sdW1uKTtcblxuICAgICAgICB2YXIgZW5kOiBQb3NpdGlvbiA9IHtcbiAgICAgICAgICAgIHJvdzogcG9zaXRpb24ucm93LFxuICAgICAgICAgICAgY29sdW1uOiBwb3NpdGlvbi5jb2x1bW4gKyB0ZXh0Lmxlbmd0aFxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBkZWx0YTogRGVsdGEgPSB7IGFjdGlvbjogXCJpbnNlcnRUZXh0XCIsIHJhbmdlOiBSYW5nZS5mcm9tUG9pbnRzKHBvc2l0aW9uLCBlbmQpLCB0ZXh0OiB0ZXh0IH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBldmVudCBjaGFuZ2VcbiAgICAgICAgICogQHBhcmFtIGRlbHRhIHtEZWx0YX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXZlbnRCdXMuX3NpZ25hbChcImNoYW5nZVwiLCB7IGRhdGE6IGRlbHRhIH0pO1xuXG4gICAgICAgIHJldHVybiBlbmQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBvblxuICAgICAqIEBwYXJhbSBldmVudE5hbWUge3N0cmluZ31cbiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgeyhldmVudCwgc291cmNlOiBEb2N1bWVudCkgPT4gYW55fVxuICAgICAqIEByZXR1cm4ge3ZvaWR9XG4gICAgICovXG4gICAgb24oZXZlbnROYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXZlbnQ6IGFueSwgc291cmNlOiBEb2N1bWVudCkgPT4gYW55KTogdm9pZCB7XG4gICAgICAgIHRoaXMuZXZlbnRCdXMub24oZXZlbnROYW1lLCBjYWxsYmFjaywgZmFsc2UpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgb2ZmXG4gICAgICogQHBhcmFtIGV2ZW50TmFtZSB7c3RyaW5nfVxuICAgICAqIEBwYXJhbSBjYWxsYmFjayB7KGV2ZW50LCBzb3VyY2U6IERvY3VtZW50KSA9PiBhbnl9XG4gICAgICogQHJldHVybiB7dm9pZH1cbiAgICAgKi9cbiAgICBvZmYoZXZlbnROYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXZlbnQ6IGFueSwgc291cmNlOiBEb2N1bWVudCkgPT4gYW55KTogdm9pZCB7XG4gICAgICAgIHRoaXMuZXZlbnRCdXMub2ZmKGV2ZW50TmFtZSwgY2FsbGJhY2spO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdGhlIGByYW5nZWAgZnJvbSB0aGUgZG9jdW1lbnQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIHJlbW92ZVxuICAgICAqIEBwYXJhbSB7UmFuZ2V9IHJhbmdlIEEgc3BlY2lmaWVkIFJhbmdlIHRvIHJlbW92ZVxuICAgICAqIEByZXR1cm4ge1Bvc2l0aW9ufSBSZXR1cm5zIHRoZSBuZXcgYHN0YXJ0YCBwcm9wZXJ0eSBvZiB0aGUgcmFuZ2UuXG4gICAgICogSWYgYHJhbmdlYCBpcyBlbXB0eSwgdGhpcyBmdW5jdGlvbiByZXR1cm5zIHRoZSB1bm1vZGlmaWVkIHZhbHVlIG9mIGByYW5nZS5zdGFydGAuXG4gICAgICovXG4gICAgcmVtb3ZlKHJhbmdlOiBSYW5nZSk6IFBvc2l0aW9uIHtcbiAgICAgICAgaWYgKCEocmFuZ2UgaW5zdGFuY2VvZiBSYW5nZSkpIHtcbiAgICAgICAgICAgIHJhbmdlID0gUmFuZ2UuZnJvbVBvaW50cyhyYW5nZS5zdGFydCwgcmFuZ2UuZW5kKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBjbGlwIHRvIGRvY3VtZW50XG4gICAgICAgIHJhbmdlLnN0YXJ0ID0gJGNsaXBQb3NpdGlvbih0aGlzLCByYW5nZS5zdGFydCk7XG4gICAgICAgIHJhbmdlLmVuZCA9ICRjbGlwUG9zaXRpb24odGhpcywgcmFuZ2UuZW5kKTtcblxuICAgICAgICBpZiAocmFuZ2UuaXNFbXB0eSgpKVxuICAgICAgICAgICAgcmV0dXJuIHJhbmdlLnN0YXJ0O1xuXG4gICAgICAgIHZhciBmaXJzdFJvdyA9IHJhbmdlLnN0YXJ0LnJvdztcbiAgICAgICAgdmFyIGxhc3RSb3cgPSByYW5nZS5lbmQucm93O1xuXG4gICAgICAgIGlmIChyYW5nZS5pc011bHRpTGluZSgpKSB7XG4gICAgICAgICAgICB2YXIgZmlyc3RGdWxsUm93ID0gcmFuZ2Uuc3RhcnQuY29sdW1uID09IDAgPyBmaXJzdFJvdyA6IGZpcnN0Um93ICsgMTtcbiAgICAgICAgICAgIHZhciBsYXN0RnVsbFJvdyA9IGxhc3RSb3cgLSAxO1xuXG4gICAgICAgICAgICBpZiAocmFuZ2UuZW5kLmNvbHVtbiA+IDApXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVJbkxpbmUobGFzdFJvdywgMCwgcmFuZ2UuZW5kLmNvbHVtbik7XG5cbiAgICAgICAgICAgIGlmIChsYXN0RnVsbFJvdyA+PSBmaXJzdEZ1bGxSb3cpXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlTGluZXMoZmlyc3RGdWxsUm93LCBsYXN0RnVsbFJvdyk7XG5cbiAgICAgICAgICAgIGlmIChmaXJzdEZ1bGxSb3cgIT0gZmlyc3RSb3cpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUluTGluZShmaXJzdFJvdywgcmFuZ2Uuc3RhcnQuY29sdW1uLCB0aGlzLmdldExpbmUoZmlyc3RSb3cpLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVOZXdMaW5lKHJhbmdlLnN0YXJ0LnJvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZUluTGluZShmaXJzdFJvdywgcmFuZ2Uuc3RhcnQuY29sdW1uLCByYW5nZS5lbmQuY29sdW1uKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmFuZ2Uuc3RhcnQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGNvbHVtbnMgZnJvbSB0aGUgYHJvd2AuXG4gICAgICogVGhpcyBtZXRob2QgYWxzbyB0cmlnZ2VycyB0aGUgYCdjaGFuZ2UnYCBldmVudC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgcmVtb3ZlSW5MaW5lXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHJvdyBUaGUgcm93IHRvIHJlbW92ZSBmcm9tXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHN0YXJ0Q29sdW1uIFRoZSBjb2x1bW4gdG8gc3RhcnQgcmVtb3ZpbmcgYXQgXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGVuZENvbHVtbiBUaGUgY29sdW1uIHRvIHN0b3AgcmVtb3ZpbmcgYXRcbiAgICAgKiBAcmV0dXJuIHtQb3NpdGlvbn0gUmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyBgc3RhcnRSb3dgIGFuZCBgc3RhcnRDb2x1bW5gLCBpbmRpY2F0aW5nIHRoZSBuZXcgcm93IGFuZCBjb2x1bW4gdmFsdWVzLjxici8+SWYgYHN0YXJ0Q29sdW1uYCBpcyBlcXVhbCB0byBgZW5kQ29sdW1uYCwgdGhpcyBmdW5jdGlvbiByZXR1cm5zIG5vdGhpbmcuXG4gICAgICpcbiAgICAgKi9cbiAgICByZW1vdmVJbkxpbmUocm93OiBudW1iZXIsIHN0YXJ0Q29sdW1uOiBudW1iZXIsIGVuZENvbHVtbjogbnVtYmVyKTogUG9zaXRpb24ge1xuICAgICAgICBpZiAoc3RhcnRDb2x1bW4gPT09IGVuZENvbHVtbilcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICB2YXIgcmFuZ2UgPSBuZXcgUmFuZ2Uocm93LCBzdGFydENvbHVtbiwgcm93LCBlbmRDb2x1bW4pO1xuICAgICAgICB2YXIgbGluZSA9IHRoaXMuZ2V0TGluZShyb3cpO1xuICAgICAgICB2YXIgcmVtb3ZlZCA9IGxpbmUuc3Vic3RyaW5nKHN0YXJ0Q29sdW1uLCBlbmRDb2x1bW4pO1xuICAgICAgICB2YXIgbmV3TGluZSA9IGxpbmUuc3Vic3RyaW5nKDAsIHN0YXJ0Q29sdW1uKSArIGxpbmUuc3Vic3RyaW5nKGVuZENvbHVtbiwgbGluZS5sZW5ndGgpO1xuICAgICAgICB0aGlzLiRsaW5lcy5zcGxpY2Uocm93LCAxLCBuZXdMaW5lKTtcblxuICAgICAgICB2YXIgZGVsdGEgPSB7XG4gICAgICAgICAgICBhY3Rpb246IFwicmVtb3ZlVGV4dFwiLFxuICAgICAgICAgICAgcmFuZ2U6IHJhbmdlLFxuICAgICAgICAgICAgdGV4dDogcmVtb3ZlZFxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAZXZlbnQgY2hhbmdlXG4gICAgICAgICAqIEBwYXJhbSBkZWx0YSB7RGVsdGF9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV2ZW50QnVzLl9zaWduYWwoXCJjaGFuZ2VcIiwgeyBkYXRhOiBkZWx0YSB9KTtcbiAgICAgICAgcmV0dXJuIHJhbmdlLnN0YXJ0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYSByYW5nZSBvZiBmdWxsIGxpbmVzLlxuICAgICAqIFRoaXMgbWV0aG9kIGFsc28gdHJpZ2dlcnMgdGhlIGAnY2hhbmdlJ2AgZXZlbnQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIHJlbW92ZUxpbmVzXG4gICAgICogQHBhcmFtIGZpcnN0Um93IHtudW1iZXJ9IFRoZSBmaXJzdCByb3cgdG8gYmUgcmVtb3ZlZC5cbiAgICAgKiBAcGFyYW0gbGFzdFJvdyB7bnVtYmVyfSBUaGUgbGFzdCByb3cgdG8gYmUgcmVtb3ZlZC5cbiAgICAgKiBAcmV0dXJuIHtzdHJpbmdbXX0gUmV0dXJucyBhbGwgdGhlIHJlbW92ZWQgbGluZXMuXG4gICAgICovXG4gICAgcmVtb3ZlTGluZXMoZmlyc3RSb3c6IG51bWJlciwgbGFzdFJvdzogbnVtYmVyKTogc3RyaW5nW10ge1xuICAgICAgICBpZiAoZmlyc3RSb3cgPCAwIHx8IGxhc3RSb3cgPj0gdGhpcy5nZXRMZW5ndGgoKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRG9jdW1lbnQucmVtb3ZlTGluZXNcIilcbiAgICAgICAgICAgIC8vIFRoaXMgcmV0dXJucyBhIFBvc2l0aW9uLCBzbyBpdCBpcyBpbmNvbXBhdGlibGUuXG4gICAgICAgICAgICAvLyByZXR1cm4gdGhpcy5yZW1vdmUobmV3IFJhbmdlKGZpcnN0Um93LCAwLCBsYXN0Um93ICsgMSwgMCkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoaXMgcmV0dXJucyBhIHN0cmluZ1tdLlxuICAgICAgICByZXR1cm4gdGhpcy5fcmVtb3ZlTGluZXMoZmlyc3RSb3csIGxhc3RSb3cpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX3JlbW92ZUxpbmVzKGZpcnN0Um93OiBudW1iZXIsIGxhc3RSb3c6IG51bWJlcik6IHN0cmluZ1tdIHtcbiAgICAgICAgdmFyIHJhbmdlID0gbmV3IFJhbmdlKGZpcnN0Um93LCAwLCBsYXN0Um93ICsgMSwgMCk7XG4gICAgICAgIHZhciByZW1vdmVkID0gdGhpcy4kbGluZXMuc3BsaWNlKGZpcnN0Um93LCBsYXN0Um93IC0gZmlyc3RSb3cgKyAxKTtcblxuICAgICAgICB2YXIgZGVsdGEgPSB7XG4gICAgICAgICAgICBhY3Rpb246IFwicmVtb3ZlTGluZXNcIixcbiAgICAgICAgICAgIHJhbmdlOiByYW5nZSxcbiAgICAgICAgICAgIG5sOiB0aGlzLmdldE5ld0xpbmVDaGFyYWN0ZXIoKSxcbiAgICAgICAgICAgIGxpbmVzOiByZW1vdmVkXG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBldmVudCBjaGFuZ2VcbiAgICAgICAgICogQHBhcmFtIGRlbHRhIHtEZWx0YX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXZlbnRCdXMuX3NpZ25hbChcImNoYW5nZVwiLCB7IGRhdGE6IGRlbHRhIH0pO1xuICAgICAgICByZXR1cm4gcmVtb3ZlZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIHRoZSBuZXcgbGluZSBiZXR3ZWVuIGByb3dgIGFuZCB0aGUgcm93IGltbWVkaWF0ZWx5IGZvbGxvd2luZyBpdC5cbiAgICAgKiBUaGlzIG1ldGhvZCBhbHNvIHRyaWdnZXJzIHRoZSBgJ2NoYW5nZSdgIGV2ZW50LlxuICAgICAqXG4gICAgICogQG1ldGhvZCByZW1vdmVOZXdMaW5lXG4gICAgICogQHBhcmFtIHJvdyB7bnVtYmVyfSBUaGUgcm93IHRvIGNoZWNrLlxuICAgICAqIEByZXR1cm4ge3ZvaWR9XG4gICAgICovXG4gICAgcmVtb3ZlTmV3TGluZShyb3c6IG51bWJlcik6IHZvaWQge1xuICAgICAgICB2YXIgZmlyc3RMaW5lID0gdGhpcy5nZXRMaW5lKHJvdyk7XG4gICAgICAgIHZhciBzZWNvbmRMaW5lID0gdGhpcy5nZXRMaW5lKHJvdyArIDEpO1xuXG4gICAgICAgIHZhciByYW5nZSA9IG5ldyBSYW5nZShyb3csIGZpcnN0TGluZS5sZW5ndGgsIHJvdyArIDEsIDApO1xuICAgICAgICB2YXIgbGluZSA9IGZpcnN0TGluZSArIHNlY29uZExpbmU7XG5cbiAgICAgICAgdGhpcy4kbGluZXMuc3BsaWNlKHJvdywgMiwgbGluZSk7XG5cbiAgICAgICAgdmFyIGRlbHRhID0ge1xuICAgICAgICAgICAgYWN0aW9uOiBcInJlbW92ZVRleHRcIixcbiAgICAgICAgICAgIHJhbmdlOiByYW5nZSxcbiAgICAgICAgICAgIHRleHQ6IHRoaXMuZ2V0TmV3TGluZUNoYXJhY3RlcigpXG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBldmVudCBjaGFuZ2VcbiAgICAgICAgICogQHBhcmFtIGRlbHRhIHtEZWx0YX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXZlbnRCdXMuX3NpZ25hbChcImNoYW5nZVwiLCB7IGRhdGE6IGRlbHRhIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlcGxhY2VzIGEgcmFuZ2UgaW4gdGhlIGRvY3VtZW50IHdpdGggdGhlIG5ldyBgdGV4dGAuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIHJlcGxhY2VcbiAgICAgKiBAcGFyYW0gcmFuZ2Uge1JhbmdlfSBBIHNwZWNpZmllZCBSYW5nZSB0byByZXBsYWNlLlxuICAgICAqIEBwYXJhbSB0ZXh0IHtzdHJpbmd9IFRoZSBuZXcgdGV4dCB0byB1c2UgYXMgYSByZXBsYWNlbWVudC5cbiAgICAgKiBAcmV0dXJuIHtQb3N0aW9ufSBSZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBmaW5hbCByb3cgYW5kIGNvbHVtbiwgbGlrZSB0aGlzOlxuICAgICAqICAgICB7cm93OiBlbmRSb3csIGNvbHVtbjogMH1cbiAgICAgKiBJZiB0aGUgdGV4dCBhbmQgcmFuZ2UgYXJlIGVtcHR5LCB0aGlzIGZ1bmN0aW9uIHJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGN1cnJlbnQgYHJhbmdlLnN0YXJ0YCB2YWx1ZS5cbiAgICAgKiBJZiB0aGUgdGV4dCBpcyB0aGUgZXhhY3Qgc2FtZSBhcyB3aGF0IGN1cnJlbnRseSBleGlzdHMsIHRoaXMgZnVuY3Rpb24gcmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgY3VycmVudCBgcmFuZ2UuZW5kYCB2YWx1ZS5cbiAgICAgKi9cbiAgICByZXBsYWNlKHJhbmdlOiBSYW5nZSwgdGV4dDogc3RyaW5nKTogUG9zaXRpb24ge1xuICAgICAgICBpZiAodGV4dC5sZW5ndGggPT09IDAgJiYgcmFuZ2UuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmFuZ2Uuc3RhcnQ7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTaG9ydGN1dDogSWYgdGhlIHRleHQgd2Ugd2FudCB0byBpbnNlcnQgaXMgdGhlIHNhbWUgYXMgaXQgaXMgYWxyZWFkeVxuICAgICAgICAvLyBpbiB0aGUgZG9jdW1lbnQsIHdlIGRvbid0IGhhdmUgdG8gcmVwbGFjZSBhbnl0aGluZy5cbiAgICAgICAgaWYgKHRleHQgPT09IHRoaXMuZ2V0VGV4dFJhbmdlKHJhbmdlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHJhbmdlLmVuZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVtb3ZlKHJhbmdlKTtcblxuICAgICAgICBpZiAodGV4dCkge1xuICAgICAgICAgICAgdmFyIGVuZCA9IHRoaXMuaW5zZXJ0KHJhbmdlLnN0YXJ0LCB0ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVuZCA9IHJhbmdlLnN0YXJ0O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVuZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBcHBsaWVzIGFsbCB0aGUgY2hhbmdlcyBwcmV2aW91c2x5IGFjY3VtdWxhdGVkLlxuICAgICAqIFRoZXNlIGNhbiBiZSBlaXRoZXIgYCdpbmNsdWRlVGV4dCdgLCBgJ2luc2VydExpbmVzJ2AsIGAncmVtb3ZlVGV4dCdgLCBhbmQgYCdyZW1vdmVMaW5lcydgLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBhcHBseURlbHRhc1xuICAgICAqIEBwYXJhbSBkZWx0YXMge0RlbHRhW119XG4gICAgICogQHJldHVybiB7dm9pZH1cbiAgICAgKi9cbiAgICBhcHBseURlbHRhcyhkZWx0YXM6IERlbHRhW10pOiB2b2lkIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZWx0YXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBkZWx0YSA9IGRlbHRhc1tpXTtcbiAgICAgICAgICAgIHZhciByYW5nZSA9IFJhbmdlLmZyb21Qb2ludHMoZGVsdGEucmFuZ2Uuc3RhcnQsIGRlbHRhLnJhbmdlLmVuZCk7XG5cbiAgICAgICAgICAgIGlmIChkZWx0YS5hY3Rpb24gPT0gXCJpbnNlcnRMaW5lc1wiKVxuICAgICAgICAgICAgICAgIHRoaXMuaW5zZXJ0TGluZXMocmFuZ2Uuc3RhcnQucm93LCBkZWx0YS5saW5lcyk7XG4gICAgICAgICAgICBlbHNlIGlmIChkZWx0YS5hY3Rpb24gPT0gXCJpbnNlcnRUZXh0XCIpXG4gICAgICAgICAgICAgICAgdGhpcy5pbnNlcnQocmFuZ2Uuc3RhcnQsIGRlbHRhLnRleHQpO1xuICAgICAgICAgICAgZWxzZSBpZiAoZGVsdGEuYWN0aW9uID09IFwicmVtb3ZlTGluZXNcIilcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVMaW5lcyhyYW5nZS5zdGFydC5yb3csIHJhbmdlLmVuZC5yb3cgLSAxKTtcbiAgICAgICAgICAgIGVsc2UgaWYgKGRlbHRhLmFjdGlvbiA9PSBcInJlbW92ZVRleHRcIilcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZShyYW5nZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXZlcnRzIGFueSBjaGFuZ2VzIHByZXZpb3VzbHkgYXBwbGllZC5cbiAgICAgKiBUaGVzZSBjYW4gYmUgZWl0aGVyIGAnaW5jbHVkZVRleHQnYCwgYCdpbnNlcnRMaW5lcydgLCBgJ3JlbW92ZVRleHQnYCwgYW5kIGAncmVtb3ZlTGluZXMnYC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgcmV2ZXJ0RGVsdGFzXG4gICAgICogQHBhcmFtIGRlbHRhcyB7RGVsdGFbXX1cbiAgICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgICAqL1xuICAgIHJldmVydERlbHRhcyhkZWx0YXM6IERlbHRhW10pOiB2b2lkIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IGRlbHRhcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgdmFyIGRlbHRhID0gZGVsdGFzW2ldO1xuXG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSBSYW5nZS5mcm9tUG9pbnRzKGRlbHRhLnJhbmdlLnN0YXJ0LCBkZWx0YS5yYW5nZS5lbmQpO1xuXG4gICAgICAgICAgICBpZiAoZGVsdGEuYWN0aW9uID09IFwiaW5zZXJ0TGluZXNcIilcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVMaW5lcyhyYW5nZS5zdGFydC5yb3csIHJhbmdlLmVuZC5yb3cgLSAxKTtcbiAgICAgICAgICAgIGVsc2UgaWYgKGRlbHRhLmFjdGlvbiA9PSBcImluc2VydFRleHRcIilcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZShyYW5nZSk7XG4gICAgICAgICAgICBlbHNlIGlmIChkZWx0YS5hY3Rpb24gPT0gXCJyZW1vdmVMaW5lc1wiKVxuICAgICAgICAgICAgICAgIHRoaXMuX2luc2VydExpbmVzKHJhbmdlLnN0YXJ0LnJvdywgZGVsdGEubGluZXMpO1xuICAgICAgICAgICAgZWxzZSBpZiAoZGVsdGEuYWN0aW9uID09IFwicmVtb3ZlVGV4dFwiKVxuICAgICAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHJhbmdlLnN0YXJ0LCBkZWx0YS50ZXh0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGFuIGluZGV4IHBvc2l0aW9uIGluIGEgZG9jdW1lbnQgdG8gYSBge3JvdywgY29sdW1ufWAgb2JqZWN0LlxuICAgICAqXG4gICAgICogSW5kZXggcmVmZXJzIHRvIHRoZSBcImFic29sdXRlIHBvc2l0aW9uXCIgb2YgYSBjaGFyYWN0ZXIgaW4gdGhlIGRvY3VtZW50LiBGb3IgZXhhbXBsZTpcbiAgICAgKlxuICAgICAqIGBgYGphdmFzY3JpcHRcbiAgICAgKiB2YXIgeCA9IDA7IC8vIDEwIGNoYXJhY3RlcnMsIHBsdXMgb25lIGZvciBuZXdsaW5lXG4gICAgICogdmFyIHkgPSAtMTtcbiAgICAgKiBgYGBcbiAgICAgKiBcbiAgICAgKiBIZXJlLCBgeWAgaXMgYW4gaW5kZXggMTU6IDExIGNoYXJhY3RlcnMgZm9yIHRoZSBmaXJzdCByb3csIGFuZCA1IGNoYXJhY3RlcnMgdW50aWwgYHlgIGluIHRoZSBzZWNvbmQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGluZGV4VG9Qb3NpdGlvblxuICAgICAqIEBwYXJhbSBpbmRleCB7bnVtYmVyfSBBbiBpbmRleCB0byBjb252ZXJ0XG4gICAgICogQHBhcmFtIHN0YXJ0Um93IHtudW1iZXJ9IFRoZSByb3cgZnJvbSB3aGljaCB0byBzdGFydCB0aGUgY29udmVyc2lvblxuICAgICAqIEByZXR1cm4ge1Bvc2l0aW9ufSBBIGB7cm93LCBjb2x1bW59YCBvYmplY3Qgb2YgdGhlIGBpbmRleGAgcG9zaXRpb24uXG4gICAgICovXG4gICAgaW5kZXhUb1Bvc2l0aW9uKGluZGV4OiBudW1iZXIsIHN0YXJ0Um93OiBudW1iZXIpOiBQb3NpdGlvbiB7XG4gICAgICAgIHZhciBsaW5lcyA9IHRoaXMuJGxpbmVzIHx8IHRoaXMuZ2V0QWxsTGluZXMoKTtcbiAgICAgICAgdmFyIG5ld2xpbmVMZW5ndGggPSB0aGlzLmdldE5ld0xpbmVDaGFyYWN0ZXIoKS5sZW5ndGg7XG4gICAgICAgIGZvciAodmFyIGkgPSBzdGFydFJvdyB8fCAwLCBsID0gbGluZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICBpbmRleCAtPSBsaW5lc1tpXS5sZW5ndGggKyBuZXdsaW5lTGVuZ3RoO1xuICAgICAgICAgICAgaWYgKGluZGV4IDwgMClcbiAgICAgICAgICAgICAgICByZXR1cm4geyByb3c6IGksIGNvbHVtbjogaW5kZXggKyBsaW5lc1tpXS5sZW5ndGggKyBuZXdsaW5lTGVuZ3RoIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgcm93OiBsIC0gMSwgY29sdW1uOiBsaW5lc1tsIC0gMV0ubGVuZ3RoIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgdGhlIGB7cm93LCBjb2x1bW59YCBwb3NpdGlvbiBpbiBhIGRvY3VtZW50IHRvIHRoZSBjaGFyYWN0ZXIncyBpbmRleC5cbiAgICAgKlxuICAgICAqIEluZGV4IHJlZmVycyB0byB0aGUgXCJhYnNvbHV0ZSBwb3NpdGlvblwiIG9mIGEgY2hhcmFjdGVyIGluIHRoZSBkb2N1bWVudC4gRm9yIGV4YW1wbGU6XG4gICAgICpcbiAgICAgKiBgYGBqYXZhc2NyaXB0XG4gICAgICogdmFyIHggPSAwOyAvLyAxMCBjaGFyYWN0ZXJzLCBwbHVzIG9uZSBmb3IgbmV3bGluZVxuICAgICAqIHZhciB5ID0gLTE7XG4gICAgICogYGBgXG4gICAgICogXG4gICAgICogSGVyZSwgYHlgIGlzIGFuIGluZGV4IDE1OiAxMSBjaGFyYWN0ZXJzIGZvciB0aGUgZmlyc3Qgcm93LCBhbmQgNSBjaGFyYWN0ZXJzIHVudGlsIGB5YCBpbiB0aGUgc2Vjb25kLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBwb3NpdGlvblRvSW5kZXhcbiAgICAgKiBAcGFyYW0ge1Bvc2l0aW9ufSBwb3MgVGhlIGB7cm93LCBjb2x1bW59YCB0byBjb252ZXJ0LlxuICAgICAqIEBwYXJhbSBzdGFydFJvdyB7bnVtYmVyfSBUaGUgcm93IGZyb20gd2hpY2ggdG8gc3RhcnQgdGhlIGNvbnZlcnNpb25cbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBpbmRleCBwb3NpdGlvbiBpbiB0aGUgZG9jdW1lbnQuXG4gICAgICovXG4gICAgcG9zaXRpb25Ub0luZGV4KHBvczogUG9zaXRpb24sIHN0YXJ0Um93OiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICB2YXIgbGluZXMgPSB0aGlzLiRsaW5lcyB8fCB0aGlzLmdldEFsbExpbmVzKCk7XG4gICAgICAgIHZhciBuZXdsaW5lTGVuZ3RoID0gdGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCkubGVuZ3RoO1xuICAgICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgICB2YXIgcm93ID0gTWF0aC5taW4ocG9zLnJvdywgbGluZXMubGVuZ3RoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0Um93IHx8IDA7IGkgPCByb3c7ICsraSlcbiAgICAgICAgICAgIGluZGV4ICs9IGxpbmVzW2ldLmxlbmd0aCArIG5ld2xpbmVMZW5ndGg7XG5cbiAgICAgICAgcmV0dXJuIGluZGV4ICsgcG9zLmNvbHVtbjtcbiAgICB9XG59XG4iXX0=