"use strict";
import EventEmitterClass from './lib/EventEmitterClass';
import Range from './Range';
var $split = (function () {
    function foo(text) {
        return text.replace(/\r\n|\r/g, "\n").split("\n");
    }
    function bar(text) {
        return text.split(/\r\n|\r|\n/);
    }
    if ("aaa".split(/a/).length === 0) {
        return foo;
    }
    else {
        return bar;
    }
})();
function $clipPosition(doc, position) {
    var length = doc.getLength();
    if (position.row >= length) {
        position.row = Math.max(0, length - 1);
        position.column = doc.getLine(length - 1).length;
    }
    else if (position.row < 0) {
        position.row = 0;
    }
    return position;
}
export default class Document {
    constructor(text) {
        this.$lines = [];
        this.$autoNewLine = "";
        this.$newLineMode = "auto";
        this.eventBus = new EventEmitterClass(this);
        if (text.length === 0) {
            this.$lines = [""];
        }
        else if (Array.isArray(text)) {
            this._insertLines(0, text);
        }
        else {
            this.insert({ row: 0, column: 0 }, text);
        }
    }
    setValue(text) {
        var len = this.getLength();
        this.remove(new Range(0, 0, len, this.getLine(len - 1).length));
        this.insert({ row: 0, column: 0 }, text);
    }
    getValue() {
        return this.getAllLines().join(this.getNewLineCharacter());
    }
    $detectNewLine(text) {
        var match = text.match(/^.*?(\r\n|\r|\n)/m);
        this.$autoNewLine = match ? match[1] : "\n";
        this.eventBus._signal("changeNewLineMode");
    }
    getNewLineCharacter() {
        switch (this.$newLineMode) {
            case "windows":
                return "\r\n";
            case "unix":
                return "\n";
            default:
                return this.$autoNewLine || "\n";
        }
    }
    setNewLineMode(newLineMode) {
        if (this.$newLineMode === newLineMode) {
            return;
        }
        this.$newLineMode = newLineMode;
        this.eventBus._signal("changeNewLineMode");
    }
    getNewLineMode() {
        return this.$newLineMode;
    }
    isNewLine(text) {
        return (text == "\r\n" || text == "\r" || text == "\n");
    }
    getLine(row) {
        return this.$lines[row] || "";
    }
    getLines(firstRow, lastRow) {
        return this.$lines.slice(firstRow, lastRow + 1);
    }
    getAllLines() {
        return this.getLines(0, this.getLength());
    }
    getLength() {
        return this.$lines.length;
    }
    getTextRange(range) {
        if (range.start.row === range.end.row) {
            return this.getLine(range.start.row).substring(range.start.column, range.end.column);
        }
        var lines = this.getLines(range.start.row, range.end.row);
        lines[0] = (lines[0] || "").substring(range.start.column);
        var l = lines.length - 1;
        if (range.end.row - range.start.row == l) {
            lines[l] = lines[l].substring(0, range.end.column);
        }
        return lines.join(this.getNewLineCharacter());
    }
    insert(position, text) {
        if (!text || text.length === 0) {
            return position;
        }
        position = $clipPosition(this, position);
        if (this.getLength() <= 1) {
            this.$detectNewLine(text);
        }
        var lines = $split(text);
        var firstLine = lines.splice(0, 1)[0];
        var lastLine = lines.length == 0 ? null : lines.splice(lines.length - 1, 1)[0];
        position = this.insertInLine(position, firstLine);
        if (lastLine !== null) {
            position = this.insertNewLine(position);
            position = this._insertLines(position.row, lines);
            position = this.insertInLine(position, lastLine || "");
        }
        return position;
    }
    insertLines(row, lines) {
        if (row >= this.getLength())
            return this.insert({ row: row, column: 0 }, "\n" + lines.join("\n"));
        return this._insertLines(Math.max(row, 0), lines);
    }
    _insertLines(row, lines) {
        if (lines.length == 0)
            return { row: row, column: 0 };
        while (lines.length > 0xF000) {
            var end = this._insertLines(row, lines.slice(0, 0xF000));
            lines = lines.slice(0xF000);
            row = end.row;
        }
        var args = [row, 0];
        args.push.apply(args, lines);
        this.$lines.splice.apply(this.$lines, args);
        var range = new Range(row, 0, row + lines.length, 0);
        var delta = {
            action: "insertLines",
            range: range,
            lines: lines
        };
        this.eventBus._signal("change", { data: delta });
        return range.end;
    }
    insertNewLine(position) {
        position = $clipPosition(this, position);
        var line = this.$lines[position.row] || "";
        this.$lines[position.row] = line.substring(0, position.column);
        this.$lines.splice(position.row + 1, 0, line.substring(position.column, line.length));
        var end = {
            row: position.row + 1,
            column: 0
        };
        var delta = {
            action: "insertText",
            range: Range.fromPoints(position, end),
            text: this.getNewLineCharacter()
        };
        this.eventBus._signal("change", { data: delta });
        return end;
    }
    insertInLine(position, text) {
        if (text.length === 0) {
            return position;
        }
        var line = this.$lines[position.row] || "";
        this.$lines[position.row] = line.substring(0, position.column) + text + line.substring(position.column);
        var end = {
            row: position.row,
            column: position.column + text.length
        };
        var delta = { action: "insertText", range: Range.fromPoints(position, end), text: text };
        this.eventBus._signal("change", { data: delta });
        return end;
    }
    on(eventName, callback) {
        this.eventBus.on(eventName, callback, false);
    }
    off(eventName, callback) {
        this.eventBus.off(eventName, callback);
    }
    remove(range) {
        if (!(range instanceof Range)) {
            range = Range.fromPoints(range.start, range.end);
        }
        range.start = $clipPosition(this, range.start);
        range.end = $clipPosition(this, range.end);
        if (range.isEmpty())
            return range.start;
        var firstRow = range.start.row;
        var lastRow = range.end.row;
        if (range.isMultiLine()) {
            var firstFullRow = range.start.column == 0 ? firstRow : firstRow + 1;
            var lastFullRow = lastRow - 1;
            if (range.end.column > 0)
                this.removeInLine(lastRow, 0, range.end.column);
            if (lastFullRow >= firstFullRow)
                this._removeLines(firstFullRow, lastFullRow);
            if (firstFullRow != firstRow) {
                this.removeInLine(firstRow, range.start.column, this.getLine(firstRow).length);
                this.removeNewLine(range.start.row);
            }
        }
        else {
            this.removeInLine(firstRow, range.start.column, range.end.column);
        }
        return range.start;
    }
    removeInLine(row, startColumn, endColumn) {
        if (startColumn === endColumn)
            return;
        var range = new Range(row, startColumn, row, endColumn);
        var line = this.getLine(row);
        var removed = line.substring(startColumn, endColumn);
        var newLine = line.substring(0, startColumn) + line.substring(endColumn, line.length);
        this.$lines.splice(row, 1, newLine);
        var delta = {
            action: "removeText",
            range: range,
            text: removed
        };
        this.eventBus._signal("change", { data: delta });
        return range.start;
    }
    removeLines(firstRow, lastRow) {
        if (firstRow < 0 || lastRow >= this.getLength()) {
            throw new Error("Document.removeLines");
        }
        return this._removeLines(firstRow, lastRow);
    }
    _removeLines(firstRow, lastRow) {
        var range = new Range(firstRow, 0, lastRow + 1, 0);
        var removed = this.$lines.splice(firstRow, lastRow - firstRow + 1);
        var delta = {
            action: "removeLines",
            range: range,
            nl: this.getNewLineCharacter(),
            lines: removed
        };
        this.eventBus._signal("change", { data: delta });
        return removed;
    }
    removeNewLine(row) {
        var firstLine = this.getLine(row);
        var secondLine = this.getLine(row + 1);
        var range = new Range(row, firstLine.length, row + 1, 0);
        var line = firstLine + secondLine;
        this.$lines.splice(row, 2, line);
        var delta = {
            action: "removeText",
            range: range,
            text: this.getNewLineCharacter()
        };
        this.eventBus._signal("change", { data: delta });
    }
    replace(range, text) {
        if (text.length === 0 && range.isEmpty()) {
            return range.start;
        }
        if (text === this.getTextRange(range)) {
            return range.end;
        }
        this.remove(range);
        if (text) {
            var end = this.insert(range.start, text);
        }
        else {
            end = range.start;
        }
        return end;
    }
    applyDeltas(deltas) {
        for (var i = 0; i < deltas.length; i++) {
            var delta = deltas[i];
            var range = Range.fromPoints(delta.range.start, delta.range.end);
            if (delta.action == "insertLines")
                this.insertLines(range.start.row, delta.lines);
            else if (delta.action == "insertText")
                this.insert(range.start, delta.text);
            else if (delta.action == "removeLines")
                this._removeLines(range.start.row, range.end.row - 1);
            else if (delta.action == "removeText")
                this.remove(range);
        }
    }
    revertDeltas(deltas) {
        for (var i = deltas.length - 1; i >= 0; i--) {
            var delta = deltas[i];
            var range = Range.fromPoints(delta.range.start, delta.range.end);
            if (delta.action == "insertLines")
                this._removeLines(range.start.row, range.end.row - 1);
            else if (delta.action == "insertText")
                this.remove(range);
            else if (delta.action == "removeLines")
                this._insertLines(range.start.row, delta.lines);
            else if (delta.action == "removeText")
                this.insert(range.start, delta.text);
        }
    }
    indexToPosition(index, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        for (var i = startRow || 0, l = lines.length; i < l; i++) {
            index -= lines[i].length + newlineLength;
            if (index < 0)
                return { row: i, column: index + lines[i].length + newlineLength };
        }
        return { row: l - 1, column: lines[l - 1].length };
    }
    positionToIndex(pos, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        var index = 0;
        var row = Math.min(pos.row, lines.length);
        for (var i = startRow || 0; i < row; ++i)
            index += lines[i].length + newlineLength;
        return index + pos.column;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRG9jdW1lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJEb2N1bWVudC50cyJdLCJuYW1lcyI6WyJmb28iLCJiYXIiLCIkY2xpcFBvc2l0aW9uIiwiRG9jdW1lbnQiLCJEb2N1bWVudC5jb25zdHJ1Y3RvciIsIkRvY3VtZW50LnNldFZhbHVlIiwiRG9jdW1lbnQuZ2V0VmFsdWUiLCJEb2N1bWVudC4kZGV0ZWN0TmV3TGluZSIsIkRvY3VtZW50LmdldE5ld0xpbmVDaGFyYWN0ZXIiLCJEb2N1bWVudC5zZXROZXdMaW5lTW9kZSIsIkRvY3VtZW50LmdldE5ld0xpbmVNb2RlIiwiRG9jdW1lbnQuaXNOZXdMaW5lIiwiRG9jdW1lbnQuZ2V0TGluZSIsIkRvY3VtZW50LmdldExpbmVzIiwiRG9jdW1lbnQuZ2V0QWxsTGluZXMiLCJEb2N1bWVudC5nZXRMZW5ndGgiLCJEb2N1bWVudC5nZXRUZXh0UmFuZ2UiLCJEb2N1bWVudC5pbnNlcnQiLCJEb2N1bWVudC5pbnNlcnRMaW5lcyIsIkRvY3VtZW50Ll9pbnNlcnRMaW5lcyIsIkRvY3VtZW50Lmluc2VydE5ld0xpbmUiLCJEb2N1bWVudC5pbnNlcnRJbkxpbmUiLCJEb2N1bWVudC5vbiIsIkRvY3VtZW50Lm9mZiIsIkRvY3VtZW50LnJlbW92ZSIsIkRvY3VtZW50LnJlbW92ZUluTGluZSIsIkRvY3VtZW50LnJlbW92ZUxpbmVzIiwiRG9jdW1lbnQuX3JlbW92ZUxpbmVzIiwiRG9jdW1lbnQucmVtb3ZlTmV3TGluZSIsIkRvY3VtZW50LnJlcGxhY2UiLCJEb2N1bWVudC5hcHBseURlbHRhcyIsIkRvY3VtZW50LnJldmVydERlbHRhcyIsIkRvY3VtZW50LmluZGV4VG9Qb3NpdGlvbiIsIkRvY3VtZW50LnBvc2l0aW9uVG9JbmRleCJdLCJtYXBwaW5ncyI6IkFBb0RBLFlBQVksQ0FBQztPQUlOLGlCQUFpQixNQUFNLHlCQUF5QjtPQUVoRCxLQUFLLE1BQU0sU0FBUztBQUUzQixJQUFJLE1BQU0sR0FBK0IsQ0FB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Q0EsR0FBR0EsS0FBS0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDcENBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLFNBQVNBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ3pGQSxDQUFDQTtRQUNEQSxJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUMxREEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDMURBLElBQUlBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBO1FBQ3pCQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN2Q0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDdkRBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENB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Q0EsSUFBSUEsQ0FBQ0EsTUFBTUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDcEJBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBO1FBQ3BCQSxDQUFDQTtRQUVEQSxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQTtRQUUzQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsUUFBUUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFFeEdBLElBQUlBLEdBQUdBLEdBQWFBO1lBQ2hCQSxHQUFHQSxFQUFFQSxRQUFRQSxDQUFDQSxHQUFHQTtZQUNqQkEsTUFBTUEsRUFBRUEsUUFBUUEsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUE7U0FDeENBLENBQUNBO1FBRUZBLElBQUlBLEtBQUtBLEdBQVVBLEVBQUVBLE1BQU1BLEVBQUVBLFlBQVlBLEVBQUVBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLFVBQVVBLENBQUNBLFFBQVFBLEVBQUVBLEdBQUdBLENBQUNBLEVBQUVBLElBQUlBLEVBQUVBLElBQUlBLEVBQUVBLENBQUNBO1FBTWhHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxPQUFPQSxDQUFDQSxRQUFRQSxFQUFFQSxFQUFFQSxJQUFJQSxFQUFFQSxLQUFLQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUVqREEsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7SUFDZkEsQ0FBQ0E7SUFRRGxCLEVBQUVBLENBQUNBLFNBQWlCQSxFQUFFQSxRQUErQ0E7UUFDakVtQixJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxFQUFFQSxDQUFDQSxTQUFTQSxFQUFFQSxRQUFRQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtJQUNqREEsQ0FBQ0E7SUFRRG5CLEdBQUdBLENBQUNBLFNBQWlCQSxFQUFFQSxRQUErQ0E7UUFDbEVvQixJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxTQUFTQSxFQUFFQSxRQUFRQSxDQUFDQSxDQUFDQTtJQUMzQ0EsQ0FBQ0E7SUFVRHBCLE1BQU1BLENBQUNBLEtBQVlBO1FBQ2ZxQixFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxLQUFLQSxZQUFZQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM1QkEsS0FBS0EsR0FBR0EsS0FBS0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDckRBLENBQUNBO1FBRURBLEtBQUtBLENBQUNBLEtBQUtBLEdBQUdBLGFBQWFBLENBQUNBLElBQUlBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBQy9DQSxLQUFLQSxDQUFDQSxHQUFHQSxHQUFHQSxhQUFhQSxDQUFDQSxJQUFJQSxFQUFFQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUUzQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7WUFDaEJBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBO1FBRXZCQSxJQUFJQSxRQUFRQSxHQUFHQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQTtRQUMvQkEsSUFBSUEsT0FBT0EsR0FBR0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7UUFFNUJBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1lBQ3RCQSxJQUFJQSxZQUFZQSxHQUFHQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxDQUFDQSxHQUFHQSxRQUFRQSxHQUFHQSxRQUFRQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNyRUEsSUFBSUEsV0FBV0EsR0FBR0EsT0FBT0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFFOUJBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBO2dCQUNyQkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0EsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFFcERBLEVBQUVBLENBQUNBLENBQUNBLFdBQVdBLElBQUlBLFlBQVlBLENBQUNBO2dCQUM1QkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsWUFBWUEsRUFBRUEsV0FBV0EsQ0FBQ0EsQ0FBQ0E7WUFFakRBLEVBQUVBLENBQUNBLENBQUNBLFlBQVlBLElBQUlBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO2dCQUMzQkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsUUFBUUEsRUFBRUEsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7Z0JBQy9FQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUN4Q0EsQ0FBQ0E7UUFDTEEsQ0FBQ0E7UUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDRkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsUUFBUUEsRUFBRUEsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsRUFBRUEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDdEVBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBO0lBQ3ZCQSxDQUFDQTtJQWFEckIsWUFBWUEsQ0FBQ0EsR0FBV0EsRUFBRUEsV0FBbUJBLEVBQUVBLFNBQWlCQTtRQUM1RHNCLEVBQUVBLENBQUNBLENBQUNBLFdBQVdBLEtBQUtBLFNBQVNBLENBQUNBO1lBQzFCQSxNQUFNQSxDQUFDQTtRQUVYQSxJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxXQUFXQSxFQUFFQSxHQUFHQSxFQUFFQSxTQUFTQSxDQUFDQSxDQUFDQTtRQUN4REEsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDN0JBLElBQUlBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLFdBQVdBLEVBQUVBLFNBQVNBLENBQUNBLENBQUNBO1FBQ3JEQSxJQUFJQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxXQUFXQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxTQUFTQSxFQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUN0RkEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsRUFBRUEsT0FBT0EsQ0FBQ0EsQ0FBQ0E7UUFFcENBLElBQUlBLEtBQUtBLEdBQUdBO1lBQ1JBLE1BQU1BLEVBQUVBLFlBQVlBO1lBQ3BCQSxLQUFLQSxFQUFFQSxLQUFLQTtZQUNaQSxJQUFJQSxFQUFFQSxPQUFPQTtTQUNoQkEsQ0FBQ0E7UUFNRkEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsRUFBRUEsSUFBSUEsRUFBRUEsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDakRBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBO0lBQ3ZCQSxDQUFDQTtJQVdEdEIsV0FBV0EsQ0FBQ0EsUUFBZ0JBLEVBQUVBLE9BQWVBO1FBQ3pDdUIsRUFBRUEsQ0FBQ0EsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsSUFBSUEsT0FBT0EsSUFBSUEsSUFBSUEsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDOUNBLE1BQU1BLElBQUlBLEtBQUtBLENBQUNBLHNCQUFzQkEsQ0FBQ0EsQ0FBQUE7UUFHM0NBLENBQUNBO1FBRURBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFFBQVFBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBO0lBQ2hEQSxDQUFDQTtJQUVPdkIsWUFBWUEsQ0FBQ0EsUUFBZ0JBLEVBQUVBLE9BQWVBO1FBQ2xEd0IsSUFBSUEsS0FBS0EsR0FBR0EsSUFBSUEsS0FBS0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0EsRUFBRUEsT0FBT0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbkRBLElBQUlBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLEVBQUVBLE9BQU9BLEdBQUdBLFFBQVFBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBRW5FQSxJQUFJQSxLQUFLQSxHQUFHQTtZQUNSQSxNQUFNQSxFQUFFQSxhQUFhQTtZQUNyQkEsS0FBS0EsRUFBRUEsS0FBS0E7WUFDWkEsRUFBRUEsRUFBRUEsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQTtZQUM5QkEsS0FBS0EsRUFBRUEsT0FBT0E7U0FDakJBLENBQUNBO1FBTUZBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLE9BQU9BLENBQUNBLFFBQVFBLEVBQUVBLEVBQUVBLElBQUlBLEVBQUVBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBO1FBQ2pEQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQTtJQUNuQkEsQ0FBQ0E7SUFVRHhCLGFBQWFBLENBQUNBLEdBQVdBO1FBQ3JCeUIsSUFBSUEsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDbENBLElBQUlBLFVBQVVBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBRXZDQSxJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxTQUFTQSxDQUFDQSxNQUFNQSxFQUFFQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6REEsSUFBSUEsSUFBSUEsR0FBR0EsU0FBU0EsR0FBR0EsVUFBVUEsQ0FBQ0E7UUFFbENBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1FBRWpDQSxJQUFJQSxLQUFLQSxHQUFHQTtZQUNSQSxNQUFNQSxFQUFFQSxZQUFZQTtZQUNwQkEsS0FBS0EsRUFBRUEsS0FBS0E7WUFDWkEsSUFBSUEsRUFBRUEsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQTtTQUNuQ0EsQ0FBQ0E7UUFNRkEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsRUFBRUEsSUFBSUEsRUFBRUEsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7SUFDckRBLENBQUNBO0lBYUR6QixPQUFPQSxDQUFDQSxLQUFZQSxFQUFFQSxJQUFZQTtRQUM5QjBCLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEtBQUtBLENBQUNBLElBQUlBLEtBQUtBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1lBQ3ZDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUN2QkEsQ0FBQ0E7UUFJREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsS0FBS0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDcENBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBO1FBQ3JCQSxDQUFDQTtRQUVEQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUVuQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDUEEsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDN0NBLENBQUNBO1FBQ0RBLElBQUlBLENBQUNBLENBQUNBO1lBQ0ZBLEdBQUdBLEdBQUdBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBO1FBQ3RCQSxDQUFDQTtRQUVEQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQTtJQUNmQSxDQUFDQTtJQVVEMUIsV0FBV0EsQ0FBQ0EsTUFBZUE7UUFDdkIyQixHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUNyQ0EsSUFBSUEsS0FBS0EsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdEJBLElBQUlBLEtBQUtBLEdBQUdBLEtBQUtBLENBQUNBLFVBQVVBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBRWpFQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxhQUFhQSxDQUFDQTtnQkFDOUJBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1lBQ25EQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxZQUFZQSxDQUFDQTtnQkFDbENBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ3pDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxhQUFhQSxDQUFDQTtnQkFDbkNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1lBQzFEQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxZQUFZQSxDQUFDQTtnQkFDbENBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBQzNCQSxDQUFDQTtJQUNMQSxDQUFDQTtJQVVEM0IsWUFBWUEsQ0FBQ0EsTUFBZUE7UUFDeEI0QixHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUMxQ0EsSUFBSUEsS0FBS0EsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFFdEJBLElBQUlBLEtBQUtBLEdBQUdBLEtBQUtBLENBQUNBLFVBQVVBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBRWpFQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxhQUFhQSxDQUFDQTtnQkFDOUJBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1lBQzFEQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxZQUFZQSxDQUFDQTtnQkFDbENBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1lBQ3ZCQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxhQUFhQSxDQUFDQTtnQkFDbkNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1lBQ3BEQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxJQUFJQSxZQUFZQSxDQUFDQTtnQkFDbENBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQzdDQSxDQUFDQTtJQUNMQSxDQUFDQTtJQW1CRDVCLGVBQWVBLENBQUNBLEtBQWFBLEVBQUVBLFFBQWdCQTtRQUMzQzZCLElBQUlBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLElBQUlBLElBQUlBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBO1FBQzlDQSxJQUFJQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEVBQUVBLENBQUNBLE1BQU1BLENBQUNBO1FBQ3REQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxRQUFRQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUN2REEsS0FBS0EsSUFBSUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsYUFBYUEsQ0FBQ0E7WUFDekNBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBO2dCQUNWQSxNQUFNQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxDQUFDQSxFQUFFQSxNQUFNQSxFQUFFQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxHQUFHQSxhQUFhQSxFQUFFQSxDQUFDQTtRQUMzRUEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsTUFBTUEsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7SUFDdkRBLENBQUNBO0lBbUJEN0IsZUFBZUEsQ0FBQ0EsR0FBYUEsRUFBRUEsUUFBZ0JBO1FBQzNDOEIsSUFBSUEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsSUFBSUEsSUFBSUEsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0E7UUFDOUNBLElBQUlBLGFBQWFBLEdBQUdBLElBQUlBLENBQUNBLG1CQUFtQkEsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDdERBLElBQUlBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBO1FBQ2RBLElBQUlBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEVBQUVBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQzFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxRQUFRQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUNwQ0EsS0FBS0EsSUFBSUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsR0FBR0EsYUFBYUEsQ0FBQ0E7UUFFN0NBLE1BQU1BLENBQUNBLEtBQUtBLEdBQUdBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBO0lBQzlCQSxDQUFDQTtBQUNMOUIsQ0FBQ0E7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qICoqKioqIEJFR0lOIExJQ0VOU0UgQkxPQ0sgKioqKipcbiAqIFRoZSBNSVQgTGljZW5zZSAoTUlUKVxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxNC0yMDE2IERhdmlkIEdlbyBIb2xtZXMgPGRhdmlkLmdlby5ob2xtZXNAZ21haWwuY29tPlxuICpcbiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAqXG4gKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbiAqIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4gKlxuICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuICogU09GVFdBUkUuXG4gKiAqKioqKiBFTkQgTElDRU5TRSBCTE9DSyAqKioqKiAqL1xuLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMCwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIFxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0XG4gKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDpcbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuXG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZVxuICogICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cbiAqICAgICAqIE5laXRoZXIgdGhlIG5hbWUgb2YgQWpheC5vcmcgQi5WLiBub3IgdGhlXG4gKiAgICAgICBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0c1xuICogICAgICAgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXG4gKiBcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiIEFORFxuICogQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRURcbiAqIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkVcbiAqIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIEFKQVguT1JHIEIuVi4gQkUgTElBQkxFIEZPUiBBTllcbiAqIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTXG4gKiAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7XG4gKiBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkRcbiAqIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUXG4gKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJU1xuICogU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG4gKlxuICogKioqKiogRU5EIExJQ0VOU0UgQkxPQ0sgKioqKiogKi9cblwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgRGVsdGEgZnJvbSAnLi9EZWx0YSc7XG5pbXBvcnQgRXZlbnRCdXMgZnJvbSAnLi9FdmVudEJ1cyc7XG5pbXBvcnQgRXZlbnRFbWl0dGVyQ2xhc3MgZnJvbSAnLi9saWIvRXZlbnRFbWl0dGVyQ2xhc3MnO1xuaW1wb3J0IFBvc2l0aW9uIGZyb20gJy4vUG9zaXRpb24nO1xuaW1wb3J0IFJhbmdlIGZyb20gJy4vUmFuZ2UnO1xuXG52YXIgJHNwbGl0OiAodGV4dDogc3RyaW5nKSA9PiBzdHJpbmdbXSA9IChmdW5jdGlvbigpIHtcbiAgICBmdW5jdGlvbiBmb28odGV4dDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9cXHJcXG58XFxyL2csIFwiXFxuXCIpLnNwbGl0KFwiXFxuXCIpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBiYXIodGV4dDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGV4dC5zcGxpdCgvXFxyXFxufFxccnxcXG4vKTtcbiAgICB9XG4gICAgLy8gRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIHNwbGl0IGZ1bmN0aW9uIHBlcmZvcm1zIGFzIHdlIGV4cGVjdC5cbiAgICAvLyBIZXJlIHdlIGF0dGVtcHQgdG8gc2VwYXJhdGUgYSBzdHJpbmcgb2YgdGhyZWUgc2VwYXJhdG9ycy5cbiAgICAvLyBJZiBhbGwgd29ya3Mgb3V0LCB3ZSBzaG91bGQgZ2V0IGJhY2sgYW4gYXJyYXkgb2YgZm91ciAoNCkgZW1wdHkgc3RyaW5ncy5cbiAgICBpZiAoXCJhYWFcIi5zcGxpdCgvYS8pLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gZm9vO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gSW4gQ2hyb21lLCB0aGlzIGlzIHRoZSBtYWlubGluZSBiZWNhdXNlIHRoZSByZXN1bHRcbiAgICAgICAgLy8gb2YgdGhlIHRlc3QgY29uZGl0aW9uIGxlbmd0aCBpcyA0LlxuICAgICAgICByZXR1cm4gYmFyO1xuICAgIH1cbn0pKCk7XG5cbmZ1bmN0aW9uICRjbGlwUG9zaXRpb24oZG9jOiBEb2N1bWVudCwgcG9zaXRpb246IFBvc2l0aW9uKTogUG9zaXRpb24ge1xuICAgIHZhciBsZW5ndGggPSBkb2MuZ2V0TGVuZ3RoKCk7XG4gICAgaWYgKHBvc2l0aW9uLnJvdyA+PSBsZW5ndGgpIHtcbiAgICAgICAgcG9zaXRpb24ucm93ID0gTWF0aC5tYXgoMCwgbGVuZ3RoIC0gMSk7XG4gICAgICAgIHBvc2l0aW9uLmNvbHVtbiA9IGRvYy5nZXRMaW5lKGxlbmd0aCAtIDEpLmxlbmd0aDtcbiAgICB9XG4gICAgZWxzZSBpZiAocG9zaXRpb24ucm93IDwgMCkge1xuICAgICAgICBwb3NpdGlvbi5yb3cgPSAwO1xuICAgIH1cbiAgICByZXR1cm4gcG9zaXRpb247XG59XG5cbi8qKlxuICogQGNsYXNzIERvY3VtZW50XG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERvY3VtZW50IGltcGxlbWVudHMgRXZlbnRCdXM8RG9jdW1lbnQ+IHtcblxuICAgIC8qKlxuICAgICAqIEBwcm9wZXJ0eSAkbGluZXNcbiAgICAgKiBAdHlwZSBzdHJpbmdbXVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSAkbGluZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICAvKipcbiAgICAgKiBAcHJvcGVydCAkYXV0b05ld0xpbmVcbiAgICAgKiBAdHlwZSBzdHJpbmdcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgJGF1dG9OZXdMaW5lOiBzdHJpbmcgPSBcIlwiO1xuXG4gICAgLyoqXG4gICAgICogQHByb3BlcnR5ICRuZXdMaW5lTW9kZVxuICAgICAqIEB0eXBlIHN0cmluZ1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSAkbmV3TGluZU1vZGU6IHN0cmluZyA9IFwiYXV0b1wiO1xuXG4gICAgLyoqXG4gICAgICogQHByb3BlcnR5IGV2ZW50QnVzXG4gICAgICogQHR5cGUgRXZlbnRFbWl0dGVyQ2xhc3NcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgZXZlbnRCdXM6IEV2ZW50RW1pdHRlckNsYXNzPERvY3VtZW50PjtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgRG9jdW1lbnQuXG4gICAgICogSWYgdGV4dCBpcyBpbmNsdWRlZCwgdGhlIERvY3VtZW50IGNvbnRhaW5zIHRob3NlIHN0cmluZ3M7IG90aGVyd2lzZSwgaXQncyBlbXB0eS5cbiAgICAgKlxuICAgICAqIEBjbGFzcyBEb2N1bWVudFxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSB0ZXh0IHtzdHJpbmcgfCBBcnJheTxzdHJpbmc+fVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHRleHQ6IHN0cmluZyB8IEFycmF5PHN0cmluZz4pIHtcblxuICAgICAgICB0aGlzLmV2ZW50QnVzID0gbmV3IEV2ZW50RW1pdHRlckNsYXNzPERvY3VtZW50Pih0aGlzKTtcblxuICAgICAgICAvLyBUaGVyZSBoYXMgdG8gYmUgb25lIGxpbmUgYXQgbGVhc3QgaW4gdGhlIGRvY3VtZW50LiBJZiB5b3UgcGFzcyBhbiBlbXB0eVxuICAgICAgICAvLyBzdHJpbmcgdG8gdGhlIGluc2VydCBmdW5jdGlvbiwgbm90aGluZyB3aWxsIGhhcHBlbi4gV29ya2Fyb3VuZC5cbiAgICAgICAgaWYgKHRleHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLiRsaW5lcyA9IFtcIlwiXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KHRleHQpKSB7XG4gICAgICAgICAgICB0aGlzLl9pbnNlcnRMaW5lcygwLCB0ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHsgcm93OiAwLCBjb2x1bW46IDAgfSwgdGV4dCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXBsYWNlcyBhbGwgdGhlIGxpbmVzIGluIHRoZSBjdXJyZW50IGBEb2N1bWVudGAgd2l0aCB0aGUgdmFsdWUgb2YgYHRleHRgLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBzZXRWYWx1ZVxuICAgICAqIEBwYXJhbSB0ZXh0IHtzdHJpbmd9IFRoZSB0ZXh0IHRvIHVzZVxuICAgICAqIEByZXR1cm4ge3ZvaWR9XG4gICAgICovXG4gICAgc2V0VmFsdWUodGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHZhciBsZW4gPSB0aGlzLmdldExlbmd0aCgpO1xuICAgICAgICB0aGlzLnJlbW92ZShuZXcgUmFuZ2UoMCwgMCwgbGVuLCB0aGlzLmdldExpbmUobGVuIC0gMSkubGVuZ3RoKSk7XG4gICAgICAgIHRoaXMuaW5zZXJ0KHsgcm93OiAwLCBjb2x1bW46IDAgfSwgdGV4dCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbGwgdGhlIGxpbmVzIGluIHRoZSBkb2N1bWVudCBhcyBhIHNpbmdsZSBzdHJpbmcsIGpvaW5lZCBieSB0aGUgbmV3IGxpbmUgY2hhcmFjdGVyLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBnZXRWYWx1ZVxuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKi9cbiAgICBnZXRWYWx1ZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBbGxMaW5lcygpLmpvaW4odGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCkpO1xuICAgIH1cblxuICAgIC8qKiBcbiAgICAgKiBEZXRlcm1pbmVzIHRoZSBuZXdsaW5lIGNoYXJhY3RlciB0aGF0IGlzIHByZXNlbnQgaW4gdGhlIHByZXNlbnRlZCB0ZXh0XG4gICAgICogYW5kIGNhY2hlcyB0aGUgcmVzdWx0IGluICRhdXRvTmV3TGluZS5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgJGRldGVjdE5ld0xpbmVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdGV4dCBUaGUgdGV4dCB0byB3b3JrIHdpdGguXG4gICAgICogQHJldHVybiB7dm9pZH1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgJGRldGVjdE5ld0xpbmUodGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHZhciBtYXRjaCA9IHRleHQubWF0Y2goL14uKj8oXFxyXFxufFxccnxcXG4pL20pO1xuICAgICAgICB0aGlzLiRhdXRvTmV3TGluZSA9IG1hdGNoID8gbWF0Y2hbMV0gOiBcIlxcblwiO1xuICAgICAgICAvKipcbiAgICAgICAgICogQGV2ZW50IGNoYW5nZU5ld0xpbmVNb2RlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV2ZW50QnVzLl9zaWduYWwoXCJjaGFuZ2VOZXdMaW5lTW9kZVwiKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBuZXdsaW5lIGNoYXJhY3RlciB0aGF0J3MgYmVpbmcgdXNlZCwgZGVwZW5kaW5nIG9uIHRoZSB2YWx1ZSBvZiBgbmV3TGluZU1vZGVgLlxuICAgICAqICBJZiBgbmV3TGluZU1vZGUgPT0gd2luZG93c2AsIGBcXHJcXG5gIGlzIHJldHVybmVkLiAgXG4gICAgICogIElmIGBuZXdMaW5lTW9kZSA9PSB1bml4YCwgYFxcbmAgaXMgcmV0dXJuZWQuICBcbiAgICAgKiAgSWYgYG5ld0xpbmVNb2RlID09IGF1dG9gLCB0aGUgdmFsdWUgb2YgYGF1dG9OZXdMaW5lYCBpcyByZXR1cm5lZC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgZ2V0TmV3TGluZUNoYXJhY3RlclxuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKi9cbiAgICBnZXROZXdMaW5lQ2hhcmFjdGVyKCk6IHN0cmluZyB7XG4gICAgICAgIHN3aXRjaCAodGhpcy4kbmV3TGluZU1vZGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJ3aW5kb3dzXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiXFxyXFxuXCI7XG4gICAgICAgICAgICBjYXNlIFwidW5peFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIlxcblwiO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kYXV0b05ld0xpbmUgfHwgXCJcXG5cIjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIG5ldyBsaW5lIG1vZGUuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIHNldE5ld0xpbmVNb2RlXG4gICAgICogQHBhcmFtIG5ld0xpbmVNb2RlIHtzdHJpbmd9IFRoZSBuZXdsaW5lIG1vZGUgdG8gdXNlOyBjYW4gYmUgZWl0aGVyIGB3aW5kb3dzYCwgYHVuaXhgLCBvciBgYXV0b2AuXG4gICAgICogQHJldHVybiB7dm9pZH1cbiAgICAgKi9cbiAgICBzZXROZXdMaW5lTW9kZShuZXdMaW5lTW9kZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLiRuZXdMaW5lTW9kZSA9PT0gbmV3TGluZU1vZGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiRuZXdMaW5lTW9kZSA9IG5ld0xpbmVNb2RlO1xuICAgICAgICAvKipcbiAgICAgICAgICogQGV2ZW50IGNoYW5nZU5ld0xpbmVNb2RlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV2ZW50QnVzLl9zaWduYWwoXCJjaGFuZ2VOZXdMaW5lTW9kZVwiKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB0eXBlIG9mIG5ld2xpbmVzIGJlaW5nIHVzZWQ7IGVpdGhlciBgd2luZG93c2AsIGB1bml4YCwgb3IgYGF1dG9gLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBnZXROZXdMaW5lTW9kZVxuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKi9cbiAgICBnZXROZXdMaW5lTW9kZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy4kbmV3TGluZU1vZGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBgdHJ1ZWAgaWYgYHRleHRgIGlzIGEgbmV3bGluZSBjaGFyYWN0ZXIgKGVpdGhlciBgXFxyXFxuYCwgYFxccmAsIG9yIGBcXG5gKS5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgaXNOZXdMaW5lXG4gICAgICogQHBhcmFtIHRleHQge3N0cmluZ30gVGhlIHRleHQgdG8gY2hlY2tcbiAgICAgKiBAcmV0dXJuIHtib29sZWFufVxuICAgICAqL1xuICAgIGlzTmV3TGluZSh0ZXh0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICh0ZXh0ID09IFwiXFxyXFxuXCIgfHwgdGV4dCA9PSBcIlxcclwiIHx8IHRleHQgPT0gXCJcXG5cIik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHZlcmJhdGltIGNvcHkgb2YgdGhlIGdpdmVuIGxpbmUgYXMgaXQgaXMgaW4gdGhlIGRvY3VtZW50LlxuICAgICAqXG4gICAgICogQG1ldGhvZCBnZXRMaW5lXG4gICAgICogQHBhcmFtIHJvdyB7TnVtYmVyfSBUaGUgcm93IGluZGV4IHRvIHJldHJpZXZlLlxuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKi9cbiAgICBnZXRMaW5lKHJvdzogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGxpbmVzW3Jvd10gfHwgXCJcIjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFuIGFycmF5IG9mIHN0cmluZ3Mgb2YgdGhlIHJvd3MgYmV0d2VlbiBgZmlyc3RSb3dgIGFuZCBgbGFzdFJvd2AuXG4gICAgICogVGhpcyBmdW5jdGlvbiBpcyBpbmNsdXNpdmUgb2YgYGxhc3RSb3dgLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBnZXRMaW5lc1xuICAgICAqIEBwYXJhbSBbZmlyc3RSb3ddIHtudW1iZXJ9IFRoZSBmaXJzdCByb3cgaW5kZXggdG8gcmV0cmlldmVcbiAgICAgKiBAcGFyYW0gW2xhc3RSb3ddIHtudW1iZXJ9IFRoZSBmaW5hbCByb3cgaW5kZXggdG8gcmV0cmlldmVcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmdbXX1cbiAgICAgKi9cbiAgICBnZXRMaW5lcyhmaXJzdFJvdz86IG51bWJlciwgbGFzdFJvdz86IG51bWJlcik6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGxpbmVzLnNsaWNlKGZpcnN0Um93LCBsYXN0Um93ICsgMSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbGwgbGluZXMgaW4gdGhlIGRvY3VtZW50IGFzIHN0cmluZyBhcnJheS5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgZ2V0QWxsTGluZXMoKVxuICAgICAqIEByZXR1cm4ge3N0cmluZ1tdfVxuICAgICAqL1xuICAgIGdldEFsbExpbmVzKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TGluZXMoMCwgdGhpcy5nZXRMZW5ndGgoKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIGRvY3VtZW50LlxuICAgICAqXG4gICAgICogQG1ldGhvZCBnZXRMZW5ndGhcbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9XG4gICAgICovXG4gICAgZ2V0TGVuZ3RoKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLiRsaW5lcy5sZW5ndGg7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2l2ZW4gYSByYW5nZSB3aXRoaW4gdGhlIGRvY3VtZW50LCByZXR1cm5zIGFsbCB0aGUgdGV4dCB3aXRoaW4gdGhhdCByYW5nZSBhcyBhIHNpbmdsZSBzdHJpbmcuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGdldFRleHRSYW5nZVxuICAgICAqIEBwYXJhbSByYW5nZSB7UmFuZ2V9IFRoZSByYW5nZSB0byB3b3JrIHdpdGguXG4gICAgICogQHJldHVybiB7c3RyaW5nfVxuICAgICAqL1xuICAgIGdldFRleHRSYW5nZShyYW5nZTogUmFuZ2UpOiBzdHJpbmcge1xuICAgICAgICBpZiAocmFuZ2Uuc3RhcnQucm93ID09PSByYW5nZS5lbmQucm93KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRMaW5lKHJhbmdlLnN0YXJ0LnJvdykuc3Vic3RyaW5nKHJhbmdlLnN0YXJ0LmNvbHVtbiwgcmFuZ2UuZW5kLmNvbHVtbik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGxpbmVzID0gdGhpcy5nZXRMaW5lcyhyYW5nZS5zdGFydC5yb3csIHJhbmdlLmVuZC5yb3cpO1xuICAgICAgICBsaW5lc1swXSA9IChsaW5lc1swXSB8fCBcIlwiKS5zdWJzdHJpbmcocmFuZ2Uuc3RhcnQuY29sdW1uKTtcbiAgICAgICAgdmFyIGwgPSBsaW5lcy5sZW5ndGggLSAxO1xuICAgICAgICBpZiAocmFuZ2UuZW5kLnJvdyAtIHJhbmdlLnN0YXJ0LnJvdyA9PSBsKSB7XG4gICAgICAgICAgICBsaW5lc1tsXSA9IGxpbmVzW2xdLnN1YnN0cmluZygwLCByYW5nZS5lbmQuY29sdW1uKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGluZXMuam9pbih0aGlzLmdldE5ld0xpbmVDaGFyYWN0ZXIoKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5zZXJ0cyBhIGJsb2NrIG9mIGB0ZXh0YCBhdCB0aGUgaW5kaWNhdGVkIGBwb3NpdGlvbmAuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGluc2VydFxuICAgICAqIEBwYXJhbSBwb3NpdGlvbiB7UG9zaXRpb259IFRoZSBwb3NpdGlvbiB0byBzdGFydCBpbnNlcnRpbmcgYXQuXG4gICAgICogQHBhcmFtIHRleHQge3N0cmluZ30gQSBjaHVuayBvZiB0ZXh0IHRvIGluc2VydC5cbiAgICAgKiBAcmV0dXJuIHtQb3NpdGlvbn0gVGhlIHBvc2l0aW9uICh7cm93LCBjb2x1bW59KSBvZiB0aGUgbGFzdCBsaW5lIG9mIGB0ZXh0YC4gSWYgdGhlIGxlbmd0aCBvZiBgdGV4dGAgaXMgMCwgdGhpcyBmdW5jdGlvbiBzaW1wbHkgcmV0dXJucyBgcG9zaXRpb25gLiBcbiAgICAgKi9cbiAgICBpbnNlcnQocG9zaXRpb246IFBvc2l0aW9uLCB0ZXh0OiBzdHJpbmcpOiBQb3NpdGlvbiB7XG4gICAgICAgIGlmICghdGV4dCB8fCB0ZXh0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xuICAgICAgICB9XG5cbiAgICAgICAgcG9zaXRpb24gPSAkY2xpcFBvc2l0aW9uKHRoaXMsIHBvc2l0aW9uKTtcblxuICAgICAgICAvLyBPbmx5IGRldGVjdCBuZXcgbGluZXMgaWYgdGhlIGRvY3VtZW50IGhhcyBubyBsaW5lIGJyZWFrIHlldFxuICAgICAgICBpZiAodGhpcy5nZXRMZW5ndGgoKSA8PSAxKSB7XG4gICAgICAgICAgICB0aGlzLiRkZXRlY3ROZXdMaW5lKHRleHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGxpbmVzID0gJHNwbGl0KHRleHQpO1xuICAgICAgICB2YXIgZmlyc3RMaW5lID0gbGluZXMuc3BsaWNlKDAsIDEpWzBdO1xuICAgICAgICB2YXIgbGFzdExpbmUgPSBsaW5lcy5sZW5ndGggPT0gMCA/IG51bGwgOiBsaW5lcy5zcGxpY2UobGluZXMubGVuZ3RoIC0gMSwgMSlbMF07XG5cbiAgICAgICAgcG9zaXRpb24gPSB0aGlzLmluc2VydEluTGluZShwb3NpdGlvbiwgZmlyc3RMaW5lKTtcbiAgICAgICAgaWYgKGxhc3RMaW5lICE9PSBudWxsKSB7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IHRoaXMuaW5zZXJ0TmV3TGluZShwb3NpdGlvbik7IC8vIHRlcm1pbmF0ZSBmaXJzdCBsaW5lXG4gICAgICAgICAgICBwb3NpdGlvbiA9IHRoaXMuX2luc2VydExpbmVzKHBvc2l0aW9uLnJvdywgbGluZXMpO1xuICAgICAgICAgICAgcG9zaXRpb24gPSB0aGlzLmluc2VydEluTGluZShwb3NpdGlvbiwgbGFzdExpbmUgfHwgXCJcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpcmVzIHdoZW5ldmVyIHRoZSBkb2N1bWVudCBjaGFuZ2VzLlxuICAgICAqXG4gICAgICogU2V2ZXJhbCBtZXRob2RzIHRyaWdnZXIgZGlmZmVyZW50IGBcImNoYW5nZVwiYCBldmVudHMuIEJlbG93IGlzIGEgbGlzdCBvZiBlYWNoIGFjdGlvbiB0eXBlLCBmb2xsb3dlZCBieSBlYWNoIHByb3BlcnR5IHRoYXQncyBhbHNvIGF2YWlsYWJsZTpcbiAgICAgKlxuICAgICAqICAqIGBcImluc2VydExpbmVzXCJgIChlbWl0dGVkIGJ5IFtbRG9jdW1lbnQuaW5zZXJ0TGluZXNdXSlcbiAgICAgKiAgICAqIGByYW5nZWA6IHRoZSBbW1JhbmdlXV0gb2YgdGhlIGNoYW5nZSB3aXRoaW4gdGhlIGRvY3VtZW50XG4gICAgICogICAgKiBgbGluZXNgOiB0aGUgbGluZXMgaW4gdGhlIGRvY3VtZW50IHRoYXQgYXJlIGNoYW5naW5nXG4gICAgICogICogYFwiaW5zZXJ0VGV4dFwiYCAoZW1pdHRlZCBieSBbW0RvY3VtZW50Lmluc2VydE5ld0xpbmVdXSlcbiAgICAgKiAgICAqIGByYW5nZWA6IHRoZSBbW1JhbmdlXV0gb2YgdGhlIGNoYW5nZSB3aXRoaW4gdGhlIGRvY3VtZW50XG4gICAgICogICAgKiBgdGV4dGA6IHRoZSB0ZXh0IHRoYXQncyBiZWluZyBhZGRlZFxuICAgICAqICAqIGBcInJlbW92ZUxpbmVzXCJgIChlbWl0dGVkIGJ5IFtbRG9jdW1lbnQuaW5zZXJ0TGluZXNdXSlcbiAgICAgKiAgICAqIGByYW5nZWA6IHRoZSBbW1JhbmdlXV0gb2YgdGhlIGNoYW5nZSB3aXRoaW4gdGhlIGRvY3VtZW50XG4gICAgICogICAgKiBgbGluZXNgOiB0aGUgbGluZXMgaW4gdGhlIGRvY3VtZW50IHRoYXQgd2VyZSByZW1vdmVkXG4gICAgICogICAgKiBgbmxgOiB0aGUgbmV3IGxpbmUgY2hhcmFjdGVyIChhcyBkZWZpbmVkIGJ5IFtbRG9jdW1lbnQuZ2V0TmV3TGluZUNoYXJhY3Rlcl1dKVxuICAgICAqICAqIGBcInJlbW92ZVRleHRcImAgKGVtaXR0ZWQgYnkgW1tEb2N1bWVudC5yZW1vdmVJbkxpbmVdXSBhbmQgW1tEb2N1bWVudC5yZW1vdmVOZXdMaW5lXV0pXG4gICAgICogICAgKiBgcmFuZ2VgOiB0aGUgW1tSYW5nZV1dIG9mIHRoZSBjaGFuZ2Ugd2l0aGluIHRoZSBkb2N1bWVudFxuICAgICAqICAgICogYHRleHRgOiB0aGUgdGV4dCB0aGF0J3MgYmVpbmcgcmVtb3ZlZFxuICAgICAqXG4gICAgICogQGV2ZW50IGNoYW5nZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlIENvbnRhaW5zIGF0IGxlYXN0IG9uZSBwcm9wZXJ0eSBjYWxsZWQgYFwiYWN0aW9uXCJgLiBgXCJhY3Rpb25cImAgaW5kaWNhdGVzIHRoZSBhY3Rpb24gdGhhdCB0cmlnZ2VyZWQgdGhlIGNoYW5nZS4gRWFjaCBhY3Rpb24gYWxzbyBoYXMgYSBzZXQgb2YgYWRkaXRpb25hbCBwcm9wZXJ0aWVzLlxuICAgICAqXG4gICAgICoqL1xuXG4gICAgLyoqXG4gICAgICogSW5zZXJ0cyB0aGUgZWxlbWVudHMgaW4gYGxpbmVzYCBpbnRvIHRoZSBkb2N1bWVudCwgc3RhcnRpbmcgYXQgdGhlIHJvdyBpbmRleCBnaXZlbiBieSBgcm93YC5cbiAgICAgKiBUaGlzIG1ldGhvZCBhbHNvIHRyaWdnZXJzIHRoZSBgJ2NoYW5nZSdgIGV2ZW50LlxuICAgICAqXG4gICAgICogQG1ldGhvZCBpbnNlcnRMaW5lc1xuICAgICAqIEBwYXJhbSByb3cge251bWJlcn0gVGhlIGluZGV4IG9mIHRoZSByb3cgdG8gaW5zZXJ0IGF0XG4gICAgICogQHBhcmFtIGxpbmVzIHtBcnJheTxzdHJpbmc+fSBBbiBhcnJheSBvZiBzdHJpbmdzXG4gICAgICogQHJldHVybiB7UG9zaXRpb259IENvbnRhaW5zIHRoZSBmaW5hbCByb3cgYW5kIGNvbHVtbiwgbGlrZSB0aGlzOiAgXG4gICAgICogICBgYGBcbiAgICAgKiAgIHtyb3c6IGVuZFJvdywgY29sdW1uOiAwfVxuICAgICAqICAgYGBgICBcbiAgICAgKiAgIElmIGBsaW5lc2AgaXMgZW1wdHksIHRoaXMgZnVuY3Rpb24gcmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgY3VycmVudCByb3csIGFuZCBjb2x1bW4sIGxpa2UgdGhpczogIFxuICAgICAqICAgYGBgIFxuICAgICAqICAge3Jvdzogcm93LCBjb2x1bW46IDB9XG4gICAgICogICBgYGBcbiAgICAgKi9cbiAgICBpbnNlcnRMaW5lcyhyb3c6IG51bWJlciwgbGluZXM6IHN0cmluZ1tdKTogUG9zaXRpb24ge1xuICAgICAgICBpZiAocm93ID49IHRoaXMuZ2V0TGVuZ3RoKCkpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbnNlcnQoeyByb3c6IHJvdywgY29sdW1uOiAwIH0sIFwiXFxuXCIgKyBsaW5lcy5qb2luKFwiXFxuXCIpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luc2VydExpbmVzKE1hdGgubWF4KHJvdywgMCksIGxpbmVzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9pbnNlcnRMaW5lcyhyb3c6IG51bWJlciwgbGluZXM6IHN0cmluZ1tdKSB7XG4gICAgICAgIGlmIChsaW5lcy5sZW5ndGggPT0gMClcbiAgICAgICAgICAgIHJldHVybiB7IHJvdzogcm93LCBjb2x1bW46IDAgfTtcblxuICAgICAgICAvLyBhcHBseSBkb2Vzbid0IHdvcmsgZm9yIGJpZyBhcnJheXMgKHNtYWxsZXN0IHRocmVzaG9sZCBpcyBvbiBzYWZhcmkgMHhGRkZGKVxuICAgICAgICAvLyB0byBjaXJjdW12ZW50IHRoYXQgd2UgaGF2ZSB0byBicmVhayBodWdlIGluc2VydHMgaW50byBzbWFsbGVyIGNodW5rcyBoZXJlXG4gICAgICAgIHdoaWxlIChsaW5lcy5sZW5ndGggPiAweEYwMDApIHtcbiAgICAgICAgICAgIHZhciBlbmQgPSB0aGlzLl9pbnNlcnRMaW5lcyhyb3csIGxpbmVzLnNsaWNlKDAsIDB4RjAwMCkpO1xuICAgICAgICAgICAgbGluZXMgPSBsaW5lcy5zbGljZSgweEYwMDApO1xuICAgICAgICAgICAgcm93ID0gZW5kLnJvdztcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBhcmdzID0gW3JvdywgMF07XG4gICAgICAgIGFyZ3MucHVzaC5hcHBseShhcmdzLCBsaW5lcyk7XG4gICAgICAgIHRoaXMuJGxpbmVzLnNwbGljZS5hcHBseSh0aGlzLiRsaW5lcywgYXJncyk7XG5cbiAgICAgICAgdmFyIHJhbmdlID0gbmV3IFJhbmdlKHJvdywgMCwgcm93ICsgbGluZXMubGVuZ3RoLCAwKTtcbiAgICAgICAgdmFyIGRlbHRhID0ge1xuICAgICAgICAgICAgYWN0aW9uOiBcImluc2VydExpbmVzXCIsXG4gICAgICAgICAgICByYW5nZTogcmFuZ2UsXG4gICAgICAgICAgICBsaW5lczogbGluZXNcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQGV2ZW50IGNoYW5nZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ldmVudEJ1cy5fc2lnbmFsKFwiY2hhbmdlXCIsIHsgZGF0YTogZGVsdGEgfSk7XG4gICAgICAgIHJldHVybiByYW5nZS5lbmQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5zZXJ0cyBhIG5ldyBsaW5lIGludG8gdGhlIGRvY3VtZW50IGF0IHRoZSBjdXJyZW50IHJvdydzIGBwb3NpdGlvbmAuXG4gICAgICogVGhpcyBtZXRob2QgYWxzbyB0cmlnZ2VycyB0aGUgYCdjaGFuZ2UnYCBldmVudC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgaW5zZXJ0TmV3TGluZVxuICAgICAqIEBwYXJhbSBwb3NpdGlvbiB7UG9zaXRpb259IFRoZSBwb3NpdGlvbiB0byBpbnNlcnQgYXQuXG4gICAgICogQHJldHVybiB7UG9zaXRpb259IFJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGZpbmFsIHJvdyBhbmQgY29sdW1uLCBsaWtlIHRoaXM6PGJyLz5cbiAgICAgKiAgICBgYGBcbiAgICAgKiAgICB7cm93OiBlbmRSb3csIGNvbHVtbjogMH1cbiAgICAgKiAgICBgYGBcbiAgICAgKi9cbiAgICBpbnNlcnROZXdMaW5lKHBvc2l0aW9uOiBQb3NpdGlvbik6IFBvc2l0aW9uIHtcbiAgICAgICAgcG9zaXRpb24gPSAkY2xpcFBvc2l0aW9uKHRoaXMsIHBvc2l0aW9uKTtcbiAgICAgICAgdmFyIGxpbmUgPSB0aGlzLiRsaW5lc1twb3NpdGlvbi5yb3ddIHx8IFwiXCI7XG5cbiAgICAgICAgdGhpcy4kbGluZXNbcG9zaXRpb24ucm93XSA9IGxpbmUuc3Vic3RyaW5nKDAsIHBvc2l0aW9uLmNvbHVtbik7XG4gICAgICAgIHRoaXMuJGxpbmVzLnNwbGljZShwb3NpdGlvbi5yb3cgKyAxLCAwLCBsaW5lLnN1YnN0cmluZyhwb3NpdGlvbi5jb2x1bW4sIGxpbmUubGVuZ3RoKSk7XG5cbiAgICAgICAgdmFyIGVuZDogUG9zaXRpb24gPSB7XG4gICAgICAgICAgICByb3c6IHBvc2l0aW9uLnJvdyArIDEsXG4gICAgICAgICAgICBjb2x1bW46IDBcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZGVsdGEgPSB7XG4gICAgICAgICAgICBhY3Rpb246IFwiaW5zZXJ0VGV4dFwiLFxuICAgICAgICAgICAgcmFuZ2U6IFJhbmdlLmZyb21Qb2ludHMocG9zaXRpb24sIGVuZCksXG4gICAgICAgICAgICB0ZXh0OiB0aGlzLmdldE5ld0xpbmVDaGFyYWN0ZXIoKVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAZXZlbnQgY2hhbmdlXG4gICAgICAgICAqIEBwYXJhbSBkZWx0YSB7RGVsdGF9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV2ZW50QnVzLl9zaWduYWwoXCJjaGFuZ2VcIiwgeyBkYXRhOiBkZWx0YSB9KTtcblxuICAgICAgICByZXR1cm4gZW5kO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEluc2VydHMgYHRleHRgIGludG8gdGhlIGBwb3NpdGlvbmAgYXQgdGhlIGN1cnJlbnQgcm93LlxuICAgICAqIFRoaXMgbWV0aG9kIGFsc28gdHJpZ2dlcnMgdGhlIGAnY2hhbmdlJ2AgZXZlbnQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGluc2VydEluTGluZVxuICAgICAqIEBwYXJhbSBwb3NpdGlvbiB7UG9zaXRpb259IFRoZSBwb3NpdGlvbiB0byBpbnNlcnQgYXQuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHRleHQgQSBjaHVuayBvZiB0ZXh0XG4gICAgICogQHJldHVybiB7UG9zaXRpb259IFJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGZpbmFsIHJvdyBhbmQgY29sdW1uLlxuICAgICAqL1xuICAgIGluc2VydEluTGluZShwb3NpdGlvbjogUG9zaXRpb24sIHRleHQ6IHN0cmluZyk6IFBvc2l0aW9uIHtcblxuICAgICAgICBpZiAodGV4dC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBwb3NpdGlvbjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsaW5lID0gdGhpcy4kbGluZXNbcG9zaXRpb24ucm93XSB8fCBcIlwiO1xuXG4gICAgICAgIHRoaXMuJGxpbmVzW3Bvc2l0aW9uLnJvd10gPSBsaW5lLnN1YnN0cmluZygwLCBwb3NpdGlvbi5jb2x1bW4pICsgdGV4dCArIGxpbmUuc3Vic3RyaW5nKHBvc2l0aW9uLmNvbHVtbik7XG5cbiAgICAgICAgdmFyIGVuZDogUG9zaXRpb24gPSB7XG4gICAgICAgICAgICByb3c6IHBvc2l0aW9uLnJvdyxcbiAgICAgICAgICAgIGNvbHVtbjogcG9zaXRpb24uY29sdW1uICsgdGV4dC5sZW5ndGhcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZGVsdGE6IERlbHRhID0geyBhY3Rpb246IFwiaW5zZXJ0VGV4dFwiLCByYW5nZTogUmFuZ2UuZnJvbVBvaW50cyhwb3NpdGlvbiwgZW5kKSwgdGV4dDogdGV4dCB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAZXZlbnQgY2hhbmdlXG4gICAgICAgICAqIEBwYXJhbSBkZWx0YSB7RGVsdGF9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV2ZW50QnVzLl9zaWduYWwoXCJjaGFuZ2VcIiwgeyBkYXRhOiBkZWx0YSB9KTtcblxuICAgICAgICByZXR1cm4gZW5kO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgb25cbiAgICAgKiBAcGFyYW0gZXZlbnROYW1lIHtzdHJpbmd9XG4gICAgICogQHBhcmFtIGNhbGxiYWNrIHsoZXZlbnQsIHNvdXJjZTogRG9jdW1lbnQpID0+IGFueX1cbiAgICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgICAqL1xuICAgIG9uKGV2ZW50TmFtZTogc3RyaW5nLCBjYWxsYmFjazogKGV2ZW50OiBhbnksIHNvdXJjZTogRG9jdW1lbnQpID0+IGFueSk6IHZvaWQge1xuICAgICAgICB0aGlzLmV2ZW50QnVzLm9uKGV2ZW50TmFtZSwgY2FsbGJhY2ssIGZhbHNlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIG9mZlxuICAgICAqIEBwYXJhbSBldmVudE5hbWUge3N0cmluZ31cbiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgeyhldmVudCwgc291cmNlOiBEb2N1bWVudCkgPT4gYW55fVxuICAgICAqIEByZXR1cm4ge3ZvaWR9XG4gICAgICovXG4gICAgb2ZmKGV2ZW50TmFtZTogc3RyaW5nLCBjYWxsYmFjazogKGV2ZW50OiBhbnksIHNvdXJjZTogRG9jdW1lbnQpID0+IGFueSk6IHZvaWQge1xuICAgICAgICB0aGlzLmV2ZW50QnVzLm9mZihldmVudE5hbWUsIGNhbGxiYWNrKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIHRoZSBgcmFuZ2VgIGZyb20gdGhlIGRvY3VtZW50LlxuICAgICAqXG4gICAgICogQG1ldGhvZCByZW1vdmVcbiAgICAgKiBAcGFyYW0ge1JhbmdlfSByYW5nZSBBIHNwZWNpZmllZCBSYW5nZSB0byByZW1vdmVcbiAgICAgKiBAcmV0dXJuIHtQb3NpdGlvbn0gUmV0dXJucyB0aGUgbmV3IGBzdGFydGAgcHJvcGVydHkgb2YgdGhlIHJhbmdlLlxuICAgICAqIElmIGByYW5nZWAgaXMgZW1wdHksIHRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgdW5tb2RpZmllZCB2YWx1ZSBvZiBgcmFuZ2Uuc3RhcnRgLlxuICAgICAqL1xuICAgIHJlbW92ZShyYW5nZTogUmFuZ2UpOiBQb3NpdGlvbiB7XG4gICAgICAgIGlmICghKHJhbmdlIGluc3RhbmNlb2YgUmFuZ2UpKSB7XG4gICAgICAgICAgICByYW5nZSA9IFJhbmdlLmZyb21Qb2ludHMocmFuZ2Uuc3RhcnQsIHJhbmdlLmVuZCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gY2xpcCB0byBkb2N1bWVudFxuICAgICAgICByYW5nZS5zdGFydCA9ICRjbGlwUG9zaXRpb24odGhpcywgcmFuZ2Uuc3RhcnQpO1xuICAgICAgICByYW5nZS5lbmQgPSAkY2xpcFBvc2l0aW9uKHRoaXMsIHJhbmdlLmVuZCk7XG5cbiAgICAgICAgaWYgKHJhbmdlLmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiByYW5nZS5zdGFydDtcblxuICAgICAgICB2YXIgZmlyc3RSb3cgPSByYW5nZS5zdGFydC5yb3c7XG4gICAgICAgIHZhciBsYXN0Um93ID0gcmFuZ2UuZW5kLnJvdztcblxuICAgICAgICBpZiAocmFuZ2UuaXNNdWx0aUxpbmUoKSkge1xuICAgICAgICAgICAgdmFyIGZpcnN0RnVsbFJvdyA9IHJhbmdlLnN0YXJ0LmNvbHVtbiA9PSAwID8gZmlyc3RSb3cgOiBmaXJzdFJvdyArIDE7XG4gICAgICAgICAgICB2YXIgbGFzdEZ1bGxSb3cgPSBsYXN0Um93IC0gMTtcblxuICAgICAgICAgICAgaWYgKHJhbmdlLmVuZC5jb2x1bW4gPiAwKVxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlSW5MaW5lKGxhc3RSb3csIDAsIHJhbmdlLmVuZC5jb2x1bW4pO1xuXG4gICAgICAgICAgICBpZiAobGFzdEZ1bGxSb3cgPj0gZmlyc3RGdWxsUm93KVxuICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUxpbmVzKGZpcnN0RnVsbFJvdywgbGFzdEZ1bGxSb3cpO1xuXG4gICAgICAgICAgICBpZiAoZmlyc3RGdWxsUm93ICE9IGZpcnN0Um93KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVJbkxpbmUoZmlyc3RSb3csIHJhbmdlLnN0YXJ0LmNvbHVtbiwgdGhpcy5nZXRMaW5lKGZpcnN0Um93KS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlTmV3TGluZShyYW5nZS5zdGFydC5yb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVJbkxpbmUoZmlyc3RSb3csIHJhbmdlLnN0YXJ0LmNvbHVtbiwgcmFuZ2UuZW5kLmNvbHVtbik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJhbmdlLnN0YXJ0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdGhlIHNwZWNpZmllZCBjb2x1bW5zIGZyb20gdGhlIGByb3dgLlxuICAgICAqIFRoaXMgbWV0aG9kIGFsc28gdHJpZ2dlcnMgdGhlIGAnY2hhbmdlJ2AgZXZlbnQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIHJlbW92ZUluTGluZVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSByb3cgVGhlIHJvdyB0byByZW1vdmUgZnJvbVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBzdGFydENvbHVtbiBUaGUgY29sdW1uIHRvIHN0YXJ0IHJlbW92aW5nIGF0IFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBlbmRDb2x1bW4gVGhlIGNvbHVtbiB0byBzdG9wIHJlbW92aW5nIGF0XG4gICAgICogQHJldHVybiB7UG9zaXRpb259IFJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgYHN0YXJ0Um93YCBhbmQgYHN0YXJ0Q29sdW1uYCwgaW5kaWNhdGluZyB0aGUgbmV3IHJvdyBhbmQgY29sdW1uIHZhbHVlcy48YnIvPklmIGBzdGFydENvbHVtbmAgaXMgZXF1YWwgdG8gYGVuZENvbHVtbmAsIHRoaXMgZnVuY3Rpb24gcmV0dXJucyBub3RoaW5nLlxuICAgICAqXG4gICAgICovXG4gICAgcmVtb3ZlSW5MaW5lKHJvdzogbnVtYmVyLCBzdGFydENvbHVtbjogbnVtYmVyLCBlbmRDb2x1bW46IG51bWJlcik6IFBvc2l0aW9uIHtcbiAgICAgICAgaWYgKHN0YXJ0Q29sdW1uID09PSBlbmRDb2x1bW4pXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgdmFyIHJhbmdlID0gbmV3IFJhbmdlKHJvdywgc3RhcnRDb2x1bW4sIHJvdywgZW5kQ29sdW1uKTtcbiAgICAgICAgdmFyIGxpbmUgPSB0aGlzLmdldExpbmUocm93KTtcbiAgICAgICAgdmFyIHJlbW92ZWQgPSBsaW5lLnN1YnN0cmluZyhzdGFydENvbHVtbiwgZW5kQ29sdW1uKTtcbiAgICAgICAgdmFyIG5ld0xpbmUgPSBsaW5lLnN1YnN0cmluZygwLCBzdGFydENvbHVtbikgKyBsaW5lLnN1YnN0cmluZyhlbmRDb2x1bW4sIGxpbmUubGVuZ3RoKTtcbiAgICAgICAgdGhpcy4kbGluZXMuc3BsaWNlKHJvdywgMSwgbmV3TGluZSk7XG5cbiAgICAgICAgdmFyIGRlbHRhID0ge1xuICAgICAgICAgICAgYWN0aW9uOiBcInJlbW92ZVRleHRcIixcbiAgICAgICAgICAgIHJhbmdlOiByYW5nZSxcbiAgICAgICAgICAgIHRleHQ6IHJlbW92ZWRcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQGV2ZW50IGNoYW5nZVxuICAgICAgICAgKiBAcGFyYW0gZGVsdGEge0RlbHRhfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ldmVudEJ1cy5fc2lnbmFsKFwiY2hhbmdlXCIsIHsgZGF0YTogZGVsdGEgfSk7XG4gICAgICAgIHJldHVybiByYW5nZS5zdGFydDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGEgcmFuZ2Ugb2YgZnVsbCBsaW5lcy5cbiAgICAgKiBUaGlzIG1ldGhvZCBhbHNvIHRyaWdnZXJzIHRoZSBgJ2NoYW5nZSdgIGV2ZW50LlxuICAgICAqXG4gICAgICogQG1ldGhvZCByZW1vdmVMaW5lc1xuICAgICAqIEBwYXJhbSBmaXJzdFJvdyB7bnVtYmVyfSBUaGUgZmlyc3Qgcm93IHRvIGJlIHJlbW92ZWQuXG4gICAgICogQHBhcmFtIGxhc3RSb3cge251bWJlcn0gVGhlIGxhc3Qgcm93IHRvIGJlIHJlbW92ZWQuXG4gICAgICogQHJldHVybiB7c3RyaW5nW119IFJldHVybnMgYWxsIHRoZSByZW1vdmVkIGxpbmVzLlxuICAgICAqL1xuICAgIHJlbW92ZUxpbmVzKGZpcnN0Um93OiBudW1iZXIsIGxhc3RSb3c6IG51bWJlcik6IHN0cmluZ1tdIHtcbiAgICAgICAgaWYgKGZpcnN0Um93IDwgMCB8fCBsYXN0Um93ID49IHRoaXMuZ2V0TGVuZ3RoKCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRvY3VtZW50LnJlbW92ZUxpbmVzXCIpXG4gICAgICAgICAgICAvLyBUaGlzIHJldHVybnMgYSBQb3NpdGlvbiwgc28gaXQgaXMgaW5jb21wYXRpYmxlLlxuICAgICAgICAgICAgLy8gcmV0dXJuIHRoaXMucmVtb3ZlKG5ldyBSYW5nZShmaXJzdFJvdywgMCwgbGFzdFJvdyArIDEsIDApKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBUaGlzIHJldHVybnMgYSBzdHJpbmdbXS5cbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlbW92ZUxpbmVzKGZpcnN0Um93LCBsYXN0Um93KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9yZW1vdmVMaW5lcyhmaXJzdFJvdzogbnVtYmVyLCBsYXN0Um93OiBudW1iZXIpOiBzdHJpbmdbXSB7XG4gICAgICAgIHZhciByYW5nZSA9IG5ldyBSYW5nZShmaXJzdFJvdywgMCwgbGFzdFJvdyArIDEsIDApO1xuICAgICAgICB2YXIgcmVtb3ZlZCA9IHRoaXMuJGxpbmVzLnNwbGljZShmaXJzdFJvdywgbGFzdFJvdyAtIGZpcnN0Um93ICsgMSk7XG5cbiAgICAgICAgdmFyIGRlbHRhID0ge1xuICAgICAgICAgICAgYWN0aW9uOiBcInJlbW92ZUxpbmVzXCIsXG4gICAgICAgICAgICByYW5nZTogcmFuZ2UsXG4gICAgICAgICAgICBubDogdGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCksXG4gICAgICAgICAgICBsaW5lczogcmVtb3ZlZFxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAZXZlbnQgY2hhbmdlXG4gICAgICAgICAqIEBwYXJhbSBkZWx0YSB7RGVsdGF9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV2ZW50QnVzLl9zaWduYWwoXCJjaGFuZ2VcIiwgeyBkYXRhOiBkZWx0YSB9KTtcbiAgICAgICAgcmV0dXJuIHJlbW92ZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyB0aGUgbmV3IGxpbmUgYmV0d2VlbiBgcm93YCBhbmQgdGhlIHJvdyBpbW1lZGlhdGVseSBmb2xsb3dpbmcgaXQuXG4gICAgICogVGhpcyBtZXRob2QgYWxzbyB0cmlnZ2VycyB0aGUgYCdjaGFuZ2UnYCBldmVudC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgcmVtb3ZlTmV3TGluZVxuICAgICAqIEBwYXJhbSByb3cge251bWJlcn0gVGhlIHJvdyB0byBjaGVjay5cbiAgICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgICAqL1xuICAgIHJlbW92ZU5ld0xpbmUocm93OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgdmFyIGZpcnN0TGluZSA9IHRoaXMuZ2V0TGluZShyb3cpO1xuICAgICAgICB2YXIgc2Vjb25kTGluZSA9IHRoaXMuZ2V0TGluZShyb3cgKyAxKTtcblxuICAgICAgICB2YXIgcmFuZ2UgPSBuZXcgUmFuZ2Uocm93LCBmaXJzdExpbmUubGVuZ3RoLCByb3cgKyAxLCAwKTtcbiAgICAgICAgdmFyIGxpbmUgPSBmaXJzdExpbmUgKyBzZWNvbmRMaW5lO1xuXG4gICAgICAgIHRoaXMuJGxpbmVzLnNwbGljZShyb3csIDIsIGxpbmUpO1xuXG4gICAgICAgIHZhciBkZWx0YSA9IHtcbiAgICAgICAgICAgIGFjdGlvbjogXCJyZW1vdmVUZXh0XCIsXG4gICAgICAgICAgICByYW5nZTogcmFuZ2UsXG4gICAgICAgICAgICB0ZXh0OiB0aGlzLmdldE5ld0xpbmVDaGFyYWN0ZXIoKVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAZXZlbnQgY2hhbmdlXG4gICAgICAgICAqIEBwYXJhbSBkZWx0YSB7RGVsdGF9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV2ZW50QnVzLl9zaWduYWwoXCJjaGFuZ2VcIiwgeyBkYXRhOiBkZWx0YSB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXBsYWNlcyBhIHJhbmdlIGluIHRoZSBkb2N1bWVudCB3aXRoIHRoZSBuZXcgYHRleHRgLlxuICAgICAqXG4gICAgICogQG1ldGhvZCByZXBsYWNlXG4gICAgICogQHBhcmFtIHJhbmdlIHtSYW5nZX0gQSBzcGVjaWZpZWQgUmFuZ2UgdG8gcmVwbGFjZS5cbiAgICAgKiBAcGFyYW0gdGV4dCB7c3RyaW5nfSBUaGUgbmV3IHRleHQgdG8gdXNlIGFzIGEgcmVwbGFjZW1lbnQuXG4gICAgICogQHJldHVybiB7UG9zdGlvbn0gUmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgZmluYWwgcm93IGFuZCBjb2x1bW4sIGxpa2UgdGhpczpcbiAgICAgKiAgICAge3JvdzogZW5kUm93LCBjb2x1bW46IDB9XG4gICAgICogSWYgdGhlIHRleHQgYW5kIHJhbmdlIGFyZSBlbXB0eSwgdGhpcyBmdW5jdGlvbiByZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBjdXJyZW50IGByYW5nZS5zdGFydGAgdmFsdWUuXG4gICAgICogSWYgdGhlIHRleHQgaXMgdGhlIGV4YWN0IHNhbWUgYXMgd2hhdCBjdXJyZW50bHkgZXhpc3RzLCB0aGlzIGZ1bmN0aW9uIHJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGN1cnJlbnQgYHJhbmdlLmVuZGAgdmFsdWUuXG4gICAgICovXG4gICAgcmVwbGFjZShyYW5nZTogUmFuZ2UsIHRleHQ6IHN0cmluZyk6IFBvc2l0aW9uIHtcbiAgICAgICAgaWYgKHRleHQubGVuZ3RoID09PSAwICYmIHJhbmdlLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHJhbmdlLnN0YXJ0O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2hvcnRjdXQ6IElmIHRoZSB0ZXh0IHdlIHdhbnQgdG8gaW5zZXJ0IGlzIHRoZSBzYW1lIGFzIGl0IGlzIGFscmVhZHlcbiAgICAgICAgLy8gaW4gdGhlIGRvY3VtZW50LCB3ZSBkb24ndCBoYXZlIHRvIHJlcGxhY2UgYW55dGhpbmcuXG4gICAgICAgIGlmICh0ZXh0ID09PSB0aGlzLmdldFRleHRSYW5nZShyYW5nZSkpIHtcbiAgICAgICAgICAgIHJldHVybiByYW5nZS5lbmQ7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlbW92ZShyYW5nZSk7XG5cbiAgICAgICAgaWYgKHRleHQpIHtcbiAgICAgICAgICAgIHZhciBlbmQgPSB0aGlzLmluc2VydChyYW5nZS5zdGFydCwgdGV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBlbmQgPSByYW5nZS5zdGFydDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBlbmQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXBwbGllcyBhbGwgdGhlIGNoYW5nZXMgcHJldmlvdXNseSBhY2N1bXVsYXRlZC5cbiAgICAgKiBUaGVzZSBjYW4gYmUgZWl0aGVyIGAnaW5jbHVkZVRleHQnYCwgYCdpbnNlcnRMaW5lcydgLCBgJ3JlbW92ZVRleHQnYCwgYW5kIGAncmVtb3ZlTGluZXMnYC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgYXBwbHlEZWx0YXNcbiAgICAgKiBAcGFyYW0gZGVsdGFzIHtEZWx0YVtdfVxuICAgICAqIEByZXR1cm4ge3ZvaWR9XG4gICAgICovXG4gICAgYXBwbHlEZWx0YXMoZGVsdGFzOiBEZWx0YVtdKTogdm9pZCB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGVsdGFzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgZGVsdGEgPSBkZWx0YXNbaV07XG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSBSYW5nZS5mcm9tUG9pbnRzKGRlbHRhLnJhbmdlLnN0YXJ0LCBkZWx0YS5yYW5nZS5lbmQpO1xuXG4gICAgICAgICAgICBpZiAoZGVsdGEuYWN0aW9uID09IFwiaW5zZXJ0TGluZXNcIilcbiAgICAgICAgICAgICAgICB0aGlzLmluc2VydExpbmVzKHJhbmdlLnN0YXJ0LnJvdywgZGVsdGEubGluZXMpO1xuICAgICAgICAgICAgZWxzZSBpZiAoZGVsdGEuYWN0aW9uID09IFwiaW5zZXJ0VGV4dFwiKVxuICAgICAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHJhbmdlLnN0YXJ0LCBkZWx0YS50ZXh0KTtcbiAgICAgICAgICAgIGVsc2UgaWYgKGRlbHRhLmFjdGlvbiA9PSBcInJlbW92ZUxpbmVzXCIpXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlTGluZXMocmFuZ2Uuc3RhcnQucm93LCByYW5nZS5lbmQucm93IC0gMSk7XG4gICAgICAgICAgICBlbHNlIGlmIChkZWx0YS5hY3Rpb24gPT0gXCJyZW1vdmVUZXh0XCIpXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUocmFuZ2UpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV2ZXJ0cyBhbnkgY2hhbmdlcyBwcmV2aW91c2x5IGFwcGxpZWQuXG4gICAgICogVGhlc2UgY2FuIGJlIGVpdGhlciBgJ2luY2x1ZGVUZXh0J2AsIGAnaW5zZXJ0TGluZXMnYCwgYCdyZW1vdmVUZXh0J2AsIGFuZCBgJ3JlbW92ZUxpbmVzJ2AuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIHJldmVydERlbHRhc1xuICAgICAqIEBwYXJhbSBkZWx0YXMge0RlbHRhW119XG4gICAgICogQHJldHVybiB7dm9pZH1cbiAgICAgKi9cbiAgICByZXZlcnREZWx0YXMoZGVsdGFzOiBEZWx0YVtdKTogdm9pZCB7XG4gICAgICAgIGZvciAodmFyIGkgPSBkZWx0YXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIHZhciBkZWx0YSA9IGRlbHRhc1tpXTtcblxuICAgICAgICAgICAgdmFyIHJhbmdlID0gUmFuZ2UuZnJvbVBvaW50cyhkZWx0YS5yYW5nZS5zdGFydCwgZGVsdGEucmFuZ2UuZW5kKTtcblxuICAgICAgICAgICAgaWYgKGRlbHRhLmFjdGlvbiA9PSBcImluc2VydExpbmVzXCIpXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlTGluZXMocmFuZ2Uuc3RhcnQucm93LCByYW5nZS5lbmQucm93IC0gMSk7XG4gICAgICAgICAgICBlbHNlIGlmIChkZWx0YS5hY3Rpb24gPT0gXCJpbnNlcnRUZXh0XCIpXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUocmFuZ2UpO1xuICAgICAgICAgICAgZWxzZSBpZiAoZGVsdGEuYWN0aW9uID09IFwicmVtb3ZlTGluZXNcIilcbiAgICAgICAgICAgICAgICB0aGlzLl9pbnNlcnRMaW5lcyhyYW5nZS5zdGFydC5yb3csIGRlbHRhLmxpbmVzKTtcbiAgICAgICAgICAgIGVsc2UgaWYgKGRlbHRhLmFjdGlvbiA9PSBcInJlbW92ZVRleHRcIilcbiAgICAgICAgICAgICAgICB0aGlzLmluc2VydChyYW5nZS5zdGFydCwgZGVsdGEudGV4dCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBhbiBpbmRleCBwb3NpdGlvbiBpbiBhIGRvY3VtZW50IHRvIGEgYHtyb3csIGNvbHVtbn1gIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEluZGV4IHJlZmVycyB0byB0aGUgXCJhYnNvbHV0ZSBwb3NpdGlvblwiIG9mIGEgY2hhcmFjdGVyIGluIHRoZSBkb2N1bWVudC4gRm9yIGV4YW1wbGU6XG4gICAgICpcbiAgICAgKiBgYGBqYXZhc2NyaXB0XG4gICAgICogdmFyIHggPSAwOyAvLyAxMCBjaGFyYWN0ZXJzLCBwbHVzIG9uZSBmb3IgbmV3bGluZVxuICAgICAqIHZhciB5ID0gLTE7XG4gICAgICogYGBgXG4gICAgICogXG4gICAgICogSGVyZSwgYHlgIGlzIGFuIGluZGV4IDE1OiAxMSBjaGFyYWN0ZXJzIGZvciB0aGUgZmlyc3Qgcm93LCBhbmQgNSBjaGFyYWN0ZXJzIHVudGlsIGB5YCBpbiB0aGUgc2Vjb25kLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBpbmRleFRvUG9zaXRpb25cbiAgICAgKiBAcGFyYW0gaW5kZXgge251bWJlcn0gQW4gaW5kZXggdG8gY29udmVydFxuICAgICAqIEBwYXJhbSBzdGFydFJvdyB7bnVtYmVyfSBUaGUgcm93IGZyb20gd2hpY2ggdG8gc3RhcnQgdGhlIGNvbnZlcnNpb25cbiAgICAgKiBAcmV0dXJuIHtQb3NpdGlvbn0gQSBge3JvdywgY29sdW1ufWAgb2JqZWN0IG9mIHRoZSBgaW5kZXhgIHBvc2l0aW9uLlxuICAgICAqL1xuICAgIGluZGV4VG9Qb3NpdGlvbihpbmRleDogbnVtYmVyLCBzdGFydFJvdzogbnVtYmVyKTogUG9zaXRpb24ge1xuICAgICAgICB2YXIgbGluZXMgPSB0aGlzLiRsaW5lcyB8fCB0aGlzLmdldEFsbExpbmVzKCk7XG4gICAgICAgIHZhciBuZXdsaW5lTGVuZ3RoID0gdGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCkubGVuZ3RoO1xuICAgICAgICBmb3IgKHZhciBpID0gc3RhcnRSb3cgfHwgMCwgbCA9IGxpbmVzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgaW5kZXggLT0gbGluZXNbaV0ubGVuZ3RoICsgbmV3bGluZUxlbmd0aDtcbiAgICAgICAgICAgIGlmIChpbmRleCA8IDApXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgcm93OiBpLCBjb2x1bW46IGluZGV4ICsgbGluZXNbaV0ubGVuZ3RoICsgbmV3bGluZUxlbmd0aCB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHJvdzogbCAtIDEsIGNvbHVtbjogbGluZXNbbCAtIDFdLmxlbmd0aCB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIHRoZSBge3JvdywgY29sdW1ufWAgcG9zaXRpb24gaW4gYSBkb2N1bWVudCB0byB0aGUgY2hhcmFjdGVyJ3MgaW5kZXguXG4gICAgICpcbiAgICAgKiBJbmRleCByZWZlcnMgdG8gdGhlIFwiYWJzb2x1dGUgcG9zaXRpb25cIiBvZiBhIGNoYXJhY3RlciBpbiB0aGUgZG9jdW1lbnQuIEZvciBleGFtcGxlOlxuICAgICAqXG4gICAgICogYGBgamF2YXNjcmlwdFxuICAgICAqIHZhciB4ID0gMDsgLy8gMTAgY2hhcmFjdGVycywgcGx1cyBvbmUgZm9yIG5ld2xpbmVcbiAgICAgKiB2YXIgeSA9IC0xO1xuICAgICAqIGBgYFxuICAgICAqIFxuICAgICAqIEhlcmUsIGB5YCBpcyBhbiBpbmRleCAxNTogMTEgY2hhcmFjdGVycyBmb3IgdGhlIGZpcnN0IHJvdywgYW5kIDUgY2hhcmFjdGVycyB1bnRpbCBgeWAgaW4gdGhlIHNlY29uZC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgcG9zaXRpb25Ub0luZGV4XG4gICAgICogQHBhcmFtIHtQb3NpdGlvbn0gcG9zIFRoZSBge3JvdywgY29sdW1ufWAgdG8gY29udmVydC5cbiAgICAgKiBAcGFyYW0gc3RhcnRSb3cge251bWJlcn0gVGhlIHJvdyBmcm9tIHdoaWNoIHRvIHN0YXJ0IHRoZSBjb252ZXJzaW9uXG4gICAgICogQHJldHVybiB7bnVtYmVyfSBUaGUgaW5kZXggcG9zaXRpb24gaW4gdGhlIGRvY3VtZW50LlxuICAgICAqL1xuICAgIHBvc2l0aW9uVG9JbmRleChwb3M6IFBvc2l0aW9uLCBzdGFydFJvdzogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgdmFyIGxpbmVzID0gdGhpcy4kbGluZXMgfHwgdGhpcy5nZXRBbGxMaW5lcygpO1xuICAgICAgICB2YXIgbmV3bGluZUxlbmd0aCA9IHRoaXMuZ2V0TmV3TGluZUNoYXJhY3RlcigpLmxlbmd0aDtcbiAgICAgICAgdmFyIGluZGV4ID0gMDtcbiAgICAgICAgdmFyIHJvdyA9IE1hdGgubWluKHBvcy5yb3csIGxpbmVzLmxlbmd0aCk7XG4gICAgICAgIGZvciAodmFyIGkgPSBzdGFydFJvdyB8fCAwOyBpIDwgcm93OyArK2kpXG4gICAgICAgICAgICBpbmRleCArPSBsaW5lc1tpXS5sZW5ndGggKyBuZXdsaW5lTGVuZ3RoO1xuXG4gICAgICAgIHJldHVybiBpbmRleCArIHBvcy5jb2x1bW47XG4gICAgfVxufVxuIl19