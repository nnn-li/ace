"use strict";
export default class UndoManager {
    constructor() {
        this.reset();
    }
    execute(options) {
        var deltas = options.args[0];
        this._editSession = options.args[1];
        if (options.merge && this.hasUndo()) {
            this._dirtyCounter--;
            deltas = this.$undoStack.pop().concat(deltas);
        }
        this.$undoStack.push(deltas);
        this.$redoStack = [];
        if (this._dirtyCounter < 0) {
            this._dirtyCounter = NaN;
        }
        this._dirtyCounter++;
    }
    undo(dontSelect) {
        var deltas = this.$undoStack.pop();
        var undoSelectionRange = null;
        if (deltas) {
            undoSelectionRange = this._editSession.undoChanges(deltas, dontSelect);
            this.$redoStack.push(deltas);
            this._dirtyCounter--;
        }
        return undoSelectionRange;
    }
    redo(dontSelect) {
        var deltas = this.$redoStack.pop();
        var redoSelectionRange = null;
        if (deltas) {
            redoSelectionRange = this._editSession.redoChanges(deltas, dontSelect);
            this.$undoStack.push(deltas);
            this._dirtyCounter++;
        }
        return redoSelectionRange;
    }
    reset() {
        this.$undoStack = [];
        this.$redoStack = [];
        this.markClean();
    }
    hasUndo() {
        return this.$undoStack.length > 0;
    }
    hasRedo() {
        return this.$redoStack.length > 0;
    }
    markClean() {
        this._dirtyCounter = 0;
    }
    isClean() {
        return this._dirtyCounter === 0;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVW5kb01hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJVbmRvTWFuYWdlci50cyJdLCJuYW1lcyI6WyJVbmRvTWFuYWdlciIsIlVuZG9NYW5hZ2VyLmNvbnN0cnVjdG9yIiwiVW5kb01hbmFnZXIuZXhlY3V0ZSIsIlVuZG9NYW5hZ2VyLnVuZG8iLCJVbmRvTWFuYWdlci5yZWRvIiwiVW5kb01hbmFnZXIucmVzZXQiLCJVbmRvTWFuYWdlci5oYXNVbmRvIiwiVW5kb01hbmFnZXIuaGFzUmVkbyIsIlVuZG9NYW5hZ2VyLm1hcmtDbGVhbiIsIlVuZG9NYW5hZ2VyLmlzQ2xlYW4iXSwibWFwcGluZ3MiOiJBQW9EQSxZQUFZLENBQUM7QUFVYjtJQTBCSUE7UUFDSUMsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7SUFDakJBLENBQUNBO0lBWURELE9BQU9BLENBQUNBLE9BQXlEQTtRQUM3REUsSUFBSUEsTUFBTUEsR0FBR0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDN0JBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ3BDQSxFQUFFQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxLQUFLQSxJQUFJQSxJQUFJQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNsQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsRUFBRUEsQ0FBQ0E7WUFDckJBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ2xEQSxDQUFDQTtRQUNEQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUM3QkEsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFFckJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBR3pCQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUM3QkEsQ0FBQ0E7UUFDREEsSUFBSUEsQ0FBQ0EsYUFBYUEsRUFBRUEsQ0FBQ0E7SUFDekJBLENBQUNBO0lBU0RGLElBQUlBLENBQUNBLFVBQW9CQTtRQUNyQkcsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDbkNBLElBQUlBLGtCQUFrQkEsR0FBVUEsSUFBSUEsQ0FBQ0E7UUFDckNBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1lBQ1RBLGtCQUFrQkEsR0FBR0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsTUFBTUEsRUFBRUEsVUFBVUEsQ0FBQ0EsQ0FBQ0E7WUFDdkVBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1lBQzdCQSxJQUFJQSxDQUFDQSxhQUFhQSxFQUFFQSxDQUFDQTtRQUN6QkEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQTtJQUM5QkEsQ0FBQ0E7SUFRREgsSUFBSUEsQ0FBQ0EsVUFBb0JBO1FBQ3JCSSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNuQ0EsSUFBSUEsa0JBQWtCQSxHQUFVQSxJQUFJQSxDQUFDQTtRQUNyQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDVEEsa0JBQWtCQSxHQUFHQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxXQUFXQSxDQUFDQSxNQUFNQSxFQUFFQSxVQUFVQSxDQUFDQSxDQUFDQTtZQUN2RUEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDN0JBLElBQUlBLENBQUNBLGFBQWFBLEVBQUVBLENBQUNBO1FBQ3pCQSxDQUFDQTtRQUNEQSxNQUFNQSxDQUFDQSxrQkFBa0JBLENBQUNBO0lBQzlCQSxDQUFDQTtJQVFESixLQUFLQTtRQUNESyxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNyQkEsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDckJBLElBQUlBLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBO0lBQ3JCQSxDQUFDQTtJQVFETCxPQUFPQTtRQUNITSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUN0Q0EsQ0FBQ0E7SUFRRE4sT0FBT0E7UUFDSE8sTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFDdENBLENBQUNBO0lBUURQLFNBQVNBO1FBQ0xRLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLENBQUNBLENBQUNBO0lBQzNCQSxDQUFDQTtJQVFEUixPQUFPQTtRQUNIUyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxLQUFLQSxDQUFDQSxDQUFDQTtJQUNwQ0EsQ0FBQ0E7QUFDTFQsQ0FBQ0E7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qICoqKioqIEJFR0lOIExJQ0VOU0UgQkxPQ0sgKioqKipcbiAqIFRoZSBNSVQgTGljZW5zZSAoTUlUKVxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxNC0yMDE2IERhdmlkIEdlbyBIb2xtZXMgPGRhdmlkLmdlby5ob2xtZXNAZ21haWwuY29tPlxuICpcbiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAqXG4gKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbiAqIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4gKlxuICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuICogU09GVFdBUkUuXG4gKiAqKioqKiBFTkQgTElDRU5TRSBCTE9DSyAqKioqKiAqL1xuLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMCwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIFxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0XG4gKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDpcbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuXG4gKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodFxuICogICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZVxuICogICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cbiAqICAgICAqIE5laXRoZXIgdGhlIG5hbWUgb2YgQWpheC5vcmcgQi5WLiBub3IgdGhlXG4gKiAgICAgICBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0c1xuICogICAgICAgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXG4gKiBcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiIEFORFxuICogQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRURcbiAqIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkVcbiAqIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIEFKQVguT1JHIEIuVi4gQkUgTElBQkxFIEZPUiBBTllcbiAqIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTXG4gKiAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7XG4gKiBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkRcbiAqIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUXG4gKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJU1xuICogU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG4gKlxuICogKioqKiogRU5EIExJQ0VOU0UgQkxPQ0sgKioqKiogKi9cblwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgRWRpdFNlc3Npb24gZnJvbSAnLi9FZGl0U2Vzc2lvbic7XG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi9SYW5nZSc7XG5cbi8qKlxuICogVGhpcyBvYmplY3QgbWFpbnRhaW5zIHRoZSB1bmRvIHN0YWNrIGZvciBhbiA8Y29kZT5FZGl0U2Vzc2lvbjwvY29kZT4uXG4gKlxuICogQGNsYXNzIFVuZG9NYW5hZ2VyXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFVuZG9NYW5hZ2VyIHtcblxuICAgIC8qKlxuICAgICAqIEBwcm9wZXJ0eSBfZWRpdFNlc3Npb25cbiAgICAgKiBAdHlwZSBFZGl0U2Vzc2lvblxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSBfZWRpdFNlc3Npb246IEVkaXRTZXNzaW9uO1xuXG4gICAgLyoqXG4gICAgICogQHByb3BlcnR5IF9kaXJ0eUNvdW50ZXJcbiAgICAgKiBAdHlwZSBudW1iZXJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgX2RpcnR5Q291bnRlcjogbnVtYmVyO1xuXG4gICAgLy8gRklYTUU6IHR5cGUgYW5kIGRvY3VtZW50YXRpb24uXG4gICAgcHJpdmF0ZSAkdW5kb1N0YWNrOiBhbnlbXTtcbiAgICBwcml2YXRlICRyZWRvU3RhY2s6IGFueVtdO1xuXG4gICAgLyoqXG4gICAgICogUmVzZXRzIHRoZSBjdXJyZW50IHVuZG8gc3RhdGUuXG4gICAgICpcbiAgICAgKiBAY2xhc3MgVW5kb01hbmFnZXJcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFByb3ZpZGVzIGEgbWVhbnMgZm9yIGltcGxlbWVudGluZyB5b3VyIG93biB1bmRvIG1hbmFnZXIuIGBvcHRpb25zYCBoYXMgb25lIHByb3BlcnR5LCBgYXJnc2AsIGFuIFtbQXJyYXkgYEFycmF5YF1dLCB3aXRoIHR3byBlbGVtZW50czpcbiAgICAgKlxuICAgICAqIC0gYGFyZ3NbMF1gIGlzIGFuIGFycmF5IG9mIGRlbHRhc1xuICAgICAqIC0gYGFyZ3NbMV1gIGlzIHRoZSBkb2N1bWVudCB0byBhc3NvY2lhdGUgd2l0aFxuICAgICAqXG4gICAgICogQG1ldGhvZCBleGVjdXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgQ29udGFpbnMgYWRkaXRpb25hbCBwcm9wZXJ0aWVzXG4gICAgICpcbiAgICAgKiovXG4gICAgZXhlY3V0ZShvcHRpb25zOiB7IGFjdGlvbj86IHN0cmluZzsgYXJnczogYW55W107IG1lcmdlOiBib29sZWFuIH0pOiB2b2lkIHtcbiAgICAgICAgdmFyIGRlbHRhcyA9IG9wdGlvbnMuYXJnc1swXTtcbiAgICAgICAgdGhpcy5fZWRpdFNlc3Npb24gPSBvcHRpb25zLmFyZ3NbMV07XG4gICAgICAgIGlmIChvcHRpb25zLm1lcmdlICYmIHRoaXMuaGFzVW5kbygpKSB7XG4gICAgICAgICAgICB0aGlzLl9kaXJ0eUNvdW50ZXItLTtcbiAgICAgICAgICAgIGRlbHRhcyA9IHRoaXMuJHVuZG9TdGFjay5wb3AoKS5jb25jYXQoZGVsdGFzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiR1bmRvU3RhY2sucHVzaChkZWx0YXMpO1xuICAgICAgICB0aGlzLiRyZWRvU3RhY2sgPSBbXTtcblxuICAgICAgICBpZiAodGhpcy5fZGlydHlDb3VudGVyIDwgMCkge1xuICAgICAgICAgICAgLy8gVGhlIHVzZXIgaGFzIG1hZGUgYSBjaGFuZ2UgYWZ0ZXIgdW5kb2luZyBwYXN0IHRoZSBsYXN0IGNsZWFuIHN0YXRlLlxuICAgICAgICAgICAgLy8gV2UgY2FuIG5ldmVyIGdldCBiYWNrIHRvIGEgY2xlYW4gc3RhdGUgbm93IHVudGlsIG1hcmtDbGVhbigpIGlzIGNhbGxlZC5cbiAgICAgICAgICAgIHRoaXMuX2RpcnR5Q291bnRlciA9IE5hTjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9kaXJ0eUNvdW50ZXIrKztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtIGFuIHVuZG8gb3BlcmF0aW9uIG9uIHRoZSBkb2N1bWVudCwgcmV2ZXJ0aW5nIHRoZSBsYXN0IGNoYW5nZS5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgdW5kb1xuICAgICAqIEBwYXJhbSBbZG9udFNlbGVjdF0ge2Jvb2xlYW59XG4gICAgICogQHJldHVybiB7UmFuZ2V9IFRoZSByYW5nZSBvZiB0aGUgdW5kby5cbiAgICAgKi9cbiAgICB1bmRvKGRvbnRTZWxlY3Q/OiBib29sZWFuKTogUmFuZ2Uge1xuICAgICAgICB2YXIgZGVsdGFzID0gdGhpcy4kdW5kb1N0YWNrLnBvcCgpO1xuICAgICAgICB2YXIgdW5kb1NlbGVjdGlvblJhbmdlOiBSYW5nZSA9IG51bGw7XG4gICAgICAgIGlmIChkZWx0YXMpIHtcbiAgICAgICAgICAgIHVuZG9TZWxlY3Rpb25SYW5nZSA9IHRoaXMuX2VkaXRTZXNzaW9uLnVuZG9DaGFuZ2VzKGRlbHRhcywgZG9udFNlbGVjdCk7XG4gICAgICAgICAgICB0aGlzLiRyZWRvU3RhY2sucHVzaChkZWx0YXMpO1xuICAgICAgICAgICAgdGhpcy5fZGlydHlDb3VudGVyLS07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVuZG9TZWxlY3Rpb25SYW5nZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtIGEgcmVkbyBvcGVyYXRpb24gb24gdGhlIGRvY3VtZW50LCByZWltcGxlbWVudGluZyB0aGUgbGFzdCBjaGFuZ2UuXG4gICAgICogQG1ldGhvZCByZWRvXG4gICAgICogQHBhcmFtIFtkb250U2VsZWN0XSB7Ym9vbGVhbn1cbiAgICAgKiBAcmV0dXJuIHtSYW5nZX0gVGhlIHJhbmdlIG9mIHRoZSByZWRvLlxuICAgICAqL1xuICAgIHJlZG8oZG9udFNlbGVjdD86IGJvb2xlYW4pOiBSYW5nZSB7XG4gICAgICAgIHZhciBkZWx0YXMgPSB0aGlzLiRyZWRvU3RhY2sucG9wKCk7XG4gICAgICAgIHZhciByZWRvU2VsZWN0aW9uUmFuZ2U6IFJhbmdlID0gbnVsbDtcbiAgICAgICAgaWYgKGRlbHRhcykge1xuICAgICAgICAgICAgcmVkb1NlbGVjdGlvblJhbmdlID0gdGhpcy5fZWRpdFNlc3Npb24ucmVkb0NoYW5nZXMoZGVsdGFzLCBkb250U2VsZWN0KTtcbiAgICAgICAgICAgIHRoaXMuJHVuZG9TdGFjay5wdXNoKGRlbHRhcyk7XG4gICAgICAgICAgICB0aGlzLl9kaXJ0eUNvdW50ZXIrKztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVkb1NlbGVjdGlvblJhbmdlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlc3Ryb3lzIHRoZSBzdGFjayBvZiB1bmRvIGFuZCByZWRvIHJlZG8gb3BlcmF0aW9ucyBhbmQgbWFya3MgdGhlIG1hbmFnZXIgYXMgY2xlYW4uXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIHJlc2V0XG4gICAgICogQHJldHVybiB7dm9pZH1cbiAgICAgKi9cbiAgICByZXNldCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy4kdW5kb1N0YWNrID0gW107XG4gICAgICAgIHRoaXMuJHJlZG9TdGFjayA9IFtdO1xuICAgICAgICB0aGlzLm1hcmtDbGVhbigpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYHRydWVgIGlmIHRoZXJlIGFyZSB1bmRvIG9wZXJhdGlvbnMgbGVmdCB0byBwZXJmb3JtLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBoYXNVbmRvXG4gICAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBoYXNVbmRvKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy4kdW5kb1N0YWNrLmxlbmd0aCA+IDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlcmUgYXJlIHJlZG8gb3BlcmF0aW9ucyBsZWZ0IHRvIHBlcmZvcm0uXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGhhc1JlZG9cbiAgICAgKiBAcmV0dXJuIHtib29sZWFufVxuICAgICAqL1xuICAgIGhhc1JlZG8oKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLiRyZWRvU3RhY2subGVuZ3RoID4gMDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYXJrcyB0aGUgY3VycmVudCBzdGF0dXMgY2xlYW4uXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIG1hcmtDbGVhblxuICAgICAqIEByZXR1cm4ge3ZvaWR9XG4gICAgICovXG4gICAgbWFya0NsZWFuKCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9kaXJ0eUNvdW50ZXIgPSAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgd2hldGhlciB0aGUgY3VycmVudCBzdGF0dXMgaXMgY2xlYW4uXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGlzQ2xlYW5cbiAgICAgKiBAcmV0dXJuIHtib29sZWFufVxuICAgICAqL1xuICAgIGlzQ2xlYW4oKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kaXJ0eUNvdW50ZXIgPT09IDA7XG4gICAgfVxufVxuIl19