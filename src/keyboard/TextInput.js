"use strict";
import { addCommandKeyListener, addListener, capture, preventDefault } from "../lib/event";
import { isChrome, isGecko, isIE, isMac, isOldIE, isTouchPad, isWebKit, isWin } from "../lib/useragent";
import { createElement } from "../lib/dom";
import { delayedCall } from "../lib/lang";
var BROKEN_SETDATA = isChrome < 18;
var USE_IE_MIME_TYPE = isIE;
export default class TextInput {
    constructor(container, editor) {
        var text = createElement("textarea");
        text.className = "ace_text-input";
        if (isTouchPad) {
            text.setAttribute("x-palm-disable-auto-cap", 'true');
        }
        text.wrap = "off";
        text['autocorrect'] = "off";
        text['autocapitalize'] = "off";
        text.spellcheck = false;
        text.style.opacity = "0";
        container.insertBefore(text, container.firstChild);
        var PLACEHOLDER = "\x01\x01";
        var copied = false;
        var pasted = false;
        var inComposition = false;
        var tempStyle = '';
        var isSelectionEmpty = true;
        try {
            var isFocused = document.activeElement === text;
        }
        catch (e) { }
        addListener(text, "blur", function () {
            editor.onBlur();
            isFocused = false;
        });
        addListener(text, "focus", function () {
            isFocused = true;
            editor.onFocus();
            resetSelection();
        });
        this.focus = function () { text.focus(); };
        this.blur = function () { text.blur(); };
        this.isFocused = function () {
            return isFocused;
        };
        var syncSelection = delayedCall(function () {
            isFocused && resetSelection(isSelectionEmpty);
        });
        var syncValue = delayedCall(function () {
            if (!inComposition) {
                text.value = PLACEHOLDER;
                isFocused && resetSelection();
            }
        });
        function resetSelection(isEmpty) {
            if (inComposition)
                return;
            if (inputHandler) {
                selectionStart = 0;
                selectionEnd = isEmpty ? 0 : text.value.length - 1;
            }
            else {
                var selectionStart = isEmpty ? 2 : 1;
                var selectionEnd = 2;
            }
            try {
                text.setSelectionRange(selectionStart, selectionEnd);
            }
            catch (e) { }
        }
        function resetValue() {
            if (inComposition)
                return;
            text.value = PLACEHOLDER;
            if (isWebKit)
                syncValue.schedule();
        }
        isWebKit || editor.on('changeSelection', function (event, editor) {
            if (editor.selection.isEmpty() != isSelectionEmpty) {
                isSelectionEmpty = !isSelectionEmpty;
                syncSelection.schedule();
            }
        });
        resetValue();
        if (isFocused)
            editor.onFocus();
        var isAllSelected = function (text) {
            return text.selectionStart === 0 && text.selectionEnd === text.value.length;
        };
        if (!text.setSelectionRange && text.createTextRange) {
            text.setSelectionRange = function (selectionStart, selectionEnd) {
                var range = this.createTextRange();
                range.collapse(true);
                range.moveStart('character', selectionStart);
                range.moveEnd('character', selectionEnd);
                range.select();
            };
            isAllSelected = function (text) {
                try {
                    var range = text.ownerDocument['selection'].createRange();
                }
                catch (e) {
                }
                if (!range || range.parentElement() != text)
                    return false;
                return range.text == text.value;
            };
        }
        if (isOldIE) {
            var inPropertyChange = false;
            var onPropertyChange = function (e) {
                if (inPropertyChange)
                    return;
                var data = text.value;
                if (inComposition || !data || data == PLACEHOLDER)
                    return;
                if (e && data == PLACEHOLDER[0])
                    return syncProperty.schedule();
                sendText(data);
                inPropertyChange = true;
                resetValue();
                inPropertyChange = false;
            };
            var syncProperty = delayedCall(onPropertyChange);
            addListener(text, "propertychange", onPropertyChange);
            var keytable = { 13: 1, 27: 1 };
            addListener(text, "keyup", function (e) {
                if (inComposition && (!text.value || keytable[e.keyCode]))
                    setTimeout(onCompositionEnd, 0);
                if ((text.value.charCodeAt(0) || 0) < 129) {
                    return syncProperty.call();
                }
                inComposition ? onCompositionUpdate() : onCompositionStart();
            });
            addListener(text, "keydown", function (e) {
                syncProperty.schedule(50);
            });
        }
        var onSelect = function (e) {
            if (copied) {
                copied = false;
            }
            else if (isAllSelected(text)) {
                editor.selectAll();
                resetSelection();
            }
            else if (inputHandler) {
                resetSelection(editor.selection.isEmpty());
            }
        };
        var inputHandler = null;
        this.setInputHandler = function (cb) { inputHandler = cb; };
        this.getInputHandler = function () { return inputHandler; };
        var afterContextMenu = false;
        var sendText = function (data) {
            if (inputHandler) {
                data = inputHandler(data);
                inputHandler = null;
            }
            if (pasted) {
                resetSelection();
                if (data)
                    editor.onPaste(data);
                pasted = false;
            }
            else if (data == PLACEHOLDER.charAt(0)) {
                if (afterContextMenu)
                    editor.execCommand("del", { source: "ace" });
                else
                    editor.execCommand("backspace", { source: "ace" });
            }
            else {
                if (data.substring(0, 2) == PLACEHOLDER)
                    data = data.substr(2);
                else if (data.charAt(0) == PLACEHOLDER.charAt(0))
                    data = data.substr(1);
                else if (data.charAt(data.length - 1) == PLACEHOLDER.charAt(0))
                    data = data.slice(0, -1);
                if (data.charAt(data.length - 1) == PLACEHOLDER.charAt(0))
                    data = data.slice(0, -1);
                if (data)
                    editor.onTextInput(data);
            }
            if (afterContextMenu)
                afterContextMenu = false;
        };
        var onInput = function (e) {
            if (inComposition)
                return;
            var data = text.value;
            sendText(data);
            resetValue();
        };
        var handleClipboardData = function (e, data) {
            var clipboardData = e.clipboardData || window['clipboardData'];
            if (!clipboardData || BROKEN_SETDATA)
                return;
            var mime = USE_IE_MIME_TYPE ? "Text" : "text/plain";
            if (data) {
                return clipboardData.setData(mime, data) !== false;
            }
            else {
                return clipboardData.getData(mime);
            }
        };
        var doCopy = function (e, isCut) {
            var data = editor.getCopyText();
            if (!data)
                return preventDefault(e);
            if (handleClipboardData(e, data)) {
                isCut ? editor.onCut() : editor.onCopy();
                preventDefault(e);
            }
            else {
                copied = true;
                text.value = data;
                text.select();
                setTimeout(function () {
                    copied = false;
                    resetValue();
                    resetSelection();
                    isCut ? editor.onCut() : editor.onCopy();
                });
            }
        };
        var onCut = function (e) {
            doCopy(e, true);
        };
        var onCopy = function (e) {
            doCopy(e, false);
        };
        var onPaste = function (e) {
            var data = handleClipboardData(e);
            if (typeof data === "string") {
                if (data)
                    editor.onPaste(data);
                if (isIE)
                    setTimeout(resetSelection);
                preventDefault(e);
            }
            else {
                text.value = "";
                pasted = true;
            }
        };
        addCommandKeyListener(text, editor.onCommandKey.bind(editor));
        addListener(text, "select", onSelect);
        addListener(text, "input", onInput);
        addListener(text, "cut", onCut);
        addListener(text, "copy", onCopy);
        addListener(text, "paste", onPaste);
        if (!('oncut' in text) || !('oncopy' in text) || !('onpaste' in text)) {
            addListener(container, "keydown", function (e) {
                if ((isMac && !e.metaKey) || !e.ctrlKey)
                    return;
                switch (e.keyCode) {
                    case 67:
                        onCopy(e);
                        break;
                    case 86:
                        onPaste(e);
                        break;
                    case 88:
                        onCut(e);
                        break;
                }
            });
        }
        var onCompositionStart = function () {
            if (inComposition || !editor.onCompositionStart || editor.$readOnly)
                return;
            inComposition = {};
            editor.onCompositionStart();
            setTimeout(onCompositionUpdate, 0);
            editor.on("mousedown", onCompositionEnd);
            if (!editor.selection.isEmpty()) {
                editor.insert("", false);
                editor.getSession().markUndoGroup();
                editor.selection.clearSelection();
            }
            editor.getSession().markUndoGroup();
        };
        var onCompositionUpdate = function () {
            if (!inComposition || !editor.onCompositionUpdate || editor.$readOnly)
                return;
            var val = text.value.replace(/\x01/g, "");
            if (inComposition.lastValue === val)
                return;
            editor.onCompositionUpdate(val);
            if (inComposition.lastValue)
                editor.undo();
            inComposition.lastValue = val;
            if (inComposition.lastValue) {
                var r = editor.selection.getRange();
                editor.insert(inComposition.lastValue, false);
                editor.getSession().markUndoGroup();
                inComposition.range = editor.selection.getRange();
                editor.selection.setRange(r);
                editor.selection.clearSelection();
            }
        };
        var onCompositionEnd = function (e, editor) {
            if (!editor.onCompositionEnd || editor.$readOnly)
                return;
            var c = inComposition;
            inComposition = false;
            var timer = setTimeout(function () {
                timer = null;
                var str = text.value.replace(/\x01/g, "");
                if (inComposition)
                    return;
                else if (str == c.lastValue)
                    resetValue();
                else if (!c.lastValue && str) {
                    resetValue();
                    sendText(str);
                }
            });
            inputHandler = function compositionInputHandler(str) {
                if (timer)
                    clearTimeout(timer);
                str = str.replace(/\x01/g, "");
                if (str == c.lastValue)
                    return "";
                if (c.lastValue && timer)
                    editor.undo();
                return str;
            };
            editor.onCompositionEnd();
            editor.off("mousedown", onCompositionEnd);
            if (e.type == "compositionend" && c.range) {
                editor.selection.setRange(c.range);
            }
        };
        var syncComposition = delayedCall(onCompositionUpdate, 50);
        addListener(text, "compositionstart", onCompositionStart);
        if (isGecko) {
            addListener(text, "text", function () { syncComposition.schedule(); });
        }
        else {
            addListener(text, "keyup", function () { syncComposition.schedule(); });
            addListener(text, "keydown", function () { syncComposition.schedule(); });
        }
        addListener(text, "compositionend", onCompositionEnd);
        this.getElement = function () {
            return text;
        };
        this.setReadOnly = function (readOnly) {
            text.readOnly = readOnly;
        };
        this.onContextMenu = function (e) {
            afterContextMenu = true;
            resetSelection(editor.selection.isEmpty());
            editor._emit("nativecontextmenu", { target: editor, domEvent: e });
            this.moveToMouse(e, true);
        };
        this.moveToMouse = function (e, bringToFront) {
            if (!tempStyle)
                tempStyle = text.style.cssText;
            text.style.cssText = (bringToFront ? "z-index:100000;" : "")
                + "height:" + text.style.height + ";"
                + (isIE ? "opacity:0.1;" : "");
            var rect = editor.container.getBoundingClientRect();
            var style = window.getComputedStyle(editor.container);
            var top = rect.top + (parseInt(style.borderTopWidth) || 0);
            var left = rect.left + (parseInt(style.borderLeftWidth) || 0);
            var maxTop = rect.bottom - top - text.clientHeight - 2;
            var move = function (e) {
                text.style.left = e.clientX - left - 2 + "px";
                text.style.top = Math.min(e.clientY - top - 2, maxTop) + "px";
            };
            move(e);
            if (e.type != "mousedown")
                return;
            if (editor.renderer.$keepTextAreaAtCursor)
                editor.renderer.$keepTextAreaAtCursor = null;
            if (isWin)
                capture(editor.container, move, onContextMenuClose);
        };
        this.onContextMenuClose = onContextMenuClose;
        function onContextMenuClose() {
            setTimeout(function () {
                if (tempStyle) {
                    text.style.cssText = tempStyle;
                    tempStyle = '';
                }
                if (editor.renderer.$keepTextAreaAtCursor == null) {
                    editor.renderer.$keepTextAreaAtCursor = true;
                    editor.renderer.$moveTextAreaToCursor();
                }
            }, 0);
        }
        var onContextMenu = function (e) {
            editor.textInput.onContextMenu(e);
            onContextMenuClose();
        };
        addListener(editor.renderer.scroller, "contextmenu", onContextMenu);
        addListener(text, "contextmenu", onContextMenu);
    }
    focus() { }
    ;
    blur() { }
    ;
    isFocused() { }
    ;
    setReadOnly(readOnly) { }
    ;
    onContextMenuClose() { }
    ;
    onContextMenu(e) { }
    ;
    moveToMouse(e, bringToFront) { }
    ;
    setInputHandler(cb) { }
    ;
    getInputHandler() { }
    ;
    getElement() { }
    ;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGV4dElucHV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiVGV4dElucHV0LnRzIl0sIm5hbWVzIjpbIlRleHRJbnB1dCIsIlRleHRJbnB1dC5jb25zdHJ1Y3RvciIsIlRleHRJbnB1dC5jb25zdHJ1Y3Rvci5yZXNldFNlbGVjdGlvbiIsIlRleHRJbnB1dC5jb25zdHJ1Y3Rvci5yZXNldFZhbHVlIiwiY29tcG9zaXRpb25JbnB1dEhhbmRsZXIiLCJUZXh0SW5wdXQuY29uc3RydWN0b3Iub25Db250ZXh0TWVudUNsb3NlIiwiVGV4dElucHV0LmZvY3VzIiwiVGV4dElucHV0LmJsdXIiLCJUZXh0SW5wdXQuaXNGb2N1c2VkIiwiVGV4dElucHV0LnNldFJlYWRPbmx5IiwiVGV4dElucHV0Lm9uQ29udGV4dE1lbnVDbG9zZSIsIlRleHRJbnB1dC5vbkNvbnRleHRNZW51IiwiVGV4dElucHV0Lm1vdmVUb01vdXNlIiwiVGV4dElucHV0LnNldElucHV0SGFuZGxlciIsIlRleHRJbnB1dC5nZXRJbnB1dEhhbmRsZXIiLCJUZXh0SW5wdXQuZ2V0RWxlbWVudCJdLCJtYXBwaW5ncyI6IkFBNkJBLFlBQVksQ0FBQztPQUVOLEVBQUUscUJBQXFCLEVBQUUsV0FBVyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxjQUFjO09BQ25GLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxNQUFNLGtCQUFrQjtPQUNoRyxFQUFpQixhQUFhLEVBQUUsTUFBTSxZQUFZO09BQ2xELEVBQUUsV0FBVyxFQUFFLE1BQU0sYUFBYTtBQUd6QyxJQUFJLGNBQWMsR0FBRyxRQUFRLEdBQUcsRUFBRSxDQUFDO0FBQ25DLElBQUksZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO0FBSzVCO0lBa0JJQSxZQUFZQSxTQUFrQkEsRUFBRUEsTUFBY0E7UUFHMUNDLElBQUlBLElBQUlBLEdBQXdCQSxhQUFhQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtRQUMxREEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsZ0JBQWdCQSxDQUFDQTtRQUVsQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDYkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EseUJBQXlCQSxFQUFFQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUN6REEsQ0FBQ0E7UUFFREEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDbEJBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBO1FBQzVCQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBO1FBQy9CQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUV4QkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDekJBLFNBQVNBLENBQUNBLFlBQVlBLENBQUNBLElBQUlBLEVBQUVBLFNBQVNBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO1FBRW5EQSxJQUFJQSxXQUFXQSxHQUFHQSxVQUFVQSxDQUFDQTtRQUU3QkEsSUFBSUEsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDbkJBLElBQUlBLE1BQU1BLEdBQUdBLEtBQUtBLENBQUNBO1FBQ25CQSxJQUFJQSxhQUFhQSxHQUFRQSxLQUFLQSxDQUFDQTtRQUMvQkEsSUFBSUEsU0FBU0EsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDbkJBLElBQUlBLGdCQUFnQkEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFJNUJBLElBQUlBLENBQUNBO1lBQUNBLElBQUlBLFNBQVNBLEdBQUdBLFFBQVFBLENBQUNBLGFBQWFBLEtBQUtBLElBQUlBLENBQUNBO1FBQUNBLENBQUVBO1FBQUFBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRXRFQSxXQUFXQSxDQUFDQSxJQUFJQSxFQUFFQSxNQUFNQSxFQUFFQTtZQUN0QixNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDaEIsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN0QixDQUFDLENBQUNBLENBQUNBO1FBQ0hBLFdBQVdBLENBQUNBLElBQUlBLEVBQUVBLE9BQU9BLEVBQUVBO1lBQ3ZCLFNBQVMsR0FBRyxJQUFJLENBQUM7WUFDakIsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ2pCLGNBQWMsRUFBRSxDQUFDO1FBQ3JCLENBQUMsQ0FBQ0EsQ0FBQ0E7UUFDSEEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsY0FBYSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUNBO1FBQzFDQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxjQUFhLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQ0E7UUFDeENBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBO1lBQ2IsTUFBTSxDQUFDLFNBQVMsQ0FBQztRQUNyQixDQUFDLENBQUNBO1FBR0ZBLElBQUlBLGFBQWFBLEdBQUdBLFdBQVdBLENBQUNBO1lBQzVCLFNBQVMsSUFBSSxjQUFjLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUNsRCxDQUFDLENBQUNBLENBQUNBO1FBQ0hBLElBQUlBLFNBQVNBLEdBQUdBLFdBQVdBLENBQUNBO1lBQ3hCLEVBQUUsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztnQkFDakIsSUFBSSxDQUFDLEtBQUssR0FBRyxXQUFXLENBQUM7Z0JBQ3pCLFNBQVMsSUFBSSxjQUFjLEVBQUUsQ0FBQztZQUNsQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDQSxDQUFDQTtRQUVIQSx3QkFBd0JBLE9BQWlCQTtZQUNyQ0MsRUFBRUEsQ0FBQ0EsQ0FBQ0EsYUFBYUEsQ0FBQ0E7Z0JBQ2RBLE1BQU1BLENBQUNBO1lBQ1hBLEVBQUVBLENBQUNBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBO2dCQUNmQSxjQUFjQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDbkJBLFlBQVlBLEdBQUdBLE9BQU9BLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBO1lBQ3ZEQSxDQUFDQTtZQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtnQkFDSkEsSUFBSUEsY0FBY0EsR0FBR0EsT0FBT0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3JDQSxJQUFJQSxZQUFZQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUN6QkEsQ0FBQ0E7WUFFREEsSUFBSUEsQ0FBQ0E7Z0JBQ0RBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsY0FBY0EsRUFBRUEsWUFBWUEsQ0FBQ0EsQ0FBQ0E7WUFDekRBLENBQUVBO1lBQUFBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ25CQSxDQUFDQTtRQUVERDtZQUNJRSxFQUFFQSxDQUFDQSxDQUFDQSxhQUFhQSxDQUFDQTtnQkFDZEEsTUFBTUEsQ0FBQ0E7WUFDWEEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsV0FBV0EsQ0FBQ0E7WUFFekJBLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBO2dCQUNUQSxTQUFTQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQTtRQUM3QkEsQ0FBQ0E7UUFFREYsUUFBUUEsSUFBSUEsTUFBTUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsaUJBQWlCQSxFQUFFQSxVQUFTQSxLQUFLQSxFQUFFQSxNQUFjQTtZQUNuRSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxJQUFJLGdCQUFnQixDQUFDLENBQUMsQ0FBQztnQkFDakQsZ0JBQWdCLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDckMsYUFBYSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQzdCLENBQUM7UUFDTCxDQUFDLENBQUNBLENBQUNBO1FBRUhBLFVBQVVBLEVBQUVBLENBQUNBO1FBQ2JBLEVBQUVBLENBQUNBLENBQUNBLFNBQVNBLENBQUNBO1lBQ1ZBLE1BQU1BLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBO1FBR3JCQSxJQUFJQSxhQUFhQSxHQUFHQSxVQUFTQSxJQUFJQTtZQUM3QixNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLFlBQVksS0FBSyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztRQUNoRixDQUFDLENBQUNBO1FBRUZBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsSUFBSUEsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbERBLElBQUlBLENBQUNBLGlCQUFpQkEsR0FBR0EsVUFBU0EsY0FBY0EsRUFBRUEsWUFBWUE7Z0JBQzFELElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztnQkFDbkMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDckIsS0FBSyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsY0FBYyxDQUFDLENBQUM7Z0JBQzdDLEtBQUssQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUFDO2dCQUN6QyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDbkIsQ0FBQyxDQUFDQTtZQUNGQSxhQUFhQSxHQUFHQSxVQUFTQSxJQUF5QkE7Z0JBQzlDLElBQUksQ0FBQztvQkFDRCxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUM5RCxDQUNBO2dCQUFBLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ1gsQ0FBQztnQkFDRCxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsYUFBYSxFQUFFLElBQUksSUFBSSxDQUFDO29CQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7Z0JBQzFELE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDcEMsQ0FBQyxDQUFBQTtRQUNMQSxDQUFDQTtRQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNWQSxJQUFJQSxnQkFBZ0JBLEdBQUdBLEtBQUtBLENBQUNBO1lBQzdCQSxJQUFJQSxnQkFBZ0JBLEdBQUdBLFVBQVNBLENBQUNBO2dCQUM3QixFQUFFLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQztvQkFDakIsTUFBTSxDQUFDO2dCQUNYLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7Z0JBQ3RCLEVBQUUsQ0FBQyxDQUFDLGFBQWEsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLElBQUksV0FBVyxDQUFDO29CQUM5QyxNQUFNLENBQUM7Z0JBRVgsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQzVCLE1BQU0sQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBRW5DLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFFZixnQkFBZ0IsR0FBRyxJQUFJLENBQUM7Z0JBQ3hCLFVBQVUsRUFBRSxDQUFDO2dCQUNiLGdCQUFnQixHQUFHLEtBQUssQ0FBQztZQUM3QixDQUFDLENBQUNBO1lBQ0ZBLElBQUlBLFlBQVlBLEdBQUdBLFdBQVdBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0E7WUFDakRBLFdBQVdBLENBQUNBLElBQUlBLEVBQUVBLGdCQUFnQkEsRUFBRUEsZ0JBQWdCQSxDQUFDQSxDQUFDQTtZQUV0REEsSUFBSUEsUUFBUUEsR0FBR0EsRUFBRUEsRUFBRUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7WUFDaENBLFdBQVdBLENBQUNBLElBQUlBLEVBQUVBLE9BQU9BLEVBQUVBLFVBQVNBLENBQUNBO2dCQUNqQyxFQUFFLENBQUMsQ0FBQyxhQUFhLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO29CQUN0RCxVQUFVLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDeEMsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDL0IsQ0FBQztnQkFDRCxhQUFhLEdBQUcsbUJBQW1CLEVBQUUsR0FBRyxrQkFBa0IsRUFBRSxDQUFDO1lBQ2pFLENBQUMsQ0FBQ0EsQ0FBQ0E7WUFHSEEsV0FBV0EsQ0FBQ0EsSUFBSUEsRUFBRUEsU0FBU0EsRUFBRUEsVUFBU0EsQ0FBQ0E7Z0JBQ25DLFlBQVksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDOUIsQ0FBQyxDQUFDQSxDQUFDQTtRQUNQQSxDQUFDQTtRQUVEQSxJQUFJQSxRQUFRQSxHQUFHQSxVQUFTQSxDQUFDQTtZQUNyQixFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUNULE1BQU0sR0FBRyxLQUFLLENBQUM7WUFDbkIsQ0FBQztZQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUM3QixNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQ25CLGNBQWMsRUFBRSxDQUFDO1lBQ3JCLENBQUM7WUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztnQkFDdEIsY0FBYyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUMvQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDQTtRQUVGQSxJQUFJQSxZQUFZQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUN4QkEsSUFBSUEsQ0FBQ0EsZUFBZUEsR0FBR0EsVUFBU0EsRUFBRUEsSUFBSSxZQUFZLEdBQUcsRUFBRSxDQUFBLENBQUMsQ0FBQyxDQUFDQTtRQUMxREEsSUFBSUEsQ0FBQ0EsZUFBZUEsR0FBR0EsY0FBYSxNQUFNLENBQUMsWUFBWSxDQUFBLENBQUMsQ0FBQyxDQUFDQTtRQUMxREEsSUFBSUEsZ0JBQWdCQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUU3QkEsSUFBSUEsUUFBUUEsR0FBR0EsVUFBU0EsSUFBSUE7WUFDeEIsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztnQkFDZixJQUFJLEdBQUcsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUMxQixZQUFZLEdBQUcsSUFBSSxDQUFDO1lBQ3hCLENBQUM7WUFDRCxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUNULGNBQWMsRUFBRSxDQUFDO2dCQUNqQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQ0wsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDekIsTUFBTSxHQUFHLEtBQUssQ0FBQztZQUNuQixDQUFDO1lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksSUFBSSxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdkMsRUFBRSxDQUFDLENBQUMsZ0JBQWdCLENBQUM7b0JBQ2pCLE1BQU0sQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7Z0JBQ2pELElBQUk7b0JBQ0EsTUFBTSxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUMzRCxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ0osRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksV0FBVyxDQUFDO29CQUNwQyxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDMUIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDN0MsSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFCLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLElBQUksV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDM0QsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRTdCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsSUFBSSxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUN0RCxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFFN0IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUNMLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDakMsQ0FBQztZQUNELEVBQUUsQ0FBQyxDQUFDLGdCQUFnQixDQUFDO2dCQUNqQixnQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFDakMsQ0FBQyxDQUFDQTtRQUNGQSxJQUFJQSxPQUFPQSxHQUFHQSxVQUFTQSxDQUFDQTtZQUNwQixFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUM7Z0JBQ2QsTUFBTSxDQUFDO1lBQ1gsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUN0QixRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDZixVQUFVLEVBQUUsQ0FBQztRQUNqQixDQUFDLENBQUNBO1FBRUZBLElBQUlBLG1CQUFtQkEsR0FBR0EsVUFBU0EsQ0FBQ0EsRUFBRUEsSUFBS0E7WUFDdkMsSUFBSSxhQUFhLEdBQUcsQ0FBQyxDQUFDLGFBQWEsSUFBSSxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDL0QsRUFBRSxDQUFDLENBQUMsQ0FBQyxhQUFhLElBQUksY0FBYyxDQUFDO2dCQUNqQyxNQUFNLENBQUM7WUFHWCxJQUFJLElBQUksR0FBRyxnQkFBZ0IsR0FBRyxNQUFNLEdBQUcsWUFBWSxDQUFDO1lBQ3BELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBRVAsTUFBTSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLEtBQUssQ0FBQztZQUN2RCxDQUFDO1lBQ0QsSUFBSSxDQUFDLENBQUM7Z0JBQ0YsTUFBTSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdkMsQ0FBQztRQUNMLENBQUMsQ0FBQ0E7UUFFRkEsSUFBSUEsTUFBTUEsR0FBR0EsVUFBU0EsQ0FBQ0EsRUFBRUEsS0FBS0E7WUFDMUIsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2hDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNOLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFN0IsRUFBRSxDQUFDLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDL0IsS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLEVBQUUsR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7Z0JBQ3pDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0QixDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ0osTUFBTSxHQUFHLElBQUksQ0FBQztnQkFDZCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztnQkFDbEIsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNkLFVBQVUsQ0FBQztvQkFDUCxNQUFNLEdBQUcsS0FBSyxDQUFDO29CQUNmLFVBQVUsRUFBRSxDQUFDO29CQUNiLGNBQWMsRUFBRSxDQUFDO29CQUNqQixLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssRUFBRSxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztnQkFDN0MsQ0FBQyxDQUFDLENBQUM7WUFDUCxDQUFDO1FBQ0wsQ0FBQyxDQUFDQTtRQUVGQSxJQUFJQSxLQUFLQSxHQUFHQSxVQUFTQSxDQUFDQTtZQUNsQixNQUFNLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3BCLENBQUMsQ0FBQ0E7UUFFRkEsSUFBSUEsTUFBTUEsR0FBR0EsVUFBU0EsQ0FBQ0E7WUFDbkIsTUFBTSxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNyQixDQUFDLENBQUNBO1FBRUZBLElBQUlBLE9BQU9BLEdBQUdBLFVBQVNBLENBQUNBO1lBQ3BCLElBQUksSUFBSSxHQUFHLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQzNCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDTCxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN6QixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQ0wsVUFBVSxDQUFDLGNBQWMsQ0FBQyxDQUFDO2dCQUMvQixjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEIsQ0FBQztZQUNELElBQUksQ0FBQyxDQUFDO2dCQUNGLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO2dCQUNoQixNQUFNLEdBQUcsSUFBSSxDQUFDO1lBQ2xCLENBQUM7UUFDTCxDQUFDLENBQUNBO1FBRUZBLHFCQUFxQkEsQ0FBQ0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFOURBLFdBQVdBLENBQUNBLElBQUlBLEVBQUVBLFFBQVFBLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO1FBRXRDQSxXQUFXQSxDQUFDQSxJQUFJQSxFQUFFQSxPQUFPQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFDQTtRQUVwQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsRUFBRUEsS0FBS0EsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFDaENBLFdBQVdBLENBQUNBLElBQUlBLEVBQUVBLE1BQU1BLEVBQUVBLE1BQU1BLENBQUNBLENBQUNBO1FBQ2xDQSxXQUFXQSxDQUFDQSxJQUFJQSxFQUFFQSxPQUFPQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFDQTtRQUlwQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsSUFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsUUFBUUEsSUFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsU0FBU0EsSUFBSUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDcEVBLFdBQVdBLENBQUNBLFNBQVNBLEVBQUVBLFNBQVNBLEVBQUVBLFVBQVNBLENBQUNBO2dCQUN4QyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7b0JBQ3BDLE1BQU0sQ0FBQztnQkFFWCxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztvQkFDaEIsS0FBSyxFQUFFO3dCQUNILE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDVixLQUFLLENBQUM7b0JBQ1YsS0FBSyxFQUFFO3dCQUNILE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDWCxLQUFLLENBQUM7b0JBQ1YsS0FBSyxFQUFFO3dCQUNILEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDVCxLQUFLLENBQUM7Z0JBQ2QsQ0FBQztZQUNMLENBQUMsQ0FBQ0EsQ0FBQ0E7UUFDUEEsQ0FBQ0E7UUFJREEsSUFBSUEsa0JBQWtCQSxHQUFHQTtZQUNyQixFQUFFLENBQUMsQ0FBQyxhQUFhLElBQUksQ0FBQyxNQUFNLENBQUMsa0JBQWtCLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQztnQkFDaEUsTUFBTSxDQUFDO1lBRVgsYUFBYSxHQUFHLEVBQUUsQ0FBQztZQUNuQixNQUFNLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUM1QixVQUFVLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDbkMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxXQUFXLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztZQUN6QyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUM5QixNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztnQkFDekIsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO2dCQUNwQyxNQUFNLENBQUMsU0FBUyxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3RDLENBQUM7WUFDRCxNQUFNLENBQUMsVUFBVSxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDeEMsQ0FBQyxDQUFDQTtRQUVGQSxJQUFJQSxtQkFBbUJBLEdBQUdBO1lBRXRCLEVBQUUsQ0FBQyxDQUFDLENBQUMsYUFBYSxJQUFJLENBQUMsTUFBTSxDQUFDLG1CQUFtQixJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUM7Z0JBQ2xFLE1BQU0sQ0FBQztZQUNYLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQztZQUMxQyxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsU0FBUyxLQUFLLEdBQUcsQ0FBQztnQkFBQyxNQUFNLENBQUM7WUFFNUMsTUFBTSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2hDLEVBQUUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUM7Z0JBQ3hCLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNsQixhQUFhLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQztZQUM5QixFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDMUIsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDcEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUM5QyxNQUFNLENBQUMsVUFBVSxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQ3BDLGFBQWEsQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDbEQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzdCLE1BQU0sQ0FBQyxTQUFTLENBQUMsY0FBYyxFQUFFLENBQUM7WUFDdEMsQ0FBQztRQUNMLENBQUMsQ0FBQ0E7UUFFRkEsSUFBSUEsZ0JBQWdCQSxHQUFHQSxVQUFTQSxDQUFDQSxFQUFFQSxNQUFjQTtZQUM3QyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDO2dCQUFDLE1BQU0sQ0FBQztZQUV6RCxJQUFJLENBQUMsR0FBRyxhQUFhLENBQUM7WUFDdEIsYUFBYSxHQUFHLEtBQUssQ0FBQztZQUN0QixJQUFJLEtBQUssR0FBRyxVQUFVLENBQUM7Z0JBQ25CLEtBQUssR0FBRyxJQUFJLENBQUM7Z0JBQ2IsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dCQUUxQyxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUM7b0JBQ2QsTUFBTSxDQUFDO2dCQUNYLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQztvQkFDeEIsVUFBVSxFQUFFLENBQUM7Z0JBQ2pCLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDM0IsVUFBVSxFQUFFLENBQUM7b0JBQ2IsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNsQixDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7WUFDSCxZQUFZLEdBQUcsaUNBQWlDLEdBQVc7Z0JBRXZERyxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQTtvQkFDTkEsWUFBWUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3hCQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxPQUFPQSxDQUFDQSxPQUFPQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtnQkFDL0JBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLFNBQVNBLENBQUNBO29CQUNuQkEsTUFBTUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7Z0JBQ2RBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLFNBQVNBLElBQUlBLEtBQUtBLENBQUNBO29CQUNyQkEsTUFBTUEsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0E7Z0JBQ2xCQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQTtZQUNmQSxDQUFDQSxDQUFDO1lBQ0YsTUFBTSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDMUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztZQUMxQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLGdCQUFnQixJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUN4QyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdkMsQ0FBQztRQUNMLENBQUMsQ0FBQ0g7UUFJRkEsSUFBSUEsZUFBZUEsR0FBR0EsV0FBV0EsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUUzREEsV0FBV0EsQ0FBQ0EsSUFBSUEsRUFBRUEsa0JBQWtCQSxFQUFFQSxrQkFBa0JBLENBQUNBLENBQUNBO1FBQzFEQSxFQUFFQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNWQSxXQUFXQSxDQUFDQSxJQUFJQSxFQUFFQSxNQUFNQSxFQUFFQSxjQUFhLGVBQWUsQ0FBQyxRQUFRLEVBQUUsQ0FBQSxDQUFDLENBQUMsQ0FBQ0EsQ0FBQ0E7UUFDekVBLENBQUNBO1FBQ0RBLElBQUlBLENBQUNBLENBQUNBO1lBQ0ZBLFdBQVdBLENBQUNBLElBQUlBLEVBQUVBLE9BQU9BLEVBQUVBLGNBQWEsZUFBZSxDQUFDLFFBQVEsRUFBRSxDQUFBLENBQUMsQ0FBQyxDQUFDQSxDQUFDQTtZQUN0RUEsV0FBV0EsQ0FBQ0EsSUFBSUEsRUFBRUEsU0FBU0EsRUFBRUEsY0FBYSxlQUFlLENBQUMsUUFBUSxFQUFFLENBQUEsQ0FBQyxDQUFDLENBQUNBLENBQUNBO1FBQzVFQSxDQUFDQTtRQUNEQSxXQUFXQSxDQUFDQSxJQUFJQSxFQUFFQSxnQkFBZ0JBLEVBQUVBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0E7UUFFdERBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBO1lBQ2QsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNoQixDQUFDLENBQUNBO1FBRUZBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLFVBQVNBLFFBQWlCQTtZQUN6QyxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUM3QixDQUFDLENBQUNBO1FBRUZBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLFVBQVNBLENBQUNBO1lBQzNCLGdCQUFnQixHQUFHLElBQUksQ0FBQztZQUN4QixjQUFjLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQzNDLE1BQU0sQ0FBQyxLQUFLLENBQUMsbUJBQW1CLEVBQUUsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ25FLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzlCLENBQUMsQ0FBQ0E7UUFFRkEsSUFBSUEsQ0FBQ0EsV0FBV0EsR0FBR0EsVUFBU0EsQ0FBQ0EsRUFBRUEsWUFBWUE7WUFDdkMsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7Z0JBQ1gsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDO1lBQ25DLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLENBQUMsWUFBWSxHQUFHLGlCQUFpQixHQUFHLEVBQUUsQ0FBQztrQkFDdEQsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLEdBQUc7a0JBQ25DLENBQUMsSUFBSSxHQUFHLGNBQWMsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUVuQyxJQUFJLElBQUksR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLHFCQUFxQixFQUFFLENBQUM7WUFDcEQsSUFBSSxLQUFLLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN0RCxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUMzRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUM5RCxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztZQUN2RCxJQUFJLElBQUksR0FBRyxVQUFTLENBQUM7Z0JBQ2pCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxPQUFPLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUM7Z0JBQzlDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sR0FBRyxHQUFHLEdBQUcsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQztZQUNsRSxDQUFDLENBQUM7WUFDRixJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFUixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLFdBQVcsQ0FBQztnQkFDdEIsTUFBTSxDQUFDO1lBRVgsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQztnQkFDdEMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsR0FBRyxJQUFJLENBQUM7WUFHakQsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDO2dCQUNOLE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1FBQzVELENBQUMsQ0FBQ0E7UUFFRkEsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxrQkFBa0JBLENBQUNBO1FBQzdDQTtZQUNJSSxVQUFVQSxDQUFDQTtnQkFDUCxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO29CQUNaLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLFNBQVMsQ0FBQztvQkFDL0IsU0FBUyxHQUFHLEVBQUUsQ0FBQztnQkFDbkIsQ0FBQztnQkFDRCxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLHFCQUFxQixJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQ2hELE1BQU0sQ0FBQyxRQUFRLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDO29CQUM3QyxNQUFNLENBQUMsUUFBUSxDQUFDLHFCQUFxQixFQUFFLENBQUM7Z0JBQzVDLENBQUM7WUFDTCxDQUFDLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ1ZBLENBQUNBO1FBRURKLElBQUlBLGFBQWFBLEdBQUdBLFVBQVNBLENBQUNBO1lBQzFCLE1BQU0sQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLGtCQUFrQixFQUFFLENBQUM7UUFDekIsQ0FBQyxDQUFDQTtRQUNGQSxXQUFXQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxRQUFRQSxFQUFFQSxhQUFhQSxFQUFFQSxhQUFhQSxDQUFDQSxDQUFDQTtRQUNwRUEsV0FBV0EsQ0FBQ0EsSUFBSUEsRUFBRUEsYUFBYUEsRUFBRUEsYUFBYUEsQ0FBQ0EsQ0FBQ0E7SUFDcERBLENBQUNBO0lBcmRERCxLQUFLQSxLQUFLTSxDQUFDQTs7SUFDWE4sSUFBSUEsS0FBS08sQ0FBQ0E7O0lBQ1ZQLFNBQVNBLEtBQUtRLENBQUNBOztJQUNmUixXQUFXQSxDQUFDQSxRQUFpQkEsSUFBSVMsQ0FBQ0E7O0lBQ2xDVCxrQkFBa0JBLEtBQUtVLENBQUNBOztJQUN4QlYsYUFBYUEsQ0FBQ0EsQ0FBQ0EsSUFBSVcsQ0FBQ0E7O0lBQ3BCWCxXQUFXQSxDQUFDQSxDQUFDQSxFQUFFQSxZQUFZQSxJQUFJWSxDQUFDQTs7SUFDaENaLGVBQWVBLENBQUNBLEVBQUVBLElBQUlhLENBQUNBOztJQUN2QmIsZUFBZUEsS0FBS2MsQ0FBQ0E7O0lBQ3JCZCxVQUFVQSxLQUFLZSxDQUFDQTs7QUE2Y3BCZixDQUFDQTtBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKlxuICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBsaWNlbnNlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMCwgQWpheC5vcmcgQi5WLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXRcbiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuICogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHRcbiAqICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XG4gKiAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlXG4gKiAgICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICogICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBBamF4Lm9yZyBCLlYuIG5vciB0aGVcbiAqICAgICAgIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzXG4gKiAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cbiAqXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkRcbiAqIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEXG4gKiBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFXG4gKiBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBBSkFYLk9SRyBCLlYuIEJFIExJQUJMRSBGT1IgQU5ZXG4gKiBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFU1xuICogKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTO1xuICogTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EXG4gKiBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVNcbiAqIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICpcbiAqICoqKioqIEVORCBMSUNFTlNFIEJMT0NLICoqKioqICovXG5cInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IHsgYWRkQ29tbWFuZEtleUxpc3RlbmVyLCBhZGRMaXN0ZW5lciwgY2FwdHVyZSwgcHJldmVudERlZmF1bHQgfSBmcm9tIFwiLi4vbGliL2V2ZW50XCJcbmltcG9ydCB7IGlzQ2hyb21lLCBpc0dlY2tvLCBpc0lFLCBpc01hYywgaXNPbGRJRSwgaXNUb3VjaFBhZCwgaXNXZWJLaXQsIGlzV2luIH0gZnJvbSBcIi4uL2xpYi91c2VyYWdlbnRcIlxuaW1wb3J0IHsgY29tcHV0ZWRTdHlsZSwgY3JlYXRlRWxlbWVudCB9IGZyb20gXCIuLi9saWIvZG9tXCJcbmltcG9ydCB7IGRlbGF5ZWRDYWxsIH0gZnJvbSBcIi4uL2xpYi9sYW5nXCI7XG5pbXBvcnQgRWRpdG9yIGZyb20gXCIuLi9FZGl0b3JcIjtcblxudmFyIEJST0tFTl9TRVREQVRBID0gaXNDaHJvbWUgPCAxODtcbnZhciBVU0VfSUVfTUlNRV9UWVBFID0gaXNJRTtcblxuLyoqXG4gKiBAY2xhc3MgVGV4dElucHV0XG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRleHRJbnB1dCB7XG4gICAgZm9jdXMoKSB7IH07XG4gICAgYmx1cigpIHsgfTtcbiAgICBpc0ZvY3VzZWQoKSB7IH07XG4gICAgc2V0UmVhZE9ubHkocmVhZE9ubHk6IGJvb2xlYW4pIHsgfTtcbiAgICBvbkNvbnRleHRNZW51Q2xvc2UoKSB7IH07XG4gICAgb25Db250ZXh0TWVudShlKSB7IH07XG4gICAgbW92ZVRvTW91c2UoZSwgYnJpbmdUb0Zyb250KSB7IH07XG4gICAgc2V0SW5wdXRIYW5kbGVyKGNiKSB7IH07XG4gICAgZ2V0SW5wdXRIYW5kbGVyKCkgeyB9O1xuICAgIGdldEVsZW1lbnQoKSB7IH07XG5cbiAgICAvKipcbiAgICAgKiBAY2xhc3MgVGV4dElucHV0XG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIGNvbnRhaW5lciB7RWxlbWVudH1cbiAgICAgKiBAcGFyYW0gZWRpdG9yIHtFZGl0b3J9XG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyOiBFbGVtZW50LCBlZGl0b3I6IEVkaXRvcikge1xuICAgICAgICAvLyBGSVhNRTogSSdtIHN1cmUgdGhpcyBzaHVsZCBiZWNvbWUgYSBwcm9wZXJ0eS5cbiAgICAgICAgLy8gRG9uJ3Qga25vdyB3aHkgd2UgaGF2ZSBhbGwgdGhlc2UgbW9ua2V5IHBhdGNoZWQgbWV0aG9kcz8hLlxuICAgICAgICB2YXIgdGV4dCA9IDxIVE1MVGV4dEFyZWFFbGVtZW50PmNyZWF0ZUVsZW1lbnQoXCJ0ZXh0YXJlYVwiKTtcbiAgICAgICAgdGV4dC5jbGFzc05hbWUgPSBcImFjZV90ZXh0LWlucHV0XCI7XG5cbiAgICAgICAgaWYgKGlzVG91Y2hQYWQpIHtcbiAgICAgICAgICAgIHRleHQuc2V0QXR0cmlidXRlKFwieC1wYWxtLWRpc2FibGUtYXV0by1jYXBcIiwgJ3RydWUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRleHQud3JhcCA9IFwib2ZmXCI7XG4gICAgICAgIHRleHRbJ2F1dG9jb3JyZWN0J10gPSBcIm9mZlwiO1xuICAgICAgICB0ZXh0WydhdXRvY2FwaXRhbGl6ZSddID0gXCJvZmZcIjtcbiAgICAgICAgdGV4dC5zcGVsbGNoZWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGV4dC5zdHlsZS5vcGFjaXR5ID0gXCIwXCI7XG4gICAgICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUodGV4dCwgY29udGFpbmVyLmZpcnN0Q2hpbGQpO1xuXG4gICAgICAgIHZhciBQTEFDRUhPTERFUiA9IFwiXFx4MDFcXHgwMVwiO1xuXG4gICAgICAgIHZhciBjb3BpZWQgPSBmYWxzZTtcbiAgICAgICAgdmFyIHBhc3RlZCA9IGZhbHNlO1xuICAgICAgICB2YXIgaW5Db21wb3NpdGlvbjogYW55ID0gZmFsc2U7XG4gICAgICAgIHZhciB0ZW1wU3R5bGUgPSAnJztcbiAgICAgICAgdmFyIGlzU2VsZWN0aW9uRW1wdHkgPSB0cnVlO1xuXG4gICAgICAgIC8vIEZPQ1VTXG4gICAgICAgIC8vIGllOSB0aHJvd3MgZXJyb3IgaWYgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBpcyBhY2Nlc3NlZCB0b28gc29vblxuICAgICAgICB0cnkgeyB2YXIgaXNGb2N1c2VkID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gdGV4dDsgfSBjYXRjaCAoZSkgeyB9XG5cbiAgICAgICAgYWRkTGlzdGVuZXIodGV4dCwgXCJibHVyXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZWRpdG9yLm9uQmx1cigpO1xuICAgICAgICAgICAgaXNGb2N1c2VkID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgICBhZGRMaXN0ZW5lcih0ZXh0LCBcImZvY3VzXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaXNGb2N1c2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIGVkaXRvci5vbkZvY3VzKCk7XG4gICAgICAgICAgICByZXNldFNlbGVjdGlvbigpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5mb2N1cyA9IGZ1bmN0aW9uKCkgeyB0ZXh0LmZvY3VzKCk7IH07XG4gICAgICAgIHRoaXMuYmx1ciA9IGZ1bmN0aW9uKCkgeyB0ZXh0LmJsdXIoKTsgfTtcbiAgICAgICAgdGhpcy5pc0ZvY3VzZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBpc0ZvY3VzZWQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gbW9kaWZ5aW5nIHNlbGVjdGlvbiBvZiBibHVyZWQgdGV4dGFyZWEgY2FuIGZvY3VzIGl0IChjaHJvbWUgbWFjL2xpbnV4KVxuICAgICAgICB2YXIgc3luY1NlbGVjdGlvbiA9IGRlbGF5ZWRDYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaXNGb2N1c2VkICYmIHJlc2V0U2VsZWN0aW9uKGlzU2VsZWN0aW9uRW1wdHkpO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHN5bmNWYWx1ZSA9IGRlbGF5ZWRDYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCFpbkNvbXBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgdGV4dC52YWx1ZSA9IFBMQUNFSE9MREVSO1xuICAgICAgICAgICAgICAgIGlzRm9jdXNlZCAmJiByZXNldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBmdW5jdGlvbiByZXNldFNlbGVjdGlvbihpc0VtcHR5PzogYm9vbGVhbikge1xuICAgICAgICAgICAgaWYgKGluQ29tcG9zaXRpb24pXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKGlucHV0SGFuZGxlcikge1xuICAgICAgICAgICAgICAgIHNlbGVjdGlvblN0YXJ0ID0gMDtcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb25FbmQgPSBpc0VtcHR5ID8gMCA6IHRleHQudmFsdWUubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdGlvblN0YXJ0ID0gaXNFbXB0eSA/IDIgOiAxO1xuICAgICAgICAgICAgICAgIHZhciBzZWxlY3Rpb25FbmQgPSAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gb24gZmlyZWZveCB0aGlzIHRocm93cyBpZiB0ZXh0YXJlYSBpcyBoaWRkZW5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdGV4dC5zZXRTZWxlY3Rpb25SYW5nZShzZWxlY3Rpb25TdGFydCwgc2VsZWN0aW9uRW5kKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVzZXRWYWx1ZSgpIHtcbiAgICAgICAgICAgIGlmIChpbkNvbXBvc2l0aW9uKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHRleHQudmFsdWUgPSBQTEFDRUhPTERFUjtcbiAgICAgICAgICAgIC8vaHR0cDovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9NzY1MTZcbiAgICAgICAgICAgIGlmIChpc1dlYktpdClcbiAgICAgICAgICAgICAgICBzeW5jVmFsdWUuc2NoZWR1bGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlzV2ViS2l0IHx8IGVkaXRvci5vbignY2hhbmdlU2VsZWN0aW9uJywgZnVuY3Rpb24oZXZlbnQsIGVkaXRvcjogRWRpdG9yKSB7XG4gICAgICAgICAgICBpZiAoZWRpdG9yLnNlbGVjdGlvbi5pc0VtcHR5KCkgIT0gaXNTZWxlY3Rpb25FbXB0eSkge1xuICAgICAgICAgICAgICAgIGlzU2VsZWN0aW9uRW1wdHkgPSAhaXNTZWxlY3Rpb25FbXB0eTtcbiAgICAgICAgICAgICAgICBzeW5jU2VsZWN0aW9uLnNjaGVkdWxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJlc2V0VmFsdWUoKTtcbiAgICAgICAgaWYgKGlzRm9jdXNlZClcbiAgICAgICAgICAgIGVkaXRvci5vbkZvY3VzKCk7XG5cblxuICAgICAgICB2YXIgaXNBbGxTZWxlY3RlZCA9IGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgICAgICAgIHJldHVybiB0ZXh0LnNlbGVjdGlvblN0YXJ0ID09PSAwICYmIHRleHQuc2VsZWN0aW9uRW5kID09PSB0ZXh0LnZhbHVlLmxlbmd0aDtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gSUU4IGRvZXMgbm90IHN1cHBvcnQgc2V0U2VsZWN0aW9uUmFuZ2VcbiAgICAgICAgaWYgKCF0ZXh0LnNldFNlbGVjdGlvblJhbmdlICYmIHRleHQuY3JlYXRlVGV4dFJhbmdlKSB7XG4gICAgICAgICAgICB0ZXh0LnNldFNlbGVjdGlvblJhbmdlID0gZnVuY3Rpb24oc2VsZWN0aW9uU3RhcnQsIHNlbGVjdGlvbkVuZCkge1xuICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IHRoaXMuY3JlYXRlVGV4dFJhbmdlKCk7XG4gICAgICAgICAgICAgICAgcmFuZ2UuY29sbGFwc2UodHJ1ZSk7XG4gICAgICAgICAgICAgICAgcmFuZ2UubW92ZVN0YXJ0KCdjaGFyYWN0ZXInLCBzZWxlY3Rpb25TdGFydCk7XG4gICAgICAgICAgICAgICAgcmFuZ2UubW92ZUVuZCgnY2hhcmFjdGVyJywgc2VsZWN0aW9uRW5kKTtcbiAgICAgICAgICAgICAgICByYW5nZS5zZWxlY3QoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpc0FsbFNlbGVjdGVkID0gZnVuY3Rpb24odGV4dDogSFRNTFRleHRBcmVhRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IHRleHQub3duZXJEb2N1bWVudFsnc2VsZWN0aW9uJ10uY3JlYXRlUmFuZ2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFyYW5nZSB8fCByYW5nZS5wYXJlbnRFbGVtZW50KCkgIT0gdGV4dCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldHVybiByYW5nZS50ZXh0ID09IHRleHQudmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzT2xkSUUpIHtcbiAgICAgICAgICAgIHZhciBpblByb3BlcnR5Q2hhbmdlID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgb25Qcm9wZXJ0eUNoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoaW5Qcm9wZXJ0eUNoYW5nZSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gdGV4dC52YWx1ZTtcbiAgICAgICAgICAgICAgICBpZiAoaW5Db21wb3NpdGlvbiB8fCAhZGF0YSB8fCBkYXRhID09IFBMQUNFSE9MREVSKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgLy8gY2FuIGhhcHBlbiBlaXRoZXIgYWZ0ZXIgZGVsZXRlIG9yIGR1cmluZyBpbnNlcnQgb3BlcmF0aW9uXG4gICAgICAgICAgICAgICAgaWYgKGUgJiYgZGF0YSA9PSBQTEFDRUhPTERFUlswXSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5bmNQcm9wZXJ0eS5zY2hlZHVsZSgpO1xuXG4gICAgICAgICAgICAgICAgc2VuZFRleHQoZGF0YSk7XG4gICAgICAgICAgICAgICAgLy8gaWU4IGNhbGxzIHByb3BlcnR5Y2hhbmdlIGhhbmRsZXJzIHN5bmNocm9ub3VzbHkhXG4gICAgICAgICAgICAgICAgaW5Qcm9wZXJ0eUNoYW5nZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmVzZXRWYWx1ZSgpO1xuICAgICAgICAgICAgICAgIGluUHJvcGVydHlDaGFuZ2UgPSBmYWxzZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgc3luY1Byb3BlcnR5ID0gZGVsYXllZENhbGwob25Qcm9wZXJ0eUNoYW5nZSk7XG4gICAgICAgICAgICBhZGRMaXN0ZW5lcih0ZXh0LCBcInByb3BlcnR5Y2hhbmdlXCIsIG9uUHJvcGVydHlDaGFuZ2UpO1xuXG4gICAgICAgICAgICB2YXIga2V5dGFibGUgPSB7IDEzOiAxLCAyNzogMSB9O1xuICAgICAgICAgICAgYWRkTGlzdGVuZXIodGV4dCwgXCJrZXl1cFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGluQ29tcG9zaXRpb24gJiYgKCF0ZXh0LnZhbHVlIHx8IGtleXRhYmxlW2Uua2V5Q29kZV0pKVxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KG9uQ29tcG9zaXRpb25FbmQsIDApO1xuICAgICAgICAgICAgICAgIGlmICgodGV4dC52YWx1ZS5jaGFyQ29kZUF0KDApIHx8IDApIDwgMTI5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzeW5jUHJvcGVydHkuY2FsbCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpbkNvbXBvc2l0aW9uID8gb25Db21wb3NpdGlvblVwZGF0ZSgpIDogb25Db21wb3NpdGlvblN0YXJ0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIHdoZW4gdXNlciBwcmVzc2VzIGJhY2tzcGFjZSBhZnRlciBmb2N1c2luZyB0aGUgZWRpdG9yIFxuICAgICAgICAgICAgLy8gcHJvcGVydHljaGFuZ2UgaXNuJ3QgY2FsbGVkIGZvciB0aGUgbmV4dCBjaGFyYWN0ZXJcbiAgICAgICAgICAgIGFkZExpc3RlbmVyKHRleHQsIFwia2V5ZG93blwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgc3luY1Byb3BlcnR5LnNjaGVkdWxlKDUwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG9uU2VsZWN0ID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGNvcGllZCkge1xuICAgICAgICAgICAgICAgIGNvcGllZCA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpc0FsbFNlbGVjdGVkKHRleHQpKSB7XG4gICAgICAgICAgICAgICAgZWRpdG9yLnNlbGVjdEFsbCgpO1xuICAgICAgICAgICAgICAgIHJlc2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlucHV0SGFuZGxlcikge1xuICAgICAgICAgICAgICAgIHJlc2V0U2VsZWN0aW9uKGVkaXRvci5zZWxlY3Rpb24uaXNFbXB0eSgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5wdXRIYW5kbGVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5zZXRJbnB1dEhhbmRsZXIgPSBmdW5jdGlvbihjYikgeyBpbnB1dEhhbmRsZXIgPSBjYiB9O1xuICAgICAgICB0aGlzLmdldElucHV0SGFuZGxlciA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gaW5wdXRIYW5kbGVyIH07XG4gICAgICAgIHZhciBhZnRlckNvbnRleHRNZW51ID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIHNlbmRUZXh0ID0gZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgaWYgKGlucHV0SGFuZGxlcikge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBpbnB1dEhhbmRsZXIoZGF0YSk7XG4gICAgICAgICAgICAgICAgaW5wdXRIYW5kbGVyID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwYXN0ZWQpIHtcbiAgICAgICAgICAgICAgICByZXNldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhKVxuICAgICAgICAgICAgICAgICAgICBlZGl0b3Iub25QYXN0ZShkYXRhKTtcbiAgICAgICAgICAgICAgICBwYXN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YSA9PSBQTEFDRUhPTERFUi5jaGFyQXQoMCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWZ0ZXJDb250ZXh0TWVudSlcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmV4ZWNDb21tYW5kKFwiZGVsXCIsIHsgc291cmNlOiBcImFjZVwiIH0pO1xuICAgICAgICAgICAgICAgIGVsc2UgLy8gc29tZSB2ZXJzaW9ucyBvZiBhbmRyb2lkIGRvIG5vdCBmaXJlIGtleWRvd24gd2hlbiBwcmVzc2luZyBiYWNrc3BhY2VcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmV4ZWNDb21tYW5kKFwiYmFja3NwYWNlXCIsIHsgc291cmNlOiBcImFjZVwiIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdWJzdHJpbmcoMCwgMikgPT0gUExBQ0VIT0xERVIpXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLnN1YnN0cigyKTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChkYXRhLmNoYXJBdCgwKSA9PSBQTEFDRUhPTERFUi5jaGFyQXQoMCkpXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLnN1YnN0cigxKTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChkYXRhLmNoYXJBdChkYXRhLmxlbmd0aCAtIDEpID09IFBMQUNFSE9MREVSLmNoYXJBdCgwKSlcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEuc2xpY2UoMCwgLTEpO1xuICAgICAgICAgICAgICAgIC8vIGNhbiBoYXBwZW4gaWYgdW5kbyBpbiB0ZXh0YXJlYSBpc24ndCBzdG9wcGVkXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuY2hhckF0KGRhdGEubGVuZ3RoIC0gMSkgPT0gUExBQ0VIT0xERVIuY2hhckF0KDApKVxuICAgICAgICAgICAgICAgICAgICBkYXRhID0gZGF0YS5zbGljZSgwLCAtMSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLm9uVGV4dElucHV0KGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFmdGVyQ29udGV4dE1lbnUpXG4gICAgICAgICAgICAgICAgYWZ0ZXJDb250ZXh0TWVudSA9IGZhbHNlO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgb25JbnB1dCA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChpbkNvbXBvc2l0aW9uKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHZhciBkYXRhID0gdGV4dC52YWx1ZTtcbiAgICAgICAgICAgIHNlbmRUZXh0KGRhdGEpO1xuICAgICAgICAgICAgcmVzZXRWYWx1ZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBoYW5kbGVDbGlwYm9hcmREYXRhID0gZnVuY3Rpb24oZSwgZGF0YT8pIHtcbiAgICAgICAgICAgIHZhciBjbGlwYm9hcmREYXRhID0gZS5jbGlwYm9hcmREYXRhIHx8IHdpbmRvd1snY2xpcGJvYXJkRGF0YSddO1xuICAgICAgICAgICAgaWYgKCFjbGlwYm9hcmREYXRhIHx8IEJST0tFTl9TRVREQVRBKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIC8vIHVzaW5nIFwiVGV4dFwiIGRvZXNuJ3Qgd29yayBvbiBvbGQgd2Via2l0IGJ1dCBpZSBuZWVkcyBpdFxuICAgICAgICAgICAgLy8gVE9ETyBhcmUgdGhlcmUgb3RoZXIgYnJvd3NlcnMgdGhhdCByZXF1aXJlIFwiVGV4dFwiP1xuICAgICAgICAgICAgdmFyIG1pbWUgPSBVU0VfSUVfTUlNRV9UWVBFID8gXCJUZXh0XCIgOiBcInRleHQvcGxhaW5cIjtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgLy8gU2FmYXJpIDUgaGFzIGNsaXBib2FyZERhdGEgb2JqZWN0LCBidXQgZG9lcyBub3QgaGFuZGxlIHNldERhdGEoKVxuICAgICAgICAgICAgICAgIHJldHVybiBjbGlwYm9hcmREYXRhLnNldERhdGEobWltZSwgZGF0YSkgIT09IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsaXBib2FyZERhdGEuZ2V0RGF0YShtaW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZG9Db3B5ID0gZnVuY3Rpb24oZSwgaXNDdXQpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gZWRpdG9yLmdldENvcHlUZXh0KCk7XG4gICAgICAgICAgICBpZiAoIWRhdGEpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByZXZlbnREZWZhdWx0KGUpO1xuXG4gICAgICAgICAgICBpZiAoaGFuZGxlQ2xpcGJvYXJkRGF0YShlLCBkYXRhKSkge1xuICAgICAgICAgICAgICAgIGlzQ3V0ID8gZWRpdG9yLm9uQ3V0KCkgOiBlZGl0b3Iub25Db3B5KCk7XG4gICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQoZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvcGllZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGV4dC52YWx1ZSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgdGV4dC5zZWxlY3QoKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBjb3BpZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmVzZXRWYWx1ZSgpO1xuICAgICAgICAgICAgICAgICAgICByZXNldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBpc0N1dCA/IGVkaXRvci5vbkN1dCgpIDogZWRpdG9yLm9uQ29weSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBvbkN1dCA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGRvQ29weShlLCB0cnVlKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgb25Db3B5ID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgZG9Db3B5KGUsIGZhbHNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgb25QYXN0ZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gaGFuZGxlQ2xpcGJvYXJkRGF0YShlKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhKVxuICAgICAgICAgICAgICAgICAgICBlZGl0b3Iub25QYXN0ZShkYXRhKTtcbiAgICAgICAgICAgICAgICBpZiAoaXNJRSlcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChyZXNldFNlbGVjdGlvbik7XG4gICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0ZXh0LnZhbHVlID0gXCJcIjtcbiAgICAgICAgICAgICAgICBwYXN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGFkZENvbW1hbmRLZXlMaXN0ZW5lcih0ZXh0LCBlZGl0b3Iub25Db21tYW5kS2V5LmJpbmQoZWRpdG9yKSk7XG5cbiAgICAgICAgYWRkTGlzdGVuZXIodGV4dCwgXCJzZWxlY3RcIiwgb25TZWxlY3QpO1xuXG4gICAgICAgIGFkZExpc3RlbmVyKHRleHQsIFwiaW5wdXRcIiwgb25JbnB1dCk7XG5cbiAgICAgICAgYWRkTGlzdGVuZXIodGV4dCwgXCJjdXRcIiwgb25DdXQpO1xuICAgICAgICBhZGRMaXN0ZW5lcih0ZXh0LCBcImNvcHlcIiwgb25Db3B5KTtcbiAgICAgICAgYWRkTGlzdGVuZXIodGV4dCwgXCJwYXN0ZVwiLCBvblBhc3RlKTtcblxuXG4gICAgICAgIC8vIE9wZXJhIGhhcyBubyBjbGlwYm9hcmQgZXZlbnRzXG4gICAgICAgIGlmICghKCdvbmN1dCcgaW4gdGV4dCkgfHwgISgnb25jb3B5JyBpbiB0ZXh0KSB8fCAhKCdvbnBhc3RlJyBpbiB0ZXh0KSkge1xuICAgICAgICAgICAgYWRkTGlzdGVuZXIoY29udGFpbmVyLCBcImtleWRvd25cIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmICgoaXNNYWMgJiYgIWUubWV0YUtleSkgfHwgIWUuY3RybEtleSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA2NzpcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ29weShlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDg2OlxuICAgICAgICAgICAgICAgICAgICAgICAgb25QYXN0ZShlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDg4OlxuICAgICAgICAgICAgICAgICAgICAgICAgb25DdXQoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy8gQ09NUE9TSVRJT05cbiAgICAgICAgdmFyIG9uQ29tcG9zaXRpb25TdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKGluQ29tcG9zaXRpb24gfHwgIWVkaXRvci5vbkNvbXBvc2l0aW9uU3RhcnQgfHwgZWRpdG9yLiRyZWFkT25seSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgIGluQ29tcG9zaXRpb24gPSB7fTtcbiAgICAgICAgICAgIGVkaXRvci5vbkNvbXBvc2l0aW9uU3RhcnQoKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQob25Db21wb3NpdGlvblVwZGF0ZSwgMCk7XG4gICAgICAgICAgICBlZGl0b3Iub24oXCJtb3VzZWRvd25cIiwgb25Db21wb3NpdGlvbkVuZCk7XG4gICAgICAgICAgICBpZiAoIWVkaXRvci5zZWxlY3Rpb24uaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgZWRpdG9yLmluc2VydChcIlwiLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgZWRpdG9yLmdldFNlc3Npb24oKS5tYXJrVW5kb0dyb3VwKCk7XG4gICAgICAgICAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5jbGVhclNlbGVjdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWRpdG9yLmdldFNlc3Npb24oKS5tYXJrVW5kb0dyb3VwKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIG9uQ29tcG9zaXRpb25VcGRhdGUgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgaWYgKCFpbkNvbXBvc2l0aW9uIHx8ICFlZGl0b3Iub25Db21wb3NpdGlvblVwZGF0ZSB8fCBlZGl0b3IuJHJlYWRPbmx5KVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHZhciB2YWwgPSB0ZXh0LnZhbHVlLnJlcGxhY2UoL1xceDAxL2csIFwiXCIpO1xuICAgICAgICAgICAgaWYgKGluQ29tcG9zaXRpb24ubGFzdFZhbHVlID09PSB2YWwpIHJldHVybjtcblxuICAgICAgICAgICAgZWRpdG9yLm9uQ29tcG9zaXRpb25VcGRhdGUodmFsKTtcbiAgICAgICAgICAgIGlmIChpbkNvbXBvc2l0aW9uLmxhc3RWYWx1ZSlcbiAgICAgICAgICAgICAgICBlZGl0b3IudW5kbygpO1xuICAgICAgICAgICAgaW5Db21wb3NpdGlvbi5sYXN0VmFsdWUgPSB2YWw7XG4gICAgICAgICAgICBpZiAoaW5Db21wb3NpdGlvbi5sYXN0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgciA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0UmFuZ2UoKTtcbiAgICAgICAgICAgICAgICBlZGl0b3IuaW5zZXJ0KGluQ29tcG9zaXRpb24ubGFzdFZhbHVlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgZWRpdG9yLmdldFNlc3Npb24oKS5tYXJrVW5kb0dyb3VwKCk7XG4gICAgICAgICAgICAgICAgaW5Db21wb3NpdGlvbi5yYW5nZSA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0UmFuZ2UoKTtcbiAgICAgICAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFJhbmdlKHIpO1xuICAgICAgICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgb25Db21wb3NpdGlvbkVuZCA9IGZ1bmN0aW9uKGUsIGVkaXRvcjogRWRpdG9yKSB7XG4gICAgICAgICAgICBpZiAoIWVkaXRvci5vbkNvbXBvc2l0aW9uRW5kIHx8IGVkaXRvci4kcmVhZE9ubHkpIHJldHVybjtcblxuICAgICAgICAgICAgdmFyIGMgPSBpbkNvbXBvc2l0aW9uO1xuICAgICAgICAgICAgaW5Db21wb3NpdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aW1lciA9IG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIHN0ciA9IHRleHQudmFsdWUucmVwbGFjZSgvXFx4MDEvZywgXCJcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoaW5Db21wb3NpdGlvbilcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHN0ciA9PSBjLmxhc3RWYWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgcmVzZXRWYWx1ZSgpO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFjLmxhc3RWYWx1ZSAmJiBzdHIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzZXRWYWx1ZSgpO1xuICAgICAgICAgICAgICAgICAgICBzZW5kVGV4dChzdHIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaW5wdXRIYW5kbGVyID0gZnVuY3Rpb24gY29tcG9zaXRpb25JbnB1dEhhbmRsZXIoc3RyOiBzdHJpbmcpIHtcblxuICAgICAgICAgICAgICAgIGlmICh0aW1lcilcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvXFx4MDEvZywgXCJcIik7XG4gICAgICAgICAgICAgICAgaWYgKHN0ciA9PSBjLmxhc3RWYWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgICAgICAgICAgaWYgKGMubGFzdFZhbHVlICYmIHRpbWVyKVxuICAgICAgICAgICAgICAgICAgICBlZGl0b3IudW5kbygpO1xuICAgICAgICAgICAgICAgIHJldHVybiBzdHI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZWRpdG9yLm9uQ29tcG9zaXRpb25FbmQoKTtcbiAgICAgICAgICAgIGVkaXRvci5vZmYoXCJtb3VzZWRvd25cIiwgb25Db21wb3NpdGlvbkVuZCk7XG4gICAgICAgICAgICBpZiAoZS50eXBlID09IFwiY29tcG9zaXRpb25lbmRcIiAmJiBjLnJhbmdlKSB7XG4gICAgICAgICAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5zZXRSYW5nZShjLnJhbmdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuXG5cbiAgICAgICAgdmFyIHN5bmNDb21wb3NpdGlvbiA9IGRlbGF5ZWRDYWxsKG9uQ29tcG9zaXRpb25VcGRhdGUsIDUwKTtcblxuICAgICAgICBhZGRMaXN0ZW5lcih0ZXh0LCBcImNvbXBvc2l0aW9uc3RhcnRcIiwgb25Db21wb3NpdGlvblN0YXJ0KTtcbiAgICAgICAgaWYgKGlzR2Vja28pIHtcbiAgICAgICAgICAgIGFkZExpc3RlbmVyKHRleHQsIFwidGV4dFwiLCBmdW5jdGlvbigpIHsgc3luY0NvbXBvc2l0aW9uLnNjaGVkdWxlKCkgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhZGRMaXN0ZW5lcih0ZXh0LCBcImtleXVwXCIsIGZ1bmN0aW9uKCkgeyBzeW5jQ29tcG9zaXRpb24uc2NoZWR1bGUoKSB9KTtcbiAgICAgICAgICAgIGFkZExpc3RlbmVyKHRleHQsIFwia2V5ZG93blwiLCBmdW5jdGlvbigpIHsgc3luY0NvbXBvc2l0aW9uLnNjaGVkdWxlKCkgfSk7XG4gICAgICAgIH1cbiAgICAgICAgYWRkTGlzdGVuZXIodGV4dCwgXCJjb21wb3NpdGlvbmVuZFwiLCBvbkNvbXBvc2l0aW9uRW5kKTtcblxuICAgICAgICB0aGlzLmdldEVsZW1lbnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB0ZXh0O1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuc2V0UmVhZE9ubHkgPSBmdW5jdGlvbihyZWFkT25seTogYm9vbGVhbikge1xuICAgICAgICAgICAgdGV4dC5yZWFkT25seSA9IHJlYWRPbmx5O1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMub25Db250ZXh0TWVudSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGFmdGVyQ29udGV4dE1lbnUgPSB0cnVlO1xuICAgICAgICAgICAgcmVzZXRTZWxlY3Rpb24oZWRpdG9yLnNlbGVjdGlvbi5pc0VtcHR5KCkpO1xuICAgICAgICAgICAgZWRpdG9yLl9lbWl0KFwibmF0aXZlY29udGV4dG1lbnVcIiwgeyB0YXJnZXQ6IGVkaXRvciwgZG9tRXZlbnQ6IGUgfSk7XG4gICAgICAgICAgICB0aGlzLm1vdmVUb01vdXNlKGUsIHRydWUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMubW92ZVRvTW91c2UgPSBmdW5jdGlvbihlLCBicmluZ1RvRnJvbnQpIHtcbiAgICAgICAgICAgIGlmICghdGVtcFN0eWxlKVxuICAgICAgICAgICAgICAgIHRlbXBTdHlsZSA9IHRleHQuc3R5bGUuY3NzVGV4dDtcbiAgICAgICAgICAgIHRleHQuc3R5bGUuY3NzVGV4dCA9IChicmluZ1RvRnJvbnQgPyBcInotaW5kZXg6MTAwMDAwO1wiIDogXCJcIilcbiAgICAgICAgICAgICAgICArIFwiaGVpZ2h0OlwiICsgdGV4dC5zdHlsZS5oZWlnaHQgKyBcIjtcIlxuICAgICAgICAgICAgICAgICsgKGlzSUUgPyBcIm9wYWNpdHk6MC4xO1wiIDogXCJcIik7XG5cbiAgICAgICAgICAgIHZhciByZWN0ID0gZWRpdG9yLmNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgIHZhciBzdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVkaXRvci5jb250YWluZXIpO1xuICAgICAgICAgICAgdmFyIHRvcCA9IHJlY3QudG9wICsgKHBhcnNlSW50KHN0eWxlLmJvcmRlclRvcFdpZHRoKSB8fCAwKTtcbiAgICAgICAgICAgIHZhciBsZWZ0ID0gcmVjdC5sZWZ0ICsgKHBhcnNlSW50KHN0eWxlLmJvcmRlckxlZnRXaWR0aCkgfHwgMCk7XG4gICAgICAgICAgICB2YXIgbWF4VG9wID0gcmVjdC5ib3R0b20gLSB0b3AgLSB0ZXh0LmNsaWVudEhlaWdodCAtIDI7XG4gICAgICAgICAgICB2YXIgbW92ZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICB0ZXh0LnN0eWxlLmxlZnQgPSBlLmNsaWVudFggLSBsZWZ0IC0gMiArIFwicHhcIjtcbiAgICAgICAgICAgICAgICB0ZXh0LnN0eWxlLnRvcCA9IE1hdGgubWluKGUuY2xpZW50WSAtIHRvcCAtIDIsIG1heFRvcCkgKyBcInB4XCI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgbW92ZShlKTtcblxuICAgICAgICAgICAgaWYgKGUudHlwZSAhPSBcIm1vdXNlZG93blwiKVxuICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgaWYgKGVkaXRvci5yZW5kZXJlci4ka2VlcFRleHRBcmVhQXRDdXJzb3IpXG4gICAgICAgICAgICAgICAgZWRpdG9yLnJlbmRlcmVyLiRrZWVwVGV4dEFyZWFBdEN1cnNvciA9IG51bGw7XG5cbiAgICAgICAgICAgIC8vIG9uIHdpbmRvd3MgY29udGV4dCBtZW51IGlzIG9wZW5lZCBhZnRlciBtb3VzZXVwXG4gICAgICAgICAgICBpZiAoaXNXaW4pXG4gICAgICAgICAgICAgICAgY2FwdHVyZShlZGl0b3IuY29udGFpbmVyLCBtb3ZlLCBvbkNvbnRleHRNZW51Q2xvc2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMub25Db250ZXh0TWVudUNsb3NlID0gb25Db250ZXh0TWVudUNsb3NlO1xuICAgICAgICBmdW5jdGlvbiBvbkNvbnRleHRNZW51Q2xvc2UoKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0ZW1wU3R5bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dC5zdHlsZS5jc3NUZXh0ID0gdGVtcFN0eWxlO1xuICAgICAgICAgICAgICAgICAgICB0ZW1wU3R5bGUgPSAnJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGVkaXRvci5yZW5kZXJlci4ka2VlcFRleHRBcmVhQXRDdXJzb3IgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBlZGl0b3IucmVuZGVyZXIuJGtlZXBUZXh0QXJlYUF0Q3Vyc29yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnJlbmRlcmVyLiRtb3ZlVGV4dEFyZWFUb0N1cnNvcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG9uQ29udGV4dE1lbnUgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBlZGl0b3IudGV4dElucHV0Lm9uQ29udGV4dE1lbnUoZSk7XG4gICAgICAgICAgICBvbkNvbnRleHRNZW51Q2xvc2UoKTtcbiAgICAgICAgfTtcbiAgICAgICAgYWRkTGlzdGVuZXIoZWRpdG9yLnJlbmRlcmVyLnNjcm9sbGVyLCBcImNvbnRleHRtZW51XCIsIG9uQ29udGV4dE1lbnUpO1xuICAgICAgICBhZGRMaXN0ZW5lcih0ZXh0LCBcImNvbnRleHRtZW51XCIsIG9uQ29udGV4dE1lbnUpO1xuICAgIH1cbn1cbiJdfQ==