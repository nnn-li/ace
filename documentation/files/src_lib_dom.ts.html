<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/lib/dom.ts - deuce</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../../assets/logo.png" title="deuce"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.15</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Anchor.html">Anchor</a></li>
                                <li><a href="../classes/BackgroundTokenizer.html">BackgroundTokenizer</a></li>
                                <li><a href="../classes/Editor.html">Editor</a></li>
                                <li><a href="../classes/EditorDocument.html">EditorDocument</a></li>
                                <li><a href="../classes/EditSession.html">EditSession</a></li>
                                <li><a href="../classes/Fold.html">Fold</a></li>
                                <li><a href="../classes/FoldLine.html">FoldLine</a></li>
                                <li><a href="../classes/GutterTooltip.html">GutterTooltip</a></li>
                                <li><a href="../classes/HScrollBar.html">HScrollBar</a></li>
                                <li><a href="../classes/HtmlMode.html">HtmlMode</a></li>
                                <li><a href="../classes/.html"></a></li>
                                <li><a href="../classes/Mode.html">Mode</a></li>
                                <li><a href="../classes/Position.html">Position</a></li>
                                <li><a href="../classes/Range.html">Range</a></li>
                                <li><a href="../classes/ScrollBar.html">ScrollBar</a></li>
                                <li><a href="../classes/Search.html">Search</a></li>
                                <li><a href="../classes/Selection.html">Selection</a></li>
                                <li><a href="../classes/TokenIterator.html">TokenIterator</a></li>
                                <li><a href="../classes/Tokenizer.html">Tokenizer</a></li>
                                <li><a href="../classes/Tooltip.html">Tooltip</a></li>
                                <li><a href="../classes/UndoManager.html">UndoManager</a></li>
                                <li><a href="../classes/VirtualRenderer.html">VirtualRenderer</a></li>
                                <li><a href="../classes/VScrollBar.html">VScrollBar</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/lib/dom.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/* ***** BEGIN LICENSE BLOCK *****
 * Distributed under the BSD license:
 *
 * Copyright (c) 2010, Ajax.org B.V.
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of Ajax.org B.V. nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * ***** END LICENSE BLOCK ***** */

var XHTML_NS = &quot;http://www.w3.org/1999/xhtml&quot;;

export function getDocumentHead(doc: Document = document): HTMLHeadElement {
    return &lt;HTMLHeadElement&gt;(doc.head || doc.getElementsByTagName(&quot;head&quot;)[0] || doc.documentElement);
}

export function getDocumentBody(doc: Document = document): HTMLBodyElement {
    return &lt;HTMLBodyElement&gt;(doc.body || doc.getElementsByTagName(&quot;body&quot;)[0]);
}

export function createElement(tagName: string, namespaceURI?: string): Element {
    return document.createElementNS ?
        document.createElementNS(namespaceURI || XHTML_NS, tagName) :
        document.createElement(tagName);
}

export function hasCssClass(element: HTMLElement, name: string): boolean {
    var classes: string[] = element.className.split(/\s+/g);
    return classes.indexOf(name) !== -1;
}

/**
 * Add a CSS class to the list of classes on the given node
 */
export function addCssClass(element: HTMLElement, name: string): void {
    if (!hasCssClass(element, name)) {
        element.className += &quot; &quot; + name;
    }
}

/**
 * Remove a CSS class from the list of classes on the given node
 */
export function removeCssClass(element: HTMLElement, name: string): void {
    var classes: string[] = element.className.split(/\s+/g);
    while (true) {
        var index = classes.indexOf(name);
        if (index === -1) {
            break;
        }
        classes.splice(index, 1);
    }
    element.className = classes.join(&quot; &quot;);
}

export function toggleCssClass(element: HTMLElement, name: string): boolean {
    var classes = element.className.split(/\s+/g);
    var add = true;
    while (true) {
        var index = classes.indexOf(name);
        if (index == -1) {
            break;
        }
        add = false;
        classes.splice(index, 1);
    }
    if (add)
        classes.push(name);

    element.className = classes.join(&quot; &quot;);
    return add;
}

/*
 * Add or remove a CSS class from the list of classes on the given node
 * depending on the value of &lt;tt&gt;include&lt;/tt&gt;
 */
export function setCssClass(node: HTMLElement, className: string, include: boolean): void {
    if (include) {
        addCssClass(node, className);
    }
    else {
        removeCssClass(node, className);
    }
}

export function hasCssString(id: string, doc: Document = document) {
    var index = 0;
    var sheets = doc.getElementsByTagName(&#x27;style&#x27;);

    if (sheets) {
        while (index &lt; sheets.length) {
            if (sheets[index++].id === id) {
                return true;
            }
        }
    }
    return false;
}

export function importCssString(cssText: string, id?: string, doc: Document = document): void {
    // If style is already imported return immediately.
    if (id &amp;&amp; hasCssString(id, doc)) {
        return;
    }
    else {
        let style = createElement(&#x27;style&#x27;);
        style.appendChild(doc.createTextNode(cssText));
        if (id) {
            style.id = id;
        }
        getDocumentHead(doc).appendChild(style);
    }
}

export function importCssStylsheet(href: string, doc?: Document) {
    var link = &lt;HTMLLinkElement&gt;createElement(&#x27;link&#x27;);
    link.rel = &#x27;stylesheet&#x27;;
    link.href = href;
    getDocumentHead(doc).appendChild(link);
}
/*
export function getInnerWidth(element: HTMLElement): number {
    return (
        parseInt(exports.computedStyle(element, &quot;paddingLeft&quot;), 10) +
        parseInt(exports.computedStyle(element, &quot;paddingRight&quot;), 10) +
        element.clientWidth
    );
}
*/
/*
export function getInnerHeight(element: HTMLElement): number {
    return (
        parseInt(exports.computedStyle(element, &quot;paddingTop&quot;), 10) +
        parseInt(exports.computedStyle(element, &quot;paddingBottom&quot;), 10) +
        element.clientHeight
    );
}
*/
/*
if (window.pageYOffset !== undefined) {
    exports.getPageScrollTop = function() {
        return window.pageYOffset;
    };

    exports.getPageScrollLeft = function() {
        return window.pageXOffset;
    };
}
else {
    exports.getPageScrollTop = function() {
        return document.body.scrollTop;
    };

    exports.getPageScrollLeft = function() {
        return document.body.scrollLeft;
    };
}
*/
// FIXME: I don&#x27;t like this because we lose type safety.
function makeComputedStyle(): (element: HTMLElement, style: string) =&gt; CSSStyleDeclaration {
    if (window.getComputedStyle) {
        // You can also call getPropertyValue!
        return function(element: HTMLElement, style: string): CSSStyleDeclaration {
            return (window.getComputedStyle(element, &quot;&quot;) || {})[style] || &quot;&quot;;
        };
    }
    else {
        return function(element: HTMLElement, style: string): CSSStyleDeclaration {
            if (style) {
                return element[&#x27;currentStyle&#x27;][style];
            }
            return element[&#x27;currentStyle&#x27;];
        };
    }
}

export var computedStyle = makeComputedStyle();
// FIXME
/*
if (window.getComputedStyle)
    exports.computedStyle = function(element, style): any {
        if (style)
            return (window.getComputedStyle(element, &quot;&quot;) || {})[style] || &quot;&quot;;
        return window.getComputedStyle(element, &quot;&quot;) || {};
    };
else
    exports.computedStyle = function(element, style) {
        if (style)
            return element.currentStyle[style];
        return element.currentStyle;
    };
*/
export function scrollbarWidth(document: Document): number {
    var inner: HTMLElement = &lt;HTMLElement&gt;createElement(&quot;ace_inner&quot;);
    inner.style.width = &quot;100%&quot;;
    inner.style.minWidth = &quot;0px&quot;;
    inner.style.height = &quot;200px&quot;;
    inner.style.display = &quot;block&quot;;

    var outer: HTMLElement = &lt;HTMLElement&gt;createElement(&quot;ace_outer&quot;);
    var style = outer.style;

    style.position = &quot;absolute&quot;;
    style.left = &quot;-10000px&quot;;
    style.overflow = &quot;hidden&quot;;
    style.width = &quot;200px&quot;;
    style.minWidth = &quot;0px&quot;;
    style.height = &quot;150px&quot;;
    style.display = &quot;block&quot;;

    outer.appendChild(inner);

    var body = document.documentElement;
    body.appendChild(outer);

    var noScrollbar = inner.offsetWidth;

    style.overflow = &quot;scroll&quot;;
    var withScrollbar = inner.offsetWidth;

    if (noScrollbar === withScrollbar) {
        withScrollbar = outer.clientWidth;
    }

    body.removeChild(outer);

    return noScrollbar - withScrollbar;
}

/*
 * Optimized set innerHTML. This is faster than plain innerHTML if the element
 * already contains a lot of child elements.
 *
 * See http://blog.stevenlevithan.com/archives/faster-than-innerhtml for details
 */
export function setInnerHtml(element: HTMLElement, innerHTML: string) {
    var clonedElement = &lt;HTMLElement&gt;element.cloneNode(false);
    clonedElement.innerHTML = innerHTML;
    element.parentNode.replaceChild(clonedElement, element);
    return clonedElement;
}

function makeGetInnerText(): (el: HTMLElement) =&gt; string {
    if (&quot;textContent&quot; in document.documentElement) {
        return function(el: HTMLElement) {
            return el.textContent;
        };
    }
    else {
        return function(el: HTMLElement) {
            return el.innerText;
        };
    }
}

function makeSetInnerText(): (el: HTMLElement, innerText: string) =&gt; void {
    if (&quot;textContent&quot; in document.documentElement) {
        return function(el: HTMLElement, innerText: string): void {
            el.textContent = innerText;
        };
    }
    else {
        return function(el: HTMLElement, innerText: string) {
            el.innerText = innerText;
        };
    }
}

export var getInnerText: (el: HTMLElement) =&gt; string = makeGetInnerText();
export var setInnerText: (el: HTMLElement, innerText: string) =&gt; void = makeSetInnerText();

export function getParentWindow(document: Document): Window {
    // This is a bit redundant now that parentWindow has been removed.
    return document.defaultView;
}

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
